"""empty message

Revision ID: ef89a02c67e4
Revises: 0005_cleanup_guardrails
Create Date: 2025-11-05 17:40:53.486070

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = 'ef89a02c67e4'
down_revision = '0005_cleanup_guardrails'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('developer_permission', schema=None) as batch_op:
        batch_op.alter_column('is_active',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'))

    with op.batch_alter_table('global_item', schema=None) as batch_op:
        batch_op.drop_column('shelf_life_months')
        batch_op.drop_column('container_volume')
        batch_op.drop_column('container_closure_type')
        batch_op.drop_column('container_volume_unit')
        batch_op.drop_column('default_days_until_expiration')
        batch_op.drop_column('container_dimensions')
        batch_op.drop_column('container_shape')

    with op.batch_alter_table('ingredient_category', schema=None) as batch_op:
        batch_op.add_column(sa.Column('show_shelf_life_days', sa.Boolean(), nullable=True))
        batch_op.drop_column('show_moisture_content_percent')
        batch_op.drop_column('show_flash_point_c')
        batch_op.drop_column('show_melting_point_c')
        batch_op.drop_column('show_shelf_life_months')

    with op.batch_alter_table('inventory_item', schema=None) as batch_op:
        batch_op.drop_column('container_volume')
        batch_op.drop_column('container_closure_type')
        batch_op.drop_column('container_volume_unit')
        batch_op.drop_column('reference_item_type')
        batch_op.drop_column('container_dimensions')
        batch_op.drop_column('container_shape')
        batch_op.drop_column('reference_guide_url')

    with op.batch_alter_table('organization', schema=None) as batch_op:
        batch_op.drop_index('ix_organization_billing_status')
        batch_op.drop_index('ix_organization_stripe_customer_id')
        batch_op.drop_index('ix_organization_subscription_tier_id')

    with op.batch_alter_table('organization_addon', schema=None) as batch_op:
        batch_op.drop_index('ix_organization_addon_addon')
        batch_op.drop_index('ix_organization_addon_org')
        batch_op.create_index(batch_op.f('ix_organization_addon_addon_id'), ['addon_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_organization_addon_organization_id'), ['organization_id'], unique=False)

    with op.batch_alter_table('product', schema=None) as batch_op:
        batch_op.drop_column('category')

    with op.batch_alter_table('role', schema=None) as batch_op:
        batch_op.alter_column('is_active',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'))
        batch_op.alter_column('is_system_role',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'))
        batch_op.create_unique_constraint('unique_role_name_org', ['name', 'organization_id'])

    with op.batch_alter_table('stripe_event', schema=None) as batch_op:
        batch_op.drop_index('ix_stripe_event_event_type')

    with op.batch_alter_table('subscription_tier', schema=None) as batch_op:
        batch_op.drop_index('ix_subscription_tier_billing_provider')
        batch_op.drop_index('ix_subscription_tier_is_customer_facing')
        batch_op.drop_column('allowed_addon_keys')

    with op.batch_alter_table('unit', schema=None) as batch_op:
        batch_op.alter_column('is_active',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'))

    with op.batch_alter_table('user', schema=None) as batch_op:
        batch_op.alter_column('is_deleted',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'))

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('user', schema=None) as batch_op:
        batch_op.alter_column('is_deleted',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'))

    with op.batch_alter_table('unit', schema=None) as batch_op:
        batch_op.alter_column('is_active',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'))

    with op.batch_alter_table('subscription_tier', schema=None) as batch_op:
        batch_op.add_column(sa.Column('allowed_addon_keys', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True))
        batch_op.create_index('ix_subscription_tier_is_customer_facing', ['is_customer_facing'], unique=False)
        batch_op.create_index('ix_subscription_tier_billing_provider', ['billing_provider'], unique=False)

    with op.batch_alter_table('stripe_event', schema=None) as batch_op:
        batch_op.create_index('ix_stripe_event_event_type', ['event_type'], unique=False)

    with op.batch_alter_table('role', schema=None) as batch_op:
        batch_op.drop_constraint('unique_role_name_org', type_='unique')
        batch_op.alter_column('is_system_role',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'))
        batch_op.alter_column('is_active',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'))

    with op.batch_alter_table('product', schema=None) as batch_op:
        batch_op.add_column(sa.Column('category', sa.VARCHAR(length=64), autoincrement=False, nullable=True))

    with op.batch_alter_table('organization_addon', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_organization_addon_organization_id'))
        batch_op.drop_index(batch_op.f('ix_organization_addon_addon_id'))
        batch_op.create_index('ix_organization_addon_org', ['organization_id'], unique=False)
        batch_op.create_index('ix_organization_addon_addon', ['addon_id'], unique=False)

    with op.batch_alter_table('organization', schema=None) as batch_op:
        batch_op.create_index('ix_organization_subscription_tier_id', ['subscription_tier_id'], unique=False)
        batch_op.create_index('ix_organization_stripe_customer_id', ['stripe_customer_id'], unique=False)
        batch_op.create_index('ix_organization_billing_status', ['billing_status'], unique=False)

    with op.batch_alter_table('inventory_item', schema=None) as batch_op:
        batch_op.add_column(sa.Column('reference_guide_url', sa.TEXT(), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_shape', sa.VARCHAR(length=32), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_dimensions', sa.VARCHAR(length=128), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('reference_item_type', sa.VARCHAR(length=64), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_volume_unit', sa.VARCHAR(length=16), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_closure_type', sa.VARCHAR(length=32), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_volume', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True))

    with op.batch_alter_table('ingredient_category', schema=None) as batch_op:
        batch_op.add_column(sa.Column('show_shelf_life_months', sa.BOOLEAN(), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('show_melting_point_c', sa.BOOLEAN(), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('show_flash_point_c', sa.BOOLEAN(), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('show_moisture_content_percent', sa.BOOLEAN(), autoincrement=False, nullable=True))
        batch_op.drop_column('show_shelf_life_days')

    with op.batch_alter_table('global_item', schema=None) as batch_op:
        batch_op.add_column(sa.Column('container_shape', sa.VARCHAR(length=32), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_dimensions', sa.VARCHAR(length=128), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('default_days_until_expiration', sa.INTEGER(), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_volume_unit', sa.VARCHAR(length=16), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_closure_type', sa.VARCHAR(length=32), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('container_volume', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True))
        batch_op.add_column(sa.Column('shelf_life_months', sa.INTEGER(), autoincrement=False, nullable=True))

    with op.batch_alter_table('developer_permission', schema=None) as batch_op:
        batch_op.alter_column('is_active',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'))

    # ### end Alembic commands ###
