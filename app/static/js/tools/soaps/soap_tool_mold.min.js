!function(e){"use strict";const t=e.SoapTool=e.SoapTool||{},{clamp:o,toNumber:n,round:l}=t.helpers,{toGrams:i,fromGrams:a}=t.units;function c(){const e=r(),t=document.getElementById("oilTotalTarget"),o=document.getElementById("oilTargetHint");t&&e.effectiveCapacity>0&&i(t.value)<=0&&(t.value=e.targetOils>0?l(a(e.targetOils),2):""),o&&(e.effectiveCapacity>0?o.textContent="Linked to mold sizing. Edit oil % or total oils target to update the other.":o.textContent="Auto-fills when mold sizing is set.");const n=document.getElementById("moldSuggestionNote");if(n){let t="Target oils are capped to the mold size above.";"cylinder"===e.shape&&e.waterWeight>0&&(t=e.useCylinder?`Cylinder correction applied (${l(100*e.cylinderFactor,0)}% of capacity).`:"Cylinder mold selected. Apply a correction if you want headspace or a smaller fill."),n.textContent=t}d()}function d(e=null){const o=document.getElementById("moldWetBatterWarning");if(!o)return;const i=()=>{o.classList.add("d-none"),o.textContent=""},c=r(),d=t.state||{},s=d.lastCalc||null,u=t.oils?.getTotalOilsGrams?t.oils.getTotalOilsGrams():0,m=n(s?.totalOils);let g=n(e);if((!isFinite(g)||g<=0)&&(g=n(s?.batchYield)),null==e&&m>0&&u>0&&Math.abs(m-u)>.01)return void i();if(!isFinite(g)||g<=0||c.effectiveCapacity<=0)return void i();const f=g-c.effectiveCapacity;if(f<=.01)return void i();const y=d.currentUnit||"g";o.textContent=`Full wet batter is ${l(a(g),2)} ${y}, exceeding mold capacity ${l(a(c.effectiveCapacity),2)} ${y} by ${l(a(f),2)} ${y}. Reduce oils target/% of mold or lower water/additives.`,o.classList.remove("d-none")}function r(){const e=i(document.getElementById("moldWaterWeight").value),t=o(n(document.getElementById("moldOilPct").value),0,100),l=document.getElementById("moldShape")?.value||"loaf",a=!!document.getElementById("moldCylinderCorrection")?.checked,c=o(n(document.getElementById("moldCylinderFactor")?.value),.5,1),d=e>0?e*(a?c:1):0;return{waterWeight:e,oilPct:t,shape:l,useCylinder:a,cylinderFactor:c,effectiveCapacity:d,targetOils:d>0?d*(t/100):0}}t.mold={updateMoldSuggested:c,updateWetBatterWarning:d,syncTargetFromMold:function(){const e=document.getElementById("oilTotalTarget"),t=r();return e?(t.effectiveCapacity>0&&(e.value=t.targetOils>0?l(a(t.targetOils),2):""),c(),t):t},syncMoldPctFromTarget:function(){const e=document.getElementById("oilTotalTarget"),t=document.getElementById("moldOilPct");if(!e||!t){const e=r();return c(),e}const n=r();if(n.effectiveCapacity>0){const c=i(e.value),d=o(c,0,n.effectiveCapacity);c>n.effectiveCapacity+.01&&(e.value=l(a(d),2));const r=d>0?d/n.effectiveCapacity*100:0;t.value=d>0?l(r,2):""}const d=r();return c(),d},getMoldSettings:r,updateMoldShapeUI:function(){const e=document.getElementById("moldShape")?.value||"loaf",t=document.getElementById("moldCylinderOptions");t&&t.classList.toggle("d-none","cylinder"!==e),c()}}}(window);