!function(e){"use strict";const t=e.SoapTool=e.SoapTool||{},a=t.state,o=t.runnerInputs,l=t.runnerQuota,i=t.runnerService,n=t.runnerRender;t.runner={getLyeSelection:(...e)=>o.getLyeSelection(...e),applyLyeSelection:(...e)=>o.applyLyeSelection(...e),setWaterMethod:(...e)=>o.setWaterMethod(...e),updateLiveCalculationPreview:(...e)=>o.updateLiveCalculationPreview(...e),calculateAll:async function(e={}){const r={consumeQuota:!1,showAlerts:!0,...e};try{r.showAlerts&&t.ui.clearSoapAlerts();const e=o.validateCalculation();if(!e.ok)return o.updateStageWaterSummary(null),o.updateLiveCalculationPreview(null),t.mold?.updateWetBatterWarning&&t.mold.updateWetBatterWarning(0),r.showAlerts&&t.ui.showSoapAlert("warning",`<strong>Missing info:</strong><ul class="mb-0">${e.errors.map(e=>`<li>${e}</li>`).join("")}</ul>`,{dismissible:!0,persist:!0}),null;if(r.consumeQuota&&!l.canConsumeCalcQuota())return null;const u=o.readSuperfatInput(),s=o.getLyeSelection(),c=o.sanitizeLyeInputs(),p=(a.calcRequestSeq||0)+1;a.calcRequestSeq=p;const d=i.buildServicePayload({oils:e.oils,selection:s,superfat:u,purity:c.purity,waterMethod:c.waterMethod,waterPct:c.waterPct,lyeConcentration:c.lyeConcentration,waterRatio:c.waterRatio,totalOils:e.totals.totalWeight}),w=await i.calculateWithSoapService(d);if(p!==a.calcRequestSeq)return a.lastCalc;if(!w)return r.showAlerts&&t.ui.showSoapAlert("danger","Soap calculator service is unavailable. Please try again.",{dismissible:!0,timeoutMs:6e3}),null;const S=n.applyServiceResult({serviceResult:w,validation:e,selection:s,superfat:u,purity:c.purity,waterMethod:c.waterMethod,waterPct:c.waterPct,lyeConcentrationInput:c.lyeConcentration,waterRatioInput:c.waterRatio,showAlerts:r.showAlerts});return r.consumeQuota&&l.consumeCalcQuota(),S}catch(e){return r.showAlerts&&t.ui.showSoapAlert("danger","Unable to run the soap calculation right now. Please try again.",{dismissible:!0,timeoutMs:6e3}),null}},buildSoapRecipePayload:(...e)=>t.recipePayload.buildSoapRecipePayload(...e),buildLineRow:(...e)=>t.recipePayload.buildLineRow(...e),addStubLine:(...e)=>t.recipePayload.addStubLine(...e),maybeShowSignupModal:(...e)=>l.maybeShowSignupModal(...e)}}(window);