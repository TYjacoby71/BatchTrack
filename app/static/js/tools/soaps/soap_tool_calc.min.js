(function(window){'use strict';const SoapTool=window.SoapTool=window.SoapTool||{};const{toNumber}=SoapTool.helpers;function computeIodine(oils){let totalWeight=0;let weighted=0;oils.forEach(oil=>{if(oil.iodine>0){totalWeight+=oil.grams;weighted+=oil.iodine*oil.grams;}});return{iodine:totalWeight>0?weighted/totalWeight:0,coverageWeight:totalWeight,};}
function computeFattyAcids(oils){const totals={};let coveredWeight=0;oils.forEach(oil=>{if(!oil.fattyProfile||typeof oil.fattyProfile!=='object'){return;}
coveredWeight+=oil.grams;Object.entries(oil.fattyProfile).forEach(([key,pct])=>{const value=toNumber(pct);if(value>0){totals[key]=(totals[key]||0)+oil.grams*(value/100);}});});const percent={};if(coveredWeight>0){Object.entries(totals).forEach(([key,grams])=>{percent[key]=(grams/coveredWeight)*100;});}
return{percent,coveredWeight};}
function computeQualities(fattyPercent){const get=key=>fattyPercent[key]||0;return{hardness:get('lauric')+get('myristic')+get('palmitic')+get('stearic'),cleansing:get('lauric')+get('myristic'),conditioning:get('oleic')+get('linoleic')+get('linolenic')+get('ricinoleic'),bubbly:get('lauric')+get('myristic')+get('ricinoleic'),creamy:get('palmitic')+get('stearic')+get('ricinoleic'),};}
function computeOilQualityScores(fattyProfile){if(!fattyProfile||typeof fattyProfile!=='object'){return{hardness:0,cleansing:0,conditioning:0,bubbly:0,creamy:0,};}
const profile={lauric:toNumber(fattyProfile.lauric),myristic:toNumber(fattyProfile.myristic),palmitic:toNumber(fattyProfile.palmitic),stearic:toNumber(fattyProfile.stearic),ricinoleic:toNumber(fattyProfile.ricinoleic),oleic:toNumber(fattyProfile.oleic),linoleic:toNumber(fattyProfile.linoleic),linolenic:toNumber(fattyProfile.linolenic),};const qualities=computeQualities(profile);return{hardness:(qualities.hardness||0)/100,cleansing:(qualities.cleansing||0)/100,conditioning:(qualities.conditioning||0)/100,bubbly:(qualities.bubbly||0)/100,creamy:(qualities.creamy||0)/100,};}
SoapTool.calc={computeIodine,computeFattyAcids,computeQualities,computeOilQualityScores,};window.SoapCalcService=SoapTool.calc;})(window);
