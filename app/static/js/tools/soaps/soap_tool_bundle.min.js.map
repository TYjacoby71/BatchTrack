{
  "version": 3,
  "sources": ["../../components/suggestions.js", "../../components/tool_lines.js", "soap_tool_core.js", "soap_tool_constants.js", "soap_tool_calc.js", "soap_tool_units.js", "soap_tool_ui.js", "soap_tool_layout.js", "soap_tool_mold.js", "soap_tool_oils.js", "soap_tool_bulk_oils_shared.js", "soap_tool_bulk_oils_render.js", "soap_tool_bulk_oils_api.js", "soap_tool_bulk_oils_modal.js", "soap_tool_additives.js", "soap_tool_stages.js", "soap_tool_quality.js", "soap_tool_recipe_payload.js", "soap_tool_runner_inputs.js", "soap_tool_runner_quota.js", "soap_tool_runner_service.js", "soap_tool_runner_render.js", "soap_tool_runner.js", "soap_tool_storage.js", "soap_tool_events.js"],
  "sourcesContent": ["// Shared suggestion helper for merged inventory + global item search\n// Updated to support scoped item types, compact rendering, and reusable modules across the app.\n\n(function(window){\n  'use strict';\n\n  const SOURCE_LABELS = {\n    inventory: 'Inventory',\n    global: 'Global Library',\n  };\n\n  const SOURCE_BADGE_CLASS = {\n    inventory: 'bg-primary',\n    global: 'bg-info text-dark',\n  };\n\n  const DEFAULT_OPTIONS = {\n    mode: 'recipe',\n    searchType: 'ingredient',\n    includeInventory: true,\n    includeGlobal: true,\n    ingredientFirst: false,\n    displayVariant: null,\n    showSourceBadge: true,\n    globalUrlBuilder: null,\n    resultFilter: null,\n  };\n\n  function debounce(fn, wait){\n    let timeout;\n    return function(){\n      const args = arguments;\n      clearTimeout(timeout);\n      timeout = setTimeout(() => fn.apply(null, args), wait);\n    };\n  }\n\n  function normalizedName(value){\n    return (value || '').trim().toLowerCase();\n  }\n\n  function ensureListContainer(listEl){\n    if (listEl) return listEl;\n    const div = document.createElement('div');\n    div.className = 'list-group position-absolute w-100 d-none inventory-suggestions';\n    div.style.zIndex = '1050';\n    div.style.maxHeight = '300px';\n    div.style.overflowY = 'auto';\n    return div;\n  }\n\n  function resolveOption(value){\n    return typeof value === 'function' ? value() : value;\n  }\n\n  function buildGlobalIdSet(items){\n    const set = new Set();\n    (items || []).forEach(item => {\n      const gid = item && (item.global_item_id || item.id);\n      if (gid) set.add(String(gid));\n    });\n    return set;\n  }\n\n  function createSourceBadge(source){\n    if (!source) return '';\n    const label = SOURCE_LABELS[source] || source;\n    const badgeClass = SOURCE_BADGE_CLASS[source] || 'bg-secondary';\n    return `<span class=\"badge ${badgeClass} ms-2\">${label}</span>`;\n  }\n\n  function renderFlatList(listEl, groups, onPick, opts){\n    opts = opts || {};\n    listEl.innerHTML = '';\n    let hasAny = false;\n    groups.forEach(group => {\n      if (!group.items || !group.items.length) return;\n      hasAny = true;\n      group.items.forEach(item => {\n        const entry = document.createElement('a');\n        entry.href = '#';\n        entry.className = 'list-group-item list-group-item-action suggestion-item';\n        const subtitle = opts.showSubtitle && item.subtitle\n          ? `<div class=\"small text-muted mt-1\">${item.subtitle}</div>`\n          : '';\n        entry.innerHTML = `<div class=\"d-flex justify-content-between align-items-center gap-2\">\n          <span class=\"fw-semibold text-truncate\">${item.text || item.display_name || item.name || ''}</span>\n          ${opts.showSourceBadge ? createSourceBadge(group.source || item.source) : ''}\n        </div>${subtitle}`;\n        entry.addEventListener('click', function(e){\n          e.preventDefault();\n          onPick(item, group.source || item.source);\n          listEl.classList.add('d-none');\n        });\n        listEl.appendChild(entry);\n      });\n    });\n    listEl.classList.toggle('d-none', !hasAny);\n    if (!hasAny && listEl.dataset.emptyMessage) {\n      const empty = document.createElement('div');\n      empty.className = 'list-group-item text-muted small';\n      empty.textContent = listEl.dataset.emptyMessage;\n      listEl.appendChild(empty);\n      listEl.classList.remove('d-none');\n    }\n  }\n\n  function renderIngredientFirst(listEl, groups, onPick){\n    listEl.innerHTML = '';\n    let hasAny = false;\n\n    groups.forEach(group => {\n      if (!group.ingredients || !group.ingredients.length) return;\n      hasAny = true;\n      const header = document.createElement('div');\n      header.className = 'list-group-item text-muted small fw-semibold';\n      header.textContent = group.title;\n      listEl.appendChild(header);\n\n      group.ingredients.forEach(ingredient => {\n        const itemEl = document.createElement('div');\n        itemEl.className = 'list-group-item ingredient-result';\n\n        const summary = document.createElement('div');\n        summary.className = 'd-flex justify-content-between align-items-center ingredient-summary';\n        summary.setAttribute('role', 'button');\n        summary.setAttribute('tabindex', '0');\n        summary.innerHTML = `<span class=\"fw-semibold\">${ingredient.name || 'Ingredient'}</span>\n          <span class=\"badge bg-light text-dark\">${ingredient.forms.length} option${ingredient.forms.length === 1 ? '' : 's'}</span>`;\n\n        const formsContainer = document.createElement('div');\n        formsContainer.className = 'ingredient-form-options d-none mt-2 ps-3 border-start border-2';\n        ingredient.forms.forEach(form => {\n          const btn = document.createElement('button');\n          btn.type = 'button';\n          btn.className = 'btn btn-sm btn-outline-primary w-100 text-start mb-2 ingredient-form-option suggestion-item';\n          btn.innerHTML = `<div class=\"fw-semibold\">${form.text || form.display_name || form.name || 'Form'}</div>`;\n          btn.addEventListener('click', function(){\n            onPick(form, form.source || group.source);\n            listEl.classList.add('d-none');\n          });\n          formsContainer.appendChild(btn);\n        });\n\n        function toggleForms(e){\n          if (e.type === 'keydown' && e.key !== 'Enter' && e.key !== ' ') return;\n          e.preventDefault();\n          formsContainer.classList.toggle('d-none');\n        }\n\n        summary.addEventListener('click', toggleForms);\n        summary.addEventListener('keydown', toggleForms);\n\n        itemEl.appendChild(summary);\n        itemEl.appendChild(formsContainer);\n        listEl.appendChild(itemEl);\n\n        if (ingredient.forms.length === 1){\n          formsContainer.classList.remove('d-none');\n        }\n      });\n    });\n\n    listEl.classList.toggle('d-none', !hasAny);\n  }\n\n  function renderDefinitionResults(listEl, items, onPick){\n    listEl.innerHTML = '';\n    let hasAny = false;\n    (items || []).forEach(item => {\n      hasAny = true;\n      const entry = document.createElement('a');\n      entry.href = '#';\n      entry.className = 'list-group-item list-group-item-action suggestion-item';\n      const meta = item.inci_name ? `<div class=\"small text-muted\">${item.inci_name}</div>` : '';\n      entry.innerHTML = `<div class=\"fw-semibold\">${item.text || item.name}</div>${meta}`;\n      entry.addEventListener('click', function(e){\n        e.preventDefault();\n        onPick(item, 'definition');\n        listEl.classList.add('d-none');\n      });\n      listEl.appendChild(entry);\n    });\n    listEl.classList.toggle('d-none', !hasAny);\n    if (!hasAny && listEl.dataset.emptyMessage) {\n      const empty = document.createElement('div');\n      empty.className = 'list-group-item text-muted small';\n      empty.textContent = listEl.dataset.emptyMessage;\n      listEl.appendChild(empty);\n      listEl.classList.remove('d-none');\n    }\n  }\n\n  function expandGlobalItems(items){\n    const expanded = [];\n    (items || []).forEach(item => {\n      if (item && Array.isArray(item.forms) && item.forms.length){\n        const baseIngredientName = (item.ingredient && item.ingredient.name) || item.ingredient_name || null;\n        const categoryName = (item.ingredient && item.ingredient.ingredient_category_name)\n          || item.ingredient_category_name\n          || (item.ingredient_category && item.ingredient_category.name)\n          || null;\n        const categoryTags = item.category_tags || [];\n        item.forms.forEach(form => {\n          const physical = form.physical_form || {};\n          const display = form.display_name || form.text || form.name || (baseIngredientName && form.physical_form_name ? `${baseIngredientName}, ${form.physical_form_name}` : (item.display_name || item.text || item.name || ''));\n          expanded.push({\n            id: form.id,\n            text: display,\n            item_type: form.item_type || item.item_type,\n            default_unit: form.default_unit || form.unit || item.default_unit || item.unit || null,\n            source: 'global',\n            global_item_id: form.id,\n            ingredient_id: form.ingredient_id || (item.ingredient && item.ingredient.id) || item.ingredient_id || null,\n            ingredient_name: form.ingredient_name || baseIngredientName,\n            physical_form_id: form.physical_form_id || (physical && physical.id) || null,\n            physical_form_name: form.physical_form_name || (physical && physical.name) || null,\n            ingredient_category_name: categoryName,\n            category_tags: categoryTags,\n            density: form.density || item.density || null,\n            capacity: form.capacity || item.capacity || null,\n            capacity_unit: form.capacity_unit || item.capacity_unit || null,\n            container_material: form.container_material || item.container_material || null,\n            container_type: form.container_type || item.container_type || null,\n            container_style: form.container_style || item.container_style || null,\n            container_color: form.container_color || item.container_color || null,\n            default_is_perishable: form.default_is_perishable ?? item.default_is_perishable,\n            recommended_shelf_life_days: form.recommended_shelf_life_days ?? item.recommended_shelf_life_days,\n            saponification_value: form.saponification_value ?? item.saponification_value ?? null,\n            iodine_value: form.iodine_value ?? item.iodine_value ?? null,\n            fatty_acid_profile: form.fatty_acid_profile ?? item.fatty_acid_profile ?? null,\n            melting_point_c: form.melting_point_c ?? item.melting_point_c ?? null,\n          });\n        });\n      } else if (item) {\n        const displayName = item.display_name || item.text || item.name || '';\n        const categoryName = (item.ingredient && item.ingredient.ingredient_category_name)\n          || item.ingredient_category_name\n          || (item.ingredient_category && item.ingredient_category.name)\n          || null;\n        expanded.push({\n          id: item.id,\n          text: displayName,\n          source: 'global',\n          item_type: item.item_type,\n          global_item_id: item.id,\n          ingredient_name: (item.ingredient && item.ingredient.name) || item.ingredient_name || item.name,\n          ingredient_category_name: categoryName,\n          category_tags: item.category_tags || [],\n          physical_form_name: (item.physical_form && item.physical_form.name) || item.physical_form_name || null,\n          default_unit: item.default_unit || item.unit || null,\n          density: item.density || null,\n          capacity: item.capacity || null,\n          capacity_unit: item.capacity_unit || null,\n          container_material: item.container_material || null,\n          container_type: item.container_type || null,\n          container_style: item.container_style || null,\n          container_color: item.container_color || null,\n          default_is_perishable: item.default_is_perishable,\n          recommended_shelf_life_days: item.recommended_shelf_life_days,\n          saponification_value: item.saponification_value || null,\n          iodine_value: item.iodine_value || null,\n          fatty_acid_profile: item.fatty_acid_profile || null,\n          melting_point_c: item.melting_point_c || null,\n        });\n      }\n    });\n    return expanded;\n  }\n\n  function groupInventoryByIngredient(items){\n    const map = new Map();\n    (items || []).forEach(item => {\n      const baseName = item.ingredient_name || item.text || item.name || '';\n      const key = item.ingredient_id ? `id:${item.ingredient_id}` : `name:${normalizedName(baseName)}`;\n      const entry = map.get(key) || {\n        ingredient_id: item.ingredient_id || null,\n        name: baseName,\n        forms: [],\n      };\n      entry.forms.push({\n        id: item.id,\n        text: item.text || baseName,\n        ingredient_name: baseName,\n        physical_form_name: item.physical_form_name || null,\n        default_unit: item.default_unit || item.unit || null,\n        source: 'inventory',\n        global_item_id: item.global_item_id || null,\n      });\n      map.set(key, entry);\n    });\n    return Array.from(map.values());\n  }\n\n  function groupGlobalByIngredient(rawGroups, dedupeIds){\n    const groups = [];\n    (rawGroups || []).forEach(group => {\n      const forms = (group.forms || []).map(form => ({\n        id: form.id,\n        text: form.name || form.display_name || form.text,\n        ingredient_name: form.ingredient_name || group.name || (group.ingredient && group.ingredient.name) || 'Ingredient',\n        physical_form_name: form.physical_form_name || null,\n        default_unit: form.default_unit || form.unit || null,\n        source: 'global',\n        global_item_id: form.id,\n        density: form.density || null,\n        capacity: form.capacity || null,\n        capacity_unit: form.capacity_unit || null,\n        container_material: form.container_material || null,\n        container_type: form.container_type || null,\n        container_style: form.container_style || null,\n        container_color: form.container_color || null,\n        saponification_value: form.saponification_value || null,\n        iodine_value: form.iodine_value || null,\n        fatty_acid_profile: form.fatty_acid_profile || null,\n        melting_point_c: form.melting_point_c || null,\n      }));\n      const filteredForms = dedupeIds\n        ? forms.filter(form => !form.global_item_id || !dedupeIds.has(String(form.global_item_id)))\n        : forms;\n      if (filteredForms.length){\n        groups.push({\n          ingredient_id: group.ingredient_id || group.id || null,\n          name: group.name || (group.ingredient && group.ingredient.name) || (forms[0] && forms[0].ingredient_name) || 'Ingredient',\n          forms: filteredForms,\n        });\n      }\n    });\n    return groups;\n  }\n\n  function fetchIngredientDefinitions(q){\n    const params = new URLSearchParams({ q });\n    return fetch(`/api/ingredients/definitions/search?${params.toString()}`)\n      .then(r => r.json())\n      .catch(() => ({ results: [] }));\n  }\n\n  function attachMergedInventoryGlobalTypeahead(options){\n    const opts = { ...DEFAULT_OPTIONS, ...options };\n    const inputEl = opts.inputEl;\n    const invHiddenEl = opts.invHiddenEl;\n    const giHiddenEl = opts.giHiddenEl;\n    const listEl = ensureListContainer(opts.listEl);\n    const mode = opts.mode || 'recipe';\n    const searchTypeOption = opts.searchType || 'ingredient';\n    const includeInventoryOption = opts.includeInventory;\n    const includeGlobalOption = opts.includeGlobal;\n    const ingredientFirstOption = opts.ingredientFirst;\n    const displayVariant = opts.displayVariant;\n    const resultFilter = typeof opts.resultFilter === 'function' ? opts.resultFilter : null;\n    const onSelection = typeof opts.onSelection === 'function' ? opts.onSelection : null;\n    const globalUrlBuilder = opts.globalUrlBuilder;\n\n    if (!inputEl || (!invHiddenEl && mode === 'recipe') || (!giHiddenEl && opts.requireHidden !== false)) return;\n\n    if (listEl && !listEl.classList.contains('list-group')) {\n      listEl.classList.add('list-group');\n    }\n    if (!listEl.parentNode && inputEl.parentNode) {\n      inputEl.parentNode.appendChild(listEl);\n    }\n\n    function buildInventoryUrl(q, effectiveSearchType){\n      const params = new URLSearchParams({ q });\n      if (effectiveSearchType && effectiveSearchType !== 'all') params.set('type', effectiveSearchType);\n      return `/inventory/api/search?${params.toString()}`;\n    }\n\n    function buildGlobalUrl(q, effectiveSearchType, useIngredientFirst){\n      if (typeof globalUrlBuilder === 'function') {\n        return globalUrlBuilder(q, effectiveSearchType, useIngredientFirst);\n      }\n      const params = new URLSearchParams({ q });\n      if (effectiveSearchType && effectiveSearchType !== 'all') params.set('type', effectiveSearchType);\n      if (effectiveSearchType === 'ingredient' && useIngredientFirst) params.set('group', 'ingredient');\n      const base = mode === 'public' ? '/api/public/global-items/search' : '/api/ingredients/global-items/search';\n      return `${base}?${params.toString()}`;\n    }\n\n    const doSearch = debounce(function(){\n      const q = (inputEl.value || '').trim();\n      if (!q){\n        listEl.classList.add('d-none');\n        listEl.innerHTML = '';\n        if (invHiddenEl) invHiddenEl.value = '';\n        if (giHiddenEl) giHiddenEl.value = '';\n        return;\n      }\n\n      const effectiveSearchType = (resolveOption(searchTypeOption) || 'ingredient').toLowerCase();\n      const includeInventory = resolveOption(includeInventoryOption);\n      const includeGlobal = resolveOption(includeGlobalOption);\n      const ingredientFirst = effectiveSearchType === 'ingredient' && !!resolveOption(ingredientFirstOption);\n      const variant = displayVariant || (ingredientFirst ? 'grouped' : 'compact');\n\n      if (effectiveSearchType === 'ingredient_definition' || effectiveSearchType === 'definition') {\n        fetchIngredientDefinitions(q).then(results => {\n          const items = (results && results.results) || [];\n          renderDefinitionResults(listEl, items.map(item => ({\n            id: item.id,\n            text: item.name,\n            name: item.name,\n            inci_name: item.inci_name,\n            slug: item.slug,\n            ingredient_category_id: item.ingredient_category_id,\n            ingredient_category_name: item.ingredient_category_name,\n          })), handleSelection);\n        }).catch(() => listEl.classList.add('d-none'));\n        return;\n      }\n\n      const inventoryPromise = includeInventory !== false\n        ? fetch(buildInventoryUrl(q, effectiveSearchType)).then(r => r.json()).catch(() => ({ results: [] }))\n        : Promise.resolve({ results: [] });\n      const globalPromise = includeGlobal !== false\n        ? fetch(buildGlobalUrl(q, effectiveSearchType, ingredientFirst)).then(r => r.json()).catch(() => ({ results: [] }))\n        : Promise.resolve({ results: [] });\n\n      Promise.all([inventoryPromise, globalPromise]).then(results => {\n        const inventoryRaw = (results[0] && results[0].results) || [];\n        const globalRaw = (results[1] && results[1].results) || [];\n        const inventory = resultFilter\n          ? inventoryRaw.filter(item => resultFilter(item, 'inventory'))\n          : inventoryRaw;\n        const filteredGlobalRaw = resultFilter\n          ? globalRaw.filter(item => resultFilter(item, 'global'))\n          : globalRaw;\n        const seenGlobalIds = buildGlobalIdSet(inventory);\n        const globalExpanded = expandGlobalItems(filteredGlobalRaw)\n          .filter(item => !item.global_item_id || !seenGlobalIds.has(String(item.global_item_id)))\n          .filter(item => (resultFilter ? resultFilter(item, 'global') : true));\n\n        if (ingredientFirst) {\n          const inventoryGroups = groupInventoryByIngredient(inventory);\n          const globalGroups = groupGlobalByIngredient(filteredGlobalRaw, seenGlobalIds);\n          const ingredientGroups = [];\n          if (inventoryGroups.length) {\n            ingredientGroups.push({ title: 'Your Inventory', source: 'inventory', ingredients: inventoryGroups });\n          }\n          if (globalGroups.length) {\n            ingredientGroups.push({ title: 'Global Library', source: 'global', ingredients: globalGroups });\n          }\n          renderIngredientFirst(listEl, ingredientGroups, handleSelection);\n          return;\n        }\n\n        const mergedGroups = [];\n        if (inventory.length) {\n          mergedGroups.push({ title: 'Your Inventory', source: 'inventory', items: inventory });\n        }\n        if (globalExpanded.length) {\n          mergedGroups.push({ title: 'Global Library', source: 'global', items: globalExpanded });\n        }\n        renderFlatList(listEl, mergedGroups, handleSelection, {\n          showSourceBadge: opts.showSourceBadge !== false,\n          showSubtitle: variant === 'detailed'\n        });\n      }).catch(() => {\n        listEl.classList.add('d-none');\n      });\n    }, 200);\n\n    function handleSelection(picked, source){\n      inputEl.value = picked.text || picked.display_name || picked.name || '';\n      if (source === 'inventory') {\n        if (invHiddenEl) invHiddenEl.value = picked.id_numeric || picked.id || '';\n        if (giHiddenEl) giHiddenEl.value = picked.global_item_id || '';\n      } else {\n        if (giHiddenEl) giHiddenEl.value = picked.global_item_id || picked.id || '';\n        if (invHiddenEl) invHiddenEl.value = '';\n      }\n      if (typeof onSelection === 'function') {\n        onSelection(picked, source);\n      }\n    }\n\n    inputEl.addEventListener('input', function(){\n      if (invHiddenEl) invHiddenEl.value = '';\n      if (giHiddenEl) giHiddenEl.value = '';\n      doSearch();\n    });\n\n    document.addEventListener('click', function(e){\n      if (!listEl.contains(e.target) && !inputEl.contains(e.target)) {\n        listEl.classList.add('d-none');\n      }\n    });\n  }\n\n  window.attachMergedInventoryGlobalTypeahead = attachMergedInventoryGlobalTypeahead;\n  window.renderInventoryTypeaheadList = renderFlatList;\n})(window);\n", "(function(window){\n  'use strict';\n\n  function buildToolLineRow(kind, options){\n    var context = (options && options.context) || 'public';\n    var unitOptionsHtml = (options && options.unitOptionsHtml) || '';\n    var mode = (options && options.mode) || (context === 'public' ? 'public' : 'recipe');\n\n    var row = document.createElement('div');\n    row.className = 'row g-2 align-items-end mb-2';\n    row.innerHTML = [\n      '<div class=\"col-md-6\">',\n      '  <label class=\"form-label\">', (kind === 'container' ? 'Container' : (kind === 'consumable' ? 'Consumable' : 'Ingredient')), '</label>',\n      '  <div class=\"position-relative\">',\n      '    <input type=\"text\" class=\"form-control tool-typeahead\" placeholder=\"Search global...\" autocomplete=\"off\">',\n      '    <input type=\"hidden\" class=\"tool-gi-id\">',\n      '    <div class=\"list-group position-absolute w-100 d-none\" data-role=\"suggestions\"></div>',\n      '  </div>',\n      '</div>',\n      '<div class=\"col-md-3 ', (kind==='container'?'d-none':''), '\">',\n      '  <label class=\"form-label\">Quantity</label>',\n      '  <input type=\"number\" step=\"0.01\" min=\"0\" class=\"form-control tool-qty\">',\n      '</div>',\n      '<div class=\"col-md-3 ', (kind==='container'?'d-none':''), '\">',\n      '  <label class=\"form-label\">Unit</label>',\n      '  <select class=\"form-select tool-unit\">',\n           unitOptionsHtml,\n      '  </select>',\n      '</div>',\n      '<div class=\"col-md-3 ', (kind!=='container'?'d-none':''), '\">',\n      '  <label class=\"form-label\">Count</label>',\n      '  <input type=\"number\" min=\"1\" step=\"1\" class=\"form-control tool-qty\">',\n      '</div>',\n      '<div class=\"col-md-2 d-grid\">',\n      '  <button type=\"button\" class=\"btn btn-outline-danger tool-remove\">Remove</button>',\n      '</div>'\n    ].join('');\n\n    var input = row.querySelector('.tool-typeahead');\n    var giHidden = row.querySelector('.tool-gi-id');\n    var list = row.querySelector('[data-role=\"suggestions\"]');\n\n    if (typeof window.attachMergedInventoryGlobalTypeahead === 'function'){\n      const searchType = kind === 'container' ? 'container' : (kind === 'consumable' ? 'consumable' : 'ingredient');\n      const includeInventory = context !== 'public';\n      window.attachMergedInventoryGlobalTypeahead({\n        inputEl: input,\n        giHiddenEl: giHidden,\n        listEl: list,\n        mode: mode,\n        context: context,\n        ingredientFirst: kind === 'ingredient',\n        searchType,\n        includeInventory,\n        includeGlobal: true\n      });\n    }\n    row.querySelector('.tool-remove').addEventListener('click', function(){ row.remove(); });\n    return row;\n  }\n\n  window.buildToolLineRow = buildToolLineRow;\n\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n\n  SoapTool.config = {\n    unitOptionsHtml: (window.soapToolConfig && window.soapToolConfig.unitOptionsHtml) || '',\n    calcLimit: Number.isFinite(window.SOAP_CALC_LIMIT) ? window.SOAP_CALC_LIMIT : null,\n    calcTier: window.SOAP_CALC_TIER || 'guest',\n    useCsvPrimary: !!(window.soapToolConfig && window.soapToolConfig.useCsvPrimary),\n    isAuthenticated: window.__IS_AUTHENTICATED__ === true,\n  };\n\n  SoapTool.state = {\n    lastCalc: null,\n    calcRequestSeq: 0,\n    lastOilEdit: null,\n    lastFragranceEdit: null,\n    selectedOilProfile: null,\n    wasCapped: false,\n    lastPreviewRow: null,\n    lastRemovedOil: null,\n    lastRemovedOilIndex: null,\n    lastSaveToastAt: 0,\n    lastRecipePayload: null,\n    totalOilsGrams: 0,\n    currentUnit: 'g',\n  };\n\n  SoapTool.helpers = {\n    round,\n    toNumber,\n    clamp,\n    formatTime,\n    getStorage,\n    buildSoapcalcSearchBuilder,\n  };\n\n  function round(value, decimals = 3){\n    if (!isFinite(value)) return 0;\n    const factor = Math.pow(10, decimals);\n    return Math.round(value * factor) / factor;\n  }\n\n  function toNumber(value){\n    let cleaned = value;\n    if (typeof cleaned === 'string') {\n      cleaned = cleaned.replace(/,/g, '').trim();\n    }\n    const num = parseFloat(cleaned);\n    return isFinite(num) ? num : 0;\n  }\n\n  function clamp(value, min, max){\n    if (!isFinite(value)) return min;\n    if (value < min) return min;\n    if (max !== undefined && max !== null && value > max) return max;\n    return value;\n  }\n\n  function formatTime(ts){\n    if (!ts) return 'Not saved yet';\n    const date = new Date(ts);\n    return `Saved ${date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}`;\n  }\n\n  function getStorage(){\n    try {\n      return window.localStorage;\n    } catch (_) {\n      return null;\n    }\n  }\n\n  function buildSoapcalcSearchBuilder(){\n    const buildGilUrl = (q, effectiveSearchType, useIngredientFirst) => {\n      const params = new URLSearchParams({ q });\n      if (effectiveSearchType && effectiveSearchType !== 'all') params.set('type', effectiveSearchType);\n      if (effectiveSearchType === 'ingredient' && useIngredientFirst) params.set('group', 'ingredient');\n      return `/api/public/global-items/search?${params.toString()}`;\n    };\n    const buildCsvUrl = (q, _searchType, useIngredientFirst) => {\n      const params = new URLSearchParams({ q });\n      if (useIngredientFirst) params.set('group', 'ingredient');\n      return `/api/public/soapcalc-items/search?${params.toString()}`;\n    };\n    return SoapTool.config.useCsvPrimary === true ? buildCsvUrl : buildGilUrl;\n  }\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n\n  const QUALITY_RANGES = {\n    hardness: [29, 54],\n    cleansing: [12, 22],\n    conditioning: [44, 69],\n    bubbly: [14, 46],\n    creamy: [16, 48],\n  };\n\n  const QUALITY_HINTS = {\n    hardness: 'Durable bar that resists mush.',\n    cleansing: 'Higher values feel more stripping.',\n    conditioning: 'Silky, moisturizing feel.',\n    bubbly: 'Fluffy lather and big bubbles.',\n    creamy: 'Stable, creamy lather.',\n  };\n\n  const QUALITY_FEEL_HINTS = {\n    hardness: {\n      low: 'Soft bar, slower unmold.',\n      ok: 'Balanced hardness for daily use.',\n      high: 'Very hard bar, can feel brittle.',\n    },\n    cleansing: {\n      low: 'Very mild cleansing.',\n      ok: 'Balanced cleansing.',\n      high: 'Strong cleansing, can be drying.',\n    },\n    conditioning: {\n      low: 'Less conditioning feel.',\n      ok: 'Smooth and conditioning.',\n      high: 'Very conditioning, may feel oily.',\n    },\n    bubbly: {\n      low: 'Low bubbly lather.',\n      ok: 'Balanced bubbly lather.',\n      high: 'Very bubbly, big foam.',\n    },\n    creamy: {\n      low: 'Light creamy lather.',\n      ok: 'Creamy and stable.',\n      high: 'Dense creamy lather.',\n    },\n  };\n\n  const IODINE_RANGE = [41, 70];\n  const IODINE_SCALE_MAX = 100;\n  const INS_RANGE = [136, 170];\n  const INS_SCALE_MAX = 250;\n\n  const QUALITY_BASE = {\n    hardness: (QUALITY_RANGES.hardness[0] + QUALITY_RANGES.hardness[1]) / 2,\n    cleansing: (QUALITY_RANGES.cleansing[0] + QUALITY_RANGES.cleansing[1]) / 2,\n    conditioning: (QUALITY_RANGES.conditioning[0] + QUALITY_RANGES.conditioning[1]) / 2,\n    bubbly: (QUALITY_RANGES.bubbly[0] + QUALITY_RANGES.bubbly[1]) / 2,\n    creamy: (QUALITY_RANGES.creamy[0] + QUALITY_RANGES.creamy[1]) / 2,\n  };\n\n  const QUALITY_PRESETS = {\n    balanced: {\n      hardness: 40,\n      cleansing: 15,\n      conditioning: 55,\n      bubbly: 25,\n      creamy: 25,\n      iodine: 55,\n      ins: 160,\n    },\n    bubbly: {\n      hardness: 35,\n      cleansing: 20,\n      conditioning: 50,\n      bubbly: 35,\n      creamy: 25,\n      iodine: 60,\n      ins: 150,\n    },\n    creamy: {\n      hardness: 45,\n      cleansing: 12,\n      conditioning: 60,\n      bubbly: 20,\n      creamy: 35,\n      iodine: 50,\n      ins: 155,\n    },\n    hard: {\n      hardness: 50,\n      cleansing: 18,\n      conditioning: 48,\n      bubbly: 22,\n      creamy: 28,\n      iodine: 45,\n      ins: 165,\n    },\n    gentle: {\n      hardness: 35,\n      cleansing: 10,\n      conditioning: 65,\n      bubbly: 15,\n      creamy: 20,\n      iodine: 65,\n      ins: 140,\n    },\n    castile: {\n      hardness: 20,\n      cleansing: 5,\n      conditioning: 75,\n      bubbly: 10,\n      creamy: 15,\n      iodine: 80,\n      ins: 110,\n    },\n    shampoo: {\n      hardness: 30,\n      cleansing: 22,\n      conditioning: 50,\n      bubbly: 30,\n      creamy: 25,\n      iodine: 60,\n      ins: 145,\n    },\n    utility: {\n      hardness: 70,\n      cleansing: 50,\n      conditioning: 20,\n      bubbly: 50,\n      creamy: 20,\n      iodine: 10,\n      ins: 250,\n    },\n    luxury: {\n      hardness: 55,\n      cleansing: 10,\n      conditioning: 55,\n      bubbly: 15,\n      creamy: 40,\n      iodine: 50,\n      ins: 150,\n    },\n    palmFree: {\n      hardness: 42,\n      cleansing: 16,\n      conditioning: 58,\n      bubbly: 22,\n      creamy: 28,\n      iodine: 55,\n      ins: 155,\n    },\n  };\n\n  const FATTY_BAR_COLORS = {\n    lauric: 'var(--color-primary)',\n    myristic: 'var(--color-info)',\n    palmitic: 'var(--color-warning)',\n    stearic: 'var(--color-muted)',\n    ricinoleic: 'var(--color-info-hover)',\n    oleic: 'var(--color-success)',\n    linoleic: 'var(--color-primary-hover)',\n    linolenic: 'var(--color-danger)',\n  };\n\n  const FATTY_DISPLAY_KEYS = [\n    'lauric',\n    'myristic',\n    'palmitic',\n    'stearic',\n    'ricinoleic',\n    'oleic',\n    'linoleic',\n    'linolenic',\n  ];\n\n  const OIL_TIP_RULES = [\n    { match: /coconut|palm kernel|babassu|murumuru/i, tip: 'High lauric oils trace fast and feel cleansing; keep superfat >= 5%.' },\n    { match: /olive|avocado|rice bran|canola|sunflower|safflower|almond|apricot|macadamia|camellia|grapeseed|hazelnut/i, tip: 'High-oleic liquid oils trace slowly and stay softer early on; allow a longer cure.' },\n    { match: /castor/i, tip: 'Castor boosts lather but can feel sticky above 10-15%.' },\n    { match: /cocoa|shea|mango|kokum|sal|illipe|tallow|lard|palm|stearic/i, tip: 'Hard fats/butters set up quickly; melt fully and keep batter warm for a smooth pour.' },\n    { match: /beeswax|candelilla|carnauba|wax/i, tip: 'Waxes harden fast and can seize; keep usage low and add hot.' },\n    { match: /hemp|flax|linseed|evening primrose|borage|rosehip|black currant|chia|pomegranate/i, tip: 'High-PUFA oils shorten shelf life; keep low and add antioxidant.' },\n  ];\n\n  const UNIT_FACTORS = { g: 1, oz: 28.3495, lb: 453.592 };\n\n  const STAGE_CONFIGS = [\n    { id: 1, tabId: 'soapStage1Tab', paneId: 'soapStage1Pane', required: true },\n    { id: 2, tabId: 'soapStage2Tab', paneId: 'soapStage2Pane', required: true },\n    { id: 3, tabId: 'soapStage3Tab', paneId: 'soapStage3Pane', required: true },\n    { id: 4, tabId: 'soapStage4Tab', paneId: 'soapStage4Pane', required: false },\n    { id: 5, tabId: 'soapStage5Tab', paneId: 'soapStage5Pane', required: false },\n  ];\n\n  const OIL_CATEGORY_SET = new Set(['Oils (Carrier & Fixed)', 'Butters & Solid Fats', 'Waxes']);\n  const FRAGRANCE_CATEGORY_SET = new Set(['Essential Oils', 'Fragrance Oils']);\n  const LACTATE_CATEGORY_SET = new Set(['Aqueous Solutions & Blends', 'Preservatives & Additives']);\n  const SUGAR_CATEGORY_SET = new Set(['Sugars & Syrups']);\n  const SALT_CATEGORY_SET = new Set(['Salts & Minerals']);\n  const CITRIC_CATEGORY_SET = new Set(['Preservatives & Additives', 'Salts & Minerals', 'Aqueous Solutions & Blends']);\n\n  SoapTool.constants = {\n    QUALITY_RANGES,\n    QUALITY_HINTS,\n    QUALITY_FEEL_HINTS,\n    IODINE_RANGE,\n    IODINE_SCALE_MAX,\n    INS_RANGE,\n    INS_SCALE_MAX,\n    QUALITY_BASE,\n    QUALITY_PRESETS,\n    FATTY_BAR_COLORS,\n    FATTY_DISPLAY_KEYS,\n    OIL_TIP_RULES,\n    UNIT_FACTORS,\n    STAGE_CONFIGS,\n    OIL_CATEGORY_SET,\n    FRAGRANCE_CATEGORY_SET,\n    LACTATE_CATEGORY_SET,\n    SUGAR_CATEGORY_SET,\n    SALT_CATEGORY_SET,\n    CITRIC_CATEGORY_SET,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { toNumber } = SoapTool.helpers;\n\n  function computeIodine(oils){\n    let totalWeight = 0;\n    let weighted = 0;\n    oils.forEach(oil => {\n      if (oil.iodine > 0) {\n        totalWeight += oil.grams;\n        weighted += oil.iodine * oil.grams;\n      }\n    });\n    return {\n      iodine: totalWeight > 0 ? weighted / totalWeight : 0,\n      coverageWeight: totalWeight,\n    };\n  }\n\n  function computeFattyAcids(oils){\n    const totals = {};\n    let coveredWeight = 0;\n    oils.forEach(oil => {\n      if (!oil.fattyProfile || typeof oil.fattyProfile !== 'object') {\n        return;\n      }\n      coveredWeight += oil.grams;\n      Object.entries(oil.fattyProfile).forEach(([key, pct]) => {\n        const value = toNumber(pct);\n        if (value > 0) {\n          totals[key] = (totals[key] || 0) + oil.grams * (value / 100);\n        }\n      });\n    });\n    const percent = {};\n    if (coveredWeight > 0) {\n      Object.entries(totals).forEach(([key, grams]) => {\n        percent[key] = (grams / coveredWeight) * 100;\n      });\n    }\n    return { percent, coveredWeight };\n  }\n\n  function computeQualities(fattyPercent){\n    const get = key => fattyPercent[key] || 0;\n    return {\n      hardness: get('lauric') + get('myristic') + get('palmitic') + get('stearic'),\n      cleansing: get('lauric') + get('myristic'),\n      conditioning: get('oleic') + get('linoleic') + get('linolenic') + get('ricinoleic'),\n      bubbly: get('lauric') + get('myristic') + get('ricinoleic'),\n      creamy: get('palmitic') + get('stearic') + get('ricinoleic'),\n    };\n  }\n\n  function computeOilQualityScores(fattyProfile){\n    if (!fattyProfile || typeof fattyProfile !== 'object') {\n      return {\n        hardness: 0,\n        cleansing: 0,\n        conditioning: 0,\n        bubbly: 0,\n        creamy: 0,\n      };\n    }\n    const profile = {\n      lauric: toNumber(fattyProfile.lauric),\n      myristic: toNumber(fattyProfile.myristic),\n      palmitic: toNumber(fattyProfile.palmitic),\n      stearic: toNumber(fattyProfile.stearic),\n      ricinoleic: toNumber(fattyProfile.ricinoleic),\n      oleic: toNumber(fattyProfile.oleic),\n      linoleic: toNumber(fattyProfile.linoleic),\n      linolenic: toNumber(fattyProfile.linolenic),\n    };\n    const qualities = computeQualities(profile);\n    return {\n      hardness: (qualities.hardness || 0) / 100,\n      cleansing: (qualities.cleansing || 0) / 100,\n      conditioning: (qualities.conditioning || 0) / 100,\n      bubbly: (qualities.bubbly || 0) / 100,\n      creamy: (qualities.creamy || 0) / 100,\n    };\n  }\n\n  SoapTool.calc = {\n    computeIodine,\n    computeFattyAcids,\n    computeQualities,\n    computeOilQualityScores,\n  };\n\n  window.SoapCalcService = SoapTool.calc;\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { round, toNumber, clamp } = SoapTool.helpers;\n  const { UNIT_FACTORS } = SoapTool.constants;\n  const state = SoapTool.state;\n\n  function toGrams(value){\n    return clamp(toNumber(value), 0) * (UNIT_FACTORS[state.currentUnit] || 1);\n  }\n\n  function fromGrams(value){\n    const grams = clamp(value, 0);\n    return grams / (UNIT_FACTORS[state.currentUnit] || 1);\n  }\n\n  function formatWeight(value){\n    if (!isFinite(value) || value <= 0) return '--';\n    return `${round(fromGrams(value), 2)} ${state.currentUnit}`;\n  }\n\n  function formatPercent(value){\n    if (!isFinite(value)) return '--';\n    return `${round(value, 1)}%`;\n  }\n\n  function updateUnitLabels(){\n    document.querySelectorAll('.unit-label').forEach(el => {\n      el.textContent = state.currentUnit;\n    });\n    document.querySelectorAll('.unit-suffix').forEach(el => {\n      el.dataset.suffix = state.currentUnit;\n    });\n  }\n\n  function setUnit(unit, options = {}){\n    if (!unit) return;\n    if (unit === state.currentUnit) {\n      updateUnitLabels();\n      return;\n    }\n    const prevUnit = state.currentUnit;\n    state.currentUnit = unit;\n    updateUnitLabels();\n    if (options.skipConvert) return;\n    const ratio = (UNIT_FACTORS[prevUnit] || 1) / (UNIT_FACTORS[unit] || 1);\n    document.querySelectorAll('.oil-grams').forEach(input => {\n      const value = toNumber(input.value);\n      if (value > 0) input.value = round(value * ratio, 2);\n    });\n    document.querySelectorAll('.fragrance-grams').forEach(input => {\n      const value = toNumber(input.value);\n      if (value > 0) input.value = round(value * ratio, 2);\n    });\n    const oilTarget = document.getElementById('oilTotalTarget');\n    if (oilTarget && oilTarget.value) {\n      const value = toNumber(oilTarget.value);\n      if (value > 0) oilTarget.value = round(value * ratio, 2);\n    }\n    const moldWater = document.getElementById('moldWaterWeight');\n    if (moldWater && moldWater.value) {\n      const value = toNumber(moldWater.value);\n      if (value > 0) moldWater.value = round(value * ratio, 2);\n    }\n    SoapTool.oils.updateOilTotals();\n    SoapTool.mold.updateMoldSuggested();\n    SoapTool.additives.updateAdditivesOutput(SoapTool.oils.getTotalOilsGrams());\n    if (SoapTool.bulkOilsModal && typeof SoapTool.bulkOilsModal.onUnitChanged === 'function') {\n      SoapTool.bulkOilsModal.onUnitChanged();\n    }\n    if (!options.skipAutoCalc) {\n      SoapTool.runner.calculateAll({ consumeQuota: false, showAlerts: false });\n    }\n  }\n\n  SoapTool.units = {\n    toGrams,\n    fromGrams,\n    formatWeight,\n    formatPercent,\n    updateUnitLabels,\n    setUnit,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const state = SoapTool.state;\n\n  const ALERT_ICONS = {\n    info: 'fa-info-circle',\n    warning: 'fa-exclamation-triangle',\n    danger: 'fa-times-circle',\n    success: 'fa-check-circle'\n  };\n\n  function pulseValue(el){\n    if (!el) return;\n    el.classList.remove('soap-number-pulse');\n    void el.offsetWidth;\n    el.classList.add('soap-number-pulse');\n  }\n\n  function getToastInstance(id){\n    const el = document.getElementById(id);\n    if (!el || !window.bootstrap?.Toast) return null;\n    return bootstrap.Toast.getOrCreateInstance(el);\n  }\n\n  function showAutosaveToast(){\n    const now = Date.now();\n    if (now - state.lastSaveToastAt < 3500) return;\n    state.lastSaveToastAt = now;\n    const toast = getToastInstance('soapAutosaveToast');\n    if (toast) toast.show();\n  }\n\n  function showUndoToast(message){\n    const toastEl = document.getElementById('soapUndoToast');\n    if (!toastEl) return;\n    const body = toastEl.querySelector('.toast-body');\n    if (body) body.textContent = message || 'Oil removed.';\n    const toast = getToastInstance('soapUndoToast');\n    if (toast) toast.show();\n  }\n\n  function updateResultsMeta(){\n    const badge = document.getElementById('resultsReadyBadge');\n    const updatedAt = document.getElementById('resultsUpdatedAt');\n    if (badge) badge.classList.remove('d-none');\n    if (updatedAt) {\n      updatedAt.textContent = `Updated ${new Date().toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}`;\n    }\n  }\n\n  function updateResultsWarnings(waterData){\n    const concentrationEl = document.getElementById('lyeConcentrationWarning');\n    const ratioEl = document.getElementById('waterRatioWarning');\n    if (concentrationEl) {\n      const concentration = waterData?.lyeConcentration || 0;\n      let message = '';\n      if (concentration > 40) message = 'High concentration';\n      if (concentration > 0 && concentration < 25) message = 'Low concentration';\n      concentrationEl.textContent = message;\n      concentrationEl.classList.toggle('d-none', !message);\n    }\n    if (ratioEl) {\n      const ratio = waterData?.waterRatio || 0;\n      let message = '';\n      if (ratio > 0 && ratio < 1.8) message = 'Low water';\n      if (ratio > 2.7) message = 'High water';\n      ratioEl.textContent = message;\n      ratioEl.classList.toggle('d-none', !message);\n    }\n  }\n\n  function applyHelperVisibility(){\n    document.querySelectorAll('#soapToolPage .form-text').forEach(text => {\n      const wrapper = text.closest('.col-md-2, .col-md-3, .col-md-4, .col-md-6, .col-md-8, .col-lg-6, .col-lg-4, .col-12');\n      if (wrapper) wrapper.classList.add('soap-field');\n    });\n  }\n\n  function validateNumericField(input){\n    if (!input || input.type !== 'number') return;\n    const raw = input.value;\n    if (raw === '') {\n      input.classList.remove('is-invalid');\n      return;\n    }\n    const value = parseFloat(raw);\n    const min = input.getAttribute('min');\n    const max = input.getAttribute('max');\n    const tooLow = min !== null && min !== '' && value < parseFloat(min);\n    const tooHigh = max !== null && max !== '' && value > parseFloat(max);\n    input.classList.toggle('is-invalid', !isFinite(value) || tooLow || tooHigh);\n  }\n\n  function flashStage(stageItem){\n    if (!stageItem) return;\n    const target = stageItem.querySelector?.('.soap-stage-card') || stageItem;\n    target.classList.add('soap-stage-highlight');\n    setTimeout(() => target.classList.remove('soap-stage-highlight'), 900);\n  }\n\n  function showSoapAlert(type, message, options = {}){\n    const alertStack = document.getElementById('soapAlertStack');\n    if (!alertStack) return;\n    const icon = ALERT_ICONS[type] || ALERT_ICONS.info;\n    const alert = document.createElement('div');\n    alert.className = `alert alert-${type} d-flex align-items-start gap-2`;\n    alert.innerHTML = `\n      <i class=\"fas ${icon} mt-1\"></i>\n      <div class=\"flex-grow-1\">${message}</div>\n      ${options.dismissible ? '<button type=\"button\" class=\"btn-close\" data-role=\"dismiss\"></button>' : ''}\n    `;\n    if (options.dismissible) {\n      alert.querySelector('[data-role=\"dismiss\"]')?.addEventListener('click', () => alert.remove());\n    }\n    alertStack.prepend(alert);\n    if (!options.persist) {\n      setTimeout(() => {\n        if (alert.parentNode) alert.remove();\n      }, options.timeoutMs || 4500);\n    }\n  }\n\n  function clearSoapAlerts(){\n    const alertStack = document.getElementById('soapAlertStack');\n    if (!alertStack) return;\n    alertStack.querySelectorAll('.alert').forEach(el => el.remove());\n  }\n\n  SoapTool.ui = {\n    pulseValue,\n    getToastInstance,\n    showAutosaveToast,\n    showUndoToast,\n    updateResultsMeta,\n    updateResultsWarnings,\n    applyHelperVisibility,\n    validateNumericField,\n    flashStage,\n    showSoapAlert,\n    clearSoapAlerts,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n\n  function syncStageHeight(){\n    const stagePane = document.getElementById('soapStagePane');\n    const qualityCard = document.getElementById('soapQualityCard');\n    if (!stagePane || !qualityCard) return;\n    const shouldSync = window.matchMedia('(min-width: 768px)').matches;\n    if (!shouldSync) {\n      stagePane.classList.remove('is-height-synced');\n      stagePane.style.removeProperty('--soap-stage-height');\n      return;\n    }\n    const qualityHeight = qualityCard.offsetHeight;\n    if (!qualityHeight) {\n      stagePane.classList.remove('is-height-synced');\n      stagePane.style.removeProperty('--soap-stage-height');\n      return;\n    }\n    stagePane.style.setProperty('--soap-stage-height', `${qualityHeight}px`);\n    stagePane.classList.add('is-height-synced');\n  }\n\n  const scheduleStageHeightSync = () => {\n    window.requestAnimationFrame(syncStageHeight);\n  };\n\n  SoapTool.layout = {\n    syncStageHeight,\n    scheduleStageHeightSync,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { clamp, toNumber, round } = SoapTool.helpers;\n  const { toGrams, fromGrams } = SoapTool.units;\n\n  function updateMoldSuggested(){\n    const settings = getMoldSettings();\n    const targetInput = document.getElementById('oilTotalTarget');\n    const targetHint = document.getElementById('oilTargetHint');\n    if (targetInput && settings.effectiveCapacity > 0 && toGrams(targetInput.value) <= 0) {\n      targetInput.value = settings.targetOils > 0 ? round(fromGrams(settings.targetOils), 2) : '';\n    }\n    if (targetHint) {\n      if (settings.effectiveCapacity > 0) {\n        targetHint.textContent = 'Linked to mold sizing. Edit oil % or total oils target to update the other.';\n      } else {\n        targetHint.textContent = 'Auto-fills when mold sizing is set.';\n      }\n    }\n    const note = document.getElementById('moldSuggestionNote');\n    if (note) {\n      let message = 'Target oils are capped to the mold size above.';\n      if (settings.shape === 'cylinder' && settings.waterWeight > 0) {\n        if (settings.useCylinder) {\n          message = `Cylinder correction applied (${round(settings.cylinderFactor * 100, 0)}% of capacity).`;\n        } else {\n          message = 'Cylinder mold selected. Apply a correction if you want headspace or a smaller fill.';\n        }\n      }\n      note.textContent = message;\n    }\n    updateWetBatterWarning();\n  }\n\n  function updateWetBatterWarning(batchYieldG = null){\n    const warning = document.getElementById('moldWetBatterWarning');\n    if (!warning) return;\n\n    const hide = () => {\n      warning.classList.add('d-none');\n      warning.textContent = '';\n    };\n\n    const settings = getMoldSettings();\n    const state = SoapTool.state || {};\n    const lastCalc = state.lastCalc || null;\n    const currentTotalOils = SoapTool.oils?.getTotalOilsGrams ? SoapTool.oils.getTotalOilsGrams() : 0;\n    const calcTotalOils = toNumber(lastCalc?.totalOils);\n    let batchYield = toNumber(batchYieldG);\n    if (!isFinite(batchYield) || batchYield <= 0) {\n      batchYield = toNumber(lastCalc?.batchYield);\n    }\n\n    // Avoid stale warnings while stage inputs have changed but a fresh calc is pending.\n    if (\n      (batchYieldG === null || batchYieldG === undefined)\n      && calcTotalOils > 0\n      && currentTotalOils > 0\n      && Math.abs(calcTotalOils - currentTotalOils) > 0.01\n    ) {\n      hide();\n      return;\n    }\n\n    if (!isFinite(batchYield) || batchYield <= 0 || settings.effectiveCapacity <= 0) {\n      hide();\n      return;\n    }\n\n    const overBy = batchYield - settings.effectiveCapacity;\n    if (overBy <= 0.01) {\n      hide();\n      return;\n    }\n\n    const unit = state.currentUnit || 'g';\n    warning.textContent = `Full wet batter is ${round(fromGrams(batchYield), 2)} ${unit}, exceeding mold capacity ${round(fromGrams(settings.effectiveCapacity), 2)} ${unit} by ${round(fromGrams(overBy), 2)} ${unit}. Reduce oils target/% of mold or lower water/additives.`;\n    warning.classList.remove('d-none');\n  }\n\n  function syncTargetFromMold(){\n    const targetInput = document.getElementById('oilTotalTarget');\n    const settings = getMoldSettings();\n    if (!targetInput) return settings;\n    if (settings.effectiveCapacity > 0) {\n      targetInput.value = settings.targetOils > 0 ? round(fromGrams(settings.targetOils), 2) : '';\n    }\n    updateMoldSuggested();\n    return settings;\n  }\n\n  function syncMoldPctFromTarget(){\n    const targetInput = document.getElementById('oilTotalTarget');\n    const moldOilPct = document.getElementById('moldOilPct');\n    if (!targetInput || !moldOilPct) {\n      const settings = getMoldSettings();\n      updateMoldSuggested();\n      return settings;\n    }\n    const settings = getMoldSettings();\n    if (settings.effectiveCapacity > 0) {\n      const target = toGrams(targetInput.value);\n      const cappedTarget = clamp(target, 0, settings.effectiveCapacity);\n      if (target > settings.effectiveCapacity + 0.01) {\n        targetInput.value = round(fromGrams(cappedTarget), 2);\n      }\n      const nextPct = cappedTarget > 0 ? (cappedTarget / settings.effectiveCapacity) * 100 : 0;\n      moldOilPct.value = cappedTarget > 0 ? round(nextPct, 2) : '';\n    }\n    const nextSettings = getMoldSettings();\n    updateMoldSuggested();\n    return nextSettings;\n  }\n\n  function getMoldSettings(){\n    const waterWeight = toGrams(document.getElementById('moldWaterWeight').value);\n    const oilPct = clamp(toNumber(document.getElementById('moldOilPct').value), 0, 100);\n    const shape = document.getElementById('moldShape')?.value || 'loaf';\n    const useCylinder = !!document.getElementById('moldCylinderCorrection')?.checked;\n    const cylinderFactor = clamp(toNumber(document.getElementById('moldCylinderFactor')?.value), 0.5, 1);\n    const effectiveCapacity = waterWeight > 0 ? waterWeight * (useCylinder ? cylinderFactor : 1) : 0;\n    const targetOils = effectiveCapacity > 0 ? effectiveCapacity * (oilPct / 100) : 0;\n    return {\n      waterWeight,\n      oilPct,\n      shape,\n      useCylinder,\n      cylinderFactor,\n      effectiveCapacity,\n      targetOils,\n    };\n  }\n\n  function updateMoldShapeUI(){\n    const shape = document.getElementById('moldShape')?.value || 'loaf';\n    const options = document.getElementById('moldCylinderOptions');\n    if (options) {\n      options.classList.toggle('d-none', shape !== 'cylinder');\n    }\n    updateMoldSuggested();\n  }\n\n  SoapTool.mold = {\n    updateMoldSuggested,\n    updateWetBatterWarning,\n    syncTargetFromMold,\n    syncMoldPctFromTarget,\n    getMoldSettings,\n    updateMoldShapeUI,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { round, toNumber, clamp, buildSoapcalcSearchBuilder } = SoapTool.helpers;\n  const { toGrams, fromGrams } = SoapTool.units;\n  const { OIL_CATEGORY_SET, OIL_TIP_RULES } = SoapTool.constants;\n  const { computeQualities } = SoapTool.calc;\n  const state = SoapTool.state;\n\n  function attachOilTypeahead(row){\n    const input = row.querySelector('.oil-typeahead');\n    const hiddenSap = row.querySelector('.oil-sap-koh');\n    const hiddenIodine = row.querySelector('.oil-iodine');\n    const hiddenFatty = row.querySelector('.oil-fatty');\n    const hiddenGi = row.querySelector('.oil-gi-id');\n    const hiddenUnit = row.querySelector('.oil-default-unit');\n    const hiddenCategory = row.querySelector('.oil-category');\n    const list = row.querySelector('[data-role=\"suggestions\"]');\n    if (!input || !list || typeof window.attachMergedInventoryGlobalTypeahead !== 'function') {\n      return;\n    }\n    const builder = buildSoapcalcSearchBuilder();\n    window.attachMergedInventoryGlobalTypeahead({\n      inputEl: input,\n      listEl: list,\n      mode: 'public',\n      giHiddenEl: hiddenGi,\n      includeInventory: false,\n      includeGlobal: true,\n      ingredientFirst: true,\n      globalUrlBuilder: builder,\n      searchType: 'ingredient',\n      resultFilter: (item, source) => matchesCategory(item, OIL_CATEGORY_SET, source),\n      requireHidden: false,\n      onSelection: function(picked){\n        if (hiddenSap) {\n          hiddenSap.value = picked?.saponification_value || '';\n        }\n        if (hiddenIodine) {\n          hiddenIodine.value = picked?.iodine_value || '';\n        }\n        if (hiddenFatty) {\n          hiddenFatty.value = picked?.fatty_acid_profile ? JSON.stringify(picked.fatty_acid_profile) : '';\n        }\n        if (hiddenUnit) {\n          hiddenUnit.value = picked?.default_unit || '';\n        }\n        if (hiddenCategory) {\n          hiddenCategory.value = picked?.ingredient_category_name || '';\n        }\n        setSelectedOilProfile(picked);\n        updateOilTotals();\n        SoapTool.storage.queueStateSave();\n        SoapTool.storage.queueAutoCalc();\n      }\n    });\n    input.addEventListener('input', function(){\n      if (!this.value.trim()) {\n        if (hiddenSap) hiddenSap.value = '';\n        if (hiddenIodine) hiddenIodine.value = '';\n        if (hiddenFatty) hiddenFatty.value = '';\n        if (hiddenGi) hiddenGi.value = '';\n        if (hiddenUnit) hiddenUnit.value = '';\n        if (hiddenCategory) hiddenCategory.value = '';\n        clearSelectedOilProfile();\n      }\n    });\n  }\n\n  function buildOilRow(){\n    const template = document.getElementById('oilRowTemplate');\n    const row = template?.content?.querySelector('.oil-row')?.cloneNode(true);\n    if (!row) {\n      return document.createElement('div');\n    }\n    row.querySelectorAll('input').forEach(input => {\n      input.value = '';\n    });\n    row.querySelectorAll('.form-text').forEach(text => {\n      const wrapper = text.closest('.soap-field-stack, [class*=\"col-\"]');\n      if (wrapper) wrapper.classList.add('soap-field');\n    });\n    attachOilTypeahead(row);\n    row.querySelectorAll('.unit-suffix').forEach(el => {\n      el.dataset.suffix = state.currentUnit;\n    });\n    return row;\n  }\n\n  function getOilTargetGrams(){\n    const targetInput = document.getElementById('oilTotalTarget');\n    const manualTarget = toGrams(targetInput?.value);\n    if (manualTarget > 0) return manualTarget;\n    const mold = SoapTool.mold.getMoldSettings();\n    if (mold.targetOils > 0) return mold.targetOils;\n    return 0;\n  }\n\n  function deriveTargetFromRows(rows){\n    const derived = [];\n    rows.forEach(row => {\n      const grams = toGrams(row.querySelector('.oil-grams')?.value);\n      const pct = clamp(toNumber(row.querySelector('.oil-percent')?.value), 0);\n      if (grams > 0 && pct > 0) {\n        derived.push(grams / (pct / 100));\n      }\n    });\n    if (!derived.length) return 0;\n    const sum = derived.reduce((acc, value) => acc + value, 0);\n    return sum / derived.length;\n  }\n\n  function getRowLimits(row, target){\n    if (!row || !target || target <= 0) {\n      return { allowedGrams: null, allowedPct: null };\n    }\n    const rows = Array.from(document.querySelectorAll('#oilRows .oil-row'));\n    const otherTotal = rows.reduce((acc, current) => {\n      if (current === row) return acc;\n      return acc + toGrams(current.querySelector('.oil-grams')?.value);\n    }, 0);\n    const otherPct = rows.reduce((acc, current) => {\n      if (current === row) return acc;\n      return acc + clamp(toNumber(current.querySelector('.oil-percent')?.value), 0);\n    }, 0);\n    const allowedPct = Math.max(0, 100 - otherPct);\n    const allowedByTotal = Math.max(0, target - otherTotal);\n    const allowedByPct = (target * allowedPct) / 100;\n    const allowedGrams = Math.max(0, Math.min(allowedByTotal, allowedByPct));\n    return { allowedGrams, allowedPct };\n  }\n\n  function setOilHint(row, field, message){\n    if (!row) return;\n    const hint = row.querySelector(`[data-role=\"oil-${field}-hint\"]`);\n    if (!hint) return;\n    if (message) {\n      hint.textContent = message;\n      hint.classList.add('is-visible');\n    } else {\n      hint.textContent = '';\n      hint.classList.remove('is-visible');\n    }\n  }\n\n  function bounceInput(input){\n    if (!input) return;\n    input.classList.remove('oil-input-bounce');\n    void input.offsetWidth;\n    input.classList.add('oil-input-bounce');\n  }\n\n  function validateOilEntry(row, field, options = {}){\n    const target = getOilTargetGrams();\n    if (!row || !target || target <= 0) {\n      setOilHint(row, field, '');\n      return;\n    }\n    const gramsInput = row.querySelector('.oil-grams');\n    const pctInput = row.querySelector('.oil-percent');\n    const limits = getRowLimits(row, target);\n    if (field === 'grams' && gramsInput) {\n      const grams = toGrams(gramsInput.value);\n      let message = '';\n      if (grams > target + 0.01) {\n        message = 'Entry exceeds the max oils allowed in stage 2.';\n      } else if (limits.allowedGrams !== null && grams > limits.allowedGrams + 0.01) {\n        message = `Must be under ${round(fromGrams(limits.allowedGrams), 2)} ${state.currentUnit} to stay within the stage 2 oil limit.`;\n      }\n      if (message) {\n        const nextValue = limits.allowedGrams !== null ? round(fromGrams(limits.allowedGrams), 2) : round(fromGrams(target), 2);\n        gramsInput.value = nextValue > 0 ? nextValue : '';\n        setOilHint(row, field, message);\n        gramsInput.classList.add('oil-input-warning');\n        bounceInput(gramsInput);\n        updateOilTotals();\n      } else {\n        gramsInput.classList.remove('oil-input-warning');\n        setOilHint(row, field, '');\n      }\n    }\n    if (field === 'percent' && pctInput) {\n      const pct = clamp(toNumber(pctInput.value), 0);\n      let message = '';\n      if (pct > 100.01) {\n        message = 'Entry exceeds the max oils allowed in stage 2.';\n      } else if (limits.allowedPct !== null && pct > limits.allowedPct + 0.01) {\n        message = `Must be under ${round(limits.allowedPct, 2)}% to stay within the stage 2 oil limit.`;\n      }\n      if (message) {\n        const nextPct = limits.allowedPct !== null ? round(limits.allowedPct, 2) : 100;\n        pctInput.value = nextPct > 0 ? nextPct : '';\n        setOilHint(row, field, message);\n        pctInput.classList.add('oil-input-warning');\n        bounceInput(pctInput);\n        updateOilTotals();\n      } else {\n        pctInput.classList.remove('oil-input-warning');\n        setOilHint(row, field, '');\n      }\n    }\n  }\n\n  function scaleOilsToTarget(target, options = {}){\n    const rows = Array.from(document.querySelectorAll('#oilRows .oil-row'));\n    const nextTarget = target ?? getOilTargetGrams();\n    const force = !!options.force;\n    if (!nextTarget || nextTarget <= 0 || !rows.length) {\n      state.lastOilTarget = nextTarget;\n      return;\n    }\n    const totalPct = rows.reduce((sum, row) => sum + clamp(toNumber(row.querySelector('.oil-percent')?.value), 0), 0);\n    const totalWeight = rows.reduce((sum, row) => sum + toGrams(row.querySelector('.oil-grams')?.value), 0);\n    if (totalPct <= 0 && totalWeight <= 0) {\n      state.lastOilTarget = nextTarget;\n      return;\n    }\n    if (!force && state.lastOilTarget && Math.abs(state.lastOilTarget - nextTarget) < 0.01) {\n      return;\n    }\n    if (totalPct > 0) {\n      rows.forEach(row => {\n        const pctInput = row.querySelector('.oil-percent');\n        const gramsInput = row.querySelector('.oil-grams');\n        const pct = clamp(toNumber(pctInput?.value), 0);\n        const share = totalPct > 0 ? (pct / totalPct) : 0;\n        if (gramsInput) {\n          gramsInput.value = share > 0 ? round(fromGrams(nextTarget * share), 2) : '';\n        }\n        if (pctInput) {\n          pctInput.value = share > 0 ? round(share * 100, 2) : '';\n        }\n      });\n    } else if (totalWeight > 0) {\n      const ratio = nextTarget / totalWeight;\n      rows.forEach(row => {\n        const gramsInput = row.querySelector('.oil-grams');\n        const pctInput = row.querySelector('.oil-percent');\n        const grams = toGrams(gramsInput?.value);\n        if (gramsInput) {\n          const nextGrams = grams > 0 ? grams * ratio : 0;\n          gramsInput.value = nextGrams > 0 ? round(fromGrams(nextGrams), 2) : '';\n        }\n        if (pctInput) {\n          const nextGrams = toGrams(gramsInput?.value);\n          pctInput.value = nextGrams > 0 ? round((nextGrams / nextTarget) * 100, 2) : '';\n        }\n      });\n    }\n    state.lastOilTarget = nextTarget;\n    updateOilTotals({ skipEnforce: true });\n  }\n\n  function enforceOilTargetCap(rows, target){\n    if (!state.lastOilEdit || !state.lastOilEdit.row) return false;\n    const lastRow = state.lastOilEdit.row;\n    const otherTotal = rows.reduce((acc, row) => {\n      if (row === lastRow) return acc;\n      return acc + toGrams(row.querySelector('.oil-grams')?.value);\n    }, 0);\n    const allowed = Math.max(0, target - otherTotal);\n    const gramsInput = lastRow.querySelector('.oil-grams');\n    const pctInput = lastRow.querySelector('.oil-percent');\n    if (!gramsInput || !pctInput) return false;\n    gramsInput.value = allowed > 0 ? round(fromGrams(allowed), 2) : '';\n    pctInput.value = allowed > 0 ? round((allowed / target) * 100, 2) : '';\n    state.wasCapped = true;\n    return true;\n  }\n\n  function updateOilLimitWarning({ totalWeight, totalPct, target, capped }){\n    const warning = document.getElementById('oilLimitWarning');\n    if (!warning) return;\n    const messages = [];\n    if (capped) {\n      messages.push('Oil total hit the mold cap and was adjusted.');\n    }\n    if (target > 0 && totalWeight > target + 0.01) {\n      const over = totalWeight - target;\n      messages.push(`Oil weights exceed the target by ${round(fromGrams(over), 2)} ${state.currentUnit}.`);\n    }\n    if (totalPct > 100.01) {\n      messages.push(`Oil percentages are over 100% by ${round(totalPct - 100, 2)}%.`);\n    }\n    if (messages.length) {\n      warning.classList.remove('d-none');\n      warning.innerHTML = `${messages.join(' ')} Adjust oils or mold % to continue.`;\n    } else {\n      warning.classList.add('d-none');\n      warning.textContent = '';\n    }\n  }\n\n  function updateOilTotals(options = {}){\n    if (!options.skipEnforce) {\n      state.wasCapped = false;\n    }\n    const rows = Array.from(document.querySelectorAll('#oilRows .oil-row'));\n    const mold = SoapTool.mold.getMoldSettings();\n    let target = getOilTargetGrams();\n    if (!target && !mold.targetOils) {\n      const derived = deriveTargetFromRows(rows);\n      if (derived > 0) {\n        target = derived;\n        const targetInput = document.getElementById('oilTotalTarget');\n        if (targetInput && !targetInput.value) {\n          targetInput.value = round(fromGrams(derived), 2);\n        }\n      }\n    }\n\n    let totalWeight = 0;\n    let totalPct = 0;\n\n    rows.forEach(row => {\n      const gramsInput = row.querySelector('.oil-grams');\n      const pctInput = row.querySelector('.oil-percent');\n      let grams = toGrams(gramsInput?.value);\n      let pct = clamp(toNumber(pctInput?.value), 0);\n      if (target > 0) {\n        if (state.lastOilEdit && state.lastOilEdit.row === row && state.lastOilEdit.field === 'percent') {\n          grams = pct > 0 ? target * (pct / 100) : 0;\n          gramsInput.value = pct > 0 ? round(fromGrams(grams), 2) : '';\n        } else {\n          if (grams > 0) {\n            pct = (grams / target) * 100;\n            pctInput.value = round(pct, 2);\n          } else if (pct > 0) {\n            grams = target * (pct / 100);\n            gramsInput.value = round(fromGrams(grams), 2);\n          }\n        }\n        totalPct += pct;\n      }\n      if (grams > 0) totalWeight += grams;\n    });\n\n    if (target <= 0) {\n      if (totalWeight > 0) {\n        totalPct = 0;\n        rows.forEach(row => {\n          const gramsInput = row.querySelector('.oil-grams');\n          const pctInput = row.querySelector('.oil-percent');\n          const grams = toGrams(gramsInput?.value);\n          if (grams > 0) {\n            const pct = (grams / totalWeight) * 100;\n            pctInput.value = round(pct, 2);\n            totalPct += pct;\n          }\n        });\n      } else {\n        totalPct = rows.reduce((sum, row) => sum + clamp(toNumber(row.querySelector('.oil-percent')?.value), 0), 0);\n      }\n    }\n\n    if (!options.skipEnforce && mold.targetOils > 0 && totalWeight > mold.targetOils + 0.01) {\n      if (enforceOilTargetCap(rows, mold.targetOils)) {\n        return updateOilTotals({ skipEnforce: true });\n      }\n    }\n\n    state.totalOilsGrams = totalWeight;\n    const totalLabel = document.getElementById('oilTotalComputed');\n    if (totalLabel) {\n      totalLabel.textContent = totalWeight > 0 ? `${round(fromGrams(totalWeight), 2)} ${state.currentUnit}` : '--';\n    }\n    document.getElementById('oilPercentTotal').textContent = round(totalPct, 2);\n    updateOilLimitWarning({ totalWeight, totalPct, target, capped: state.wasCapped });\n    SoapTool.additives.updateAdditivesOutput(totalWeight);\n    SoapTool.mold.updateMoldSuggested();\n    updateOilTips();\n    return { totalWeight, totalPct, target };\n  }\n\n  function normalizeOils(){\n    const rows = Array.from(document.querySelectorAll('#oilRows .oil-row'));\n    if (!rows.length) return;\n    const target = getOilTargetGrams();\n    let totalPct = rows.reduce((sum, row) => sum + clamp(toNumber(row.querySelector('.oil-percent')?.value), 0), 0);\n    if (!totalPct && target > 0) {\n      totalPct = rows.reduce((sum, row) => {\n        const grams = toGrams(row.querySelector('.oil-grams')?.value);\n        return sum + (grams > 0 ? (grams / target) * 100 : 0);\n      }, 0);\n    }\n    if (totalPct <= 0) return;\n    rows.forEach(row => {\n      const pctInput = row.querySelector('.oil-percent');\n      const gramsInput = row.querySelector('.oil-grams');\n      const pct = clamp(toNumber(pctInput.value), 0);\n      const nextPct = (pct / totalPct) * 100;\n      pctInput.value = round(nextPct, 2);\n      if (target > 0) {\n        gramsInput.value = nextPct > 0 ? round(fromGrams(target * (nextPct / 100)), 2) : '';\n      }\n    });\n    updateOilTotals();\n  }\n\n  function collectOilData(){\n    const oils = [];\n    document.querySelectorAll('#oilRows .oil-row').forEach(row => {\n      const name = row.querySelector('.oil-typeahead')?.value?.trim();\n      const grams = toGrams(row.querySelector('.oil-grams')?.value);\n      const sapKoh = toNumber(row.querySelector('.oil-sap-koh')?.value);\n      const iodine = toNumber(row.querySelector('.oil-iodine')?.value);\n      const fattyRaw = row.querySelector('.oil-fatty')?.value || '';\n      const gi = row.querySelector('.oil-gi-id')?.value || '';\n      const defaultUnit = row.querySelector('.oil-default-unit')?.value || '';\n      const categoryName = row.querySelector('.oil-category')?.value || '';\n      let fattyProfile = null;\n      if (fattyRaw) {\n        try {\n          fattyProfile = JSON.parse(fattyRaw);\n        } catch (_) {\n          fattyProfile = null;\n        }\n      }\n      if (grams <= 0) return;\n      oils.push({\n        name: name || null,\n        grams,\n        sapKoh,\n        iodine,\n        fattyProfile,\n        global_item_id: gi ? parseInt(gi) : null,\n        default_unit: defaultUnit || null,\n        ingredient_category_name: categoryName || null,\n      });\n    });\n    return oils;\n  }\n\n  function updateSelectedOilProfileDisplay({ name, sapKoh, iodine, fattyProfile } = {}){\n    const floatCard = document.getElementById('oilProfileFloat');\n    const setText = (id, value) => {\n      const el = document.getElementById(id);\n      if (el) el.textContent = value;\n    };\n    const nameLabel = name || 'Pick an oil to preview';\n    setText('selectedOilName', nameLabel);\n    setText('selectedOilModalName', nameLabel);\n    if (floatCard) {\n      floatCard.classList.toggle('d-none', !name);\n    }\n    const sapValue = sapKoh > 0 ? round(sapKoh, 1) : '--';\n    const iodineValue = iodine > 0 ? round(iodine, 1) : '--';\n    setText('selectedOilSap', sapValue);\n    setText('selectedOilModalSap', sapValue);\n    setText('selectedOilIodine', iodineValue);\n    setText('selectedOilModalIodine', iodineValue);\n\n    const qualities = fattyProfile ? computeQualities(fattyProfile) : {};\n    const setValue = (id, value) => {\n      const safe = isFinite(value) && value > 0 ? round(value, 1) : '--';\n      setText(id, safe);\n    };\n    setValue('selectedOilHardness', qualities.hardness);\n    setValue('selectedOilModalHardness', qualities.hardness);\n    setValue('selectedOilCleansing', qualities.cleansing);\n    setValue('selectedOilModalCleansing', qualities.cleansing);\n    setValue('selectedOilConditioning', qualities.conditioning);\n    setValue('selectedOilModalConditioning', qualities.conditioning);\n    setValue('selectedOilBubbly', qualities.bubbly);\n    setValue('selectedOilModalBubbly', qualities.bubbly);\n    setValue('selectedOilCreamy', qualities.creamy);\n    setValue('selectedOilModalCreamy', qualities.creamy);\n\n    const fattyKeys = ['lauric', 'myristic', 'palmitic', 'stearic', 'ricinoleic', 'oleic', 'linoleic', 'linolenic'];\n    fattyKeys.forEach(key => {\n      const baseId = `selectedOil${key.charAt(0).toUpperCase()}${key.slice(1)}`;\n      const modalId = `selectedOilModal${key.charAt(0).toUpperCase()}${key.slice(1)}`;\n      const value = fattyProfile ? toNumber(fattyProfile[key]) : 0;\n      const safe = value > 0 ? round(value, 1) : '--';\n      setText(baseId, safe);\n      setText(modalId, safe);\n    });\n  }\n\n  function setSelectedOilProfile(picked){\n    if (!picked) {\n      clearSelectedOilProfile();\n      return;\n    }\n    state.selectedOilProfile = picked;\n    let fattyProfile = picked.fatty_acid_profile || null;\n    if (typeof fattyProfile === 'string') {\n      try {\n        fattyProfile = JSON.parse(fattyProfile);\n      } catch (_) {\n        fattyProfile = null;\n      }\n    }\n    updateSelectedOilProfileDisplay({\n      name: picked.text || picked.display_name || picked.name,\n      sapKoh: toNumber(picked.saponification_value),\n      iodine: toNumber(picked.iodine_value),\n      fattyProfile,\n    });\n  }\n\n  function setSelectedOilProfileFromRow(row){\n    if (!row) return;\n    const name = row.querySelector('.oil-typeahead')?.value?.trim();\n    const sapKoh = toNumber(row.querySelector('.oil-sap-koh')?.value);\n    const iodine = toNumber(row.querySelector('.oil-iodine')?.value);\n    const fattyRaw = row.querySelector('.oil-fatty')?.value || '';\n    let fattyProfile = null;\n    if (fattyRaw) {\n      try {\n        fattyProfile = JSON.parse(fattyRaw);\n      } catch (_) {\n        fattyProfile = null;\n      }\n    }\n    updateSelectedOilProfileDisplay({\n      name,\n      sapKoh,\n      iodine,\n      fattyProfile,\n    });\n  }\n\n  function clearSelectedOilProfile(){\n    state.selectedOilProfile = null;\n    state.lastPreviewRow = null;\n    updateSelectedOilProfileDisplay();\n  }\n\n  function updateOilTips(){\n    const tipBox = document.getElementById('oilBlendTips');\n    if (!tipBox) return;\n    const oils = collectOilData().filter(oil => oil.grams > 0 || oil.percent > 0);\n    if (!oils.length) {\n      tipBox.classList.add('d-none');\n      tipBox.textContent = '';\n      return;\n    }\n    const tips = new Set();\n    oils.forEach(oil => {\n      const name = (oil.name || '').toLowerCase();\n      if (name) {\n        OIL_TIP_RULES.forEach(rule => {\n          if (rule.match.test(name)) tips.add(rule.tip);\n        });\n      }\n      if (oil.fattyProfile && typeof oil.fattyProfile === 'object') {\n        const lauric = toNumber(oil.fattyProfile.lauric);\n        const myristic = toNumber(oil.fattyProfile.myristic);\n        const palmitic = toNumber(oil.fattyProfile.palmitic);\n        const stearic = toNumber(oil.fattyProfile.stearic);\n        const ricinoleic = toNumber(oil.fattyProfile.ricinoleic);\n        const oleic = toNumber(oil.fattyProfile.oleic);\n        const linoleic = toNumber(oil.fattyProfile.linoleic);\n        const linolenic = toNumber(oil.fattyProfile.linolenic);\n        if (lauric + myristic >= 30) {\n          tips.add(`${oil.name || 'This oil'} is high in lauric/myristic; expect faster trace and stronger cleansing.`);\n        }\n        if (palmitic + stearic >= 40) {\n          tips.add(`${oil.name || 'This oil'} is high in palmitic/stearic; expect a harder bar and quicker set-up.`);\n        }\n        if (oleic >= 60) {\n          tips.add(`${oil.name || 'This oil'} is high oleic; trace may be slow and bars may start softer.`);\n        }\n        if (linoleic + linolenic >= 20) {\n          tips.add(`${oil.name || 'This oil'} is high in PUFAs; keep the % lower to reduce DOS risk.`);\n        }\n        if (ricinoleic >= 60) {\n          tips.add(`${oil.name || 'This oil'} boosts lather but can feel tacky; keep under 10-15%.`);\n        }\n      }\n    });\n    const tipList = Array.from(tips).slice(0, 6);\n    if (!tipList.length) {\n      tipBox.classList.add('d-none');\n      tipBox.textContent = '';\n      return;\n    }\n    tipBox.classList.remove('d-none');\n    tipBox.innerHTML = `<strong>Blend behavior tips:</strong><ul class=\"mb-0\">${tipList.map(tip => `<li>${tip}</li>`).join('')}</ul>`;\n  }\n\n  function getTotalOilsGrams(){\n    return state.totalOilsGrams || 0;\n  }\n\n  function serializeOilRow(row){\n    if (!row) return null;\n    return {\n      name: row.querySelector('.oil-typeahead')?.value || '',\n      grams: row.querySelector('.oil-grams')?.value || '',\n      percent: row.querySelector('.oil-percent')?.value || '',\n      sap: row.querySelector('.oil-sap-koh')?.value || '',\n      iodine: row.querySelector('.oil-iodine')?.value || '',\n      fattyRaw: row.querySelector('.oil-fatty')?.value || '',\n      gi: row.querySelector('.oil-gi-id')?.value || '',\n      defaultUnit: row.querySelector('.oil-default-unit')?.value || '',\n      categoryName: row.querySelector('.oil-category')?.value || '',\n    };\n  }\n\n  function matchesCategory(item, allowedSet, source){\n    const category = getItemCategoryName(item);\n    if (!category) {\n      return source === 'inventory';\n    }\n    return allowedSet.has(category);\n  }\n\n  function getItemCategoryName(item){\n    if (!item || typeof item !== 'object') return null;\n    return (item.ingredient && item.ingredient.ingredient_category_name)\n      || item.ingredient_category_name\n      || (item.ingredient_category && item.ingredient_category.name)\n      || null;\n  }\n\n  SoapTool.oils = {\n    attachOilTypeahead,\n    buildOilRow,\n    getOilTargetGrams,\n    updateOilTotals,\n    normalizeOils,\n    collectOilData,\n    setSelectedOilProfileFromRow,\n    clearSelectedOilProfile,\n    updateOilTips,\n    getTotalOilsGrams,\n    serializeOilRow,\n    validateOilEntry,\n    scaleOilsToTarget,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const bulk = SoapTool.bulkOils = SoapTool.bulkOils || {};\n  const { toNumber, clamp } = SoapTool.helpers;\n  const state = SoapTool.state;\n\n  const FATTY_KEYS = Array.isArray(SoapTool.constants?.FATTY_DISPLAY_KEYS)\n    ? SoapTool.constants.FATTY_DISPLAY_KEYS.slice()\n    : ['lauric', 'myristic', 'palmitic', 'stearic', 'ricinoleic', 'oleic', 'linoleic', 'linolenic'];\n  const LOCAL_SORT_KEYS = new Set(['selected_pct', 'selected_weight_g']);\n  const PAGE_SIZE = 25;\n  const SCROLL_FETCH_THRESHOLD = 140;\n  const SEARCH_DEBOUNCE_MS = 260;\n  const DEFAULT_MODAL_STATE = {\n    mode: 'basics',\n    viewSelected: false,\n    query: '',\n    sortKey: 'name',\n    sortDir: 'asc',\n    selection: {},\n    recordByKey: {},\n    visibleRecords: [],\n    offset: 0,\n    totalCount: 0,\n    hasMore: true,\n    loading: false,\n    requestToken: 0,\n  };\n\n  function queueStateSave(){\n    SoapTool.storage?.queueStateSave?.();\n  }\n\n  function showAlert(level, message){\n    SoapTool.ui?.showSoapAlert?.(level, message, { dismissible: true, timeoutMs: 6000 });\n  }\n\n  function getRefs(){\n    return {\n      modalEl: document.getElementById('bulkOilModal'),\n      openBtn: document.getElementById('openBulkOilModal'),\n      searchInput: document.getElementById('bulkOilSearchInput'),\n      modeToggle: document.getElementById('bulkOilDisplayAllToggle'),\n      viewSelectedToggle: document.getElementById('bulkOilViewSelectedToggle'),\n      statusEl: document.getElementById('bulkOilCatalogStatus'),\n      summaryEl: document.getElementById('bulkOilSelectedSummary'),\n      stageCountEl: document.getElementById('bulkOilSelectionCount'),\n      bodyEl: document.getElementById('bulkOilCatalogBody'),\n      scrollEl: document.getElementById('bulkOilCatalogScroll'),\n      importBtn: document.getElementById('bulkOilImportBtn'),\n      clearBtn: document.getElementById('bulkOilClearSelectionBtn'),\n      unitLabelEl: document.getElementById('bulkOilWeightUnitLabel'),\n    };\n  }\n\n  function isSupportedSortKey(sortKey){\n    if (!sortKey) return false;\n    if (sortKey === 'name') return true;\n    if (LOCAL_SORT_KEYS.has(sortKey)) return true;\n    return FATTY_KEYS.includes(sortKey);\n  }\n\n  function ensureModalState(){\n    if (!state.bulkOilModal || typeof state.bulkOilModal !== 'object') {\n      state.bulkOilModal = JSON.parse(JSON.stringify(DEFAULT_MODAL_STATE));\n    }\n    const modalState = state.bulkOilModal;\n    modalState.mode = modalState.mode === 'all' ? 'all' : 'basics';\n    modalState.viewSelected = !!modalState.viewSelected;\n    modalState.query = typeof modalState.query === 'string' ? modalState.query : '';\n    modalState.sortKey = isSupportedSortKey(modalState.sortKey) ? modalState.sortKey : 'name';\n    modalState.sortDir = modalState.sortDir === 'desc' ? 'desc' : 'asc';\n    modalState.selection = modalState.selection && typeof modalState.selection === 'object' ? modalState.selection : {};\n    modalState.recordByKey = modalState.recordByKey && typeof modalState.recordByKey === 'object' ? modalState.recordByKey : {};\n    modalState.visibleRecords = Array.isArray(modalState.visibleRecords) ? modalState.visibleRecords : [];\n    modalState.offset = Math.max(0, parseInt(modalState.offset, 10) || 0);\n    modalState.totalCount = Math.max(0, parseInt(modalState.totalCount, 10) || 0);\n    modalState.hasMore = modalState.hasMore !== false;\n    modalState.loading = !!modalState.loading;\n    modalState.requestToken = Math.max(0, parseInt(modalState.requestToken, 10) || 0);\n    return modalState;\n  }\n\n  function normalizeFattyProfile(rawProfile){\n    const profile = {};\n    const input = rawProfile && typeof rawProfile === 'object' ? rawProfile : {};\n    FATTY_KEYS.forEach(key => {\n      const value = toNumber(input[key]);\n      if (value > 0) {\n        profile[key] = value;\n      }\n    });\n    return profile;\n  }\n\n  function normalizeCatalogRecord(raw){\n    const fattyProfile = normalizeFattyProfile(raw?.fatty_profile);\n    const name = String(raw?.name || '').trim();\n    const source = String(raw?.source || 'soapcalc').trim().toLowerCase() || 'soapcalc';\n    const globalItemId = Number.isInteger(raw?.global_item_id)\n      ? raw.global_item_id\n      : (toNumber(raw?.global_item_id) > 0 ? parseInt(raw.global_item_id, 10) : null);\n    const key = String(raw?.key || (globalItemId ? `global:${globalItemId}` : `${source}:${name.toLowerCase()}`));\n    return {\n      key,\n      name,\n      sap_koh: toNumber(raw?.sap_koh),\n      iodine: toNumber(raw?.iodine),\n      fatty_profile: fattyProfile,\n      default_unit: String(raw?.default_unit || 'gram'),\n      ingredient_category_name: String(raw?.ingredient_category_name || 'Oils (Carrier & Fixed)'),\n      global_item_id: globalItemId,\n      source,\n      is_basic: !!raw?.is_basic,\n    };\n  }\n\n  function updateSelectionCounters(){\n    const refs = getRefs();\n    const modalState = ensureModalState();\n    const count = Object.keys(modalState.selection || {}).length;\n    const summary = `Selected: ${count}`;\n    if (refs.summaryEl) refs.summaryEl.textContent = summary;\n    if (refs.stageCountEl) refs.stageCountEl.textContent = String(count);\n  }\n\n  function selectionForRecordKey(recordKey){\n    const modalState = ensureModalState();\n    return modalState.selection?.[recordKey] || null;\n  }\n\n  function setSelection(record, values = {}){\n    const modalState = ensureModalState();\n    if (!record || !record.key) return null;\n    const existing = modalState.selection[record.key] || {};\n    const next = {\n      key: record.key,\n      name: record.name,\n      sap_koh: record.sap_koh,\n      iodine: record.iodine,\n      fatty_profile: record.fatty_profile || {},\n      default_unit: record.default_unit || 'gram',\n      ingredient_category_name: record.ingredient_category_name || '',\n      global_item_id: record.global_item_id || null,\n      source: record.source || 'soapcalc',\n      is_basic: !!record.is_basic,\n      selected_pct: clamp(toNumber(values.selected_pct ?? existing.selected_pct), 0, 100),\n      selected_weight_g: clamp(toNumber(values.selected_weight_g ?? existing.selected_weight_g), 0),\n    };\n    modalState.selection[record.key] = next;\n    return next;\n  }\n\n  function removeSelection(recordKey){\n    const modalState = ensureModalState();\n    if (modalState.selection?.[recordKey]) {\n      delete modalState.selection[recordKey];\n    }\n  }\n\n  function getRecordByKey(recordKey){\n    const modalState = ensureModalState();\n    return modalState.recordByKey?.[recordKey] || null;\n  }\n\n  function serializeSelection(){\n    const modalState = ensureModalState();\n    return {\n      mode: modalState.mode,\n      view_selected: !!modalState.viewSelected,\n      query: modalState.query,\n      sort_key: modalState.sortKey,\n      sort_dir: modalState.sortDir,\n      selections: Object.values(modalState.selection || {}).map(item => ({\n        key: item.key,\n        name: item.name,\n        sap_koh: item.sap_koh,\n        iodine: item.iodine,\n        fatty_profile: item.fatty_profile || {},\n        default_unit: item.default_unit,\n        ingredient_category_name: item.ingredient_category_name,\n        global_item_id: item.global_item_id,\n        source: item.source,\n        is_basic: !!item.is_basic,\n        selected_pct: clamp(toNumber(item.selected_pct), 0, 100),\n        selected_weight_g: clamp(toNumber(item.selected_weight_g), 0),\n      })),\n    };\n  }\n\n  function restoreState(savedState){\n    const modalState = ensureModalState();\n    modalState.mode = savedState?.mode === 'all' ? 'all' : 'basics';\n    modalState.viewSelected = !!savedState?.view_selected;\n    modalState.query = typeof savedState?.query === 'string' ? savedState.query : '';\n    modalState.sortKey = isSupportedSortKey(savedState?.sort_key) ? savedState.sort_key : 'name';\n    modalState.sortDir = savedState?.sort_dir === 'desc' ? 'desc' : 'asc';\n    const selection = {};\n    const rows = Array.isArray(savedState?.selections) ? savedState.selections : [];\n    rows.forEach(raw => {\n      const key = String(raw?.key || '').trim();\n      const name = String(raw?.name || '').trim();\n      if (!key || !name) return;\n      selection[key] = {\n        key,\n        name,\n        sap_koh: toNumber(raw?.sap_koh),\n        iodine: toNumber(raw?.iodine),\n        fatty_profile: normalizeFattyProfile(raw?.fatty_profile),\n        default_unit: String(raw?.default_unit || 'gram'),\n        ingredient_category_name: String(raw?.ingredient_category_name || ''),\n        global_item_id: toNumber(raw?.global_item_id) > 0 ? parseInt(raw.global_item_id, 10) : null,\n        source: String(raw?.source || 'soapcalc'),\n        is_basic: !!raw?.is_basic,\n        selected_pct: clamp(toNumber(raw?.selected_pct), 0, 100),\n        selected_weight_g: clamp(toNumber(raw?.selected_weight_g), 0),\n      };\n    });\n    modalState.selection = selection;\n    modalState.visibleRecords = [];\n    modalState.offset = 0;\n    modalState.totalCount = 0;\n    modalState.hasMore = true;\n    modalState.loading = false;\n    updateSelectionCounters();\n  }\n\n  bulk.shared = {\n    FATTY_KEYS,\n    LOCAL_SORT_KEYS,\n    PAGE_SIZE,\n    SCROLL_FETCH_THRESHOLD,\n    SEARCH_DEBOUNCE_MS,\n    queueStateSave,\n    showAlert,\n    getRefs,\n    ensureModalState,\n    normalizeFattyProfile,\n    normalizeCatalogRecord,\n    updateSelectionCounters,\n    selectionForRecordKey,\n    setSelection,\n    removeSelection,\n    getRecordByKey,\n    serializeSelection,\n    restoreState,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const bulk = SoapTool.bulkOils = SoapTool.bulkOils || {};\n  const shared = bulk.shared;\n  if (!shared) return;\n\n  const { round, toNumber } = SoapTool.helpers;\n  const { fromGrams } = SoapTool.units;\n  const {\n    FATTY_KEYS,\n    LOCAL_SORT_KEYS,\n    getRefs,\n    ensureModalState,\n    selectionForRecordKey,\n    updateSelectionCounters,\n  } = shared;\n\n  function updateStatusText(text){\n    const refs = getRefs();\n    if (refs.statusEl) refs.statusEl.textContent = text;\n  }\n\n  function refreshCatalogStatus(){\n    const modalState = ensureModalState();\n    const modeLabel = modalState.mode === 'all' ? 'all oils' : 'SoapCalc basics';\n    if (modalState.loading && !modalState.visibleRecords.length) {\n      updateStatusText('Loading oils...');\n      return;\n    }\n    if (!modalState.visibleRecords.length) {\n      const noMatchLabel = modalState.query ? 'No oils match that search.' : 'No oils available.';\n      updateStatusText(noMatchLabel);\n      return;\n    }\n    const loaded = modalState.visibleRecords.length;\n    const total = modalState.totalCount;\n    const moreHint = modalState.hasMore ? ' \u2022 scroll for more' : '';\n    const queryHint = modalState.query ? ` \u2022 search: \"${modalState.query}\"` : '';\n    updateStatusText(`Loaded ${loaded}/${total} in ${modeLabel}${queryHint}${moreHint}`);\n  }\n\n  function compareValues(aValue, bValue, dir){\n    if (typeof aValue === 'string' || typeof bValue === 'string') {\n      const left = String(aValue || '').toLowerCase();\n      const right = String(bValue || '').toLowerCase();\n      if (left < right) return dir === 'asc' ? -1 : 1;\n      if (left > right) return dir === 'asc' ? 1 : -1;\n      return 0;\n    }\n    const aNum = toNumber(aValue);\n    const bNum = toNumber(bValue);\n    if (aNum < bNum) return dir === 'asc' ? -1 : 1;\n    if (aNum > bNum) return dir === 'asc' ? 1 : -1;\n    return 0;\n  }\n\n  function localSortValue(record, sortKey){\n    if (sortKey === 'selected_pct') return selectionForRecordKey(record.key)?.selected_pct || 0;\n    if (sortKey === 'selected_weight_g') return selectionForRecordKey(record.key)?.selected_weight_g || 0;\n    return '';\n  }\n\n  function applyLocalSelectionSortIfNeeded(){\n    const modalState = ensureModalState();\n    if (!LOCAL_SORT_KEYS.has(modalState.sortKey)) return;\n    modalState.visibleRecords.sort((left, right) => {\n      const primary = compareValues(\n        localSortValue(left, modalState.sortKey),\n        localSortValue(right, modalState.sortKey),\n        modalState.sortDir\n      );\n      if (primary !== 0) return primary;\n      return compareValues(left.name || '', right.name || '', 'asc');\n    });\n  }\n\n  function applyViewSelectedOrderingIfNeeded(){\n    const modalState = ensureModalState();\n    if (!modalState.viewSelected) return;\n    const selected = [];\n    const others = [];\n    modalState.visibleRecords.forEach(record => {\n      if (selectionForRecordKey(record.key)) {\n        selected.push(record);\n      } else {\n        others.push(record);\n      }\n    });\n    modalState.visibleRecords = selected.concat(others);\n  }\n\n  function applyClientOrdering(){\n    applyLocalSelectionSortIfNeeded();\n    applyViewSelectedOrderingIfNeeded();\n  }\n\n  function normalizeServerSortKey(sortKey){\n    const key = String(sortKey || '').trim().toLowerCase();\n    if (key === 'name') return key;\n    if (FATTY_KEYS.includes(key)) return key;\n    return 'name';\n  }\n\n  function sortButtonsLabel(){\n    const modalState = ensureModalState();\n    document.querySelectorAll('.bulk-oil-sort').forEach(button => {\n      if (!button.dataset.label) {\n        button.dataset.label = String(button.textContent || '').replace(/[\u25B2\u25BC]\\s*$/, '').trim();\n      }\n      const label = button.dataset.label || '';\n      const key = button.dataset.sortKey || '';\n      if (modalState.sortKey === key) {\n        button.textContent = `${label} ${modalState.sortDir === 'asc' ? '\u25B2' : '\u25BC'}`;\n      } else {\n        button.textContent = label;\n      }\n    });\n  }\n\n  function updateRowFromSelection(row, record){\n    const selection = selectionForRecordKey(record.key);\n    const checkbox = row.querySelector('.bulk-oil-check');\n    const pctInput = row.querySelector('.bulk-oil-pct');\n    const weightInput = row.querySelector('.bulk-oil-weight');\n    if (checkbox) checkbox.checked = !!selection;\n    if (pctInput) pctInput.value = selection && selection.selected_pct > 0 ? round(selection.selected_pct, 2) : '';\n    if (weightInput) {\n      weightInput.value = selection && selection.selected_weight_g > 0\n        ? round(fromGrams(selection.selected_weight_g), 2)\n        : '';\n    }\n  }\n\n  function createFattyCell(value){\n    const cell = document.createElement('td');\n    cell.className = 'bulk-oil-acid';\n    const numeric = toNumber(value);\n    cell.textContent = numeric > 0 ? round(numeric, 1).toString() : '--';\n    return cell;\n  }\n\n  function createRow(record){\n    const row = document.createElement('tr');\n    row.dataset.recordKey = record.key;\n\n    const pickCell = document.createElement('td');\n    pickCell.className = 'text-center';\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.className = 'form-check-input bulk-oil-check';\n    pickCell.appendChild(checkbox);\n    row.appendChild(pickCell);\n\n    const nameCell = document.createElement('td');\n    nameCell.className = 'bulk-oil-name';\n    const title = document.createElement('div');\n    title.className = 'fw-semibold small';\n    title.textContent = record.name;\n    const detail = document.createElement('div');\n    detail.className = 'text-muted small';\n    const category = record.ingredient_category_name ? ` \u00B7 ${record.ingredient_category_name}` : '';\n    detail.textContent = `${record.source}${category}`;\n    nameCell.appendChild(title);\n    nameCell.appendChild(detail);\n    row.appendChild(nameCell);\n\n    FATTY_KEYS.forEach(key => {\n      row.appendChild(createFattyCell(record.fatty_profile?.[key]));\n    });\n\n    const pctCell = document.createElement('td');\n    const pctInput = document.createElement('input');\n    pctInput.type = 'number';\n    pctInput.min = '0';\n    pctInput.max = '100';\n    pctInput.step = '0.1';\n    pctInput.className = 'form-control form-control-sm bulk-oil-input bulk-oil-pct';\n    pctCell.appendChild(pctInput);\n    row.appendChild(pctCell);\n\n    const weightCell = document.createElement('td');\n    const weightInput = document.createElement('input');\n    weightInput.type = 'number';\n    weightInput.min = '0';\n    weightInput.step = '0.1';\n    weightInput.className = 'form-control form-control-sm bulk-oil-input bulk-oil-weight';\n    weightCell.appendChild(weightInput);\n    row.appendChild(weightCell);\n\n    updateRowFromSelection(row, record);\n    return row;\n  }\n\n  function renderVisibleRecords(){\n    const refs = getRefs();\n    const modalState = ensureModalState();\n    if (!refs.bodyEl) return;\n    refs.bodyEl.innerHTML = '';\n    const fragment = document.createDocumentFragment();\n    modalState.visibleRecords.forEach(record => {\n      fragment.appendChild(createRow(record));\n    });\n    refs.bodyEl.appendChild(fragment);\n    sortButtonsLabel();\n    updateSelectionCounters();\n    refreshCatalogStatus();\n  }\n\n  bulk.render = {\n    updateStatusText,\n    refreshCatalogStatus,\n    applyLocalSelectionSortIfNeeded,\n    applyViewSelectedOrderingIfNeeded,\n    applyClientOrdering,\n    normalizeServerSortKey,\n    sortButtonsLabel,\n    renderVisibleRecords,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const bulk = SoapTool.bulkOils = SoapTool.bulkOils || {};\n  const shared = bulk.shared;\n  const render = bulk.render;\n  if (!shared || !render) return;\n\n  const {\n    PAGE_SIZE,\n    getRefs,\n    ensureModalState,\n    normalizeCatalogRecord,\n  } = shared;\n  const {\n    refreshCatalogStatus,\n    normalizeServerSortKey,\n    applyClientOrdering,\n    renderVisibleRecords,\n    updateStatusText,\n  } = render;\n\n  function resetVisibleCatalogForFetch(){\n    const modalState = ensureModalState();\n    const refs = getRefs();\n    modalState.visibleRecords = [];\n    modalState.offset = 0;\n    modalState.totalCount = 0;\n    modalState.hasMore = true;\n    if (refs.bodyEl) refs.bodyEl.innerHTML = '';\n    if (refs.scrollEl) refs.scrollEl.scrollTop = 0;\n  }\n\n  async function fetchCatalogPage({ reset = false } = {}){\n    const modalState = ensureModalState();\n    const refs = getRefs();\n    if (!refs.modalEl) return;\n    if (modalState.loading && !reset) return;\n    if (!modalState.hasMore && !reset) return;\n\n    if (reset) {\n      resetVisibleCatalogForFetch();\n    }\n\n    const requestToken = modalState.requestToken + 1;\n    modalState.requestToken = requestToken;\n    modalState.loading = true;\n    refreshCatalogStatus();\n\n    const params = new URLSearchParams();\n    params.set('mode', modalState.mode);\n    params.set('offset', String(modalState.offset));\n    params.set('limit', String(PAGE_SIZE));\n    params.set('q', modalState.query || '');\n    params.set('sort_key', normalizeServerSortKey(modalState.sortKey));\n    params.set('sort_dir', modalState.sortDir === 'desc' ? 'desc' : 'asc');\n\n    try {\n      const response = await fetch(`/tools/api/soap/oils-catalog?${params.toString()}`);\n      if (!response.ok) {\n        throw new Error('Unable to load oils catalog');\n      }\n      const payload = await response.json();\n      if (!payload || payload.success !== true || !payload.result || !Array.isArray(payload.result.records)) {\n        throw new Error('Invalid oils catalog response');\n      }\n      if (requestToken !== modalState.requestToken) {\n        return;\n      }\n      const records = payload.result.records.map(normalizeCatalogRecord);\n      const nextOffset = Math.max(0, parseInt(payload.result.next_offset, 10) || (modalState.offset + records.length));\n      const totalCount = Math.max(records.length, parseInt(payload.result.count, 10) || 0);\n      const hasMore = !!payload.result.has_more;\n\n      records.forEach(record => {\n        modalState.recordByKey[record.key] = record;\n      });\n      modalState.visibleRecords = reset\n        ? records.slice()\n        : modalState.visibleRecords.concat(records);\n      modalState.offset = nextOffset;\n      modalState.totalCount = totalCount;\n      modalState.hasMore = hasMore;\n      applyClientOrdering();\n      renderVisibleRecords();\n    } catch (_) {\n      if (requestToken === modalState.requestToken) {\n        updateStatusText('Unable to load oils catalog.');\n      }\n      throw _;\n    } finally {\n      if (requestToken === modalState.requestToken) {\n        modalState.loading = false;\n        refreshCatalogStatus();\n      }\n    }\n  }\n\n  bulk.api = {\n    fetchCatalogPage,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const bulk = SoapTool.bulkOils = SoapTool.bulkOils || {};\n  const shared = bulk.shared;\n  const render = bulk.render;\n  const api = bulk.api;\n  if (!shared || !render || !api) return;\n\n  const { round, toNumber, clamp } = SoapTool.helpers;\n  const { toGrams, fromGrams } = SoapTool.units;\n  const state = SoapTool.state;\n  const {\n    LOCAL_SORT_KEYS,\n    SCROLL_FETCH_THRESHOLD,\n    SEARCH_DEBOUNCE_MS,\n    queueStateSave,\n    showAlert,\n    getRefs,\n    ensureModalState,\n    updateSelectionCounters,\n    setSelection,\n    removeSelection,\n    getRecordByKey,\n    serializeSelection,\n    restoreState,\n  } = shared;\n  const {\n    applyClientOrdering,\n    sortButtonsLabel,\n    renderVisibleRecords,\n  } = render;\n  const { fetchCatalogPage } = api;\n\n  let modalInstance = null;\n  let searchDebounceTimer = null;\n\n  function closeModal(){\n    const refs = getRefs();\n    if (!refs.modalEl) return;\n    if (!modalInstance && window.bootstrap?.Modal) {\n      modalInstance = window.bootstrap.Modal.getOrCreateInstance(refs.modalEl);\n    }\n    if (modalInstance) modalInstance.hide();\n  }\n\n  function getStageRowsContainer(){\n    return document.getElementById('oilRows');\n  }\n\n  function getStageRows(){\n    return Array.from(document.querySelectorAll('#oilRows .oil-row'));\n  }\n\n  function normalizeName(value){\n    return String(value || '').trim().toLowerCase();\n  }\n\n  function stageRowName(row){\n    return normalizeName(row?.querySelector('.oil-typeahead')?.value);\n  }\n\n  function stageRowGi(row){\n    const raw = String(row?.querySelector('.oil-gi-id')?.value || '').trim();\n    return raw ? raw : '';\n  }\n\n  function stageRowByKey(recordKey, fallbackRecord){\n    const normalizedKey = String(recordKey || '').trim();\n    if (!normalizedKey) return null;\n    const rows = getStageRows();\n    let row = rows.find(entry => String(entry.dataset.bulkOilKey || '') === normalizedKey);\n    if (row) return row;\n    const gi = String(fallbackRecord?.global_item_id || '').trim();\n    if (gi) {\n      row = rows.find(entry => stageRowGi(entry) === gi);\n      if (row) return row;\n    }\n    const name = normalizeName(fallbackRecord?.name);\n    if (name) {\n      row = rows.find(entry => stageRowName(entry) === name);\n      if (row) return row;\n    }\n    return null;\n  }\n\n  function applySelectionToStageRow(row, item){\n    if (!row || !item) return;\n    row.dataset.bulkOilKey = item.key || '';\n    const nameInput = row.querySelector('.oil-typeahead');\n    const sapInput = row.querySelector('.oil-sap-koh');\n    const iodineInput = row.querySelector('.oil-iodine');\n    const fattyInput = row.querySelector('.oil-fatty');\n    const giInput = row.querySelector('.oil-gi-id');\n    const unitInput = row.querySelector('.oil-default-unit');\n    const categoryInput = row.querySelector('.oil-category');\n    const gramsInput = row.querySelector('.oil-grams');\n    const percentInput = row.querySelector('.oil-percent');\n\n    if (nameInput) nameInput.value = item.name || '';\n    if (sapInput) sapInput.value = item.sap_koh > 0 ? round(item.sap_koh, 3) : '';\n    if (iodineInput) iodineInput.value = item.iodine > 0 ? round(item.iodine, 3) : '';\n    if (fattyInput) fattyInput.value = item.fatty_profile && Object.keys(item.fatty_profile).length ? JSON.stringify(item.fatty_profile) : '';\n    if (giInput) giInput.value = item.global_item_id || '';\n    if (unitInput) unitInput.value = item.default_unit || '';\n    if (categoryInput) categoryInput.value = item.ingredient_category_name || '';\n    if (percentInput) percentInput.value = item.selected_pct > 0 ? round(item.selected_pct, 2) : '';\n    if (gramsInput) gramsInput.value = item.selected_weight_g > 0 ? round(fromGrams(item.selected_weight_g), 2) : '';\n  }\n\n  function upsertStageRowForSelection(item){\n    if (!item || !item.key) return null;\n    let row = stageRowByKey(item.key, item);\n    const oilRows = getStageRowsContainer();\n    if (!row && oilRows) {\n      row = SoapTool.oils.buildOilRow();\n      if (row) {\n        oilRows.appendChild(row);\n      }\n    }\n    applySelectionToStageRow(row, item);\n    return row;\n  }\n\n  function removeStageRowForSelection(recordKey, fallbackRecord){\n    const row = stageRowByKey(recordKey, fallbackRecord);\n    if (!row) return;\n    if (state.lastOilEdit && state.lastOilEdit.row === row) {\n      state.lastOilEdit = null;\n      SoapTool.oils.clearSelectedOilProfile();\n    }\n    row.remove();\n  }\n\n  function clearStageRows(){\n    const rows = getStageRows();\n    rows.forEach(row => {\n      if (state.lastOilEdit && state.lastOilEdit.row === row) {\n        state.lastOilEdit = null;\n      }\n      row.remove();\n    });\n    SoapTool.oils.clearSelectedOilProfile();\n  }\n\n  function notifyStageOilChanged(){\n    SoapTool.oils.updateOilTotals();\n    SoapTool.stages.updateStageStatuses();\n    SoapTool.storage.queueStateSave();\n    SoapTool.storage.queueAutoCalc();\n  }\n\n  function normalizeSelectionKey(rawName, rawGi, rawKey){\n    const explicit = String(rawKey || '').trim();\n    if (explicit) return explicit;\n    const gi = String(rawGi || '').trim();\n    if (gi) return `global:${gi}`;\n    const name = normalizeName(rawName);\n    if (name) return `soapcalc:${name}`;\n    return '';\n  }\n\n  function buildSelectionFromStage(){\n    const selection = {};\n    getStageRows().forEach(row => {\n      const name = String(row.querySelector('.oil-typeahead')?.value || '').trim();\n      const sap = toNumber(row.querySelector('.oil-sap-koh')?.value);\n      const iodine = toNumber(row.querySelector('.oil-iodine')?.value);\n      const giRaw = String(row.querySelector('.oil-gi-id')?.value || '').trim();\n      const unit = String(row.querySelector('.oil-default-unit')?.value || 'gram');\n      const categoryName = String(row.querySelector('.oil-category')?.value || '');\n      const selectedPct = clamp(toNumber(row.querySelector('.oil-percent')?.value), 0, 100);\n      const selectedWeightG = clamp(toGrams(row.querySelector('.oil-grams')?.value), 0);\n      const fattyRaw = String(row.querySelector('.oil-fatty')?.value || '');\n      let fattyProfile = {};\n      if (fattyRaw) {\n        try {\n          const parsed = JSON.parse(fattyRaw);\n          fattyProfile = shared.normalizeFattyProfile(parsed);\n        } catch (_) {\n          fattyProfile = {};\n        }\n      }\n      const key = normalizeSelectionKey(name, giRaw, row.dataset.bulkOilKey);\n      if (!key) return;\n      const hasMaterial = name || selectedPct > 0 || selectedWeightG > 0 || sap > 0 || iodine > 0 || Object.keys(fattyProfile).length > 0;\n      if (!hasMaterial) return;\n      row.dataset.bulkOilKey = key;\n      selection[key] = {\n        key,\n        name: name || 'Unnamed oil',\n        sap_koh: sap,\n        iodine,\n        fatty_profile: fattyProfile,\n        default_unit: unit || 'gram',\n        ingredient_category_name: categoryName,\n        global_item_id: giRaw ? parseInt(giRaw, 10) : null,\n        source: giRaw ? 'global' : 'soapcalc',\n        is_basic: !giRaw,\n        selected_pct: selectedPct,\n        selected_weight_g: selectedWeightG,\n      };\n    });\n    return selection;\n  }\n\n  function hydrateSelectionFromStage(){\n    const modalState = ensureModalState();\n    modalState.selection = buildSelectionFromStage();\n    updateSelectionCounters();\n  }\n\n  function syncAllSelectionsToStage(){\n    const modalState = ensureModalState();\n    const selectedItems = Object.values(modalState.selection || {});\n    const expectedKeys = new Set(selectedItems.map(item => item.key));\n    getStageRows().forEach(row => {\n      const key = String(row.dataset.bulkOilKey || '').trim();\n      if (!key || !expectedKeys.has(key)) {\n        row.remove();\n      }\n    });\n    selectedItems\n      .slice()\n      .sort((left, right) => String(left.name || '').localeCompare(String(right.name || '')))\n      .forEach(item => {\n        upsertStageRowForSelection(item);\n      });\n    notifyStageOilChanged();\n  }\n\n  async function openModal(){\n    const refs = getRefs();\n    const modalState = ensureModalState();\n    if (!refs.modalEl) return;\n    hydrateSelectionFromStage();\n    if (!modalInstance && window.bootstrap?.Modal) {\n      modalInstance = window.bootstrap.Modal.getOrCreateInstance(refs.modalEl);\n    }\n    if (refs.searchInput) refs.searchInput.value = modalState.query || '';\n    if (refs.modeToggle) refs.modeToggle.checked = modalState.mode === 'all';\n    if (refs.viewSelectedToggle) refs.viewSelectedToggle.checked = !!modalState.viewSelected;\n    if (refs.unitLabelEl) refs.unitLabelEl.textContent = state.currentUnit || 'g';\n    if (modalInstance) modalInstance.show();\n    sortButtonsLabel();\n    updateSelectionCounters();\n    try {\n      await fetchCatalogPage({ reset: true });\n    } catch (_) {\n      showAlert('danger', 'Unable to load bulk oils catalog right now.');\n    }\n  }\n\n  function handleBodyInput(event){\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) return;\n    const row = target.closest('tr[data-record-key]');\n    if (!row) return;\n    const recordKey = row.dataset.recordKey || '';\n    const record = getRecordByKey(recordKey);\n    if (!record) return;\n\n    const checkbox = row.querySelector('.bulk-oil-check');\n    const pctInput = row.querySelector('.bulk-oil-pct');\n    const weightInput = row.querySelector('.bulk-oil-weight');\n    const pct = clamp(toNumber(pctInput?.value), 0, 100);\n    const selectedWeightG = clamp(toGrams(weightInput?.value), 0);\n    const hasValues = pct > 0 || selectedWeightG > 0;\n    const isChecked = !!checkbox?.checked;\n\n    if (isChecked || hasValues) {\n      if (checkbox) checkbox.checked = true;\n      const selected = setSelection(record, {\n        selected_pct: pct,\n        selected_weight_g: selectedWeightG,\n      });\n      upsertStageRowForSelection(selected);\n    } else {\n      removeSelection(recordKey);\n      removeStageRowForSelection(recordKey, record);\n    }\n\n    const modalState = ensureModalState();\n    const shouldReorder = LOCAL_SORT_KEYS.has(modalState.sortKey) || modalState.viewSelected;\n    if (shouldReorder) {\n      applyClientOrdering();\n      renderVisibleRecords();\n    } else {\n      updateSelectionCounters();\n    }\n    notifyStageOilChanged();\n    queueStateSave();\n  }\n\n  async function handleModeToggle(checked){\n    const modalState = ensureModalState();\n    modalState.mode = checked ? 'all' : 'basics';\n    queueStateSave();\n    try {\n      await fetchCatalogPage({ reset: true });\n    } catch (_) {\n      showAlert('danger', 'Unable to load bulk oils catalog right now.');\n    }\n  }\n\n  function handleViewSelectedToggle(checked){\n    const modalState = ensureModalState();\n    modalState.viewSelected = !!checked;\n    applyClientOrdering();\n    renderVisibleRecords();\n    queueStateSave();\n  }\n\n  async function handleSortClick(event){\n    const button = event.target instanceof HTMLElement ? event.target.closest('.bulk-oil-sort') : null;\n    if (!button) return;\n    const sortKey = button.getAttribute('data-sort-key') || 'name';\n    const modalState = ensureModalState();\n    if (modalState.sortKey === sortKey) {\n      modalState.sortDir = modalState.sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      modalState.sortKey = sortKey;\n      modalState.sortDir = sortKey === 'name' ? 'asc' : 'desc';\n    }\n    queueStateSave();\n    if (LOCAL_SORT_KEYS.has(modalState.sortKey)) {\n      applyClientOrdering();\n      renderVisibleRecords();\n      return;\n    }\n    try {\n      await fetchCatalogPage({ reset: true });\n    } catch (_) {\n      showAlert('danger', 'Unable to load oils in that sort order.');\n    }\n  }\n\n  function clearSelection(){\n    const modalState = ensureModalState();\n    modalState.selection = {};\n    clearStageRows();\n    if (LOCAL_SORT_KEYS.has(modalState.sortKey) || modalState.viewSelected) {\n      applyClientOrdering();\n    }\n    renderVisibleRecords();\n    notifyStageOilChanged();\n    queueStateSave();\n  }\n\n  async function handleScroll(){\n    const refs = getRefs();\n    const modalState = ensureModalState();\n    if (!refs.scrollEl) return;\n    if (modalState.loading || !modalState.hasMore) return;\n    const isNearBottom = refs.scrollEl.scrollTop + refs.scrollEl.clientHeight >= refs.scrollEl.scrollHeight - SCROLL_FETCH_THRESHOLD;\n    if (!isNearBottom) return;\n    try {\n      await fetchCatalogPage({ reset: false });\n    } catch (_) {\n      showAlert('danger', 'Unable to load more oils right now.');\n    }\n  }\n\n  function scheduleSearchReload(){\n    if (searchDebounceTimer) window.clearTimeout(searchDebounceTimer);\n    searchDebounceTimer = window.setTimeout(async () => {\n      try {\n        await fetchCatalogPage({ reset: true });\n      } catch (_) {\n        showAlert('danger', 'Unable to search oils right now.');\n      }\n    }, SEARCH_DEBOUNCE_MS);\n  }\n\n  function saveAndClose(){\n    syncAllSelectionsToStage();\n    queueStateSave();\n    closeModal();\n  }\n\n  function onUnitChanged(){\n    const refs = getRefs();\n    if (refs.unitLabelEl) refs.unitLabelEl.textContent = state.currentUnit || 'g';\n    if (refs.modalEl?.classList.contains('show')) {\n      renderVisibleRecords();\n    }\n  }\n\n  function bindEvents(){\n    const refs = getRefs();\n    if (!refs.modalEl) return;\n    if (refs.openBtn) {\n      refs.openBtn.addEventListener('click', () => {\n        openModal();\n      });\n    }\n    if (refs.searchInput) {\n      refs.searchInput.addEventListener('input', () => {\n        const modalState = ensureModalState();\n        modalState.query = refs.searchInput.value || '';\n        queueStateSave();\n        scheduleSearchReload();\n      });\n    }\n    if (refs.modeToggle) {\n      refs.modeToggle.addEventListener('change', async () => {\n        await handleModeToggle(!!refs.modeToggle.checked);\n      });\n    }\n    if (refs.viewSelectedToggle) {\n      refs.viewSelectedToggle.addEventListener('change', () => {\n        handleViewSelectedToggle(!!refs.viewSelectedToggle.checked);\n      });\n    }\n    if (refs.scrollEl) {\n      refs.scrollEl.addEventListener('scroll', handleScroll);\n    }\n    if (refs.bodyEl) {\n      refs.bodyEl.addEventListener('input', handleBodyInput);\n      refs.bodyEl.addEventListener('change', handleBodyInput);\n    }\n    refs.modalEl.querySelectorAll('.bulk-oil-sort').forEach(button => {\n      button.addEventListener('click', handleSortClick);\n    });\n    if (refs.importBtn) {\n      refs.importBtn.addEventListener('click', () => {\n        saveAndClose();\n      });\n    }\n    if (refs.clearBtn) {\n      refs.clearBtn.addEventListener('click', () => {\n        clearSelection();\n      });\n    }\n    refs.modalEl.addEventListener('shown.bs.modal', () => {\n      const localRefs = getRefs();\n      if (localRefs.searchInput) localRefs.searchInput.focus();\n    });\n  }\n\n  bindEvents();\n  updateSelectionCounters();\n  sortButtonsLabel();\n\n  SoapTool.bulkOilsModal = {\n    openModal,\n    serializeSelection,\n    restoreState,\n    onUnitChanged,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { toNumber, round, clamp, buildSoapcalcSearchBuilder } = SoapTool.helpers;\n  const { formatWeight, toGrams, fromGrams } = SoapTool.units;\n  const { FRAGRANCE_CATEGORY_SET } = SoapTool.constants;\n  const state = SoapTool.state;\n\n  function attachAdditiveTypeahead(inputId, hiddenId, categorySet, unitId, categoryId){\n    const input = document.getElementById(inputId);\n    const hidden = document.getElementById(hiddenId);\n    const hiddenUnit = unitId ? document.getElementById(unitId) : null;\n    const hiddenCategory = categoryId ? document.getElementById(categoryId) : null;\n    const list = input?.parentElement?.querySelector('[data-role=\"suggestions\"]');\n    if (!input || !list || typeof window.attachMergedInventoryGlobalTypeahead !== 'function') return;\n    const builder = buildSoapcalcSearchBuilder();\n    window.attachMergedInventoryGlobalTypeahead({\n      inputEl: input,\n      listEl: list,\n      mode: 'public',\n      giHiddenEl: hidden,\n      includeInventory: false,\n      includeGlobal: true,\n      ingredientFirst: false,\n      globalUrlBuilder: builder,\n      searchType: 'ingredient',\n      resultFilter: (item, source) => {\n        const category = getItemCategoryName(item);\n        if (!category) return source === 'inventory';\n        return categorySet.has(category);\n      },\n      requireHidden: false,\n      onSelection: function(picked){\n        if (hiddenUnit) hiddenUnit.value = picked?.default_unit || '';\n        if (hiddenCategory) hiddenCategory.value = picked?.ingredient_category_name || '';\n        SoapTool.storage.queueStateSave();\n      }\n    });\n    input.addEventListener('input', function(){\n      if (!this.value.trim()) {\n        if (hiddenUnit) hiddenUnit.value = '';\n        if (hiddenCategory) hiddenCategory.value = '';\n      }\n    });\n  }\n\n  function readAdditivePct({ pctId, weightId }){\n    const pctInput = document.getElementById(pctId);\n    const pctRaw = pctInput?.value;\n    if (pctRaw !== '' && pctRaw !== null && pctRaw !== undefined) {\n      return toNumber(pctRaw);\n    }\n    const totalOils = clamp(SoapTool.oils?.getTotalOilsGrams?.() || 0, 0);\n    if (totalOils <= 0) return 0;\n    const weightGrams = toGrams(document.getElementById(weightId)?.value);\n    if (weightGrams <= 0) return 0;\n    return (weightGrams / totalOils) * 100;\n  }\n\n  function collectAdditiveSettings(){\n    return {\n      lactatePct: readAdditivePct({ pctId: 'additiveLactatePct', weightId: 'additiveLactateWeight' }),\n      sugarPct: readAdditivePct({ pctId: 'additiveSugarPct', weightId: 'additiveSugarWeight' }),\n      saltPct: readAdditivePct({ pctId: 'additiveSaltPct', weightId: 'additiveSaltWeight' }),\n      citricPct: readAdditivePct({ pctId: 'additiveCitricPct', weightId: 'additiveCitricWeight' }),\n      lactateName: document.getElementById('additiveLactateName')?.value?.trim() || 'Sodium Lactate',\n      sugarName: document.getElementById('additiveSugarName')?.value?.trim() || 'Sugar',\n      saltName: document.getElementById('additiveSaltName')?.value?.trim() || 'Salt',\n      citricName: document.getElementById('additiveCitricName')?.value?.trim() || 'Citric Acid',\n    };\n  }\n\n  function applyComputedOutputs(outputs){\n    const setOutput = (id, value) => {\n      const el = document.getElementById(id);\n      if (!el) return;\n      if (el.tagName === 'INPUT') {\n        el.value = value;\n      } else {\n        el.textContent = value;\n      }\n    };\n    const toDisplay = (grams) => (grams > 0 ? round(fromGrams(grams), 2) : '');\n    setOutput('additiveLactateWeight', toDisplay(toNumber(outputs?.lactateG)));\n    setOutput('additiveSugarWeight', toDisplay(toNumber(outputs?.sugarG)));\n    setOutput('additiveSaltWeight', toDisplay(toNumber(outputs?.saltG)));\n    setOutput('additiveCitricWeight', toDisplay(toNumber(outputs?.citricG)));\n    setOutput('additiveCitricLyeOut', formatWeight(toNumber(outputs?.citricLyeG)));\n  }\n\n  function updateAdditivesOutput(totalOils){\n    const expectedOils = clamp(toNumber(totalOils), 0);\n    const calc = SoapTool.state?.lastCalc;\n    const calcOils = clamp(toNumber(calc?.totalOils), 0);\n    const oilsMatch = Math.abs(calcOils - expectedOils) < 0.01;\n    const outputs = (calc?.additives && oilsMatch)\n      ? calc.additives\n      : { lactateG: 0, sugarG: 0, saltG: 0, citricG: 0, citricLyeG: 0 };\n    applyComputedOutputs(outputs);\n    return outputs;\n  }\n\n  function attachFragranceTypeahead(row){\n    const input = row.querySelector('.fragrance-typeahead');\n    const hidden = row.querySelector('.fragrance-gi-id');\n    const hiddenUnit = row.querySelector('.fragrance-default-unit');\n    const hiddenCategory = row.querySelector('.fragrance-category');\n    const list = row.querySelector('[data-role=\"suggestions\"]');\n    if (!input || !list || typeof window.attachMergedInventoryGlobalTypeahead !== 'function') return;\n    const builder = buildSoapcalcSearchBuilder();\n    window.attachMergedInventoryGlobalTypeahead({\n      inputEl: input,\n      listEl: list,\n      mode: 'public',\n      giHiddenEl: hidden,\n      includeInventory: false,\n      includeGlobal: true,\n      ingredientFirst: false,\n      globalUrlBuilder: builder,\n      searchType: 'ingredient',\n      resultFilter: (item, source) => {\n        const category = getItemCategoryName(item);\n        if (!category) return source === 'inventory';\n        return FRAGRANCE_CATEGORY_SET.has(category);\n      },\n      requireHidden: false,\n      onSelection: function(picked){\n        if (hiddenUnit) hiddenUnit.value = picked?.default_unit || '';\n        if (hiddenCategory) hiddenCategory.value = picked?.ingredient_category_name || '';\n        SoapTool.storage.queueStateSave();\n      }\n    });\n    input.addEventListener('input', function(){\n      if (!this.value.trim()) {\n        if (hiddenUnit) hiddenUnit.value = '';\n        if (hiddenCategory) hiddenCategory.value = '';\n      }\n    });\n  }\n\n  function buildFragranceRow(){\n    const template = document.getElementById('fragranceRowTemplate');\n    const row = template?.content?.querySelector('.fragrance-row')?.cloneNode(true);\n    if (!row) return document.createElement('div');\n    row.querySelectorAll('input').forEach(input => {\n      input.value = '';\n    });\n    attachFragranceTypeahead(row);\n    row.querySelectorAll('.unit-suffix').forEach(el => {\n      el.dataset.suffix = state.currentUnit;\n    });\n    return row;\n  }\n\n  function updateFragranceTotals(totalOils){\n    const rows = Array.from(document.querySelectorAll('#fragranceRows .fragrance-row'));\n    const target = clamp(totalOils || SoapTool.oils.getTotalOilsGrams() || 0, 0);\n    let totalGrams = 0;\n    let totalPct = 0;\n    rows.forEach(row => {\n      const gramsInput = row.querySelector('.fragrance-grams');\n      const pctInput = row.querySelector('.fragrance-percent');\n      const grams = toGrams(gramsInput?.value);\n      const pct = clamp(toNumber(pctInput?.value), 0);\n      let effectiveGrams = grams;\n      let effectivePct = pct;\n      if (target > 0) {\n        if (effectiveGrams <= 0 && effectivePct > 0) {\n          effectiveGrams = target * (effectivePct / 100);\n        } else if (effectivePct <= 0 && effectiveGrams > 0) {\n          effectivePct = (effectiveGrams / target) * 100;\n        }\n      }\n      if (effectiveGrams > 0) totalGrams += effectiveGrams;\n      totalPct += effectivePct;\n    });\n    const totalPctEl = document.getElementById('fragrancePercentTotal');\n    if (totalPctEl) totalPctEl.textContent = round(totalPct, 2);\n    const totalWeightEl = document.getElementById('fragranceTotalComputed');\n    if (totalWeightEl) totalWeightEl.textContent = totalGrams > 0 ? formatWeight(totalGrams) : '--';\n    return { totalGrams, totalPct };\n  }\n\n  function collectFragranceData(){\n    const rows = [];\n    document.querySelectorAll('#fragranceRows .fragrance-row').forEach(row => {\n      const name = row.querySelector('.fragrance-typeahead')?.value?.trim() || '';\n      const grams = row.querySelector('.fragrance-grams')?.value || '';\n      const percent = row.querySelector('.fragrance-percent')?.value || '';\n      const gi = row.querySelector('.fragrance-gi-id')?.value || '';\n      const defaultUnit = row.querySelector('.fragrance-default-unit')?.value || '';\n      const categoryName = row.querySelector('.fragrance-category')?.value || '';\n      if (!name && !grams && !percent && !gi) return;\n      rows.push({\n        name,\n        grams,\n        percent,\n        gi,\n        defaultUnit,\n        categoryName,\n      });\n    });\n    return rows;\n  }\n\n  function updateVisualGuidance(data){\n    const list = document.getElementById('soapVisualGuidanceList');\n    if (!list) return;\n    const tips = Array.isArray(data?.tips) && data.tips.length\n      ? data.tips\n      : ['No visual flags detected for this formula.'];\n    list.innerHTML = tips.map(tip => `<li>${tip}</li>`).join('');\n  }\n\n  function getItemCategoryName(item){\n    if (!item || typeof item !== 'object') return null;\n    return (item.ingredient && item.ingredient.ingredient_category_name)\n      || item.ingredient_category_name\n      || (item.ingredient_category && item.ingredient_category.name)\n      || null;\n  }\n\n  SoapTool.additives = {\n    attachAdditiveTypeahead,\n    collectAdditiveSettings,\n    applyComputedOutputs,\n    updateAdditivesOutput,\n    updateVisualGuidance,\n  };\n  SoapTool.fragrances = {\n    buildFragranceRow,\n    updateFragranceTotals,\n    collectFragranceData,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { toNumber } = SoapTool.helpers;\n  const { STAGE_CONFIGS } = SoapTool.constants;\n\n  function openStageByIndex(index){\n    const stage = STAGE_CONFIGS[index];\n    if (!stage) return;\n    const tabButton = document.getElementById(stage.tabId);\n    if (!tabButton) return;\n    if (window.bootstrap?.Tab) {\n      bootstrap.Tab.getOrCreateInstance(tabButton).show();\n    } else {\n      document.querySelectorAll('#soapStageTabList .nav-link').forEach(btn => {\n        btn.classList.remove('active');\n        btn.setAttribute('aria-selected', 'false');\n      });\n      document.querySelectorAll('#soapStageTabContent .tab-pane').forEach(pane => {\n        pane.classList.remove('show', 'active');\n      });\n      tabButton.classList.add('active');\n      tabButton.setAttribute('aria-selected', 'true');\n      const pane = document.getElementById(stage.paneId);\n      if (pane) pane.classList.add('show', 'active');\n    }\n    SoapTool.layout.scheduleStageHeightSync();\n    tabButton.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });\n  }\n\n  function resetStage(stageId){\n    if (stageId === 1) {\n      const unitGrams = document.getElementById('unitGrams');\n      if (unitGrams) unitGrams.checked = true;\n      SoapTool.units.setUnit('g', { skipAutoCalc: true });\n      document.getElementById('moldWaterWeight').value = '';\n      document.getElementById('moldOilPct').value = '65';\n      document.getElementById('oilTotalTarget').value = '';\n      document.getElementById('moldShape').value = 'loaf';\n      const correction = document.getElementById('moldCylinderCorrection');\n      if (correction) correction.checked = false;\n      document.getElementById('moldCylinderFactor').value = '0.85';\n      SoapTool.mold.updateMoldShapeUI();\n      if (SoapTool.mold?.updateWetBatterWarning) {\n        SoapTool.mold.updateWetBatterWarning(0);\n      }\n    }\n    if (stageId === 2) {\n      const oilRows = document.getElementById('oilRows');\n      if (oilRows) {\n        oilRows.innerHTML = '';\n        oilRows.appendChild(SoapTool.oils.buildOilRow());\n      }\n      SoapTool.oils.updateOilTotals();\n    }\n    if (stageId === 3) {\n      const lyeNaoh = document.getElementById('lyeTypeNaoh');\n      if (lyeNaoh) lyeNaoh.checked = true;\n      const waterMethod = document.getElementById('waterMethod');\n      if (waterMethod) waterMethod.value = 'percent';\n      const superfat = document.getElementById('lyeSuperfat');\n      if (superfat) superfat.value = '5';\n      const purity = document.getElementById('lyePurity');\n      if (purity) purity.value = '100';\n      const waterPct = document.getElementById('waterPct');\n      if (waterPct) waterPct.value = '33';\n      const lyeConcentration = document.getElementById('lyeConcentration');\n      if (lyeConcentration) lyeConcentration.value = '33';\n      const waterRatio = document.getElementById('waterRatio');\n      if (waterRatio) waterRatio.value = '2';\n      SoapTool.runner.applyLyeSelection();\n      SoapTool.runner.setWaterMethod();\n      SoapTool.additives.updateAdditivesOutput(SoapTool.oils.getTotalOilsGrams());\n    }\n    if (stageId === 4) {\n      document.getElementById('additiveLactatePct').value = '1';\n      document.getElementById('additiveSugarPct').value = '1';\n      document.getElementById('additiveSaltPct').value = '0.5';\n      document.getElementById('additiveCitricPct').value = '0';\n      ['additiveLactateName', 'additiveSugarName', 'additiveSaltName', 'additiveCitricName']\n        .forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });\n      ['additiveLactateGi', 'additiveSugarGi', 'additiveSaltGi', 'additiveCitricGi']\n        .forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });\n      SoapTool.additives.updateAdditivesOutput(SoapTool.oils.getTotalOilsGrams());\n    }\n    if (stageId === 5) {\n      const fragranceRows = document.getElementById('fragranceRows');\n      if (fragranceRows) {\n        fragranceRows.innerHTML = '';\n        if (SoapTool.fragrances?.buildFragranceRow) {\n          fragranceRows.appendChild(SoapTool.fragrances.buildFragranceRow());\n        }\n      }\n      const totalPct = document.getElementById('fragrancePercentTotal');\n      if (totalPct) totalPct.textContent = '0';\n      const totalWeight = document.getElementById('fragranceTotalComputed');\n      if (totalWeight) totalWeight.textContent = '--';\n    }\n    SoapTool.storage.queueStateSave();\n    SoapTool.storage.queueAutoCalc();\n    updateStageStatuses();\n  }\n\n  function getStageCompletion(stageId){\n    if (stageId === 1) {\n      const moldWeight = toNumber(document.getElementById('moldWaterWeight').value);\n      const oilTarget = toNumber(document.getElementById('oilTotalTarget').value);\n      const moldPct = toNumber(document.getElementById('moldOilPct').value);\n      const hasUnit = !!document.querySelector('input[name=\"weight_unit\"]:checked');\n      const complete = hasUnit && (moldWeight > 0 || oilTarget > 0) && moldPct > 0;\n      return { state: complete ? 'complete' : 'incomplete', label: complete ? 'Sized' : 'Needs target' };\n    }\n    if (stageId === 2) {\n      const rows = Array.from(document.querySelectorAll('#oilRows .oil-row'));\n      const hasOil = rows.some(row => {\n        const name = row.querySelector('.oil-typeahead')?.value?.trim();\n        const grams = toNumber(row.querySelector('.oil-grams')?.value);\n        const pct = toNumber(row.querySelector('.oil-percent')?.value);\n        return name && (grams > 0 || pct > 0);\n      });\n      return { state: hasOil ? 'complete' : 'incomplete', label: hasOil ? 'Oils added' : 'Add oils' };\n    }\n    if (stageId === 3) {\n      const superfat = toNumber(document.getElementById('lyeSuperfat').value);\n      const method = document.getElementById('waterMethod')?.value;\n      const hasLye = !!document.querySelector('input[name=\"lye_type\"]:checked');\n      const complete = hasLye && !!method && superfat >= 0;\n      return { state: complete ? 'complete' : 'incomplete', label: complete ? 'Configured' : 'Set lye' };\n    }\n    if (stageId === 4) {\n      const hasAdditive = ['additiveLactatePct', 'additiveSugarPct', 'additiveSaltPct', 'additiveCitricPct']\n        .some(id => toNumber(document.getElementById(id).value) > 0);\n      return { state: 'optional', label: hasAdditive ? 'Added' : 'Optional' };\n    }\n    if (stageId === 5) {\n      const rows = Array.from(document.querySelectorAll('#fragranceRows .fragrance-row'));\n      const hasFragrance = rows.some(row => {\n        const name = row.querySelector('.fragrance-typeahead')?.value?.trim();\n        const grams = toNumber(row.querySelector('.fragrance-grams')?.value);\n        const pct = toNumber(row.querySelector('.fragrance-percent')?.value);\n        return name || grams > 0 || pct > 0;\n      });\n      return { state: 'optional', label: hasFragrance ? 'Added' : 'Optional' };\n    }\n    return { state: 'incomplete', label: 'Incomplete' };\n  }\n\n  function updateStageStatuses(){\n    const tabList = document.getElementById('soapStageTabList');\n    if (tabList) {\n      tabList.querySelectorAll('.soap-stage-status').forEach(el => el.remove());\n    }\n    const progress = document.getElementById('soapStageProgress');\n    if (progress) progress.textContent = '';\n  }\n\n  SoapTool.stages = {\n    openStageByIndex,\n    resetStage,\n    updateStageStatuses,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { round, toNumber, clamp } = SoapTool.helpers;\n  const { computeFattyAcids, computeQualities, computeOilQualityScores } = SoapTool.calc;\n  const {\n    QUALITY_RANGES,\n    QUALITY_HINTS,\n    QUALITY_FEEL_HINTS,\n    IODINE_RANGE,\n    IODINE_SCALE_MAX,\n    INS_RANGE,\n    INS_SCALE_MAX,\n    QUALITY_BASE,\n    QUALITY_PRESETS,\n    FATTY_BAR_COLORS,\n    FATTY_DISPLAY_KEYS,\n  } = SoapTool.constants;\n\n  const { pulseValue, showSoapAlert } = SoapTool.ui;\n\n  function setBarFill({ barId, fillId, value, max, label }){\n    const bar = document.getElementById(barId);\n    const fill = document.getElementById(fillId);\n    if (!bar || !fill) return null;\n    const safeValue = isFinite(value) ? value : 0;\n    const clamped = Math.max(0, Math.min(max, safeValue));\n    const width = max > 0 ? (clamped / max) * 100 : 0;\n    fill.style.width = `${width}%`;\n    bar.setAttribute('aria-valuemin', '0');\n    bar.setAttribute('aria-valuemax', String(max));\n    bar.setAttribute('aria-valuenow', clamped.toFixed(1));\n    if (label) {\n      bar.setAttribute('aria-label', label);\n    }\n    return { bar, fill, value: safeValue };\n  }\n\n  function setQualityBarColor(fill, value, range){\n    if (!fill || !range) return;\n    fill.classList.remove('bg-success', 'bg-warning', 'bg-danger', 'bg-secondary');\n    if (!isFinite(value)) {\n      fill.classList.add('bg-secondary');\n      return;\n    }\n    if (value < range[0]) {\n      fill.classList.add('bg-warning');\n    } else if (value > range[1]) {\n      fill.classList.add('bg-danger');\n    } else {\n      fill.classList.add('bg-success');\n    }\n  }\n\n  function setScaledBar(barId, fillId, value, range, max, label){\n    const result = setBarFill({ barId, fillId, value, max, label });\n    if (!result) return;\n    setQualityBarColor(result.fill, value, range);\n  }\n\n  function setQualityRangeBars(){\n    const rangeConfig = {\n      hardness: { range: QUALITY_RANGES.hardness, scale: 100 },\n      cleansing: { range: QUALITY_RANGES.cleansing, scale: 100 },\n      conditioning: { range: QUALITY_RANGES.conditioning, scale: 100 },\n      bubbly: { range: QUALITY_RANGES.bubbly, scale: 100 },\n      creamy: { range: QUALITY_RANGES.creamy, scale: 100 },\n      iodine: { range: IODINE_RANGE, scale: IODINE_SCALE_MAX },\n      ins: { range: INS_RANGE, scale: INS_SCALE_MAX },\n    };\n    Object.entries(rangeConfig).forEach(([key, config]) => {\n      const [min, max] = config.range;\n      const scale = config.scale;\n      const name = key.charAt(0).toUpperCase() + key.slice(1);\n      const barId = key === 'iodine' ? 'iodineBar' : (key === 'ins' ? 'insBar' : `quality${name}Bar`);\n      const safe = document.getElementById(`quality${name}Safe`);\n      if (safe) {\n        const startPct = Math.max(0, Math.min(100, (min / scale) * 100));\n        const widthPct = Math.max(0, Math.min(100, ((max - min) / scale) * 100));\n        safe.style.left = `${startPct}%`;\n        safe.style.width = `${widthPct}%`;\n        safe.title = `Safe range ${round(min, 0)}-${round(max, 0)}`;\n      }\n      const bar = document.getElementById(barId);\n      if (bar) {\n        bar.dataset.safeRange = `${round(min, 0)}-${round(max, 0)}`;\n      }\n      const minLabel = document.getElementById(`quality${name}RangeMin`);\n      const maxLabel = document.getElementById(`quality${name}RangeMax`);\n      if (minLabel) minLabel.textContent = round(min, 0);\n      if (maxLabel) maxLabel.textContent = round(max, 0);\n    });\n  }\n\n  function updateQualitySliders(qualities, superfat){\n    const hardness = clamp(qualities.hardness || 0, 0, 100);\n    const bubbly = clamp(qualities.bubbly || 0, 0, 100);\n    const conditioning = clamp(qualities.conditioning || 0, 0, 100);\n    const greasyScore = clamp(conditioning + (superfat || 0) * 3, 0, 100);\n    const hardEl = document.getElementById('feelHardness');\n    const bubblyEl = document.getElementById('feelBubbly');\n    const conditioningEl = document.getElementById('feelConditioning');\n    const greasyEl = document.getElementById('feelGreasy');\n    if (hardEl) hardEl.value = round(hardness, 1);\n    if (bubblyEl) bubblyEl.value = round(bubbly, 1);\n    if (conditioningEl) conditioningEl.value = round(conditioning, 1);\n    if (greasyEl) greasyEl.value = round(greasyScore, 1);\n  }\n\n  function updateFattyBar(fattyPercent){\n    FATTY_DISPLAY_KEYS.forEach(key => {\n      const el = document.getElementById(`fattyBar${key.charAt(0).toUpperCase()}${key.slice(1)}`);\n      if (!el) return;\n      const value = clamp(toNumber(fattyPercent[key]), 0, 100);\n      const width = value;\n      el.style.width = `${width}%`;\n      el.style.backgroundColor = FATTY_BAR_COLORS[key] || 'var(--color-muted)';\n      el.title = `${key.charAt(0).toUpperCase()}${key.slice(1)}: ${round(value, 1)}%`;\n    });\n  }\n\n  function getQualityTargets(){\n    const preset = document.getElementById('qualityPreset')?.value || 'balanced';\n    const focusEls = Array.from(document.querySelectorAll('.quality-focus:checked'));\n    if (preset === 'none' && !focusEls.length) return null;\n    const base = preset === 'none'\n      ? { ...QUALITY_BASE }\n      : (QUALITY_PRESETS[preset] ? { ...QUALITY_PRESETS[preset] } : { ...QUALITY_BASE });\n    focusEls.forEach(el => {\n      const attr = el.dataset.attr;\n      const direction = el.dataset.direction;\n      const range = QUALITY_RANGES[attr];\n      if (!range) return;\n      base[attr] = direction === 'low' ? range[0] : range[1];\n    });\n    return base;\n  }\n\n  function updateQualityTargets(){\n    const targets = getQualityTargets();\n    const markers = {\n      hardness: document.getElementById('qualityHardnessTarget'),\n      cleansing: document.getElementById('qualityCleansingTarget'),\n      conditioning: document.getElementById('qualityConditioningTarget'),\n      bubbly: document.getElementById('qualityBubblyTarget'),\n      creamy: document.getElementById('qualityCreamyTarget'),\n      iodine: document.getElementById('iodineTarget'),\n      ins: document.getElementById('insTarget'),\n    };\n    Object.entries(markers).forEach(([key, marker]) => {\n      if (!marker) return;\n      const labelEl = document.getElementById(`${marker.id}Label`);\n      if (!targets) {\n        marker.classList.add('d-none');\n        if (labelEl) labelEl.textContent = '';\n        return;\n      }\n      const value = toNumber(targets[key]);\n      if (!isFinite(value)) {\n        marker.classList.add('d-none');\n        if (labelEl) labelEl.textContent = '';\n        return;\n      }\n      const scaleMax = key === 'iodine' ? IODINE_SCALE_MAX : (key === 'ins' ? INS_SCALE_MAX : 100);\n      const clamped = clamp(value, 0, scaleMax);\n      marker.classList.remove('d-none');\n      marker.style.left = `${(clamped / scaleMax) * 100}%`;\n      marker.setAttribute('aria-label', `Apply ${key} target`);\n      marker.setAttribute('role', 'button');\n      marker.setAttribute('tabindex', '0');\n      marker.title = `Target ${key}: ${round(value, 1)}`;\n      if (labelEl) {\n        labelEl.textContent = round(value, 1);\n      }\n    });\n  }\n\n  function applyQualityTargets(){\n    const targets = getQualityTargets();\n    if (!targets) {\n      showSoapAlert('info', 'Select a quality target to nudge the blend.', { dismissible: true, timeoutMs: 5000 });\n      return;\n    }\n    const rows = Array.from(document.querySelectorAll('#oilRows .oil-row'));\n    const oils = rows.map(row => {\n      const grams = SoapTool.units.toGrams(row.querySelector('.oil-grams')?.value);\n      const fattyRaw = row.querySelector('.oil-fatty')?.value || '';\n      let fattyProfile = null;\n      if (fattyRaw) {\n        try {\n          fattyProfile = JSON.parse(fattyRaw);\n        } catch (_) {\n          fattyProfile = null;\n        }\n      }\n      return { row, grams, fattyProfile };\n    }).filter(item => item.grams > 0);\n\n    if (!oils.length) {\n      showSoapAlert('warning', 'Add oils before nudging toward a target.', { dismissible: true, timeoutMs: 5000 });\n      return;\n    }\n\n    const fatty = computeFattyAcids(oils.map(oil => ({\n      grams: oil.grams,\n      fattyProfile: oil.fattyProfile,\n    })));\n    const currentQualities = computeQualities(fatty.percent);\n    const deltas = {\n      hardness: clamp((targets.hardness - currentQualities.hardness) / 100, -1, 1),\n      cleansing: clamp((targets.cleansing - currentQualities.cleansing) / 100, -1, 1),\n      conditioning: clamp((targets.conditioning - currentQualities.conditioning) / 100, -1, 1),\n      bubbly: clamp((targets.bubbly - currentQualities.bubbly) / 100, -1, 1),\n      creamy: clamp((targets.creamy - currentQualities.creamy) / 100, -1, 1),\n    };\n\n    const totalOils = oils.reduce((sum, oil) => sum + oil.grams, 0);\n    const adjusted = [];\n    let totalAdjusted = 0;\n    const strength = 0.8;\n    const missingFatty = oils.filter(oil => !oil.fattyProfile || typeof oil.fattyProfile !== 'object').length;\n    if (missingFatty === oils.length) {\n      showSoapAlert('warning', 'None of the selected oils have fatty acid data, so targets cannot be applied.', { dismissible: true, timeoutMs: 6000 });\n      return;\n    }\n    if (missingFatty) {\n      showSoapAlert('info', 'Some oils are missing fatty acid data. The nudge will only use oils with profiles.', { dismissible: true, timeoutMs: 5000 });\n    }\n\n    oils.forEach(oil => {\n      const scores = computeOilQualityScores(oil.fattyProfile);\n      const adjustment = (deltas.hardness * scores.hardness)\n        + (deltas.cleansing * scores.cleansing)\n        + (deltas.conditioning * scores.conditioning)\n        + (deltas.bubbly * scores.bubbly)\n        + (deltas.creamy * scores.creamy);\n      const factor = clamp(1 + adjustment * strength, 0.2, 1.8);\n      const next = oil.grams * factor;\n      adjusted.push({ row: oil.row, grams: next });\n      totalAdjusted += next;\n    });\n\n    if (totalAdjusted <= 0) {\n      showSoapAlert('warning', 'Unable to adjust blend with current data.', { dismissible: true, timeoutMs: 5000 });\n      return;\n    }\n\n    const scale = totalOils / totalAdjusted;\n    const target = SoapTool.oils.getOilTargetGrams() || totalOils;\n    adjusted.forEach(item => {\n      const grams = item.grams * scale;\n      const gramsInput = item.row.querySelector('.oil-grams');\n      const pctInput = item.row.querySelector('.oil-percent');\n      if (gramsInput) gramsInput.value = grams > 0 ? round(SoapTool.units.fromGrams(grams), 2) : '';\n      if (pctInput && target > 0) {\n        const percent = (grams / target) * 100;\n        pctInput.value = percent > 0 ? round(percent, 2) : '';\n      }\n    });\n\n    SoapTool.oils.updateOilTotals();\n    SoapTool.storage.queueStateSave();\n    SoapTool.storage.queueAutoCalc();\n    showSoapAlert('info', 'Blend nudged toward selected targets. Re-check results and adjust as needed.', { dismissible: true, timeoutMs: 6000 });\n  }\n\n  function updateQualitiesDisplay(data){\n    const {\n      qualities,\n      fattyPercent,\n      coveragePct,\n      iodine,\n      ins,\n      sapAvg,\n      superfat,\n      warnings: serviceWarnings,\n    } = data;\n\n    const hasCoverage = coveragePct > 0;\n\n    function setQuality(name, value){\n      const label = document.getElementById(`quality${name}Value`);\n      const hintEl = document.getElementById(`quality${name}Hint`);\n      if (!label) return;\n      label.textContent = hasCoverage && isFinite(value) ? round(value, 1) : '--';\n      pulseValue(label);\n      const rangeKey = name.toLowerCase();\n      const range = QUALITY_RANGES[rangeKey];\n      const fillResult = setBarFill({\n        barId: `quality${name}Bar`,\n        fillId: `quality${name}Fill`,\n        value: hasCoverage ? value : 0,\n        max: 100,\n        label: name\n      });\n      if (fillResult && range) {\n        setQualityBarColor(fillResult.fill, value, range);\n        if (hasCoverage && isFinite(value)) {\n          fillResult.bar.title = `${name}: ${round(value, 1)} (safe ${range[0]}-${range[1]}). ${QUALITY_HINTS[rangeKey] || ''}`.trim();\n        } else {\n          fillResult.bar.title = `${name}: -- (safe ${range[0]}-${range[1]}). ${QUALITY_HINTS[rangeKey] || ''}`.trim();\n        }\n      }\n      if (hintEl && range) {\n        if (!hasCoverage || !isFinite(value)) {\n          hintEl.textContent = '';\n        } else if (value < range[0]) {\n          hintEl.textContent = QUALITY_FEEL_HINTS[rangeKey]?.low || '';\n        } else if (value > range[1]) {\n          hintEl.textContent = QUALITY_FEEL_HINTS[rangeKey]?.high || '';\n        } else {\n          hintEl.textContent = '';\n        }\n      }\n    }\n\n    setQuality('Hardness', qualities.hardness);\n    setQuality('Cleansing', qualities.cleansing);\n    setQuality('Conditioning', qualities.conditioning);\n    setQuality('Bubbly', qualities.bubbly);\n    setQuality('Creamy', qualities.creamy);\n\n    const coverageNote = document.getElementById('fattyCoverageNote');\n    if (coverageNote) {\n      coverageNote.textContent = coveragePct > 0\n        ? `Fatty acid coverage: ${round(coveragePct, 1)}% of oils`\n        : 'Fatty acid coverage: not enough data yet';\n    }\n\n    const iodineEl = document.getElementById('iodineValue');\n    const insEl = document.getElementById('insValue');\n    const sapEl = document.getElementById('sapAvgValue');\n    if (iodineEl) {\n      iodineEl.textContent = iodine > 0 ? round(iodine, 1) : '--';\n      pulseValue(iodineEl);\n    }\n    if (insEl) {\n      insEl.textContent = ins > 0 ? round(ins, 1) : '--';\n      pulseValue(insEl);\n    }\n    if (sapEl) {\n      sapEl.textContent = sapAvg > 0 ? round(sapAvg, 1) : '--';\n      pulseValue(sapEl);\n    }\n    setScaledBar('iodineBar', 'iodineFill', iodine, IODINE_RANGE, IODINE_SCALE_MAX, 'Iodine');\n    setScaledBar('insBar', 'insFill', ins, INS_RANGE, INS_SCALE_MAX, 'INS');\n\n    const sat = (fattyPercent.lauric || 0) + (fattyPercent.myristic || 0) + (fattyPercent.palmitic || 0) + (fattyPercent.stearic || 0);\n    const unsat = (fattyPercent.ricinoleic || 0) + (fattyPercent.oleic || 0) + (fattyPercent.linoleic || 0) + (fattyPercent.linolenic || 0);\n    const ratioEl = document.getElementById('fattySatRatioResult');\n    if (ratioEl) {\n      ratioEl.textContent = (sat + unsat) > 0 ? `${round(sat, 0)}:${round(unsat, 0)}` : '--';\n      pulseValue(ratioEl);\n    }\n\n    FATTY_DISPLAY_KEYS.forEach(key => {\n      const id = `fatty${key.charAt(0).toUpperCase()}${key.slice(1)}`;\n      const value = fattyPercent[key];\n      document.getElementById(id).textContent = hasCoverage && value ? `${round(value, 1)}%` : '--';\n    });\n    updateQualitySliders(qualities, superfat || 0);\n    updateFattyBar(fattyPercent);\n    updateQualityTargets();\n\n    const warnings = Array.isArray(serviceWarnings) ? serviceWarnings.slice() : [];\n    const warningBox = document.getElementById('soapQualityWarnings');\n    if (warnings.length) {\n      warningBox.classList.remove('d-none');\n      warningBox.innerHTML = `<strong>Guidance & flags:</strong><ul class=\"mb-0\">${warnings.map(w => `<li>${w}</li>`).join('')}</ul>`;\n    } else {\n      warningBox.classList.add('d-none');\n      warningBox.textContent = '';\n    }\n    SoapTool.layout.scheduleStageHeightSync();\n  }\n\n  function initQualityTooltips(){\n    document.querySelectorAll('.soap-quality-help').forEach(btn => {\n      const key = btn.dataset.quality;\n      if (QUALITY_HINTS[key]) {\n        btn.setAttribute('title', QUALITY_HINTS[key]);\n      }\n    });\n    if (window.bootstrap?.Tooltip) {\n      document.querySelectorAll('[data-bs-toggle=\"tooltip\"]').forEach(el => {\n        bootstrap.Tooltip.getOrCreateInstance(el);\n      });\n    }\n  }\n\n  SoapTool.quality = {\n    setQualityRangeBars,\n    updateQualityTargets,\n    applyQualityTargets,\n    updateQualitiesDisplay,\n    initQualityTooltips,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { round, toNumber, clamp } = SoapTool.helpers;\n\n  function deriveSapAverage(oils){\n    let sapWeighted = 0;\n    let sapWeightG = 0;\n    (oils || []).forEach(oil => {\n      const sapKoh = toNumber(oil?.sapKoh);\n      const grams = toNumber(oil?.grams);\n      if (sapKoh > 0 && grams > 0) {\n        sapWeighted += sapKoh * grams;\n        sapWeightG += grams;\n      }\n    });\n    return sapWeightG > 0 ? sapWeighted / sapWeightG : 0;\n  }\n\n  function buildSoapNotesBlob(calc){\n    const qualityReport = calc.qualityReport || {};\n    const fattyPercent = qualityReport.fatty_acids_pct || {};\n    const qualities = qualityReport.qualities || {};\n    const sapAvg = (isFinite(calc.sapAvg) && calc.sapAvg > 0)\n      ? calc.sapAvg\n      : (toNumber(qualityReport.sap_avg_koh) || deriveSapAverage(calc.oils || []));\n    const iodine = toNumber(qualityReport.iodine);\n    const ins = toNumber(qualityReport.ins) || ((sapAvg && iodine) ? (sapAvg - iodine) : 0);\n    const mold = SoapTool.mold.getMoldSettings();\n    return {\n      source: 'soap_tool',\n      schema_version: 1,\n      unit_display: SoapTool.state.currentUnit,\n      input_mode: 'mixed',\n      quality_preset: document.getElementById('qualityPreset')?.value || 'balanced',\n      quality_focus: Array.from(document.querySelectorAll('.quality-focus:checked')).map(el => el.id),\n      mold,\n      oils: (calc.oils || []).map(oil => ({\n        name: oil.name || null,\n        grams: round(oil.grams || 0, 2),\n        iodine: oil.iodine || null,\n        sap_koh: oil.sapKoh || null,\n        fatty_profile: oil.fattyProfile || null,\n        global_item_id: oil.global_item_id || null,\n        default_unit: oil.default_unit || null,\n        ingredient_category_name: oil.ingredient_category_name || null,\n      })),\n      totals: {\n        total_oils_g: round(calc.totalOils || 0, 2),\n        batch_yield_g: round(calc.batchYield || 0, 2),\n        lye_pure_g: round(calc.lyePure || 0, 2),\n        lye_adjusted_g: round(calc.lyeAdjusted || 0, 2),\n        water_g: round(calc.water || 0, 2),\n      },\n      lye: {\n        lye_type: calc.lyeType,\n        superfat: calc.superfat,\n        purity: calc.purity,\n        water_method: calc.waterMethod,\n        water_pct: calc.waterPct,\n        lye_concentration: calc.lyeConcentration,\n        water_ratio: calc.waterRatio,\n      },\n      additives: {\n        fragrance_pct: calc.additives?.fragrancePct || 0,\n        lactate_pct: calc.additives?.lactatePct || 0,\n        sugar_pct: calc.additives?.sugarPct || 0,\n        salt_pct: calc.additives?.saltPct || 0,\n        citric_pct: calc.additives?.citricPct || 0,\n        fragrance_g: round(calc.additives?.fragranceG || 0, 2),\n        lactate_g: round(calc.additives?.lactateG || 0, 2),\n        sugar_g: round(calc.additives?.sugarG || 0, 2),\n        salt_g: round(calc.additives?.saltG || 0, 2),\n        citric_g: round(calc.additives?.citricG || 0, 2),\n        citric_lye_g: round(calc.additives?.citricLyeG || 0, 2),\n      },\n      qualities: {\n        hardness: round(qualities.hardness || 0, 1),\n        cleansing: round(qualities.cleansing || 0, 1),\n        conditioning: round(qualities.conditioning || 0, 1),\n        bubbly: round(qualities.bubbly || 0, 1),\n        creamy: round(qualities.creamy || 0, 1),\n        iodine: round(iodine || 0, 1),\n        ins: round(ins || 0, 1),\n        sap_avg: round(sapAvg || 0, 1),\n      },\n      fatty_acids: fattyPercent,\n      updated_at: new Date().toISOString(),\n    };\n  }\n\n  function getAdditiveItem(nameId, giId, fallbackName, unitId, categoryId){\n    const name = document.getElementById(nameId)?.value?.trim();\n    const giRaw = document.getElementById(giId)?.value || '';\n    const defaultUnit = unitId ? document.getElementById(unitId)?.value || '' : '';\n    const categoryName = categoryId ? document.getElementById(categoryId)?.value || '' : '';\n    return {\n      name: name || fallbackName,\n      globalItemId: giRaw ? parseInt(giRaw) : undefined,\n      defaultUnit: defaultUnit || undefined,\n      categoryName: categoryName || undefined,\n    };\n  }\n\n  function collectFragranceRows(totalOils){\n    const rows = [];\n    const target = clamp(totalOils || SoapTool.oils.getTotalOilsGrams() || 0, 0);\n    document.querySelectorAll('#fragranceRows .fragrance-row').forEach(row => {\n      const name = row.querySelector('.fragrance-typeahead')?.value?.trim();\n      const giRaw = row.querySelector('.fragrance-gi-id')?.value || '';\n      const defaultUnit = row.querySelector('.fragrance-default-unit')?.value || '';\n      const categoryName = row.querySelector('.fragrance-category')?.value || '';\n      const gramsInput = row.querySelector('.fragrance-grams')?.value;\n      const pctInput = row.querySelector('.fragrance-percent')?.value;\n      let grams = SoapTool.units.toGrams(gramsInput);\n      const pct = clamp(toNumber(pctInput), 0);\n      if (grams <= 0 && pct > 0 && target > 0) {\n        grams = target * (pct / 100);\n      }\n      if (!name && !giRaw && grams <= 0) return;\n      rows.push({\n        name: name || 'Fragrance/Essential Oils',\n        globalItemId: giRaw ? parseInt(giRaw) : undefined,\n        defaultUnit: defaultUnit || undefined,\n        categoryName: categoryName || undefined,\n        grams,\n        pct,\n      });\n    });\n    return rows;\n  }\n\n  function collectDraftLines(wrapperId, kind){\n    const out = [];\n    document.querySelectorAll(`#${wrapperId} .row`).forEach(function(row){\n      const name = row.querySelector('.tool-typeahead')?.value?.trim();\n      const gi = row.querySelector('.tool-gi-id')?.value || '';\n      const qtyEl = row.querySelector('.tool-qty');\n      const unitEl = row.querySelector('.tool-unit');\n      const hasQty = qtyEl && qtyEl.value !== '';\n      if (!name && !gi) return;\n      if (kind === 'container'){\n        out.push({ name: name || undefined, global_item_id: gi ? parseInt(gi) : undefined, quantity: hasQty ? parseFloat(qtyEl.value) : 1 });\n      } else {\n        out.push({ name: name || undefined, global_item_id: gi ? parseInt(gi) : undefined, quantity: hasQty ? parseFloat(qtyEl.value) : 0, unit: (unitEl?.value || '').trim() || 'gram' });\n      }\n    });\n    return out;\n  }\n\n  function buildLineRow(kind){\n    const context = SoapTool.config.isAuthenticated ? 'member' : 'public';\n    const mode = SoapTool.config.isAuthenticated ? 'recipe' : 'public';\n    return buildToolLineRow(kind, { context, mode, unitOptionsHtml: SoapTool.config.unitOptionsHtml });\n  }\n\n  function addStubLine(kind, name){\n    const row = buildLineRow(kind);\n    const input = row.querySelector('.tool-typeahead');\n    const qty = row.querySelector('.tool-qty');\n    if (input) {\n      input.value = name;\n    }\n    if (qty && kind === 'container') {\n      qty.value = 1;\n    }\n    if (kind === 'container') {\n      document.getElementById('tool-containers').appendChild(row);\n    } else if (kind === 'consumable') {\n      document.getElementById('tool-consumables').appendChild(row);\n    } else {\n      document.getElementById('tool-ingredients').appendChild(row);\n    }\n  }\n\n  function buildSoapRecipePayload(calc){\n    const notesBlob = buildSoapNotesBlob(calc);\n    const baseIngredients = (calc.oils || []).map(oil => ({\n      name: oil.name || undefined,\n      global_item_id: oil.global_item_id || undefined,\n      quantity: oil.grams,\n      unit: 'gram',\n      default_unit: oil.default_unit || undefined,\n      ingredient_category_name: oil.ingredient_category_name || undefined,\n    }));\n    const lyeName = calc.lyeType === 'KOH' ? 'Potassium Hydroxide (KOH)' : 'Sodium Hydroxide (NaOH)';\n    if (calc.lyeAdjusted > 0) {\n      baseIngredients.push({ name: lyeName, quantity: round(calc.lyeAdjusted, 2), unit: 'gram' });\n    }\n    if (calc.water > 0) {\n      baseIngredients.push({ name: 'Distilled Water', quantity: round(calc.water, 2), unit: 'gram' });\n    }\n    const fragranceRows = collectFragranceRows(calc.totalOils || 0);\n    fragranceRows.forEach(item => {\n      if (item.grams > 0) {\n        baseIngredients.push({\n          name: item.name,\n          global_item_id: item.globalItemId,\n          quantity: round(item.grams, 2),\n          unit: 'gram',\n          default_unit: item.defaultUnit,\n          ingredient_category_name: item.categoryName,\n        });\n      }\n    });\n    if (calc.additives?.lactateG > 0) {\n      const item = getAdditiveItem('additiveLactateName', 'additiveLactateGi', 'Sodium Lactate', 'additiveLactateUnit', 'additiveLactateCategory');\n      baseIngredients.push({\n        name: item.name,\n        global_item_id: item.globalItemId,\n        quantity: round(calc.additives.lactateG, 2),\n        unit: 'gram',\n        default_unit: item.defaultUnit,\n        ingredient_category_name: item.categoryName,\n      });\n    }\n    if (calc.additives?.sugarG > 0) {\n      const item = getAdditiveItem('additiveSugarName', 'additiveSugarGi', 'Sugar', 'additiveSugarUnit', 'additiveSugarCategory');\n      baseIngredients.push({\n        name: item.name,\n        global_item_id: item.globalItemId,\n        quantity: round(calc.additives.sugarG, 2),\n        unit: 'gram',\n        default_unit: item.defaultUnit,\n        ingredient_category_name: item.categoryName,\n      });\n    }\n    if (calc.additives?.saltG > 0) {\n      const item = getAdditiveItem('additiveSaltName', 'additiveSaltGi', 'Salt', 'additiveSaltUnit', 'additiveSaltCategory');\n      baseIngredients.push({\n        name: item.name,\n        global_item_id: item.globalItemId,\n        quantity: round(calc.additives.saltG, 2),\n        unit: 'gram',\n        default_unit: item.defaultUnit,\n        ingredient_category_name: item.categoryName,\n      });\n    }\n    if (calc.additives?.citricG > 0) {\n      const item = getAdditiveItem('additiveCitricName', 'additiveCitricGi', 'Citric Acid', 'additiveCitricUnit', 'additiveCitricCategory');\n      baseIngredients.push({\n        name: item.name,\n        global_item_id: item.globalItemId,\n        quantity: round(calc.additives.citricG, 2),\n        unit: 'gram',\n        default_unit: item.defaultUnit,\n        ingredient_category_name: item.categoryName,\n      });\n      baseIngredients.push({ name: 'Extra Lye for Citric Acid', quantity: round(calc.additives.citricLyeG, 2), unit: 'gram' });\n    }\n    return {\n      name: 'Soap (Draft)',\n      instructions: 'Draft from Soap Tools',\n      predicted_yield: Math.round((calc.batchYield || 0) * 100) / 100,\n      predicted_yield_unit: 'gram',\n      category_name: 'Soaps',\n      category_data: {\n        soap_superfat: calc.superfat,\n        soap_lye_type: calc.lyeType,\n        soap_lye_purity: calc.purity,\n        soap_water_method: calc.waterMethod,\n        soap_water_pct: calc.waterPct,\n        soap_lye_concentration: calc.lyeConcentration,\n        soap_water_ratio: calc.waterRatio,\n        soap_oils_total_g: calc.totalOils,\n        soap_lye_g: calc.lyeAdjusted,\n        soap_water_g: calc.water,\n      },\n      ingredients: baseIngredients.concat(collectDraftLines('tool-ingredients', 'ingredient')),\n      consumables: collectDraftLines('tool-consumables', 'consumable'),\n      containers: collectDraftLines('tool-containers', 'container'),\n      notes: JSON.stringify(notesBlob),\n    };\n  }\n\n  SoapTool.recipePayload = {\n    collectFragranceRows,\n    collectDraftLines,\n    buildLineRow,\n    addStubLine,\n    buildSoapRecipePayload,\n  };\n})(window);\n\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { round, toNumber, clamp } = SoapTool.helpers;\n  const { formatWeight, formatPercent } = SoapTool.units;\n\n  function getLyeSelection(){\n    const selected = document.querySelector('input[name=\"lye_type\"]:checked')?.value || 'NaOH';\n    const purityInput = document.getElementById('lyePurity');\n    const purityRaw = purityInput?.value;\n    let purity = toNumber(purityInput?.value);\n    const lyeType = selected === 'NaOH' ? 'NaOH' : 'KOH';\n    if (purityRaw === '' || purityRaw === null || purityRaw === undefined || !isFinite(purity)) {\n      purity = 100;\n    }\n    return { selected, lyeType, purity };\n  }\n\n  function applyLyeSelection(){\n    const purityInput = document.getElementById('lyePurity');\n    const selection = getLyeSelection();\n    if (!purityInput) return;\n    purityInput.removeAttribute('readonly');\n    if (selection.selected === 'KOH90') {\n      const hint = document.getElementById('lyePurityHint');\n      if (hint) hint.textContent = '90% KOH selected. Safe default purity is 90%.';\n    } else {\n      const hint = document.getElementById('lyePurityHint');\n      if (hint) hint.textContent = 'Safe default is 100%.';\n    }\n  }\n\n  function getWaterMethodHelp(method){\n    if (method === 'concentration') {\n      return 'Concentration mode uses lye amount, so superfat and purity change water.';\n    }\n    if (method === 'ratio') {\n      return 'Ratio mode uses lye amount, so superfat and purity change water.';\n    }\n    return 'Percent mode uses oils total, so superfat changes lye but not water.';\n  }\n\n  function updateStageWaterSummary(summary = null, explicitMethod = null){\n    const waterOutput = document.getElementById('stageWaterOutput');\n    const hintOutput = document.getElementById('stageWaterComputedHint');\n    const method = explicitMethod || summary?.waterMethod || document.getElementById('waterMethod')?.value || 'percent';\n\n    if (waterOutput) {\n      const hasWater = summary && isFinite(summary.waterG) && summary.waterG > 0;\n      waterOutput.textContent = hasWater ? formatWeight(summary.waterG) : '--';\n    }\n    if (!hintOutput) return;\n\n    if (!summary || !isFinite(summary.totalOils) || summary.totalOils <= 0) {\n      hintOutput.textContent = `Set oils in Stage 2 to calculate water. ${getWaterMethodHelp(method)}`;\n      return;\n    }\n\n    if (method === 'concentration') {\n      const concentration = summary.lyeConcentrationInput || summary.lyeConcentration || 0;\n      hintOutput.textContent = `Using ${round(concentration, 1)}% lye concentration from ${formatWeight(summary.lyeAdjusted || 0)} lye.`;\n      return;\n    }\n    if (method === 'ratio') {\n      const ratio = summary.waterRatioInput || summary.waterRatio || 0;\n      hintOutput.textContent = `Using ${round(ratio, 2)} : 1 water-to-lye ratio from ${formatWeight(summary.lyeAdjusted || 0)} lye.`;\n      return;\n    }\n    hintOutput.textContent = `Using ${round(summary.waterPct || 0, 1)}% of total oils (${formatWeight(summary.totalOils)}).`;\n  }\n\n  function updateLiveCalculationPreview(summary = null, explicitMethod = null){\n    const anchorEl = document.getElementById('lyeWaterPreviewAnchor');\n    const lyeEl = document.getElementById('lyePreview');\n    const waterEl = document.getElementById('waterPreview');\n    const concEl = document.getElementById('concPreview');\n    const ratioEl = document.getElementById('ratioPreview');\n    if (!anchorEl && !lyeEl && !waterEl && !concEl && !ratioEl) return;\n\n    const setText = (el, value) => {\n      if (el) el.textContent = value;\n    };\n    const method = explicitMethod || summary?.waterMethod || document.getElementById('waterMethod')?.value || 'percent';\n    const totalOils = toNumber(summary?.totalOils);\n    const lye = toNumber(summary?.lyeAdjusted);\n    const water = toNumber(summary?.waterG);\n    if (totalOils <= 0 || lye <= 0) {\n      setText(anchorEl, 'Based on -- oils. All values update live as you change inputs.');\n      setText(lyeEl, '--');\n      setText(waterEl, '--');\n      setText(concEl, '--');\n      setText(ratioEl, '--');\n      return;\n    }\n\n    const concentration = toNumber(summary?.lyeConcentration) > 0\n      ? toNumber(summary?.lyeConcentration)\n      : ((lye + water) > 0 ? (lye / (lye + water)) * 100 : 0);\n    const ratio = toNumber(summary?.waterRatio) > 0\n      ? toNumber(summary?.waterRatio)\n      : (lye > 0 ? water / lye : 0);\n    setText(anchorEl, `Based on ${formatWeight(totalOils)} oils. All values update live as you change inputs.`);\n    setText(lyeEl, formatWeight(lye));\n    setText(waterEl, formatWeight(water));\n    setText(concEl, concentration > 0 ? formatPercent(concentration) : '--');\n    setText(ratioEl, ratio > 0 ? `${round(ratio, 2)} : 1` : '--');\n\n    if (method === 'concentration') {\n      const concentrationInput = toNumber(summary?.lyeConcentrationInput);\n      if (concentrationInput > 0) {\n        setText(concEl, formatPercent(concentrationInput));\n      }\n    }\n    if (method === 'ratio') {\n      const ratioInput = toNumber(summary?.waterRatioInput);\n      if (ratioInput > 0) {\n        setText(ratioEl, `${round(ratioInput, 2)} : 1`);\n      }\n    }\n  }\n\n  function setWaterMethod(){\n    const method = document.getElementById('waterMethod')?.value || 'percent';\n    document.querySelectorAll('.water-input').forEach(el => {\n      el.classList.toggle('d-none', el.dataset.method !== method);\n    });\n    updateStageWaterSummary(null, method);\n    updateLiveCalculationPreview(null, method);\n  }\n\n  function validateCalculation(){\n    const totals = SoapTool.oils.updateOilTotals();\n    const totalOils = totals.totalWeight;\n    const totalPct = totals.totalPct;\n    const errors = [];\n    const oils = SoapTool.oils.collectOilData();\n    const target = SoapTool.oils.getOilTargetGrams();\n    const percentInputs = Array.from(document.querySelectorAll('#oilRows .oil-percent'))\n      .map(input => clamp(toNumber(input.value), 0));\n    const hasPercent = percentInputs.some(value => value > 0);\n\n    if (!oils.length || totalOils <= 0) {\n      errors.push('Add at least one oil with a weight or percent.');\n    }\n    if (!target && totalOils <= 0 && hasPercent) {\n      errors.push('Enter a total oils target or weights to convert percentages.');\n    }\n    if (target > 0 && totalPct > 0 && Math.abs(totalPct - 100) > 0.5) {\n      errors.push('Oil percentages should total 100% (use Normalize to fix).');\n    }\n    if (target > 0 && totalOils > target + 0.01) {\n      errors.push('Oil weights exceed the mold target.');\n    } else if (!target && totalPct > 100.01) {\n      errors.push('Oil percentages exceed 100%.');\n    }\n    return { ok: errors.length === 0, errors, totals, oils };\n  }\n\n  function readSuperfatInput(){\n    const superfatInput = document.getElementById('lyeSuperfat');\n    const superfatRaw = superfatInput?.value;\n    let superfat = toNumber(superfatRaw);\n    if (superfatRaw === '' || superfatRaw === null || superfatRaw === undefined || !isFinite(superfat)) {\n      superfat = 5;\n    }\n    return superfat;\n  }\n\n  function sanitizeLyeInputs(){\n    const selection = getLyeSelection();\n    let purity = selection.purity;\n    if (!isFinite(purity)) {\n      purity = 100;\n    }\n\n    const waterMethod = document.getElementById('waterMethod')?.value || 'percent';\n    // Do not force defaults or clamp user typing for water inputs.\n    // Backend calculation logic owns method defaults/ranges.\n    const waterPct = toNumber(document.getElementById('waterPct')?.value);\n    const lyeConcentration = toNumber(document.getElementById('lyeConcentration')?.value);\n    const waterRatio = toNumber(document.getElementById('waterRatio')?.value);\n\n    return { purity, waterMethod, waterPct, lyeConcentration, waterRatio };\n  }\n\n  SoapTool.runnerInputs = {\n    getLyeSelection,\n    applyLyeSelection,\n    setWaterMethod,\n    updateStageWaterSummary,\n    updateLiveCalculationPreview,\n    validateCalculation,\n    readSuperfatInput,\n    sanitizeLyeInputs,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { getStorage } = SoapTool.helpers;\n\n  function readCalcUsage(){\n    if (!SoapTool.config.calcLimit) return { count: 0, date: null };\n    const storage = getStorage();\n    if (!storage) return { count: 0, date: null };\n    try {\n      const raw = storage.getItem('soap_calc_usage');\n      const today = new Date().toISOString().slice(0, 10);\n      if (!raw) return { count: 0, date: today };\n      const data = JSON.parse(raw);\n      if (!data || data.date !== today) {\n        return { count: 0, date: today };\n      }\n      return { count: Number(data.count) || 0, date: today };\n    } catch (_) {\n      return { count: 0, date: null };\n    }\n  }\n\n  function writeCalcUsage(count){\n    if (!SoapTool.config.calcLimit) return;\n    const storage = getStorage();\n    if (!storage) return;\n    const today = new Date().toISOString().slice(0, 10);\n    try {\n      storage.setItem('soap_calc_usage', JSON.stringify({ count, date: today }));\n    } catch (_) {}\n  }\n\n  function canConsumeCalcQuota(){\n    if (!SoapTool.config.calcLimit) return true;\n    const usage = readCalcUsage();\n    if (usage.count >= SoapTool.config.calcLimit) {\n      SoapTool.ui.showSoapAlert(\n        'warning',\n        `You have reached the ${SoapTool.config.calcLimit} calculation limit for ${SoapTool.config.calcTier} accounts. Create a free account or upgrade to keep calculating.`,\n        { dismissible: true }\n      );\n      return false;\n    }\n    return true;\n  }\n\n  function consumeCalcQuota(){\n    if (!SoapTool.config.calcLimit) return;\n    const usage = readCalcUsage();\n    const nextCount = usage.count + 1;\n    writeCalcUsage(nextCount);\n    const remaining = Math.max(0, SoapTool.config.calcLimit - nextCount);\n    if (remaining <= 1) {\n      SoapTool.ui.showSoapAlert(\n        'info',\n        `You have ${remaining} calculation${remaining === 1 ? '' : 's'} left on the ${SoapTool.config.calcTier} tier today.`,\n        { dismissible: true, timeoutMs: 6000 }\n      );\n    }\n  }\n\n  function maybeShowSignupModal(remaining){\n    if (!SoapTool.config.calcLimit || remaining === null || remaining > 1) return;\n    const modalEl = document.getElementById('soapSignupModal');\n    if (!modalEl) return;\n    if (window.bootstrap && window.bootstrap.Modal) {\n      const modal = window.bootstrap.Modal.getOrCreateInstance(modalEl);\n      modal.show();\n    } else {\n      SoapTool.ui.showSoapAlert(\n        'info',\n        'You are almost at the free limit. Create a free account to keep saving your work.',\n        { dismissible: true, timeoutMs: 7000 }\n      );\n    }\n  }\n\n  SoapTool.runnerQuota = {\n    canConsumeCalcQuota,\n    consumeCalcQuota,\n    maybeShowSignupModal,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const state = SoapTool.state;\n\n  function buildServicePayload({\n    oils,\n    selection,\n    superfat,\n    purity,\n    waterMethod,\n    waterPct,\n    lyeConcentration,\n    waterRatio,\n    totalOils,\n  }){\n    const additiveSettings = SoapTool.additives.collectAdditiveSettings();\n    const fragranceRows = SoapTool.recipePayload.collectFragranceRows(totalOils || 0);\n    return {\n      oils: (oils || []).map(oil => ({\n        name: oil.name || null,\n        grams: oil.grams || 0,\n        sap_koh: oil.sapKoh || 0,\n        iodine: oil.iodine || 0,\n        fatty_profile: oil.fattyProfile || null,\n        global_item_id: oil.global_item_id || null,\n        default_unit: oil.default_unit || null,\n        ingredient_category_name: oil.ingredient_category_name || null,\n      })),\n      fragrances: fragranceRows.map(row => ({\n        name: row.name || 'Fragrance/Essential Oils',\n        grams: row.grams || 0,\n        pct: row.pct || 0,\n      })),\n      additives: {\n        lactate_pct: additiveSettings.lactatePct || 0,\n        sugar_pct: additiveSettings.sugarPct || 0,\n        salt_pct: additiveSettings.saltPct || 0,\n        citric_pct: additiveSettings.citricPct || 0,\n        lactate_name: additiveSettings.lactateName || 'Sodium Lactate',\n        sugar_name: additiveSettings.sugarName || 'Sugar',\n        salt_name: additiveSettings.saltName || 'Salt',\n        citric_name: additiveSettings.citricName || 'Citric Acid',\n      },\n      lye: {\n        selected: selection?.selected || 'NaOH',\n        superfat,\n        purity,\n      },\n      water: {\n        method: waterMethod,\n        water_pct: waterPct,\n        lye_concentration: lyeConcentration,\n        water_ratio: waterRatio,\n      },\n      meta: {\n        unit_display: state.currentUnit || 'g',\n      }\n    };\n  }\n\n  async function calculateWithSoapService(payload){\n    const token = document.querySelector('meta[name=\"csrf-token\"]')?.getAttribute('content') || '';\n    const controller = new AbortController();\n    const timeoutId = window.setTimeout(() => controller.abort(), 2500);\n    try {\n      const response = await fetch('/tools/api/soap/calculate', {\n        method: 'POST',\n        signal: controller.signal,\n        headers: {\n          'Content-Type': 'application/json',\n          ...(token ? { 'X-CSRFToken': token } : {}),\n        },\n        body: JSON.stringify(payload || {}),\n      });\n      if (!response.ok) return null;\n      const data = await response.json();\n      if (!data || data.success !== true || typeof data.result !== 'object') return null;\n      return data.result;\n    } catch (_) {\n      return null;\n    } finally {\n      window.clearTimeout(timeoutId);\n    }\n  }\n\n  SoapTool.runnerService = {\n    buildServicePayload,\n    calculateWithSoapService,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { round, toNumber } = SoapTool.helpers;\n  const { formatWeight, formatPercent } = SoapTool.units;\n  const state = SoapTool.state;\n\n  const DEFAULT_ADDITIVES = {\n    lactateG: 0,\n    sugarG: 0,\n    saltG: 0,\n    citricG: 0,\n    citricLyeG: 0,\n    fragranceG: 0,\n    fragrancePct: 0,\n  };\n\n  function mapOilsForState(rows){\n    return (rows || []).map(oil => ({\n      name: oil.name || null,\n      grams: toNumber(oil.grams),\n      sapKoh: toNumber(oil.sap_koh ?? oil.sapKoh),\n      iodine: toNumber(oil.iodine),\n      fattyProfile: oil.fatty_profile || oil.fattyProfile || null,\n      global_item_id: oil.global_item_id || null,\n      default_unit: oil.default_unit || null,\n      ingredient_category_name: oil.ingredient_category_name || null,\n    }));\n  }\n\n  function setText(id, value){\n    const el = document.getElementById(id);\n    if (!el) return;\n    el.textContent = value;\n  }\n\n  function renderResultsCard({\n    resultsCard,\n    lyeAdjusted,\n    waterData,\n    batchYield,\n    totalOils,\n    superfat,\n  }){\n    const card = document.getElementById('resultsCard');\n    if (card) card.style.display = 'block';\n\n    const ratioValue = toNumber(resultsCard.water_lye_ratio) || waterData.waterRatio;\n    setText('lyeAdjustedOutput', formatWeight(toNumber(resultsCard.lye_adjusted_g) || lyeAdjusted));\n    setText('waterOutput', formatWeight(toNumber(resultsCard.water_g) || waterData.waterG));\n    setText('batchYieldOutput', formatWeight(batchYield));\n    setText(\n      'lyeConcentrationOutput',\n      formatPercent(toNumber(resultsCard.lye_concentration_pct) || waterData.lyeConcentration)\n    );\n    setText(\n      'waterRatioOutput',\n      (isFinite(ratioValue) && ratioValue > 0) ? round(ratioValue, 2).toString() : '--'\n    );\n    setText('totalOilsOutput', formatWeight(totalOils));\n    setText('superfatOutput', formatPercent(superfat));\n\n    [\n      'lyeAdjustedOutput',\n      'waterOutput',\n      'batchYieldOutput',\n      'lyeConcentrationOutput',\n      'waterRatioOutput',\n      'totalOilsOutput',\n      'superfatOutput',\n    ].forEach(id => SoapTool.ui.pulseValue(document.getElementById(id)));\n  }\n\n  function maybeShowGuidanceAlerts({ showAlerts, lyeTotals, purity, waterData }){\n    if (!showAlerts) return;\n    if (lyeTotals.usedFallback) {\n      SoapTool.ui.showSoapAlert(\n        'info',\n        'Some oils are missing SAP values, so an average SAP was used. Select oils with SAP data for the most accurate lye calculation.',\n        { dismissible: true, timeoutMs: 7000 }\n      );\n    }\n    if (purity < 100) {\n      SoapTool.ui.showSoapAlert(\n        'info',\n        `Lye purity is set to ${round(purity, 1)}%. Adjusting lye to match your real-world purity.`,\n        { dismissible: true, timeoutMs: 6000 }\n      );\n    }\n    if (waterData.lyeConcentration < 25 || waterData.lyeConcentration > 45) {\n      SoapTool.ui.showSoapAlert(\n        'warning',\n        'Your lye concentration is outside the common 25-45% range. Expect slower or faster trace.',\n        { dismissible: true, timeoutMs: 7000 }\n      );\n    }\n    const mold = SoapTool.mold.getMoldSettings();\n    if (mold.shape === 'cylinder' && mold.waterWeight > 0 && !mold.useCylinder) {\n      SoapTool.ui.showSoapAlert(\n        'info',\n        'Cylinder mold selected. Enable the cylinder correction if you want to leave headspace or reduce spill risk.',\n        { dismissible: true, timeoutMs: 7000 }\n      );\n    }\n  }\n\n  function applyServiceResult({\n    serviceResult,\n    validation,\n    selection,\n    superfat,\n    purity,\n    waterMethod,\n    waterPct,\n    lyeConcentrationInput,\n    waterRatioInput,\n    showAlerts,\n  }){\n    const lyeType = serviceResult.lye_type || selection.lyeType || 'NaOH';\n    const totalOils = toNumber(serviceResult.total_oils_g) || validation.totals.totalWeight;\n    const resolvedSuperfat = toNumber(serviceResult.superfat_pct);\n    const superfatValue = isFinite(resolvedSuperfat) ? resolvedSuperfat : superfat;\n    const lyeTotals = {\n      sapAvg: toNumber(serviceResult.sap_avg_koh),\n      usedFallback: !!serviceResult.used_sap_fallback,\n    };\n    const lyePure = toNumber(serviceResult.lye_pure_g);\n    const lyeAdjusted = toNumber(serviceResult.lye_adjusted_g);\n    const resolvedPurity = toNumber(serviceResult.lye_purity_pct) || purity;\n    const resolvedWaterMethod = serviceResult.water_method || waterMethod;\n    const resolvedWaterPct = toNumber(serviceResult.water_pct) || waterPct;\n    const resolvedLyeConcentrationInput = toNumber(serviceResult.lye_concentration_input_pct) || lyeConcentrationInput;\n    const resolvedWaterRatioInput = toNumber(serviceResult.water_ratio_input) || waterRatioInput;\n    const waterData = {\n      waterG: toNumber(serviceResult.water_g),\n      lyeConcentration: toNumber(serviceResult.lye_concentration_pct),\n      waterRatio: toNumber(serviceResult.water_lye_ratio),\n    };\n    const resultsCard = serviceResult.results_card || {};\n    const qualityReport = serviceResult.quality_report || {};\n    const oilsForState = mapOilsForState(serviceResult.oils || validation.oils);\n    const liveSummary = {\n      waterG: waterData.waterG,\n      lyeAdjusted,\n      totalOils,\n      waterMethod: resolvedWaterMethod,\n      waterPct: resolvedWaterPct,\n      lyeConcentrationInput: resolvedLyeConcentrationInput,\n      waterRatioInput: resolvedWaterRatioInput,\n      lyeConcentration: waterData.lyeConcentration,\n      waterRatio: waterData.waterRatio,\n    };\n    SoapTool.runnerInputs.updateStageWaterSummary(liveSummary);\n    SoapTool.runnerInputs.updateLiveCalculationPreview(liveSummary);\n\n    const additives = serviceResult.additives || DEFAULT_ADDITIVES;\n    if (SoapTool.additives.applyComputedOutputs) {\n      SoapTool.additives.applyComputedOutputs(additives);\n    }\n    const batchYield = toNumber(resultsCard.batch_yield_g) || (\n      totalOils\n      + lyeAdjusted\n      + waterData.waterG\n      + additives.fragranceG\n      + additives.lactateG\n      + additives.sugarG\n      + additives.saltG\n      + additives.citricG\n    );\n    if (SoapTool.mold?.updateWetBatterWarning) {\n      SoapTool.mold.updateWetBatterWarning(batchYield);\n    }\n\n    renderResultsCard({\n      resultsCard,\n      lyeAdjusted,\n      waterData,\n      batchYield,\n      totalOils,\n      superfat: superfatValue,\n    });\n    SoapTool.ui.updateResultsWarnings(waterData);\n    SoapTool.ui.updateResultsMeta();\n\n    SoapTool.quality.updateQualitiesDisplay({\n      qualities: qualityReport.qualities || {},\n      fattyPercent: qualityReport.fatty_acids_pct || {},\n      coveragePct: toNumber(qualityReport.coverage_pct),\n      iodine: toNumber(qualityReport.iodine),\n      ins: toNumber(qualityReport.ins),\n      sapAvg: lyeTotals.sapAvg,\n      superfat: superfatValue,\n      waterData,\n      additives,\n      oils: oilsForState,\n      totalOils,\n      warnings: qualityReport.warnings || [],\n    });\n    SoapTool.additives.updateVisualGuidance({\n      tips: qualityReport.visual_guidance || [],\n    });\n    SoapTool.stages.updateStageStatuses();\n    maybeShowGuidanceAlerts({\n      showAlerts,\n      lyeTotals,\n      purity: resolvedPurity,\n      waterData,\n    });\n\n    state.lastCalc = {\n      totalOils,\n      oils: oilsForState,\n      lyeType,\n      superfat: superfatValue,\n      purity: resolvedPurity,\n      lyePure,\n      lyeAdjusted,\n      water: waterData.waterG,\n      waterMethod: resolvedWaterMethod,\n      waterPct: resolvedWaterPct,\n      lyeConcentration: waterData.lyeConcentration,\n      waterRatio: waterData.waterRatio,\n      sapAvg: lyeTotals.sapAvg,\n      usedSapFallback: lyeTotals.usedFallback,\n      additives,\n      batchYield,\n      qualityReport,\n      export: serviceResult.export || null,\n    };\n    return state.lastCalc;\n  }\n\n  SoapTool.runnerRender = {\n    applyServiceResult,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const state = SoapTool.state;\n  const runnerInputs = SoapTool.runnerInputs;\n  const runnerQuota = SoapTool.runnerQuota;\n  const runnerService = SoapTool.runnerService;\n  const runnerRender = SoapTool.runnerRender;\n\n  async function calculateAll(options = {}){\n    const settings = {\n      consumeQuota: false,\n      showAlerts: true,\n      ...options\n    };\n    try {\n      if (settings.showAlerts) {\n        SoapTool.ui.clearSoapAlerts();\n      }\n\n      const validation = runnerInputs.validateCalculation();\n      if (!validation.ok) {\n        runnerInputs.updateStageWaterSummary(null);\n        runnerInputs.updateLiveCalculationPreview(null);\n        if (SoapTool.mold?.updateWetBatterWarning) {\n          SoapTool.mold.updateWetBatterWarning(0);\n        }\n        if (settings.showAlerts) {\n          SoapTool.ui.showSoapAlert(\n            'warning',\n            `<strong>Missing info:</strong><ul class=\"mb-0\">${validation.errors.map(err => `<li>${err}</li>`).join('')}</ul>`,\n            { dismissible: true, persist: true }\n          );\n        }\n        return null;\n      }\n      if (settings.consumeQuota && !runnerQuota.canConsumeCalcQuota()) {\n        return null;\n      }\n\n      const superfat = runnerInputs.readSuperfatInput();\n      const selection = runnerInputs.getLyeSelection();\n      const sanitized = runnerInputs.sanitizeLyeInputs();\n\n      const requestSeq = (state.calcRequestSeq || 0) + 1;\n      state.calcRequestSeq = requestSeq;\n      const servicePayload = runnerService.buildServicePayload({\n        oils: validation.oils,\n        selection,\n        superfat,\n        purity: sanitized.purity,\n        waterMethod: sanitized.waterMethod,\n        waterPct: sanitized.waterPct,\n        lyeConcentration: sanitized.lyeConcentration,\n        waterRatio: sanitized.waterRatio,\n        totalOils: validation.totals.totalWeight,\n      });\n      const serviceResult = await runnerService.calculateWithSoapService(servicePayload);\n      if (requestSeq !== state.calcRequestSeq) {\n        return state.lastCalc;\n      }\n      if (!serviceResult) {\n        if (settings.showAlerts) {\n          SoapTool.ui.showSoapAlert(\n            'danger',\n            'Soap calculator service is unavailable. Please try again.',\n            { dismissible: true, timeoutMs: 6000 }\n          );\n        }\n        return null;\n      }\n\n      const calc = runnerRender.applyServiceResult({\n        serviceResult,\n        validation,\n        selection,\n        superfat,\n        purity: sanitized.purity,\n        waterMethod: sanitized.waterMethod,\n        waterPct: sanitized.waterPct,\n        lyeConcentrationInput: sanitized.lyeConcentration,\n        waterRatioInput: sanitized.waterRatio,\n        showAlerts: settings.showAlerts,\n      });\n      if (settings.consumeQuota) {\n        runnerQuota.consumeCalcQuota();\n      }\n      return calc;\n    } catch (_) {\n      if (settings.showAlerts) {\n        SoapTool.ui.showSoapAlert('danger', 'Unable to run the soap calculation right now. Please try again.', { dismissible: true, timeoutMs: 6000 });\n      }\n      return null;\n    }\n  }\n\n  SoapTool.runner = {\n    getLyeSelection: (...args) => runnerInputs.getLyeSelection(...args),\n    applyLyeSelection: (...args) => runnerInputs.applyLyeSelection(...args),\n    setWaterMethod: (...args) => runnerInputs.setWaterMethod(...args),\n    updateLiveCalculationPreview: (...args) => runnerInputs.updateLiveCalculationPreview(...args),\n    calculateAll,\n    buildSoapRecipePayload: (...args) => SoapTool.recipePayload.buildSoapRecipePayload(...args),\n    buildLineRow: (...args) => SoapTool.recipePayload.buildLineRow(...args),\n    addStubLine: (...args) => SoapTool.recipePayload.addStubLine(...args),\n    maybeShowSignupModal: (...args) => runnerQuota.maybeShowSignupModal(...args),\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { formatTime, getStorage } = SoapTool.helpers;\n  const STATE_STORAGE_KEY = 'soap_tool_state_v2';\n\n  function serializeLines(wrapperId, kind){\n    const out = [];\n    const rows = document.querySelectorAll(`#${wrapperId} .row`);\n    rows.forEach(row => {\n      const name = row.querySelector('.tool-typeahead')?.value?.trim();\n      const gi = row.querySelector('.tool-gi-id')?.value || '';\n      const qtyEl = row.querySelector('.tool-qty');\n      const unitEl = row.querySelector('.tool-unit');\n      const qty = qtyEl && qtyEl.value !== '' ? SoapTool.helpers.toNumber(qtyEl.value) : null;\n      if (!name && !gi) return;\n      if (kind === 'container') {\n        out.push({\n          name: name || '',\n          global_item_id: gi ? parseInt(gi) : null,\n          quantity: qty && qty > 0 ? qty : 1,\n        });\n      } else {\n        out.push({\n          name: name || '',\n          global_item_id: gi ? parseInt(gi) : null,\n          quantity: qty && qty >= 0 ? qty : 0,\n          unit: unitEl?.value || 'gram',\n        });\n      }\n    });\n    return out;\n  }\n\n  function serializeOils(){\n    const oils = [];\n    document.querySelectorAll('#oilRows .oil-row').forEach(row => {\n      const name = row.querySelector('.oil-typeahead')?.value?.trim() || '';\n      const grams = row.querySelector('.oil-grams')?.value || '';\n      const percent = row.querySelector('.oil-percent')?.value || '';\n      const sap = row.querySelector('.oil-sap-koh')?.value || '';\n      const iodine = row.querySelector('.oil-iodine')?.value || '';\n      const fattyRaw = row.querySelector('.oil-fatty')?.value || '';\n      const gi = row.querySelector('.oil-gi-id')?.value || '';\n      const defaultUnit = row.querySelector('.oil-default-unit')?.value || '';\n      const categoryName = row.querySelector('.oil-category')?.value || '';\n      if (!name && !grams && !percent && !gi) return;\n      oils.push({\n        name,\n        grams,\n        percent,\n        sap,\n        iodine,\n        fattyRaw,\n        gi,\n        defaultUnit,\n        categoryName,\n      });\n    });\n    return oils;\n  }\n\n  function serializeFragrances(){\n    if (SoapTool.fragrances?.collectFragranceData) {\n      return SoapTool.fragrances.collectFragranceData();\n    }\n    const rows = [];\n    document.querySelectorAll('#fragranceRows .fragrance-row').forEach(row => {\n      const name = row.querySelector('.fragrance-typeahead')?.value?.trim() || '';\n      const grams = row.querySelector('.fragrance-grams')?.value || '';\n      const percent = row.querySelector('.fragrance-percent')?.value || '';\n      const gi = row.querySelector('.fragrance-gi-id')?.value || '';\n      const defaultUnit = row.querySelector('.fragrance-default-unit')?.value || '';\n      const categoryName = row.querySelector('.fragrance-category')?.value || '';\n      if (!name && !grams && !percent && !gi) return;\n      rows.push({ name, grams, percent, gi, defaultUnit, categoryName });\n    });\n    return rows;\n  }\n\n  function restoreOilRow(data, index){\n    const oilRows = document.getElementById('oilRows');\n    if (!oilRows || !data) return;\n    const row = SoapTool.oils.buildOilRow();\n    row.querySelector('.oil-typeahead').value = data.name || '';\n    row.querySelector('.oil-grams').value = data.grams || '';\n    row.querySelector('.oil-percent').value = data.percent || '';\n    row.querySelector('.oil-sap-koh').value = data.sap || '';\n    row.querySelector('.oil-iodine').value = data.iodine || '';\n    row.querySelector('.oil-fatty').value = data.fattyRaw || '';\n    row.querySelector('.oil-gi-id').value = data.gi || '';\n    const unitEl = row.querySelector('.oil-default-unit');\n    if (unitEl) unitEl.value = data.defaultUnit || '';\n    const categoryEl = row.querySelector('.oil-category');\n    if (categoryEl) categoryEl.value = data.categoryName || '';\n    const children = Array.from(oilRows.children);\n    if (index >= children.length) {\n      oilRows.appendChild(row);\n    } else {\n      oilRows.insertBefore(row, children[index]);\n    }\n    return row;\n  }\n\n  function saveState(){\n    const storage = getStorage();\n    if (!storage) return;\n    const payload = {\n      version: 2,\n      unit: SoapTool.state.currentUnit,\n      oil_total_target: document.getElementById('oilTotalTarget').value || '',\n      oils: serializeOils(),\n      lye_form: {\n        superfat: document.getElementById('lyeSuperfat')?.value || '5',\n        lye_type: document.querySelector('input[name=\"lye_type\"]:checked')?.value || 'NaOH',\n        lye_purity: document.getElementById('lyePurity')?.value || '100',\n        water_method: document.getElementById('waterMethod')?.value || 'percent',\n        water_pct: document.getElementById('waterPct')?.value || '',\n        lye_concentration: document.getElementById('lyeConcentration')?.value || '',\n        water_ratio: document.getElementById('waterRatio')?.value || '',\n      },\n      additives: {\n        fragrances: serializeFragrances(),\n        lactate_pct: document.getElementById('additiveLactatePct').value || '1',\n        lactate_name: document.getElementById('additiveLactateName')?.value || '',\n        lactate_gi: document.getElementById('additiveLactateGi')?.value || '',\n        lactate_unit: document.getElementById('additiveLactateUnit')?.value || '',\n        lactate_category: document.getElementById('additiveLactateCategory')?.value || '',\n        sugar_pct: document.getElementById('additiveSugarPct').value || '1',\n        sugar_name: document.getElementById('additiveSugarName')?.value || '',\n        sugar_gi: document.getElementById('additiveSugarGi')?.value || '',\n        sugar_unit: document.getElementById('additiveSugarUnit')?.value || '',\n        sugar_category: document.getElementById('additiveSugarCategory')?.value || '',\n        salt_pct: document.getElementById('additiveSaltPct').value || '0.5',\n        salt_name: document.getElementById('additiveSaltName')?.value || '',\n        salt_gi: document.getElementById('additiveSaltGi')?.value || '',\n        salt_unit: document.getElementById('additiveSaltUnit')?.value || '',\n        salt_category: document.getElementById('additiveSaltCategory')?.value || '',\n        citric_pct: document.getElementById('additiveCitricPct').value || '0',\n        citric_name: document.getElementById('additiveCitricName')?.value || '',\n        citric_gi: document.getElementById('additiveCitricGi')?.value || '',\n        citric_unit: document.getElementById('additiveCitricUnit')?.value || '',\n        citric_category: document.getElementById('additiveCitricCategory')?.value || '',\n      },\n      mold: {\n        water_weight: document.getElementById('moldWaterWeight').value || '',\n        oil_pct: document.getElementById('moldOilPct').value || '65',\n        shape: document.getElementById('moldShape')?.value || 'loaf',\n        cylinder_correction: !!document.getElementById('moldCylinderCorrection')?.checked,\n        cylinder_factor: document.getElementById('moldCylinderFactor')?.value || '0.85',\n      },\n      quality: {\n        preset: document.getElementById('qualityPreset')?.value || 'balanced',\n        focus: Array.from(document.querySelectorAll('.quality-focus:checked')).map(el => el.id),\n      },\n      lines: {\n        ingredients: serializeLines('tool-ingredients', 'ingredient'),\n        consumables: serializeLines('tool-consumables', 'consumable'),\n        containers: serializeLines('tool-containers', 'container'),\n      },\n      bulk_oils: (SoapTool.bulkOilsModal && typeof SoapTool.bulkOilsModal.serializeSelection === 'function')\n        ? SoapTool.bulkOilsModal.serializeSelection()\n        : { mode: 'basics', selections: [] },\n      updated_at: Date.now(),\n    };\n    try {\n      storage.setItem(STATE_STORAGE_KEY, JSON.stringify(payload));\n      const lastSaved = document.getElementById('soapLastSaved');\n      if (lastSaved) lastSaved.textContent = formatTime(payload.updated_at);\n      SoapTool.ui.showAutosaveToast();\n    } catch (_) {}\n  }\n\n  function restoreState(){\n    const storage = getStorage();\n    if (!storage) return;\n    const raw = storage.getItem(STATE_STORAGE_KEY);\n    if (!raw) return;\n    let data = null;\n    try {\n      data = JSON.parse(raw);\n    } catch (_) {\n      return;\n    }\n    if (!data || typeof data !== 'object') return;\n\n    if (data.unit) {\n      const unitInput = document.querySelector(`input[name=\"weight_unit\"][value=\"${data.unit}\"]`);\n      if (unitInput) unitInput.checked = true;\n      SoapTool.units.setUnit(data.unit, { skipConvert: true, skipAutoCalc: true });\n    }\n\n    if (data.oil_total_target !== undefined) {\n      document.getElementById('oilTotalTarget').value = data.oil_total_target;\n    }\n\n    const oilRows = document.getElementById('oilRows');\n    if (oilRows) {\n      oilRows.innerHTML = '';\n      const oils = Array.isArray(data.oils) && data.oils.length ? data.oils : [{}];\n      oils.forEach(oil => {\n        const row = SoapTool.oils.buildOilRow();\n        row.querySelector('.oil-typeahead').value = oil.name || '';\n        row.querySelector('.oil-grams').value = oil.grams || '';\n        row.querySelector('.oil-percent').value = oil.percent || '';\n        row.querySelector('.oil-sap-koh').value = oil.sap || '';\n        row.querySelector('.oil-iodine').value = oil.iodine || '';\n        row.querySelector('.oil-fatty').value = oil.fattyRaw || '';\n        row.querySelector('.oil-gi-id').value = oil.gi || '';\n        const unitEl = row.querySelector('.oil-default-unit');\n        if (unitEl) unitEl.value = oil.defaultUnit || '';\n        const categoryEl = row.querySelector('.oil-category');\n        if (categoryEl) categoryEl.value = oil.categoryName || '';\n        oilRows.appendChild(row);\n      });\n    }\n\n    if (data.lye_form) {\n      const superfat = document.getElementById('lyeSuperfat');\n      if (superfat) superfat.value = data.lye_form.superfat || '5';\n      const lyeType = document.querySelector(`input[name=\"lye_type\"][value=\"${data.lye_form.lye_type || 'NaOH'}\"]`);\n      if (lyeType) lyeType.checked = true;\n      const purity = document.getElementById('lyePurity');\n      if (purity) purity.value = data.lye_form.lye_purity || '100';\n      const waterMethod = document.getElementById('waterMethod');\n      if (waterMethod) waterMethod.value = data.lye_form.water_method || 'percent';\n      const waterPct = document.getElementById('waterPct');\n      if (waterPct) waterPct.value = data.lye_form.water_pct || '';\n      const lyeConcentration = document.getElementById('lyeConcentration');\n      if (lyeConcentration) lyeConcentration.value = data.lye_form.lye_concentration || '';\n      const waterRatio = document.getElementById('waterRatio');\n      if (waterRatio) waterRatio.value = data.lye_form.water_ratio || '';\n      SoapTool.runner.applyLyeSelection();\n    }\n\n    if (data.additives) {\n      const fragranceRows = document.getElementById('fragranceRows');\n      if (fragranceRows && SoapTool.fragrances?.buildFragranceRow) {\n        fragranceRows.innerHTML = '';\n        const fragrances = Array.isArray(data.additives.fragrances) && data.additives.fragrances.length\n          ? data.additives.fragrances\n          : null;\n        if (fragrances) {\n          fragrances.forEach(item => {\n            const row = SoapTool.fragrances.buildFragranceRow();\n            row.querySelector('.fragrance-typeahead').value = item.name || '';\n            row.querySelector('.fragrance-grams').value = item.grams || '';\n            row.querySelector('.fragrance-percent').value = item.percent || '';\n            row.querySelector('.fragrance-gi-id').value = item.gi || '';\n            const unitEl = row.querySelector('.fragrance-default-unit');\n            if (unitEl) unitEl.value = item.defaultUnit || '';\n            const categoryEl = row.querySelector('.fragrance-category');\n            if (categoryEl) categoryEl.value = item.categoryName || '';\n            fragranceRows.appendChild(row);\n          });\n        } else if (data.additives.fragrance_pct || data.additives.fragrance_name || data.additives.fragrance_gi) {\n          const row = SoapTool.fragrances.buildFragranceRow();\n          row.querySelector('.fragrance-typeahead').value = data.additives.fragrance_name || '';\n          row.querySelector('.fragrance-percent').value = data.additives.fragrance_pct || '3';\n          row.querySelector('.fragrance-gi-id').value = data.additives.fragrance_gi || '';\n          fragranceRows.appendChild(row);\n        }\n      }\n      document.getElementById('additiveLactatePct').value = data.additives.lactate_pct || '1';\n      const lactateName = document.getElementById('additiveLactateName');\n      if (lactateName) lactateName.value = data.additives.lactate_name || '';\n      const lactateGi = document.getElementById('additiveLactateGi');\n      if (lactateGi) lactateGi.value = data.additives.lactate_gi || '';\n      const lactateUnit = document.getElementById('additiveLactateUnit');\n      if (lactateUnit) lactateUnit.value = data.additives.lactate_unit || '';\n      const lactateCategory = document.getElementById('additiveLactateCategory');\n      if (lactateCategory) lactateCategory.value = data.additives.lactate_category || '';\n      document.getElementById('additiveSugarPct').value = data.additives.sugar_pct || '1';\n      const sugarName = document.getElementById('additiveSugarName');\n      if (sugarName) sugarName.value = data.additives.sugar_name || '';\n      const sugarGi = document.getElementById('additiveSugarGi');\n      if (sugarGi) sugarGi.value = data.additives.sugar_gi || '';\n      const sugarUnit = document.getElementById('additiveSugarUnit');\n      if (sugarUnit) sugarUnit.value = data.additives.sugar_unit || '';\n      const sugarCategory = document.getElementById('additiveSugarCategory');\n      if (sugarCategory) sugarCategory.value = data.additives.sugar_category || '';\n      document.getElementById('additiveSaltPct').value = data.additives.salt_pct || '0.5';\n      const saltName = document.getElementById('additiveSaltName');\n      if (saltName) saltName.value = data.additives.salt_name || '';\n      const saltGi = document.getElementById('additiveSaltGi');\n      if (saltGi) saltGi.value = data.additives.salt_gi || '';\n      const saltUnit = document.getElementById('additiveSaltUnit');\n      if (saltUnit) saltUnit.value = data.additives.salt_unit || '';\n      const saltCategory = document.getElementById('additiveSaltCategory');\n      if (saltCategory) saltCategory.value = data.additives.salt_category || '';\n      document.getElementById('additiveCitricPct').value = data.additives.citric_pct || '0';\n      const citricName = document.getElementById('additiveCitricName');\n      if (citricName) citricName.value = data.additives.citric_name || '';\n      const citricGi = document.getElementById('additiveCitricGi');\n      if (citricGi) citricGi.value = data.additives.citric_gi || '';\n      const citricUnit = document.getElementById('additiveCitricUnit');\n      if (citricUnit) citricUnit.value = data.additives.citric_unit || '';\n      const citricCategory = document.getElementById('additiveCitricCategory');\n      if (citricCategory) citricCategory.value = data.additives.citric_category || '';\n    }\n\n    if (data.mold) {\n      document.getElementById('moldWaterWeight').value = data.mold.water_weight || '';\n      document.getElementById('moldOilPct').value = data.mold.oil_pct || '65';\n      const moldShape = document.getElementById('moldShape');\n      if (moldShape) moldShape.value = data.mold.shape || 'loaf';\n      const cylCorrection = document.getElementById('moldCylinderCorrection');\n      if (cylCorrection) cylCorrection.checked = !!data.mold.cylinder_correction;\n      const cylFactor = document.getElementById('moldCylinderFactor');\n      if (cylFactor) cylFactor.value = data.mold.cylinder_factor || '0.85';\n      const targetInput = document.getElementById('oilTotalTarget');\n      if (SoapTool.mold?.syncMoldPctFromTarget && SoapTool.mold?.syncTargetFromMold) {\n        const restoredTarget = SoapTool.units.toGrams(targetInput?.value);\n        if (restoredTarget > 0) {\n          SoapTool.mold.syncMoldPctFromTarget();\n        } else {\n          SoapTool.mold.syncTargetFromMold();\n        }\n      }\n    }\n    if (data.quality) {\n      const preset = document.getElementById('qualityPreset');\n      if (preset) {\n        const desired = data.quality.preset || 'balanced';\n        const option = Array.from(preset.options).find(opt => opt.value === desired);\n        preset.value = option ? desired : 'balanced';\n      }\n      document.querySelectorAll('.quality-focus').forEach(el => {\n        el.checked = Array.isArray(data.quality.focus) && data.quality.focus.includes(el.id);\n      });\n    }\n\n    function restoreLines(wrapperId, items, kind){\n      const wrapper = document.getElementById(wrapperId);\n      if (!wrapper) return;\n      wrapper.innerHTML = '';\n      (items || []).forEach(item => {\n        const row = SoapTool.runner.buildLineRow(kind);\n        const input = row.querySelector('.tool-typeahead');\n        const giHidden = row.querySelector('.tool-gi-id');\n        const qtyEl = row.querySelector('.tool-qty');\n        const unitEl = row.querySelector('.tool-unit');\n        if (input) input.value = item.name || '';\n        if (giHidden) giHidden.value = item.global_item_id || '';\n        if (qtyEl && item.quantity !== undefined && item.quantity !== null) qtyEl.value = item.quantity;\n        if (unitEl && item.unit) {\n          const option = Array.from(unitEl.options).find(opt => opt.value === item.unit);\n          if (option) unitEl.value = item.unit;\n        }\n        wrapper.appendChild(row);\n      });\n    }\n\n    if (data.lines) {\n      restoreLines('tool-ingredients', data.lines.ingredients, 'ingredient');\n      restoreLines('tool-consumables', data.lines.consumables, 'consumable');\n      restoreLines('tool-containers', data.lines.containers, 'container');\n    }\n    if (SoapTool.bulkOilsModal && typeof SoapTool.bulkOilsModal.restoreState === 'function') {\n      SoapTool.bulkOilsModal.restoreState(data.bulk_oils || null);\n    }\n\n    SoapTool.runner.setWaterMethod();\n    SoapTool.mold.updateMoldShapeUI();\n    SoapTool.quality.updateQualityTargets();\n    SoapTool.oils.updateOilTotals();\n    SoapTool.additives.updateAdditivesOutput(SoapTool.oils.getTotalOilsGrams());\n    SoapTool.mold.updateMoldSuggested();\n    SoapTool.runner.calculateAll({ consumeQuota: false, showAlerts: false });\n    if (data.updated_at) {\n      const lastSaved = document.getElementById('soapLastSaved');\n      if (lastSaved) lastSaved.textContent = formatTime(data.updated_at);\n    }\n    SoapTool.stages.updateStageStatuses();\n    SoapTool.ui.showSoapAlert('info', 'Restored your last soap tool session from this device.', { dismissible: true, timeoutMs: 5000 });\n  }\n\n  let saveStateTimer = null;\n  function queueStateSave(){\n    if (saveStateTimer) clearTimeout(saveStateTimer);\n    saveStateTimer = setTimeout(saveState, 350);\n  }\n\n  let autoCalcTimer = null;\n  function queueAutoCalc(){\n    if (autoCalcTimer) clearTimeout(autoCalcTimer);\n    autoCalcTimer = setTimeout(() => {\n      SoapTool.runner.calculateAll({ consumeQuota: false, showAlerts: false });\n    }, 350);\n  }\n\n  SoapTool.storage = {\n    saveState,\n    restoreState,\n    serializeLines,\n    serializeOils,\n    restoreOilRow,\n    queueStateSave,\n    queueAutoCalc,\n  };\n})(window);\n", "(function(window){\n  'use strict';\n\n  const SoapTool = window.SoapTool = window.SoapTool || {};\n  const { LACTATE_CATEGORY_SET, SUGAR_CATEGORY_SET, SALT_CATEGORY_SET, CITRIC_CATEGORY_SET } = SoapTool.constants;\n  const { round, toNumber, clamp } = SoapTool.helpers;\n  const { formatWeight, formatPercent, toGrams } = SoapTool.units;\n  const state = SoapTool.state;\n\n  async function getCalcForExport(){\n    const calc = state.lastCalc || await SoapTool.runner.calculateAll({ consumeQuota: false, showAlerts: true });\n    if (!calc) {\n      if (SoapTool.ui?.showSoapAlert) {\n        SoapTool.ui.showSoapAlert('warning', 'Run a calculation before exporting or printing.', { dismissible: true, timeoutMs: 6000 });\n      }\n      return null;\n    }\n    return calc;\n  }\n\n  function collectFragranceExportRows(totalOils){\n    const rows = [];\n    document.querySelectorAll('#fragranceRows .fragrance-row').forEach(row => {\n      const name = row.querySelector('.fragrance-typeahead')?.value?.trim();\n      const gramsInput = row.querySelector('.fragrance-grams')?.value;\n      const pctInput = row.querySelector('.fragrance-percent')?.value;\n      let grams = toGrams(gramsInput);\n      let pct = clamp(toNumber(pctInput), 0);\n      if (grams <= 0 && pct > 0 && totalOils > 0) {\n        grams = totalOils * (pct / 100);\n      }\n      if (grams <= 0 && pct <= 0 && !name) return;\n      if (!pct && grams > 0 && totalOils > 0) {\n        pct = (grams / totalOils) * 100;\n      }\n      rows.push({\n        name: name || 'Fragrance/Essential Oils',\n        grams,\n        pct,\n      });\n    });\n    return rows;\n  }\n\n  function collectAdditiveExportRows(additives){\n    const rows = [];\n    if (!additives) return rows;\n    const lactateName = document.getElementById('additiveLactateName')?.value?.trim() || 'Sodium Lactate';\n    const sugarName = document.getElementById('additiveSugarName')?.value?.trim() || 'Sugar';\n    const saltName = document.getElementById('additiveSaltName')?.value?.trim() || 'Salt';\n    const citricName = document.getElementById('additiveCitricName')?.value?.trim() || 'Citric Acid';\n    if (additives.lactateG > 0) {\n      rows.push({ name: lactateName, grams: additives.lactateG, pct: additives.lactatePct });\n    }\n    if (additives.sugarG > 0) {\n      rows.push({ name: sugarName, grams: additives.sugarG, pct: additives.sugarPct });\n    }\n    if (additives.saltG > 0) {\n      rows.push({ name: saltName, grams: additives.saltG, pct: additives.saltPct });\n    }\n    if (additives.citricG > 0) {\n      rows.push({ name: citricName, grams: additives.citricG, pct: additives.citricPct });\n    }\n    return rows;\n  }\n\n  function buildFormulaCsv(calc){\n    if (Array.isArray(calc?.export?.csv_rows) && calc.export.csv_rows.length) {\n      return calc.export.csv_rows;\n    }\n    const totalOils = calc.totalOils || 0;\n    const rows = [['section', 'name', 'quantity', 'unit', 'percent']];\n    rows.push(['Summary', 'Lye Type', calc.lyeType || '', '', '']);\n    rows.push(['Summary', 'Superfat', round(calc.superfat || 0, 2), '%', '']);\n    rows.push(['Summary', 'Lye Purity', round(calc.purity || 0, 1), '%', '']);\n    rows.push(['Summary', 'Water Method', calc.waterMethod || '', '', '']);\n    rows.push(['Summary', 'Water %', round(calc.waterPct || 0, 1), '%', '']);\n    rows.push(['Summary', 'Lye Concentration', round(calc.lyeConcentration || 0, 1), '%', '']);\n    rows.push(['Summary', 'Water Ratio', round(calc.waterRatio || 0, 2), '', '']);\n    rows.push(['Summary', 'Total Oils', round(totalOils, 2), 'gram', '']);\n    rows.push(['Summary', 'Batch Yield', round(calc.batchYield || 0, 2), 'gram', '']);\n\n    (calc.oils || []).forEach(oil => {\n      const pct = totalOils > 0 ? round((oil.grams / totalOils) * 100, 2) : '';\n      rows.push(['Oils', oil.name || 'Oil', round(oil.grams || 0, 2), 'gram', pct]);\n    });\n    if (calc.lyeAdjusted > 0) {\n      rows.push(['Lye', calc.lyeType === 'KOH' ? 'Potassium Hydroxide (KOH)' : 'Sodium Hydroxide (NaOH)', round(calc.lyeAdjusted, 2), 'gram', '']);\n    }\n    if (calc.water > 0) {\n      rows.push(['Water', 'Distilled Water', round(calc.water, 2), 'gram', '']);\n    }\n    const fragrances = collectFragranceExportRows(totalOils);\n    fragrances.forEach(row => {\n      rows.push(['Fragrance', row.name, round(row.grams || 0, 2), 'gram', round(row.pct || 0, 2)]);\n    });\n    const additiveRows = collectAdditiveExportRows(calc.additives);\n    additiveRows.forEach(row => {\n      rows.push(['Additives', row.name, round(row.grams || 0, 2), 'gram', round(row.pct || 0, 2)]);\n    });\n    if (calc.additives?.citricLyeG > 0) {\n      rows.push(['Additives', 'Extra Lye for Citric Acid', round(calc.additives.citricLyeG, 2), 'gram', '']);\n    }\n    return rows;\n  }\n\n  function csvEscape(value){\n    if (value === null || value === undefined) return '';\n    const str = String(value);\n    if (/[\",\\n]/.test(str)) {\n      return `\"${str.replace(/\"/g, '\"\"')}\"`;\n    }\n    return str;\n  }\n\n  function buildCsvString(rows){\n    return rows.map(row => row.map(csvEscape).join(',')).join('\\n');\n  }\n\n  function triggerCsvDownload(csvText, filename){\n    const blob = new Blob([csvText], { type: 'text/csv;charset=utf-8;' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n  }\n\n  function buildPrintSheet(calc){\n    if (typeof calc?.export?.sheet_html === 'string' && calc.export.sheet_html.trim()) {\n      return calc.export.sheet_html;\n    }\n    const totalOils = calc.totalOils || 0;\n    const oils = (calc.oils || []).map(oil => ({\n      name: oil.name || 'Oil',\n      grams: oil.grams || 0,\n      pct: totalOils > 0 ? (oil.grams / totalOils) * 100 : 0,\n    }));\n    const fragrances = collectFragranceExportRows(totalOils);\n    const additives = collectAdditiveExportRows(calc.additives);\n    const now = new Date().toLocaleString();\n    const oilRows = oils.length\n      ? oils.map(oil => `\n          <tr>\n            <td>${oil.name}</td>\n            <td class=\"text-end\">${formatWeight(oil.grams)}</td>\n            <td class=\"text-end\">${formatPercent(oil.pct)}</td>\n          </tr>`).join('')\n      : '<tr><td colspan=\"3\" class=\"text-muted\">No oils added.</td></tr>';\n    const fragranceRows = fragrances.length\n      ? fragrances.map(item => `\n          <tr>\n            <td>${item.name}</td>\n            <td class=\"text-end\">${formatWeight(item.grams)}</td>\n            <td class=\"text-end\">${formatPercent(item.pct)}</td>\n          </tr>`).join('')\n      : '<tr><td colspan=\"3\" class=\"text-muted\">No fragrances added.</td></tr>';\n    const additiveRows = additives.length\n      ? additives.map(item => `\n          <tr>\n            <td>${item.name}</td>\n            <td class=\"text-end\">${formatWeight(item.grams)}</td>\n            <td class=\"text-end\">${formatPercent(item.pct)}</td>\n          </tr>`).join('')\n      : '<tr><td colspan=\"3\" class=\"text-muted\">No additives added.</td></tr>';\n    const lyeLabel = calc.lyeType === 'KOH' ? 'Potassium Hydroxide (KOH)' : 'Sodium Hydroxide (NaOH)';\n    const extraLyeRow = calc.additives?.citricLyeG > 0\n      ? `<tr><td>Extra Lye for Citric Acid</td><td class=\"text-end\">${formatWeight(calc.additives.citricLyeG)}</td></tr>`\n      : '';\n\n    return `<!doctype html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Soap Formula Sheet</title>\n    <style>\n      body { font-family: Arial, sans-serif; color: #111; margin: 24px; }\n      h1 { font-size: 20px; margin-bottom: 4px; }\n      h2 { font-size: 16px; margin-top: 20px; }\n      .meta { font-size: 12px; color: #555; margin-bottom: 12px; }\n      table { width: 100%; border-collapse: collapse; margin-top: 8px; }\n      th, td { border: 1px solid #ddd; padding: 6px 8px; font-size: 12px; }\n      th { background: #f3f4f6; text-align: left; }\n      .text-end { text-align: right; }\n      .summary-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 6px 16px; font-size: 12px; }\n      .summary-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 4px 0; }\n      .text-muted { color: #666; }\n    </style>\n  </head>\n  <body>\n    <h1>Soap Formula Sheet</h1>\n    <div class=\"meta\">Generated ${now}</div>\n    <div class=\"summary-grid\">\n      <div class=\"summary-item\"><span>Lye type</span><span>${calc.lyeType || '--'}</span></div>\n      <div class=\"summary-item\"><span>Superfat</span><span>${formatPercent(calc.superfat || 0)}</span></div>\n      <div class=\"summary-item\"><span>Lye purity</span><span>${formatPercent(calc.purity || 0)}</span></div>\n      <div class=\"summary-item\"><span>Total oils</span><span>${formatWeight(totalOils)}</span></div>\n      <div class=\"summary-item\"><span>Water</span><span>${formatWeight(calc.water || 0)}</span></div>\n      <div class=\"summary-item\"><span>Batch yield</span><span>${formatWeight(calc.batchYield || 0)}</span></div>\n      <div class=\"summary-item\"><span>Water method</span><span>${calc.waterMethod || '--'}</span></div>\n      <div class=\"summary-item\"><span>Lye concentration</span><span>${formatPercent(calc.lyeConcentration || 0)}</span></div>\n    </div>\n\n    <h2>Oils</h2>\n    <table>\n      <thead>\n        <tr><th>Oil</th><th class=\"text-end\">Weight</th><th class=\"text-end\">Percent</th></tr>\n      </thead>\n      <tbody>${oilRows}</tbody>\n    </table>\n\n    <h2>Lye & Water</h2>\n    <table>\n      <thead>\n        <tr><th>Item</th><th class=\"text-end\">Weight</th></tr>\n      </thead>\n      <tbody>\n        <tr><td>${lyeLabel}</td><td class=\"text-end\">${formatWeight(calc.lyeAdjusted || 0)}</td></tr>\n        <tr><td>Distilled Water</td><td class=\"text-end\">${formatWeight(calc.water || 0)}</td></tr>\n        ${extraLyeRow}\n      </tbody>\n    </table>\n\n    <h2>Fragrance & Essential Oils</h2>\n    <table>\n      <thead>\n        <tr><th>Fragrance</th><th class=\"text-end\">Weight</th><th class=\"text-end\">Percent</th></tr>\n      </thead>\n      <tbody>${fragranceRows}</tbody>\n    </table>\n\n    <h2>Additives</h2>\n    <table>\n      <thead>\n        <tr><th>Additive</th><th class=\"text-end\">Weight</th><th class=\"text-end\">Percent</th></tr>\n      </thead>\n      <tbody>${additiveRows}</tbody>\n    </table>\n  </body>\n</html>`;\n  }\n\n  const oilRows = document.getElementById('oilRows');\n  const addOilBtn = document.getElementById('addOil');\n  const normalizeOilsBtn = document.getElementById('normalizeOils');\n  if (addOilBtn && oilRows) {\n    addOilBtn.dataset.bound = 'direct';\n    addOilBtn.addEventListener('click', function(){\n      oilRows.appendChild(SoapTool.oils.buildOilRow());\n      SoapTool.stages.updateStageStatuses();\n      SoapTool.storage.queueStateSave();\n    });\n  }\n  if (normalizeOilsBtn) {\n    normalizeOilsBtn.dataset.bound = 'direct';\n    normalizeOilsBtn.addEventListener('click', function(){\n      SoapTool.oils.normalizeOils();\n      SoapTool.stages.updateStageStatuses();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n\n  if (oilRows) oilRows.addEventListener('input', function(e){\n    if (e.target.classList.contains('oil-grams')) {\n      state.lastOilEdit = { row: e.target.closest('.oil-row'), field: 'grams' };\n    }\n    if (e.target.classList.contains('oil-percent')) {\n      state.lastOilEdit = { row: e.target.closest('.oil-row'), field: 'percent' };\n    }\n    if (e.target.classList.contains('oil-grams')\n      || e.target.classList.contains('oil-percent')\n      || e.target.classList.contains('oil-typeahead')) {\n      if (e.target.classList.contains('oil-typeahead')) {\n        SoapTool.oils.setSelectedOilProfileFromRow(e.target.closest('.oil-row'));\n      }\n      SoapTool.oils.updateOilTotals();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    }\n  });\n\n  if (oilRows) oilRows.addEventListener('focusin', function(e){\n    if (e.target.classList.contains('oil-typeahead')) {\n      SoapTool.oils.setSelectedOilProfileFromRow(e.target.closest('.oil-row'));\n    }\n  });\n\n  if (oilRows) oilRows.addEventListener('focusout', function(e){\n    if (e.target.classList.contains('oil-typeahead')) {\n      SoapTool.oils.clearSelectedOilProfile();\n    }\n    if (e.target.classList.contains('oil-grams')) {\n      SoapTool.oils.validateOilEntry(e.target.closest('.oil-row'), 'grams');\n    }\n    if (e.target.classList.contains('oil-percent')) {\n      SoapTool.oils.validateOilEntry(e.target.closest('.oil-row'), 'percent');\n    }\n  });\n\n  if (oilRows) oilRows.addEventListener('keydown', function(e){\n    if (e.key !== 'Enter') return;\n    if (e.target.classList.contains('oil-grams')) {\n      e.preventDefault();\n      SoapTool.oils.validateOilEntry(e.target.closest('.oil-row'), 'grams');\n    }\n    if (e.target.classList.contains('oil-percent')) {\n      e.preventDefault();\n      SoapTool.oils.validateOilEntry(e.target.closest('.oil-row'), 'percent');\n    }\n  });\n\n  if (oilRows) oilRows.addEventListener('mouseover', function(e){\n    if (!e.target.classList.contains('oil-typeahead')) return;\n    const row = e.target.closest('.oil-row');\n    if (!row || row === state.lastPreviewRow) return;\n    state.lastPreviewRow = row;\n    SoapTool.oils.setSelectedOilProfileFromRow(row);\n  });\n\n  if (oilRows) oilRows.addEventListener('mouseout', function(e){\n    if (e.target.classList.contains('oil-typeahead')) {\n      SoapTool.oils.clearSelectedOilProfile();\n    }\n  });\n\n  if (oilRows) oilRows.addEventListener('click', function(e){\n    const profileButton = e.target.closest('.oil-profile-open');\n    if (profileButton) {\n      const row = profileButton.closest('.oil-row');\n      if (row) {\n        SoapTool.oils.setSelectedOilProfileFromRow(row);\n        const modalEl = document.getElementById('oilProfileModal');\n        if (modalEl && window.bootstrap) {\n          const modal = bootstrap.Modal.getOrCreateInstance(modalEl);\n          modal.show();\n        }\n      }\n      return;\n    }\n    const removeButton = e.target.closest('.remove-oil');\n    if (removeButton) {\n      const row = removeButton.closest('.oil-row');\n      if (row) {\n        state.lastRemovedOil = SoapTool.oils.serializeOilRow(row);\n        state.lastRemovedOilIndex = Array.from(row.parentElement.children).indexOf(row);\n        SoapTool.ui.showUndoToast('Oil removed.');\n      }\n      if (row && state.lastOilEdit && state.lastOilEdit.row === row) {\n        state.lastOilEdit = null;\n        SoapTool.oils.clearSelectedOilProfile();\n      }\n      if (row) row.remove();\n      SoapTool.oils.updateOilTotals();\n      SoapTool.stages.updateStageStatuses();\n      SoapTool.storage.queueStateSave();\n    }\n  });\n\n  const fragranceRows = document.getElementById('fragranceRows');\n  const addFragranceBtn = document.getElementById('addFragrance');\n  if (addFragranceBtn && fragranceRows) {\n    addFragranceBtn.dataset.bound = 'direct';\n    addFragranceBtn.addEventListener('click', function(){\n      fragranceRows.appendChild(SoapTool.fragrances.buildFragranceRow());\n      SoapTool.fragrances.updateFragranceTotals(SoapTool.oils.getTotalOilsGrams());\n      SoapTool.stages.updateStageStatuses();\n      SoapTool.storage.queueStateSave();\n    });\n  }\n  if (fragranceRows) {\n    fragranceRows.addEventListener('input', function(e){\n      if (e.target.classList.contains('fragrance-grams')) {\n        SoapTool.state.lastFragranceEdit = { row: e.target.closest('.fragrance-row'), field: 'grams' };\n      }\n      if (e.target.classList.contains('fragrance-percent')) {\n        SoapTool.state.lastFragranceEdit = { row: e.target.closest('.fragrance-row'), field: 'percent' };\n      }\n      if (e.target.classList.contains('fragrance-grams')\n        || e.target.classList.contains('fragrance-percent')\n        || e.target.classList.contains('fragrance-typeahead')) {\n        SoapTool.fragrances.updateFragranceTotals(SoapTool.oils.getTotalOilsGrams());\n        SoapTool.stages.updateStageStatuses();\n        SoapTool.storage.queueStateSave();\n        SoapTool.storage.queueAutoCalc();\n      }\n    });\n    fragranceRows.addEventListener('click', function(e){\n      const removeButton = e.target.closest('.remove-fragrance');\n      if (!removeButton) return;\n      const row = removeButton.closest('.fragrance-row');\n      if (row) row.remove();\n      SoapTool.fragrances.updateFragranceTotals(SoapTool.oils.getTotalOilsGrams());\n      SoapTool.stages.updateStageStatuses();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n\n  const stageTabContent = document.getElementById('soapStageTabContent');\n  const getActiveStageScrollContainer = () => {\n    if (!stageTabContent) return null;\n    const activePane = stageTabContent.querySelector('.tab-pane.active') || stageTabContent.querySelector('.tab-pane.show.active');\n    if (!activePane) return null;\n    return activePane.querySelector('.soap-stage-body') || activePane;\n  };\n  const bindStageWheelGuard = () => {\n    if (!stageTabContent) return;\n    stageTabContent.addEventListener('wheel', event => {\n      const target = event.target;\n      if (!(target instanceof HTMLElement)) return;\n      const numberInput = target.closest('input[type=\"number\"]');\n      if (!(numberInput instanceof HTMLInputElement)) return;\n      const scrollContainer = getActiveStageScrollContainer();\n      if (!(scrollContainer instanceof HTMLElement)) return;\n      if (scrollContainer.scrollHeight <= scrollContainer.clientHeight + 1) return;\n      if (document.activeElement === numberInput && typeof numberInput.blur === 'function') {\n        numberInput.blur();\n      }\n      const atTop = scrollContainer.scrollTop <= 0;\n      const atBottom = (\n        scrollContainer.scrollTop + scrollContainer.clientHeight\n      ) >= (scrollContainer.scrollHeight - 1);\n      if ((event.deltaY < 0 && atTop) || (event.deltaY > 0 && atBottom)) {\n        return;\n      }\n      scrollContainer.scrollTop += event.deltaY;\n      event.preventDefault();\n    }, { passive: false });\n  };\n  if (stageTabContent) {\n    stageTabContent.addEventListener('click', event => {\n      const actionBtn = event.target.closest('[data-stage-action]');\n      const soapActionBtn = event.target.closest('[data-soap-action]');\n      if (!actionBtn && !soapActionBtn) return;\n      event.preventDefault();\n      event.stopPropagation();\n      if (document.activeElement && typeof document.activeElement.blur === 'function') {\n        document.activeElement.blur();\n      }\n      if (soapActionBtn) {\n        if (soapActionBtn.dataset.bound === 'direct') return;\n        const action = soapActionBtn.dataset.soapAction;\n        if (action === 'add-oil' && oilRows) {\n          oilRows.appendChild(SoapTool.oils.buildOilRow());\n          SoapTool.stages.updateStageStatuses();\n          SoapTool.storage.queueStateSave();\n        }\n        if (action === 'normalize-oils') {\n          SoapTool.oils.normalizeOils();\n          SoapTool.stages.updateStageStatuses();\n          SoapTool.storage.queueStateSave();\n          SoapTool.storage.queueAutoCalc();\n        }\n        if (action === 'add-fragrance' && fragranceRows) {\n          fragranceRows.appendChild(SoapTool.fragrances.buildFragranceRow());\n          SoapTool.fragrances.updateFragranceTotals(SoapTool.oils.getTotalOilsGrams());\n          SoapTool.stages.updateStageStatuses();\n          SoapTool.storage.queueStateSave();\n        }\n        return;\n      }\n      const action = actionBtn.dataset.stageAction;\n      const index = Number(actionBtn.dataset.stageIndex);\n      if (Number.isNaN(index)) return;\n      if (action === 'prev') SoapTool.stages.openStageByIndex(Math.max(0, index - 1));\n      if (action === 'next') SoapTool.stages.openStageByIndex(Math.min(SoapTool.constants.STAGE_CONFIGS.length - 1, index + 1));\n      if (action === 'reset') SoapTool.stages.resetStage(index + 1);\n    });\n    bindStageWheelGuard();\n  }\n  const stageTabList = document.getElementById('soapStageTabList');\n  const updateStageTabSizing = () => {\n    if (!stageTabList) return;\n    stageTabList.querySelectorAll('.nav-item').forEach(item => item.classList.remove('is-expanded'));\n    const active = stageTabList.querySelector('.nav-link.active');\n    if (active && active.closest('.nav-item')) {\n      active.closest('.nav-item').classList.add('is-expanded');\n    }\n  };\n  if (stageTabList) {\n    stageTabList.addEventListener('shown.bs.tab', () => {\n      updateStageTabSizing();\n      SoapTool.layout.scheduleStageHeightSync();\n    });\n    updateStageTabSizing();\n  }\n\n  const resultsToggle = document.getElementById('resultsCardToggle');\n  const resultsCard = document.getElementById('resultsCard');\n  if (resultsToggle && resultsCard) {\n    resultsToggle.addEventListener('click', () => {\n      resultsCard.classList.toggle('is-collapsed');\n      const isCollapsed = resultsCard.classList.contains('is-collapsed');\n      resultsToggle.setAttribute('aria-expanded', (!isCollapsed).toString());\n      const label = isCollapsed ? 'Expand formula details' : 'Collapse formula details';\n      resultsToggle.setAttribute('aria-label', label);\n      resultsToggle.setAttribute('title', label);\n      const icon = resultsToggle.querySelector('i');\n      if (icon) {\n        icon.classList.toggle('fa-chevron-down', isCollapsed);\n        icon.classList.toggle('fa-chevron-up', !isCollapsed);\n      }\n    });\n  }\n\n  document.querySelectorAll('input[name=\"weight_unit\"]').forEach(el => {\n    el.addEventListener('change', function(){\n      SoapTool.units.setUnit(this.value);\n      SoapTool.storage.queueStateSave();\n    });\n  });\n\n  const rescaleOilsFromStageOne = () => {\n    SoapTool.oils.scaleOilsToTarget(undefined, { force: true });\n    SoapTool.oils.updateOilTotals();\n    if (SoapTool.mold?.updateWetBatterWarning) {\n      SoapTool.mold.updateWetBatterWarning(null);\n    }\n  };\n\n  const oilTotalTarget = document.getElementById('oilTotalTarget');\n  if (oilTotalTarget) {\n    oilTotalTarget.addEventListener('input', function(){\n      SoapTool.mold.syncMoldPctFromTarget();\n      rescaleOilsFromStageOne();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n\n  const waterMethod = document.getElementById('waterMethod');\n  if (waterMethod) {\n    waterMethod.addEventListener('change', function(){\n      SoapTool.runner.setWaterMethod();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n\n  document.querySelectorAll('input[name=\"lye_type\"]').forEach(el => {\n    el.addEventListener('change', function(){\n      SoapTool.runner.applyLyeSelection();\n      SoapTool.additives.updateAdditivesOutput(SoapTool.oils.getTotalOilsGrams());\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  });\n\n  ['lyeSuperfat', 'lyePurity', 'waterPct', 'lyeConcentration', 'waterRatio'].forEach(id => {\n    const el = document.getElementById(id);\n    if (!el) return;\n    ['input', 'change'].forEach(eventName => {\n      el.addEventListener(eventName, () => {\n        SoapTool.storage.queueStateSave();\n        SoapTool.storage.queueAutoCalc();\n      });\n    });\n  });\n\n  ['additiveLactatePct', 'additiveSugarPct', 'additiveSaltPct', 'additiveCitricPct']\n    .forEach(id => {\n      const el = document.getElementById(id);\n      if (el) el.addEventListener('input', () => {\n        SoapTool.additives.updateAdditivesOutput(SoapTool.oils.getTotalOilsGrams());\n        SoapTool.stages.updateStageStatuses();\n        SoapTool.storage.queueStateSave();\n        SoapTool.storage.queueAutoCalc();\n      });\n    });\n  const additiveWeights = [\n    { weightId: 'additiveLactateWeight' },\n    { weightId: 'additiveSugarWeight' },\n    { weightId: 'additiveSaltWeight' },\n    { weightId: 'additiveCitricWeight' },\n  ];\n  additiveWeights.forEach(({ weightId }) => {\n    const weightInput = document.getElementById(weightId);\n    if (!weightInput) return;\n    weightInput.addEventListener('input', () => {\n      const totalOils = SoapTool.oils.getTotalOilsGrams();\n      if (!totalOils) return;\n      SoapTool.additives.updateAdditivesOutput(totalOils);\n      SoapTool.stages.updateStageStatuses();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  });\n\n  document.querySelectorAll('.additive-typeahead').forEach(input => {\n    input.addEventListener('input', () => {\n      SoapTool.storage.queueStateSave();\n    });\n  });\n\n  const qualityPreset = document.getElementById('qualityPreset');\n  if (qualityPreset) {\n    qualityPreset.addEventListener('change', function(){\n      SoapTool.quality.updateQualityTargets();\n      SoapTool.storage.queueStateSave();\n    });\n  }\n  document.querySelectorAll('.quality-focus').forEach(el => {\n    el.addEventListener('change', function(){\n      SoapTool.quality.updateQualityTargets();\n      SoapTool.storage.queueStateSave();\n    });\n  });\n  const applyQualityBtn = document.getElementById('applyQualityTargets');\n  if (applyQualityBtn) {\n    applyQualityBtn.addEventListener('click', function(){\n      SoapTool.quality.applyQualityTargets();\n    });\n  }\n  document.querySelectorAll('.quality-target-marker').forEach(marker => {\n    marker.addEventListener('click', () => SoapTool.quality.applyQualityTargets());\n    marker.addEventListener('keydown', event => {\n      if (event.key === 'Enter' || event.key === ' ') {\n        event.preventDefault();\n        SoapTool.quality.applyQualityTargets();\n      }\n    });\n  });\n\n  const moldWaterWeight = document.getElementById('moldWaterWeight');\n  if (moldWaterWeight) {\n    moldWaterWeight.addEventListener('input', function(){\n      SoapTool.mold.syncTargetFromMold();\n      rescaleOilsFromStageOne();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n  const moldOilPct = document.getElementById('moldOilPct');\n  if (moldOilPct) {\n    moldOilPct.addEventListener('input', function(){\n      SoapTool.mold.syncTargetFromMold();\n      rescaleOilsFromStageOne();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n  const moldShape = document.getElementById('moldShape');\n  if (moldShape) {\n    moldShape.addEventListener('change', function(){\n      SoapTool.mold.updateMoldShapeUI();\n      SoapTool.mold.syncTargetFromMold();\n      rescaleOilsFromStageOne();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n  const moldCylinderCorrection = document.getElementById('moldCylinderCorrection');\n  if (moldCylinderCorrection) {\n    moldCylinderCorrection.addEventListener('change', function(){\n      SoapTool.mold.syncTargetFromMold();\n      rescaleOilsFromStageOne();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n  const moldCylinderFactor = document.getElementById('moldCylinderFactor');\n  if (moldCylinderFactor) {\n    moldCylinderFactor.addEventListener('input', function(){\n      SoapTool.mold.syncTargetFromMold();\n      rescaleOilsFromStageOne();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n\n  document.querySelectorAll('.stub-btn').forEach(btn => {\n    btn.addEventListener('click', function(){\n      const kind = this.dataset.stubKind;\n      const name = this.dataset.stubName;\n      SoapTool.runner.addStubLine(kind, name);\n      SoapTool.storage.queueStateSave();\n    });\n  });\n\n  const soapRoot = document.getElementById('soapToolPage');\n  if (soapRoot) {\n    soapRoot.addEventListener('click', function(e){\n      if (e.target.classList.contains('tool-remove')) {\n        SoapTool.storage.queueStateSave();\n      }\n    });\n    soapRoot.addEventListener('input', function(e){\n      if (e.target.matches('input, select, textarea')) {\n        SoapTool.storage.queueStateSave();\n        SoapTool.ui.validateNumericField(e.target);\n        SoapTool.stages.updateStageStatuses();\n        SoapTool.ui.flashStage(e.target.closest('.soap-stage-card'));\n      }\n    });\n    soapRoot.addEventListener('change', function(e){\n      if (e.target.matches('input, select, textarea')) {\n        SoapTool.storage.queueStateSave();\n        SoapTool.ui.validateNumericField(e.target);\n        SoapTool.stages.updateStageStatuses();\n      }\n    });\n  }\n\n  const addToolIngredient = document.getElementById('addToolIngredient');\n  if (addToolIngredient) {\n    addToolIngredient.addEventListener('click', function(){\n      const wrapper = document.getElementById('tool-ingredients');\n      if (wrapper) wrapper.appendChild(SoapTool.runner.buildLineRow('ingredient'));\n      SoapTool.storage.queueStateSave();\n    });\n  }\n  const addToolConsumable = document.getElementById('addToolConsumable');\n  if (addToolConsumable) {\n    addToolConsumable.addEventListener('click', function(){\n      const wrapper = document.getElementById('tool-consumables');\n      if (wrapper) wrapper.appendChild(SoapTool.runner.buildLineRow('consumable'));\n      SoapTool.storage.queueStateSave();\n    });\n  }\n  const addToolContainer = document.getElementById('addToolContainer');\n  if (addToolContainer) {\n    addToolContainer.addEventListener('click', function(){\n      const wrapper = document.getElementById('tool-containers');\n      if (wrapper) wrapper.appendChild(SoapTool.runner.buildLineRow('container'));\n      SoapTool.storage.queueStateSave();\n    });\n  }\n\n  const calcLyeBtn = document.getElementById('calcLyeBtn');\n  if (calcLyeBtn) {\n    calcLyeBtn.addEventListener('click', async function(){\n      await SoapTool.runner.calculateAll({ consumeQuota: true, showAlerts: true });\n      SoapTool.storage.queueStateSave();\n    });\n  }\n\n  const saveSoapToolBtn = document.getElementById('saveSoapTool');\n  if (saveSoapToolBtn) {\n    saveSoapToolBtn.addEventListener('click', async function(){\n      try {\n        const calc = state.lastCalc || await SoapTool.runner.calculateAll({ consumeQuota: false, showAlerts: true });\n        if (!calc) return;\n        const payload = SoapTool.runner.buildSoapRecipePayload(calc);\n        state.lastRecipePayload = payload;\n        try {\n          const storage = SoapTool.helpers.getStorage();\n          if (storage) {\n            storage.setItem('soap_recipe_payload', JSON.stringify(payload));\n          }\n        } catch (_) {}\n        window.SOAP_RECIPE_DTO = payload;\n        SoapTool.ui.showSoapAlert('info', 'Recipe payload is ready. Push is stubbed for now; no data has been sent.', { dismissible: true, timeoutMs: 7000 });\n      } catch(_) {\n        SoapTool.ui.showSoapAlert('danger', 'Unable to prepare the recipe payload. Please try again.', { dismissible: true, persist: true });\n      }\n    });\n  }\n\n  const exportSoapCsvBtn = document.getElementById('exportSoapCsv');\n  if (exportSoapCsvBtn) {\n    exportSoapCsvBtn.addEventListener('click', async function(){\n      const calc = await getCalcForExport();\n      if (!calc) return;\n      const rows = buildFormulaCsv(calc);\n      const csvText = (typeof calc?.export?.csv_text === 'string' && calc.export.csv_text)\n        ? calc.export.csv_text\n        : buildCsvString(rows);\n      triggerCsvDownload(csvText, 'soap_formula.csv');\n    });\n  }\n\n  const printSoapSheetBtn = document.getElementById('printSoapSheet');\n  if (printSoapSheetBtn) {\n    printSoapSheetBtn.addEventListener('click', async function(){\n      const calc = await getCalcForExport();\n      if (!calc) return;\n      const html = buildPrintSheet(calc);\n      const win = window.open('', '_blank', 'width=960,height=720');\n      if (!win) {\n        if (SoapTool.ui?.showSoapAlert) {\n          SoapTool.ui.showSoapAlert('warning', 'Pop-up blocked. Allow pop-ups to print the sheet.', { dismissible: true, timeoutMs: 6000 });\n        }\n        return;\n      }\n      win.document.open();\n      win.document.write(html);\n      win.document.close();\n      win.focus();\n      win.onload = () => {\n        win.print();\n      };\n    });\n  }\n\n  const undoRemoveBtn = document.getElementById('soapUndoRemove');\n  if (undoRemoveBtn) {\n    undoRemoveBtn.addEventListener('click', () => {\n      if (!state.lastRemovedOil) return;\n      SoapTool.storage.restoreOilRow(state.lastRemovedOil, state.lastRemovedOilIndex || 0);\n      state.lastRemovedOil = null;\n      state.lastRemovedOilIndex = null;\n      SoapTool.oils.updateOilTotals();\n      SoapTool.storage.queueStateSave();\n      SoapTool.storage.queueAutoCalc();\n    });\n  }\n\n  const setupMobileDrawer = () => {\n    const drawer = document.getElementById('soapMobileDrawer');\n    const drawerContent = document.getElementById('soapMobileDrawerContent');\n    const drawerTitle = document.getElementById('soapMobileDrawerTitle');\n    const drawerEmpty = document.getElementById('soapDrawerEmpty');\n    const closeBtn = document.getElementById('soapDrawerClose');\n    const qualityCard = document.getElementById('soapQualityCard');\n    const resultsCard = document.getElementById('resultsCard');\n    if (!drawer || !drawerContent || !drawerTitle || !qualityCard || !resultsCard) return;\n\n    const qualityHome = qualityCard.parentElement;\n    const resultsHome = resultsCard.parentElement;\n    const placeholders = new Map();\n    let currentTarget = null;\n\n    const isSmallScreen = () => window.matchMedia('(max-width: 767px)').matches;\n    const cardForTarget = (target) => (target === 'quality' ? qualityCard : resultsCard);\n    const homeForTarget = (target) => (target === 'quality' ? qualityHome : resultsHome);\n    const titleForTarget = (target) => (target === 'quality' ? 'Display' : 'Results');\n\n    const ensurePlaceholder = (card) => {\n      let placeholder = placeholders.get(card);\n      if (!placeholder) {\n        placeholder = document.createElement('div');\n        placeholder.className = 'soap-card-placeholder';\n        placeholders.set(card, placeholder);\n      }\n      placeholder.style.height = `${card.offsetHeight}px`;\n      if (card.parentElement && card.parentElement !== drawerContent && !placeholder.parentElement) {\n        card.parentElement.insertBefore(placeholder, card);\n      }\n    };\n\n    const moveCardToDrawer = (card) => {\n      if (!card) return;\n      ensurePlaceholder(card);\n      drawerContent.appendChild(card);\n    };\n\n    const restoreCard = (card, home) => {\n      const placeholder = placeholders.get(card);\n      if (placeholder && placeholder.parentElement) {\n        placeholder.replaceWith(card);\n      } else if (home && card.parentElement !== home) {\n        home.appendChild(card);\n      }\n    };\n\n    const updateDrawerEmpty = () => {\n      if (!drawerEmpty) return;\n      const isResults = currentTarget === 'results';\n      const resultsVisible = getComputedStyle(resultsCard).display !== 'none';\n      drawerEmpty.classList.toggle('d-none', !isResults || resultsVisible);\n    };\n\n    const openDrawer = (target) => {\n      if (!isSmallScreen()) return;\n      if (currentTarget && currentTarget !== target) {\n        restoreCard(cardForTarget(currentTarget), homeForTarget(currentTarget));\n      }\n      moveCardToDrawer(cardForTarget(target));\n      drawerTitle.textContent = titleForTarget(target);\n      currentTarget = target;\n      drawer.classList.add('is-open');\n      updateDrawerEmpty();\n    };\n\n    const closeDrawer = () => {\n      if (!currentTarget) return;\n      restoreCard(cardForTarget(currentTarget), homeForTarget(currentTarget));\n      currentTarget = null;\n      drawer.classList.remove('is-open');\n      updateDrawerEmpty();\n    };\n\n    drawer.querySelectorAll('[data-drawer-target]').forEach(btn => {\n      btn.addEventListener('click', () => {\n        const target = btn.dataset.drawerTarget;\n        if (!target) return;\n        if (drawer.classList.contains('is-open') && currentTarget === target) {\n          closeDrawer();\n        } else {\n          openDrawer(target);\n        }\n      });\n    });\n\n    if (closeBtn) {\n      closeBtn.addEventListener('click', closeDrawer);\n    }\n\n    window.addEventListener('resize', () => {\n      if (!isSmallScreen() && currentTarget) {\n        closeDrawer();\n      }\n    });\n\n    const resultsObserver = new MutationObserver(() => updateDrawerEmpty());\n    resultsObserver.observe(resultsCard, { attributes: true, attributeFilter: ['style', 'class'] });\n  };\n\n  setupMobileDrawer();\n  window.addEventListener('resize', SoapTool.layout.scheduleStageHeightSync);\n  window.addEventListener('load', SoapTool.layout.scheduleStageHeightSync);\n\n  SoapTool.additives.attachAdditiveTypeahead('additiveLactateName', 'additiveLactateGi', LACTATE_CATEGORY_SET, 'additiveLactateUnit', 'additiveLactateCategory');\n  SoapTool.additives.attachAdditiveTypeahead('additiveSugarName', 'additiveSugarGi', SUGAR_CATEGORY_SET, 'additiveSugarUnit', 'additiveSugarCategory');\n  SoapTool.additives.attachAdditiveTypeahead('additiveSaltName', 'additiveSaltGi', SALT_CATEGORY_SET, 'additiveSaltUnit', 'additiveSaltCategory');\n  SoapTool.additives.attachAdditiveTypeahead('additiveCitricName', 'additiveCitricGi', CITRIC_CATEGORY_SET, 'additiveCitricUnit', 'additiveCitricCategory');\n  SoapTool.ui.applyHelperVisibility();\n  SoapTool.quality.initQualityTooltips();\n  SoapTool.runner.applyLyeSelection();\n  SoapTool.runner.setWaterMethod();\n  SoapTool.mold.updateMoldShapeUI();\n  SoapTool.quality.setQualityRangeBars();\n  SoapTool.units.updateUnitLabels();\n  SoapTool.quality.updateQualityTargets();\n  SoapTool.additives.updateAdditivesOutput(SoapTool.oils.getTotalOilsGrams());\n  SoapTool.stages.updateStageStatuses();\n  SoapTool.storage.restoreState();\n  if (oilRows && !oilRows.querySelector('.oil-row')) {\n    oilRows.appendChild(SoapTool.oils.buildOilRow());\n  }\n  if (fragranceRows && !fragranceRows.querySelector('.fragrance-row')) {\n    if (SoapTool.fragrances?.buildFragranceRow) {\n      fragranceRows.appendChild(SoapTool.fragrances.buildFragranceRow());\n    }\n  }\n  if (SoapTool.fragrances?.updateFragranceTotals) {\n    SoapTool.fragrances.updateFragranceTotals(SoapTool.oils.getTotalOilsGrams());\n  }\n  SoapTool.layout.scheduleStageHeightSync();\n})(window);\n"],
  "mappings": "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",
  "names": ["window", "SOURCE_LABELS", "SOURCE_BADGE_CLASS", "DEFAULT_OPTIONS", "debounce", "fn", "wait", "timeout", "args", "normalizedName", "value", "ensureListContainer", "listEl", "div", "resolveOption", "buildGlobalIdSet", "items", "set", "item", "gid", "createSourceBadge", "source", "label", "renderFlatList", "groups", "onPick", "opts", "hasAny", "group", "entry", "subtitle", "e", "empty", "renderIngredientFirst", "header", "ingredient", "itemEl", "summary", "formsContainer", "form", "btn", "toggleForms", "renderDefinitionResults", "meta", "expandGlobalItems", "expanded", "baseIngredientName", "categoryName", "categoryTags", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "_j", "physical", "display", "displayName", "groupInventoryByIngredient", "map", "baseName", "key", "groupGlobalByIngredient", "rawGroups", "dedupeIds", "forms", "filteredForms", "fetchIngredientDefinitions", "q", "params", "r", "attachMergedInventoryGlobalTypeahead", "options", "inputEl", "invHiddenEl", "giHiddenEl", "mode", "searchTypeOption", "includeInventoryOption", "includeGlobalOption", "ingredientFirstOption", "displayVariant", "resultFilter", "onSelection", "globalUrlBuilder", "buildInventoryUrl", "effectiveSearchType", "buildGlobalUrl", "useIngredientFirst", "doSearch", "includeInventory", "includeGlobal", "ingredientFirst", "variant", "results", "handleSelection", "inventoryPromise", "globalPromise", "inventoryRaw", "globalRaw", "inventory", "filteredGlobalRaw", "seenGlobalIds", "globalExpanded", "inventoryGroups", "globalGroups", "ingredientGroups", "mergedGroups", "picked", "window", "buildToolLineRow", "kind", "options", "context", "unitOptionsHtml", "mode", "row", "input", "giHidden", "list", "searchType", "includeInventory", "window", "SoapTool", "round", "toNumber", "clamp", "formatTime", "getStorage", "buildSoapcalcSearchBuilder", "value", "decimals", "factor", "cleaned", "num", "min", "max", "ts", "buildGilUrl", "q", "effectiveSearchType", "useIngredientFirst", "params", "buildCsvUrl", "_searchType", "window", "SoapTool", "QUALITY_RANGES", "QUALITY_HINTS", "QUALITY_FEEL_HINTS", "IODINE_RANGE", "IODINE_SCALE_MAX", "INS_RANGE", "INS_SCALE_MAX", "QUALITY_BASE", "QUALITY_PRESETS", "FATTY_BAR_COLORS", "FATTY_DISPLAY_KEYS", "OIL_TIP_RULES", "UNIT_FACTORS", "STAGE_CONFIGS", "OIL_CATEGORY_SET", "FRAGRANCE_CATEGORY_SET", "LACTATE_CATEGORY_SET", "SUGAR_CATEGORY_SET", "SALT_CATEGORY_SET", "CITRIC_CATEGORY_SET", "window", "SoapTool", "toNumber", "computeIodine", "oils", "totalWeight", "weighted", "oil", "computeFattyAcids", "totals", "coveredWeight", "key", "pct", "value", "percent", "grams", "computeQualities", "fattyPercent", "get", "computeOilQualityScores", "fattyProfile", "profile", "qualities", "window", "SoapTool", "round", "toNumber", "clamp", "UNIT_FACTORS", "state", "toGrams", "value", "fromGrams", "formatWeight", "formatPercent", "updateUnitLabels", "el", "setUnit", "unit", "options", "prevUnit", "ratio", "input", "oilTarget", "moldWater", "window", "SoapTool", "state", "ALERT_ICONS", "pulseValue", "el", "getToastInstance", "id", "_a", "showAutosaveToast", "now", "toast", "showUndoToast", "message", "toastEl", "body", "updateResultsMeta", "badge", "updatedAt", "updateResultsWarnings", "waterData", "concentrationEl", "ratioEl", "concentration", "ratio", "applyHelperVisibility", "text", "wrapper", "validateNumericField", "input", "raw", "value", "min", "max", "tooLow", "tooHigh", "flashStage", "stageItem", "target", "showSoapAlert", "type", "options", "alertStack", "icon", "alert", "clearSoapAlerts", "window", "SoapTool", "syncStageHeight", "stagePane", "qualityCard", "qualityHeight", "scheduleStageHeightSync", "window", "SoapTool", "clamp", "toNumber", "round", "toGrams", "fromGrams", "updateMoldSuggested", "settings", "getMoldSettings", "targetInput", "targetHint", "note", "message", "updateWetBatterWarning", "batchYieldG", "_a", "warning", "hide", "state", "lastCalc", "currentTotalOils", "calcTotalOils", "batchYield", "overBy", "unit", "syncTargetFromMold", "syncMoldPctFromTarget", "moldOilPct", "target", "cappedTarget", "nextPct", "nextSettings", "_b", "_c", "waterWeight", "oilPct", "shape", "useCylinder", "cylinderFactor", "effectiveCapacity", "targetOils", "updateMoldShapeUI", "options", "window", "SoapTool", "round", "toNumber", "clamp", "buildSoapcalcSearchBuilder", "toGrams", "fromGrams", "OIL_CATEGORY_SET", "OIL_TIP_RULES", "computeQualities", "state", "attachOilTypeahead", "row", "input", "hiddenSap", "hiddenIodine", "hiddenFatty", "hiddenGi", "hiddenUnit", "hiddenCategory", "list", "builder", "item", "source", "matchesCategory", "picked", "setSelectedOilProfile", "updateOilTotals", "clearSelectedOilProfile", "buildOilRow", "_a", "_b", "template", "text", "wrapper", "el", "getOilTargetGrams", "targetInput", "manualTarget", "mold", "deriveTargetFromRows", "rows", "derived", "grams", "pct", "acc", "value", "getRowLimits", "target", "otherTotal", "current", "otherPct", "allowedPct", "allowedByTotal", "allowedByPct", "setOilHint", "field", "message", "hint", "bounceInput", "validateOilEntry", "options", "gramsInput", "pctInput", "limits", "nextValue", "nextPct", "scaleOilsToTarget", "nextTarget", "force", "totalPct", "sum", "totalWeight", "share", "ratio", "nextGrams", "enforceOilTargetCap", "lastRow", "allowed", "updateOilLimitWarning", "capped", "warning", "messages", "over", "totalLabel", "updateOilTips", "normalizeOils", "collectOilData", "oils", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "name", "sapKoh", "iodine", "fattyRaw", "gi", "defaultUnit", "categoryName", "fattyProfile", "updateSelectedOilProfileDisplay", "floatCard", "setText", "id", "nameLabel", "sapValue", "iodineValue", "qualities", "setValue", "safe", "key", "baseId", "modalId", "setSelectedOilProfileFromRow", "tipBox", "oil", "tips", "rule", "lauric", "myristic", "palmitic", "stearic", "ricinoleic", "oleic", "linoleic", "linolenic", "tipList", "tip", "getTotalOilsGrams", "serializeOilRow", "allowedSet", "category", "getItemCategoryName", "window", "_a", "SoapTool", "bulk", "toNumber", "clamp", "state", "FATTY_KEYS", "LOCAL_SORT_KEYS", "PAGE_SIZE", "SCROLL_FETCH_THRESHOLD", "SEARCH_DEBOUNCE_MS", "DEFAULT_MODAL_STATE", "queueStateSave", "_b", "showAlert", "level", "message", "getRefs", "isSupportedSortKey", "sortKey", "ensureModalState", "modalState", "normalizeFattyProfile", "rawProfile", "profile", "input", "key", "value", "normalizeCatalogRecord", "raw", "fattyProfile", "name", "source", "globalItemId", "updateSelectionCounters", "refs", "count", "summary", "selectionForRecordKey", "recordKey", "setSelection", "record", "values", "existing", "next", "removeSelection", "getRecordByKey", "serializeSelection", "item", "restoreState", "savedState", "selection", "window", "SoapTool", "bulk", "shared", "round", "toNumber", "fromGrams", "FATTY_KEYS", "LOCAL_SORT_KEYS", "getRefs", "ensureModalState", "selectionForRecordKey", "updateSelectionCounters", "updateStatusText", "text", "refs", "refreshCatalogStatus", "modalState", "modeLabel", "noMatchLabel", "loaded", "total", "moreHint", "queryHint", "compareValues", "aValue", "bValue", "dir", "left", "right", "aNum", "bNum", "localSortValue", "record", "sortKey", "_a", "_b", "applyLocalSelectionSortIfNeeded", "primary", "applyViewSelectedOrderingIfNeeded", "selected", "others", "applyClientOrdering", "normalizeServerSortKey", "key", "sortButtonsLabel", "button", "label", "updateRowFromSelection", "row", "selection", "checkbox", "pctInput", "weightInput", "createFattyCell", "value", "cell", "numeric", "createRow", "pickCell", "nameCell", "title", "detail", "category", "pctCell", "weightCell", "renderVisibleRecords", "fragment", "window", "SoapTool", "bulk", "shared", "render", "PAGE_SIZE", "getRefs", "ensureModalState", "normalizeCatalogRecord", "refreshCatalogStatus", "normalizeServerSortKey", "applyClientOrdering", "renderVisibleRecords", "updateStatusText", "resetVisibleCatalogForFetch", "modalState", "refs", "fetchCatalogPage", "reset", "requestToken", "params", "response", "payload", "records", "nextOffset", "totalCount", "hasMore", "record", "_", "window", "SoapTool", "bulk", "shared", "render", "api", "round", "toNumber", "clamp", "toGrams", "fromGrams", "state", "LOCAL_SORT_KEYS", "SCROLL_FETCH_THRESHOLD", "SEARCH_DEBOUNCE_MS", "queueStateSave", "showAlert", "getRefs", "ensureModalState", "updateSelectionCounters", "setSelection", "removeSelection", "getRecordByKey", "serializeSelection", "restoreState", "applyClientOrdering", "sortButtonsLabel", "renderVisibleRecords", "fetchCatalogPage", "modalInstance", "searchDebounceTimer", "closeModal", "_a", "refs", "getStageRowsContainer", "getStageRows", "normalizeName", "value", "stageRowName", "row", "stageRowGi", "raw", "stageRowByKey", "recordKey", "fallbackRecord", "normalizedKey", "rows", "entry", "gi", "name", "applySelectionToStageRow", "item", "nameInput", "sapInput", "iodineInput", "fattyInput", "giInput", "unitInput", "categoryInput", "gramsInput", "percentInput", "upsertStageRowForSelection", "oilRows", "removeStageRowForSelection", "clearStageRows", "notifyStageOilChanged", "normalizeSelectionKey", "rawName", "rawGi", "rawKey", "explicit", "buildSelectionFromStage", "selection", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "sap", "iodine", "giRaw", "unit", "categoryName", "selectedPct", "selectedWeightG", "fattyRaw", "fattyProfile", "parsed", "key", "hydrateSelectionFromStage", "modalState", "syncAllSelectionsToStage", "selectedItems", "expectedKeys", "left", "right", "openModal", "handleBodyInput", "event", "target", "record", "checkbox", "pctInput", "weightInput", "pct", "hasValues", "selected", "handleModeToggle", "checked", "handleViewSelectedToggle", "handleSortClick", "button", "sortKey", "clearSelection", "handleScroll", "scheduleSearchReload", "saveAndClose", "onUnitChanged", "bindEvents", "localRefs", "window", "SoapTool", "toNumber", "round", "clamp", "buildSoapcalcSearchBuilder", "formatWeight", "toGrams", "fromGrams", "FRAGRANCE_CATEGORY_SET", "state", "attachAdditiveTypeahead", "inputId", "hiddenId", "categorySet", "unitId", "categoryId", "_a", "input", "hidden", "hiddenUnit", "hiddenCategory", "list", "builder", "item", "source", "category", "getItemCategoryName", "picked", "readAdditivePct", "pctId", "weightId", "_b", "_c", "pctInput", "pctRaw", "totalOils", "weightGrams", "collectAdditiveSettings", "_d", "_e", "_f", "_g", "_h", "applyComputedOutputs", "outputs", "setOutput", "id", "value", "el", "toDisplay", "grams", "updateAdditivesOutput", "expectedOils", "calc", "calcOils", "oilsMatch", "attachFragranceTypeahead", "row", "buildFragranceRow", "template", "updateFragranceTotals", "rows", "target", "totalGrams", "totalPct", "gramsInput", "pct", "effectiveGrams", "effectivePct", "totalPctEl", "totalWeightEl", "collectFragranceData", "name", "percent", "gi", "defaultUnit", "categoryName", "updateVisualGuidance", "data", "tips", "tip", "window", "SoapTool", "toNumber", "STAGE_CONFIGS", "openStageByIndex", "index", "_a", "stage", "tabButton", "btn", "pane", "resetStage", "stageId", "_b", "unitGrams", "correction", "oilRows", "lyeNaoh", "waterMethod", "superfat", "purity", "waterPct", "lyeConcentration", "waterRatio", "id", "el", "fragranceRows", "totalPct", "totalWeight", "updateStageStatuses", "getStageCompletion", "moldWeight", "oilTarget", "moldPct", "complete", "hasOil", "row", "_c", "_d", "name", "grams", "pct", "method", "tabList", "progress", "window", "SoapTool", "round", "toNumber", "clamp", "computeFattyAcids", "computeQualities", "computeOilQualityScores", "QUALITY_RANGES", "QUALITY_HINTS", "QUALITY_FEEL_HINTS", "IODINE_RANGE", "IODINE_SCALE_MAX", "INS_RANGE", "INS_SCALE_MAX", "QUALITY_BASE", "QUALITY_PRESETS", "FATTY_BAR_COLORS", "FATTY_DISPLAY_KEYS", "pulseValue", "showSoapAlert", "setBarFill", "barId", "fillId", "value", "max", "label", "bar", "fill", "safeValue", "clamped", "width", "setQualityBarColor", "range", "setScaledBar", "result", "setQualityRangeBars", "rangeConfig", "key", "config", "min", "scale", "name", "safe", "startPct", "widthPct", "minLabel", "maxLabel", "updateQualitySliders", "qualities", "superfat", "hardness", "bubbly", "conditioning", "greasyScore", "hardEl", "bubblyEl", "conditioningEl", "greasyEl", "updateFattyBar", "fattyPercent", "el", "getQualityTargets", "_a", "preset", "focusEls", "base", "attr", "direction", "updateQualityTargets", "targets", "markers", "marker", "labelEl", "scaleMax", "applyQualityTargets", "oils", "row", "_b", "grams", "fattyRaw", "fattyProfile", "item", "fatty", "oil", "currentQualities", "deltas", "totalOils", "sum", "adjusted", "totalAdjusted", "strength", "missingFatty", "scores", "adjustment", "factor", "next", "target", "gramsInput", "pctInput", "percent", "updateQualitiesDisplay", "data", "coveragePct", "iodine", "ins", "sapAvg", "serviceWarnings", "hasCoverage", "setQuality", "hintEl", "rangeKey", "fillResult", "coverageNote", "iodineEl", "insEl", "sapEl", "sat", "unsat", "ratioEl", "id", "warnings", "warningBox", "w", "initQualityTooltips", "btn", "window", "SoapTool", "round", "toNumber", "clamp", "deriveSapAverage", "oils", "sapWeighted", "sapWeightG", "oil", "sapKoh", "grams", "buildSoapNotesBlob", "calc", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "_j", "_k", "_l", "qualityReport", "fattyPercent", "qualities", "sapAvg", "iodine", "ins", "mold", "el", "getAdditiveItem", "nameId", "giId", "fallbackName", "unitId", "categoryId", "name", "giRaw", "defaultUnit", "categoryName", "collectFragranceRows", "totalOils", "rows", "target", "row", "gramsInput", "pctInput", "pct", "collectDraftLines", "wrapperId", "kind", "out", "gi", "qtyEl", "unitEl", "hasQty", "buildLineRow", "context", "mode", "addStubLine", "input", "qty", "buildSoapRecipePayload", "notesBlob", "baseIngredients", "lyeName", "item", "window", "SoapTool", "round", "toNumber", "clamp", "formatWeight", "formatPercent", "getLyeSelection", "_a", "selected", "purityInput", "purityRaw", "purity", "lyeType", "applyLyeSelection", "selection", "hint", "getWaterMethodHelp", "method", "updateStageWaterSummary", "summary", "explicitMethod", "waterOutput", "hintOutput", "hasWater", "concentration", "ratio", "updateLiveCalculationPreview", "anchorEl", "lyeEl", "waterEl", "concEl", "ratioEl", "setText", "el", "value", "totalOils", "lye", "water", "concentrationInput", "ratioInput", "setWaterMethod", "validateCalculation", "totals", "totalPct", "errors", "oils", "target", "hasPercent", "input", "readSuperfatInput", "superfatInput", "superfatRaw", "superfat", "sanitizeLyeInputs", "_b", "_c", "_d", "waterMethod", "waterPct", "lyeConcentration", "waterRatio", "window", "SoapTool", "getStorage", "readCalcUsage", "storage", "raw", "today", "data", "writeCalcUsage", "count", "canConsumeCalcQuota", "consumeCalcQuota", "nextCount", "remaining", "maybeShowSignupModal", "modalEl", "window", "SoapTool", "state", "buildServicePayload", "oils", "selection", "superfat", "purity", "waterMethod", "waterPct", "lyeConcentration", "waterRatio", "totalOils", "additiveSettings", "fragranceRows", "oil", "row", "calculateWithSoapService", "payload", "_a", "token", "controller", "timeoutId", "response", "data", "window", "SoapTool", "round", "toNumber", "formatWeight", "formatPercent", "state", "DEFAULT_ADDITIVES", "mapOilsForState", "rows", "oil", "_a", "setText", "id", "value", "el", "renderResultsCard", "resultsCard", "lyeAdjusted", "waterData", "batchYield", "totalOils", "superfat", "card", "ratioValue", "maybeShowGuidanceAlerts", "showAlerts", "lyeTotals", "purity", "mold", "applyServiceResult", "serviceResult", "validation", "selection", "waterMethod", "waterPct", "lyeConcentrationInput", "waterRatioInput", "lyeType", "resolvedSuperfat", "superfatValue", "lyePure", "resolvedPurity", "resolvedWaterMethod", "resolvedWaterPct", "resolvedLyeConcentrationInput", "resolvedWaterRatioInput", "qualityReport", "oilsForState", "liveSummary", "additives", "window", "SoapTool", "state", "runnerInputs", "runnerQuota", "runnerService", "runnerRender", "calculateAll", "options", "_a", "settings", "validation", "err", "superfat", "selection", "sanitized", "requestSeq", "servicePayload", "serviceResult", "calc", "args", "window", "SoapTool", "formatTime", "getStorage", "STATE_STORAGE_KEY", "serializeLines", "wrapperId", "kind", "out", "row", "_a", "_b", "_c", "name", "gi", "qtyEl", "unitEl", "qty", "serializeOils", "oils", "_d", "_e", "_f", "_g", "_h", "_i", "_j", "grams", "percent", "sap", "iodine", "fattyRaw", "defaultUnit", "categoryName", "serializeFragrances", "rows", "restoreOilRow", "data", "index", "oilRows", "categoryEl", "children", "saveState", "_k", "_l", "_m", "_n", "_o", "_p", "_q", "_r", "_s", "_t", "_u", "_v", "_w", "_x", "_y", "_z", "_A", "storage", "payload", "el", "lastSaved", "restoreState", "raw", "unitInput", "oil", "superfat", "lyeType", "purity", "waterMethod", "waterPct", "lyeConcentration", "waterRatio", "fragranceRows", "fragrances", "item", "lactateName", "lactateGi", "lactateUnit", "lactateCategory", "sugarName", "sugarGi", "sugarUnit", "sugarCategory", "saltName", "saltGi", "saltUnit", "saltCategory", "citricName", "citricGi", "citricUnit", "citricCategory", "moldShape", "cylCorrection", "cylFactor", "targetInput", "preset", "desired", "option", "opt", "restoreLines", "items", "wrapper", "input", "giHidden", "saveStateTimer", "queueStateSave", "autoCalcTimer", "queueAutoCalc", "window", "_a", "_b", "SoapTool", "LACTATE_CATEGORY_SET", "SUGAR_CATEGORY_SET", "SALT_CATEGORY_SET", "CITRIC_CATEGORY_SET", "round", "toNumber", "clamp", "formatWeight", "formatPercent", "toGrams", "state", "getCalcForExport", "calc", "collectFragranceExportRows", "totalOils", "rows", "row", "_c", "_d", "name", "gramsInput", "pctInput", "grams", "pct", "collectAdditiveExportRows", "additives", "_e", "_f", "_g", "_h", "lactateName", "sugarName", "saltName", "citricName", "buildFormulaCsv", "oil", "csvEscape", "value", "str", "buildCsvString", "triggerCsvDownload", "csvText", "filename", "blob", "url", "link", "buildPrintSheet", "oils", "fragrances", "now", "oilRows", "fragranceRows", "item", "additiveRows", "lyeLabel", "extraLyeRow", "addOilBtn", "normalizeOilsBtn", "e", "profileButton", "modalEl", "removeButton", "addFragranceBtn", "stageTabContent", "getActiveStageScrollContainer", "activePane", "bindStageWheelGuard", "event", "target", "numberInput", "scrollContainer", "atTop", "atBottom", "actionBtn", "soapActionBtn", "action", "index", "stageTabList", "updateStageTabSizing", "active", "resultsToggle", "resultsCard", "isCollapsed", "label", "icon", "el", "rescaleOilsFromStageOne", "oilTotalTarget", "waterMethod", "id", "eventName", "weightId", "weightInput", "input", "qualityPreset", "applyQualityBtn", "marker", "moldWaterWeight", "moldOilPct", "moldShape", "moldCylinderCorrection", "moldCylinderFactor", "btn", "kind", "soapRoot", "addToolIngredient", "wrapper", "addToolConsumable", "addToolContainer", "calcLyeBtn", "saveSoapToolBtn", "payload", "storage", "exportSoapCsvBtn", "printSoapSheetBtn", "html", "win", "undoRemoveBtn", "drawer", "drawerContent", "drawerTitle", "drawerEmpty", "closeBtn", "qualityCard", "qualityHome", "resultsHome", "placeholders", "currentTarget", "isSmallScreen", "cardForTarget", "homeForTarget", "titleForTarget", "ensurePlaceholder", "card", "placeholder", "moveCardToDrawer", "restoreCard", "home", "updateDrawerEmpty", "isResults", "resultsVisible", "openDrawer", "closeDrawer"]
}
