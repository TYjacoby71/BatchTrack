(()=>{(function(h){"use strict";function d(n,r){var e;return function(){clearTimeout(e);var t=this,o=arguments;e=setTimeout(function(){n.apply(t,o)},r)}}function p(n){var r=String(n||"").replace(/[^A-Za-z0-9\s]+/g," ").replace(/[_-]+/g," "),e=r.trim().split(/\s+/).filter(Boolean);if(!e.length)return"RCP";var t=e.map(function(u){return u.toUpperCase()}),o=[];t.length===1?(o.push(t[0].slice(0,3)),o.push(t[0].slice(0,4))):t.length===2?(o.push(t[0].slice(0,2)+t[1].slice(0,1)),o.push(t[0].slice(0,1)+t[1].slice(0,2))):(o.push(t[0].slice(0,1)+t[1].slice(0,1)+t[2].slice(0,1)),o.push(t[0].slice(0,1)+t[1].slice(0,2)+t[2].slice(0,1)));for(var i="",a=0;a<o.length;a++)if(o[a]){i=o[a];break}return i=(i||"RCP").toUpperCase(),i.slice(0,8)}function f(){var n=document.querySelector('input[name="name"]'),r=document.getElementById("label_prefix");if(!n||!r||r.dataset.autoPrefix!=="true")return;var e=r.dataset.prefixEndpoint||"";r.readOnly=!0;function t(){var i=(n.value||"").trim();if(!i){r.value="";return}var a=p(i);r.value=a,e&&fetch(e+"?name="+encodeURIComponent(i),{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(u){return u.ok?u.json():null}).then(function(u){u&&u.prefix&&(r.value=String(u.prefix||a).toUpperCase().slice(0,8))}).catch(function(){})}var o=d(t,300);n.addEventListener("input",o),n.addEventListener("blur",t),n.value&&!r.value&&t()}function v(){var n=document.getElementById("portion_name");if(!n)return;var r=n.parentNode,e=document.createElement("div");e.className="list-group position-absolute w-100 d-none",r.style.position="relative",r.appendChild(e);function t(i){e.innerHTML="";var a=!1;i&&i.length&&(i.forEach(function(l){var c=document.createElement("a");c.href="#",c.className="list-group-item list-group-item-action",c.textContent=l.name,c.addEventListener("click",function(m){m.preventDefault(),n.value=l.name,e.classList.add("d-none")}),e.appendChild(c)}),a=!0);var u=(n.value||"").trim();if(u){var s=document.createElement("a");s.href="#",s.className="list-group-item list-group-item-action text-primary",s.textContent='Create "'+u+'"',s.addEventListener("click",function(l){l.preventDefault(),fetch("/recipes/units/quick-add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u,type:"count"})}).then(function(c){return c.json()}).then(function(c){c&&!c.error&&(n.value=c.name||u,e.classList.add("d-none"))})}),e.appendChild(s),a=!0}e.classList.toggle("d-none",!a)}var o=d(function(){var i=(n.value||"").trim();if(!i){e.classList.add("d-none"),e.innerHTML="";return}fetch("/api/unit-search?type=count&q="+encodeURIComponent(i),{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(a){return a.ok?a.json():{data:[]}}).then(function(a){t(a&&a.data||[])}).catch(function(){e.classList.add("d-none")})},200);n.addEventListener("input",o),document.addEventListener("click",function(i){!e.contains(i.target)&&i.target!==n&&e.classList.add("d-none")})}document.addEventListener("DOMContentLoaded",function(){v(),f()})})(window);})();
