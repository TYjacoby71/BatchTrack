(()=>{(function(){"use strict";console.log("\u{1F527} CONTAINER DRAWER JS: Script is loading");function y(e){return e&&e.matches("#yieldFixForm")}function l(e){return e?e.closest("#containerUnitMismatchDrawer"):null}function s(e,t,n){e&&(t?(n&&(e.textContent=n),e.classList.remove("d-none")):e.classList.add("d-none"))}function R(e){var t,n,o;return e?((n=e.querySelector('input[name="csrf_token"]'))==null?void 0:n.value)||((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)||typeof window!="undefined"&&typeof window.getCSRFToken=="function"&&window.getCSRFToken()||"":typeof window!="undefined"&&typeof window.getCSRFToken=="function"&&window.getCSRFToken()||((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""}async function S(e){if(!y(e.target))return;e.preventDefault();let t=e.target,n=l(t),o=t.dataset.recipeId,i=t.querySelector('button[type="submit"]'),f=n==null?void 0:n.querySelector("#yieldFixSuccess"),w=n==null?void 0:n.querySelector("#yieldFixError"),p=t.dataset.updateUrl,m=R(t);if(!p){console.warn("Container drawer missing update URL");return}s(f,!1),s(w,!1),i&&(i.disabled=!0,i.dataset.originalLabel=i.innerHTML,i.innerHTML='<span class="spinner-border spinner-border-sm"></span> Saving');try{let r=await fetch(p,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json",...m?{"X-CSRFToken":m}:{}},body:new FormData(t)}),d=await r.text(),a;try{a=d?JSON.parse(d):{}}catch(c){throw console.error("Container drawer: non-JSON response received",c,d),new Error("Server returned an unexpected response while saving. Please refresh and try again.")}if(!r.ok||!a.success)throw new Error(a.error||"Failed to update recipe yield");s(f,!0,"Yield updated. Refreshing plan\u2026"),window.dispatchEvent(new CustomEvent("recipe.yield.updated",{detail:{recipe_id:Number(o),yield_amount:a.yield_amount,yield_unit:a.yield_unit,source:"container_unit_mismatch",refresh_plan:!0}})),setTimeout(()=>{if(!n)return;let c=bootstrap.Modal.getInstance(n);c&&c.hide()},600)}catch(r){console.error("Container drawer: yield update failed",r),s(w,!0,r.message)}finally{i&&(i.disabled=!1,i.innerHTML=i.dataset.originalLabel||'<i class="fas fa-sync-alt me-1"></i> Save & Refresh')}}function g(e){let t=e.target.closest("#disableContainersBtn");if(!t)return;console.log("\u{1F527} CONTAINER DRAWER: Disable button clicked");let n=l(t),o=Number(t.dataset.recipeId);if(window.dispatchEvent(new CustomEvent("container.requirements.disable",{detail:{recipe_id:o}})),n){let i=bootstrap.Modal.getInstance(n);i&&i.hide()}}function h(){console.log("\u{1F527} CONTAINER DRAWER: initializeModal called")}function u(){console.log("\u{1F527} CONTAINER DRAWER JS: Initializing event listeners"),document.body.addEventListener("submit",S),document.body.addEventListener("click",g)}window.containerUnitMismatchDrawer=window.containerUnitMismatchDrawer||{},window.containerUnitMismatchDrawer.initializeModal=h,console.log("\u{1F527} CONTAINER DRAWER JS: Functions exposed to window.containerUnitMismatchDrawer",window.containerUnitMismatchDrawer),console.log("\u{1F527} CONTAINER DRAWER JS: initializeModal type:",typeof window.containerUnitMismatchDrawer.initializeModal),console.log("\u{1F527} CONTAINER DRAWER JS: Setting up initialization, readyState:",document.readyState),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u(),console.log("\u{1F527} CONTAINER DRAWER JS: Script fully loaded")})();})();
