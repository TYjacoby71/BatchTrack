var H={offcanvasId:"globalItemDetail",loadingId:"giDetailLoading",contentId:"giDetailContent",developerLinkId:"giDevLink",storeLinkId:"giStoreLink",nameId:"giName",typeId:"giType",ingredientNameId:"giIngredientName",ingredientInciId:"giInciName",ingredientCasId:"giCasNumber",categoryId:"giCategory",unitId:"giUnit",densityId:"giDensity",physicalFormId:"giPhysicalForm",functionsId:"giFunctions",applicationsId:"giApplications",containerSectionId:"giContainerMeta",containerMaterialId:"giMaterial",containerTypeStyleId:"giTypeStyle",containerColorId:"giColor",ingredientSectionId:"giIngredientStats",ingredientGridId:"giPropsGrid",costStatsId:"giCostStats",metaId:"giMeta",developerLinkBase:null,storeLinkHref:null},S={...H};function F(e={}){S={...S,...e}}function d(e){return e?document.getElementById(e):null}function o(e,r){let t=d(e);t&&(t.textContent=r!=null?r:"")}function I(e,r=2){return typeof e=="number"&&!Number.isNaN(e)?e.toFixed(r):"-"}function M(e){return e===!0?"Yes":e===!1?"No":""}function y(e){return e==null||typeof e=="string"&&e.trim()===""?"\u2013":e}function w(e){return!Array.isArray(e)||e.length===0?"\u2013":e.join(", ")}function f(e,r=!0){e&&(e.style.display=r?"":"none")}function T(e){return e==null?!1:typeof e=="string"?e.trim().length>0:!0}function A(e){if(!Number.isFinite(Number(e)))return"";let r=Number(e);return`${r} day${r===1?"":"s"}`}var D={ingredient:[{label:"Aliases",getter:e=>w(e.aliases)},{label:"Certifications",getter:e=>w(e.certifications)},{label:"Recommended Usage",getter:e=>y(e.recommended_usage_rate)},{label:"Fragrance Load",getter:e=>e.recommended_fragrance_load_pct!=null?`${e.recommended_fragrance_load_pct}%`:""},{label:"Recommended Shelf Life",getter:e=>A(e.recommended_shelf_life_days)},{label:"Perishable",getter:e=>M(e.default_is_perishable)}],container:[{label:"Capacity",getter:e=>{if(e.capacity==null)return"";let r=e.capacity_unit?` ${e.capacity_unit}`:"";return`${e.capacity}${r}`}},{label:"Material",getter:e=>e.container_material||""},{label:"Type",getter:e=>e.container_type||""},{label:"Style",getter:e=>e.container_style||""},{label:"Color",getter:e=>e.container_color||""},{label:"Default Unit",getter:e=>e.default_unit||""}],packaging:[{label:"Capacity",getter:e=>{if(e.capacity==null)return"";let r=e.capacity_unit?` ${e.capacity_unit}`:"";return`${e.capacity}${r}`}},{label:"Material",getter:e=>e.container_material||""},{label:"Color",getter:e=>e.container_color||""},{label:"Default Unit",getter:e=>e.default_unit||""}],consumable:[{label:"Default Unit",getter:e=>e.default_unit||""},{label:"Perishable",getter:e=>M(e.default_is_perishable)},{label:"Recommended Usage",getter:e=>y(e.recommended_usage_rate)}]};function P(e,r){if(!e)return;let t=(r.item_type||"").toLowerCase(),u=D[t]||[],a=[];u.forEach(s=>{let h=typeof s.getter=="function"?s.getter(r):r[s.key];!T(h)||h==="\u2013"||a.push(`<div><strong>${s.label}:</strong> ${h}</div>`)}),a.length?e.innerHTML=a.join(""):e.innerHTML='<div class="text-muted">No additional attributes.</div>'}async function E(e,r={}){let t={...S,...r};if(!e){console.warn("openGlobalItemStats requires a global item id");return}let u=d(t.offcanvasId),a=d(t.loadingId),s=d(t.contentId);if(!u||!a||!s){console.error("Global item stats drawer elements are missing");return}if(typeof bootstrap=="undefined"||!bootstrap.Offcanvas){console.error("Bootstrap Offcanvas is required to open global item stats.");return}f(a,!0),a.innerHTML=`
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2 mb-0">Loading item details...</p>`,f(s,!1),bootstrap.Offcanvas.getOrCreateInstance(u).show();let g;try{let i=await fetch(`/global-items/${e}/stats`,{credentials:"same-origin",headers:{Accept:"application/json"}});if(!i.ok){let c=await i.text();throw new Error(`HTTP ${i.status}: ${c.slice(0,160)}`)}if(!(i.headers.get("content-type")||"").includes("application/json")){let c=await i.text();throw new Error(`Unexpected response format. Preview: ${c.slice(0,160)}`)}g=await i.json()}catch(i){console.error("Failed to load global item stats",i),a.innerHTML=`<div class="alert alert-danger mb-0">Failed to load item details.<br><small>${i.message}</small></div>`;return}if(!(g!=null&&g.success)){let i=(g==null?void 0:g.error)||"Unknown error";a.innerHTML=`<div class="alert alert-warning mb-0">${i}</div>`;return}let n=g.item||{},m=g.cost||{};o(t.nameId,n.name||`#${e}`),o(t.typeId,n.item_type||"");let C=n.ingredient||{};o(t.ingredientNameId,y(C.name)),o(t.ingredientInciId,y(C.inci_name||n.inci_name)),o(t.ingredientCasId,y(C.cas_number)),o(t.categoryId,n.ingredient_category_name||""),o(t.unitId,n.default_unit||""),o(t.densityId,n.density!=null?Number(n.density).toFixed(3):""),o(t.physicalFormId,y(n.physical_form)),o(t.functionsId,w(n.functions)),o(t.applicationsId,w(n.applications));let x=n.item_type==="container"||n.item_type==="packaging",k=d(t.containerSectionId);if(k){let i=[n.container_type||"",n.container_style?`(${n.container_style})`:""].join(" ").trim(),l=[{id:t.containerMaterialId,value:n.container_material},{id:t.containerTypeStyleId,value:i},{id:t.containerColorId,value:n.container_color}],c=l.some(p=>T(p.value));f(k,x&&c),x&&c&&l.forEach(p=>o(p.id,p.value||""))}let N=n.item_type==="ingredient",G=d(t.ingredientSectionId),_=d(t.ingredientGridId);if(f(G,N),N&&_){_.innerHTML="";let i=(l,c)=>{if(!T(c))return;let p=c,L=document.createElement("div");L.innerHTML=`<div><strong>${l}:</strong> ${p}</div>`,_.appendChild(L)};if(i("Saponification",n.saponification_value),i("Iodine",n.iodine_value),i("Melting Point (\xB0C)",n.melting_point_c),i("Flash Point (\xB0C)",n.flash_point_c),i("pH",n.ph_value),i("Moisture %",n.moisture_content_percent),i("Shelf Life (months)",n.shelf_life_months),i("Comedogenic",n.comedogenic_rating),!_.childElementCount){let l=document.createElement("div");l.className="text-muted",l.textContent="No ingredient-specific attributes available.",_.appendChild(l)}}let v=d(t.costStatsId);if(v)if(m.count&&m.count>0){let i=I(m.mean_ex_outliers,2),l=I(m.low,2),c=I(m.high,2),p=I(m.min,2),L=I(m.max,2);v.innerHTML=`Average: $${i} (excluding outliers)<br>Low/High: $${l} \u2013 $${c}<br>Extremes: $${p} \u2013 $${L} (n=${m.count})`}else v.textContent="No cost data yet.";P(d(t.metaId),n);let $=d(t.developerLinkId);$&&(t.developerLinkBase?($.href=`${t.developerLinkBase}${e}`,f($,!0)):f($,!1));let b=d(t.storeLinkId);b&&(t.storeLinkHref?(b.href=`${t.storeLinkHref}${e}`,b.classList.remove("disabled"),b.setAttribute("aria-disabled","false"),b.removeAttribute("tabindex"),f(b,!0)):f(b,!1)),f(a,!1),f(s,!0)}function U(e,r={}){if(!e)return;document.querySelectorAll(e).forEach(u=>{u.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation();let s=u.dataset.globalItemId||u.getAttribute("data-global-item-id");if(!s){console.warn("Global item trigger missing data-global-item-id");return}E(s,r)})})}typeof window!="undefined"&&(window.configureGlobalItemStats=F,window.openGlobalItemStats=E,window.bindGlobalItemStatTriggers=U);export{U as bindGlobalItemStatTriggers,F as configureGlobalItemStats,E as openGlobalItemStats};
