(function(P){"use strict";let e={inventory:"Inventory",global:"Global Library"},l={inventory:"bg-primary",global:"bg-info text-dark"},m={mode:"recipe",searchType:"ingredient",includeInventory:!0,includeGlobal:!0,ingredientFirst:!1,displayVariant:null,showSourceBadge:!0,globalUrlBuilder:null,resultFilter:null};function O(u,p){let c;return function(){let w=arguments;clearTimeout(c),c=setTimeout(()=>u.apply(null,w),p)}}function D(u){return(u||"").trim().toLowerCase()}function H(u){if(u)return u;let p=document.createElement("div");return p.className="list-group position-absolute w-100 d-none inventory-suggestions",p.style.zIndex="1050",p.style.maxHeight="300px",p.style.overflowY="auto",p}function q(u){return typeof u=="function"?u():u}function y(u){let p=new Set;return(u||[]).forEach(c=>{let w=c&&(c.global_item_id||c.id);w&&p.add(String(w))}),p}function S(u){if(!u)return"";let p=e[u]||u;return`<span class="badge ${l[u]||"bg-secondary"} ms-2">${p}</span>`}function C(u,p,c,w){w=w||{},u.innerHTML="";let F=!1;if(p.forEach(A=>{!A.items||!A.items.length||(F=!0,A.items.forEach(_=>{let Q=document.createElement("a");Q.href="#",Q.className="list-group-item list-group-item-action suggestion-item";let r=w.showSubtitle&&_.subtitle?`<div class="small text-muted mt-1">${_.subtitle}</div>`:"";Q.innerHTML=`<div class="d-flex justify-content-between align-items-center gap-2">
          <span class="fw-semibold text-truncate">${_.text||_.display_name||_.name||""}</span>
          ${w.showSourceBadge?S(A.source||_.source):""}
        </div>${r}`,Q.addEventListener("click",function(t){t.preventDefault(),c(_,A.source||_.source),u.classList.add("d-none")}),u.appendChild(Q)}))}),u.classList.toggle("d-none",!F),!F&&u.dataset.emptyMessage){let A=document.createElement("div");A.className="list-group-item text-muted small",A.textContent=u.dataset.emptyMessage,u.appendChild(A),u.classList.remove("d-none")}}function f(u,p,c){u.innerHTML="";let w=!1;p.forEach(F=>{if(!F.ingredients||!F.ingredients.length)return;w=!0;let A=document.createElement("div");A.className="list-group-item text-muted small fw-semibold",A.textContent=F.title,u.appendChild(A),F.ingredients.forEach(_=>{let Q=document.createElement("div");Q.className="list-group-item ingredient-result";let r=document.createElement("div");r.className="d-flex justify-content-between align-items-center ingredient-summary",r.setAttribute("role","button"),r.setAttribute("tabindex","0"),r.innerHTML=`<span class="fw-semibold">${_.name||"Ingredient"}</span>
          <span class="badge bg-light text-dark">${_.forms.length} option${_.forms.length===1?"":"s"}</span>`;let t=document.createElement("div");t.className="ingredient-form-options d-none mt-2 ps-3 border-start border-2",_.forms.forEach(I=>{let x=document.createElement("button");x.type="button",x.className="btn btn-sm btn-outline-primary w-100 text-start mb-2 ingredient-form-option suggestion-item",x.innerHTML=`<div class="fw-semibold">${I.text||I.display_name||I.name||"Form"}</div>`,x.addEventListener("click",function(){c(I,I.source||F.source),u.classList.add("d-none")}),t.appendChild(x)});function h(I){I.type==="keydown"&&I.key!=="Enter"&&I.key!==" "||(I.preventDefault(),t.classList.toggle("d-none"))}r.addEventListener("click",h),r.addEventListener("keydown",h),Q.appendChild(r),Q.appendChild(t),u.appendChild(Q),_.forms.length===1&&t.classList.remove("d-none")})}),u.classList.toggle("d-none",!w)}function B(u,p,c){u.innerHTML="";let w=!1;if((p||[]).forEach(F=>{w=!0;let A=document.createElement("a");A.href="#",A.className="list-group-item list-group-item-action suggestion-item";let _=F.inci_name?`<div class="small text-muted">${F.inci_name}</div>`:"";A.innerHTML=`<div class="fw-semibold">${F.text||F.name}</div>${_}`,A.addEventListener("click",function(Q){Q.preventDefault(),c(F,"definition"),u.classList.add("d-none")}),u.appendChild(A)}),u.classList.toggle("d-none",!w),!w&&u.dataset.emptyMessage){let F=document.createElement("div");F.className="list-group-item text-muted small",F.textContent=u.dataset.emptyMessage,u.appendChild(F),u.classList.remove("d-none")}}function i(u){let p=[];return(u||[]).forEach(c=>{if(c&&Array.isArray(c.forms)&&c.forms.length){let w=c.ingredient&&c.ingredient.name||c.ingredient_name||null,F=c.ingredient&&c.ingredient.ingredient_category_name||c.ingredient_category_name||c.ingredient_category&&c.ingredient_category.name||null,A=c.category_tags||[];c.forms.forEach(_=>{var t,h,I,x,L,M,N,k,g,b;let Q=_.physical_form||{},r=_.display_name||_.text||_.name||(w&&_.physical_form_name?`${w}, ${_.physical_form_name}`:c.display_name||c.text||c.name||"");p.push({id:_.id,text:r,item_type:_.item_type||c.item_type,default_unit:_.default_unit||_.unit||c.default_unit||c.unit||null,source:"global",global_item_id:_.id,ingredient_id:_.ingredient_id||c.ingredient&&c.ingredient.id||c.ingredient_id||null,ingredient_name:_.ingredient_name||w,physical_form_id:_.physical_form_id||Q&&Q.id||null,physical_form_name:_.physical_form_name||Q&&Q.name||null,ingredient_category_name:F,category_tags:A,density:_.density||c.density||null,capacity:_.capacity||c.capacity||null,capacity_unit:_.capacity_unit||c.capacity_unit||null,container_material:_.container_material||c.container_material||null,container_type:_.container_type||c.container_type||null,container_style:_.container_style||c.container_style||null,container_color:_.container_color||c.container_color||null,default_is_perishable:(t=_.default_is_perishable)!=null?t:c.default_is_perishable,recommended_shelf_life_days:(h=_.recommended_shelf_life_days)!=null?h:c.recommended_shelf_life_days,saponification_value:(x=(I=_.saponification_value)!=null?I:c.saponification_value)!=null?x:null,iodine_value:(M=(L=_.iodine_value)!=null?L:c.iodine_value)!=null?M:null,fatty_acid_profile:(k=(N=_.fatty_acid_profile)!=null?N:c.fatty_acid_profile)!=null?k:null,melting_point_c:(b=(g=_.melting_point_c)!=null?g:c.melting_point_c)!=null?b:null})})}else if(c){let w=c.display_name||c.text||c.name||"",F=c.ingredient&&c.ingredient.ingredient_category_name||c.ingredient_category_name||c.ingredient_category&&c.ingredient_category.name||null;p.push({id:c.id,text:w,source:"global",item_type:c.item_type,global_item_id:c.id,ingredient_name:c.ingredient&&c.ingredient.name||c.ingredient_name||c.name,ingredient_category_name:F,category_tags:c.category_tags||[],physical_form_name:c.physical_form&&c.physical_form.name||c.physical_form_name||null,default_unit:c.default_unit||c.unit||null,density:c.density||null,capacity:c.capacity||null,capacity_unit:c.capacity_unit||null,container_material:c.container_material||null,container_type:c.container_type||null,container_style:c.container_style||null,container_color:c.container_color||null,default_is_perishable:c.default_is_perishable,recommended_shelf_life_days:c.recommended_shelf_life_days,saponification_value:c.saponification_value||null,iodine_value:c.iodine_value||null,fatty_acid_profile:c.fatty_acid_profile||null,melting_point_c:c.melting_point_c||null})}}),p}function s(u){let p=new Map;return(u||[]).forEach(c=>{let w=c.ingredient_name||c.text||c.name||"",F=c.ingredient_id?`id:${c.ingredient_id}`:`name:${D(w)}`,A=p.get(F)||{ingredient_id:c.ingredient_id||null,name:w,forms:[]};A.forms.push({id:c.id,text:c.text||w,ingredient_name:w,physical_form_name:c.physical_form_name||null,default_unit:c.default_unit||c.unit||null,source:"inventory",global_item_id:c.global_item_id||null}),p.set(F,A)}),Array.from(p.values())}function o(u,p){let c=[];return(u||[]).forEach(w=>{let F=(w.forms||[]).map(_=>({id:_.id,text:_.name||_.display_name||_.text,ingredient_name:_.ingredient_name||w.name||w.ingredient&&w.ingredient.name||"Ingredient",physical_form_name:_.physical_form_name||null,default_unit:_.default_unit||_.unit||null,source:"global",global_item_id:_.id,density:_.density||null,capacity:_.capacity||null,capacity_unit:_.capacity_unit||null,container_material:_.container_material||null,container_type:_.container_type||null,container_style:_.container_style||null,container_color:_.container_color||null,saponification_value:_.saponification_value||null,iodine_value:_.iodine_value||null,fatty_acid_profile:_.fatty_acid_profile||null,melting_point_c:_.melting_point_c||null})),A=p?F.filter(_=>!_.global_item_id||!p.has(String(_.global_item_id))):F;A.length&&c.push({ingredient_id:w.ingredient_id||w.id||null,name:w.name||w.ingredient&&w.ingredient.name||F[0]&&F[0].ingredient_name||"Ingredient",forms:A})}),c}function a(u){let p=new URLSearchParams({q:u});return fetch(`/api/ingredients/definitions/search?${p.toString()}`).then(c=>c.json()).catch(()=>({results:[]}))}function n(u){let p={...m,...u},c=p.inputEl,w=p.invHiddenEl,F=p.giHiddenEl,A=H(p.listEl),_=p.mode||"recipe",Q=p.searchType||"ingredient",r=p.includeInventory,t=p.includeGlobal,h=p.ingredientFirst,I=p.displayVariant,x=typeof p.resultFilter=="function"?p.resultFilter:null,L=typeof p.onSelection=="function"?p.onSelection:null,M=p.globalUrlBuilder;if(!c||!w&&_==="recipe"||!F&&p.requireHidden!==!1)return;A&&!A.classList.contains("list-group")&&A.classList.add("list-group"),!A.parentNode&&c.parentNode&&c.parentNode.appendChild(A);function N(E,d){let v=new URLSearchParams({q:E});return d&&d!=="all"&&v.set("type",d),`/inventory/api/search?${v.toString()}`}function k(E,d,v){if(typeof M=="function")return M(E,d,v);let T=new URLSearchParams({q:E});return d&&d!=="all"&&T.set("type",d),d==="ingredient"&&v&&T.set("group","ingredient"),`${_==="public"?"/api/public/global-items/search":"/api/ingredients/global-items/search"}?${T.toString()}`}let g=O(function(){let E=(c.value||"").trim();if(!E){A.classList.add("d-none"),A.innerHTML="",w&&(w.value=""),F&&(F.value="");return}let d=(q(Q)||"ingredient").toLowerCase(),v=q(r),T=q(t),R=d==="ingredient"&&!!q(h),K=I||(R?"grouped":"compact");if(d==="ingredient_definition"||d==="definition"){a(E).then(G=>{let Y=G&&G.results||[];B(A,Y.map(z=>({id:z.id,text:z.name,name:z.name,inci_name:z.inci_name,slug:z.slug,ingredient_category_id:z.ingredient_category_id,ingredient_category_name:z.ingredient_category_name})),b)}).catch(()=>A.classList.add("d-none"));return}let j=v!==!1?fetch(N(E,d)).then(G=>G.json()).catch(()=>({results:[]})):Promise.resolve({results:[]}),U=T!==!1?fetch(k(E,d,R)).then(G=>G.json()).catch(()=>({results:[]})):Promise.resolve({results:[]});Promise.all([j,U]).then(G=>{let Y=G[0]&&G[0].results||[],z=G[1]&&G[1].results||[],X=x?Y.filter(te=>x(te,"inventory")):Y,ee=x?z.filter(te=>x(te,"global")):z,oe=y(X),le=i(ee).filter(te=>!te.global_item_id||!oe.has(String(te.global_item_id))).filter(te=>x?x(te,"global"):!0);if(R){let te=s(X),re=o(ee,oe),ue=[];te.length&&ue.push({title:"Your Inventory",source:"inventory",ingredients:te}),re.length&&ue.push({title:"Global Library",source:"global",ingredients:re}),f(A,ue,b);return}let ae=[];X.length&&ae.push({title:"Your Inventory",source:"inventory",items:X}),le.length&&ae.push({title:"Global Library",source:"global",items:le}),C(A,ae,b,{showSourceBadge:p.showSourceBadge!==!1,showSubtitle:K==="detailed"})}).catch(()=>{A.classList.add("d-none")})},200);function b(E,d){c.value=E.text||E.display_name||E.name||"",d==="inventory"?(w&&(w.value=E.id_numeric||E.id||""),F&&(F.value=E.global_item_id||"")):(F&&(F.value=E.global_item_id||E.id||""),w&&(w.value="")),typeof L=="function"&&L(E,d)}c.addEventListener("input",function(){w&&(w.value=""),F&&(F.value=""),g()}),document.addEventListener("click",function(E){!A.contains(E.target)&&!c.contains(E.target)&&A.classList.add("d-none")})}P.attachMergedInventoryGlobalTypeahead=n,P.renderInventoryTypeaheadList=C})(window);(function(P){"use strict";function e(l,m){var O=m&&m.context||"public",D=m&&m.unitOptionsHtml||"",H=m&&m.mode||(O==="public"?"public":"recipe"),q=document.createElement("div");q.className="row g-2 align-items-end mb-2",q.innerHTML=['<div class="col-md-6">','  <label class="form-label">',l==="container"?"Container":l==="consumable"?"Consumable":"Ingredient","</label>",'  <div class="position-relative">','    <input type="text" class="form-control tool-typeahead" placeholder="Search global..." autocomplete="off">','    <input type="hidden" class="tool-gi-id">','    <div class="list-group position-absolute w-100 d-none" data-role="suggestions"></div>',"  </div>","</div>",'<div class="col-md-3 ',l==="container"?"d-none":"",'">','  <label class="form-label">Quantity</label>','  <input type="number" step="0.01" min="0" class="form-control tool-qty">',"</div>",'<div class="col-md-3 ',l==="container"?"d-none":"",'">','  <label class="form-label">Unit</label>','  <select class="form-select tool-unit">',D,"  </select>","</div>",'<div class="col-md-3 ',l!=="container"?"d-none":"",'">','  <label class="form-label">Count</label>','  <input type="number" min="1" step="1" class="form-control tool-qty">',"</div>",'<div class="col-md-2 d-grid">','  <button type="button" class="btn btn-outline-danger tool-remove">Remove</button>',"</div>"].join("");var y=q.querySelector(".tool-typeahead"),S=q.querySelector(".tool-gi-id"),C=q.querySelector('[data-role="suggestions"]');if(typeof P.attachMergedInventoryGlobalTypeahead=="function"){let f=l==="container"?"container":l==="consumable"?"consumable":"ingredient",B=O!=="public";P.attachMergedInventoryGlobalTypeahead({inputEl:y,giHiddenEl:S,listEl:C,mode:H,context:O,ingredientFirst:l==="ingredient",searchType:f,includeInventory:B,includeGlobal:!0})}return q.querySelector(".tool-remove").addEventListener("click",function(){q.remove()}),q}P.buildToolLineRow=e})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{};e.config={unitOptionsHtml:P.soapToolConfig&&P.soapToolConfig.unitOptionsHtml||"",calcLimit:Number.isFinite(P.SOAP_CALC_LIMIT)?P.SOAP_CALC_LIMIT:null,calcTier:P.SOAP_CALC_TIER||"guest",useCsvPrimary:!!(P.soapToolConfig&&P.soapToolConfig.useCsvPrimary),isAuthenticated:P.__IS_AUTHENTICATED__===!0},e.state={lastCalc:null,calcRequestSeq:0,lastOilEdit:null,lastFragranceEdit:null,selectedOilProfile:null,wasCapped:!1,lastPreviewRow:null,lastRemovedOil:null,lastRemovedOilIndex:null,lastSaveToastAt:0,lastRecipePayload:null,totalOilsGrams:0,currentUnit:"g"},e.helpers={round:l,toNumber:m,clamp:O,formatTime:D,getStorage:H,buildSoapcalcSearchBuilder:q};function l(y,S=3){if(!isFinite(y))return 0;let C=Math.pow(10,S);return Math.round(y*C)/C}function m(y){let S=y;typeof S=="string"&&(S=S.replace(/,/g,"").trim());let C=parseFloat(S);return isFinite(C)?C:0}function O(y,S,C){return!isFinite(y)||y<S?S:C!=null&&y>C?C:y}function D(y){return y?`Saved ${new Date(y).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}`:"Not saved yet"}function H(){try{return P.localStorage}catch{return null}}function q(){let y=(C,f,B)=>{let i=new URLSearchParams({q:C});return f&&f!=="all"&&i.set("type",f),f==="ingredient"&&B&&i.set("group","ingredient"),`/api/public/global-items/search?${i.toString()}`},S=(C,f,B)=>{let i=new URLSearchParams({q:C});return B&&i.set("group","ingredient"),`/api/public/soapcalc-items/search?${i.toString()}`};return e.config.useCsvPrimary===!0?S:y}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},l={quality_ranges:{hardness:[29,54],cleansing:[12,22],conditioning:[44,69],bubbly:[14,46],creamy:[16,48]},quality_hints:{hardness:"Durable bar that resists mush.",cleansing:"Higher values feel more stripping.",conditioning:"Silky, moisturizing feel.",bubbly:"Fluffy lather and big bubbles.",creamy:"Stable, creamy lather."},quality_feel_hints:{hardness:{low:"Soft bar, slower unmold.",ok:"Balanced hardness for daily use.",high:"Very hard bar, can feel brittle."},cleansing:{low:"Very mild cleansing.",ok:"Balanced cleansing.",high:"Strong cleansing, can be drying."},conditioning:{low:"Less conditioning feel.",ok:"Smooth and conditioning.",high:"Very conditioning, may feel oily."},bubbly:{low:"Low bubbly lather.",ok:"Balanced bubbly lather.",high:"Very bubbly, big foam."},creamy:{low:"Light creamy lather.",ok:"Creamy and stable.",high:"Dense creamy lather."}},iodine_range:[41,70],iodine_scale_max:100,ins_range:[136,170],ins_scale_max:250,quality_base:{hardness:41.5,cleansing:17,conditioning:56.5,bubbly:30,creamy:32},quality_presets:{balanced:{hardness:40,cleansing:15,conditioning:55,bubbly:25,creamy:25,iodine:55,ins:160},bubbly:{hardness:35,cleansing:20,conditioning:50,bubbly:35,creamy:25,iodine:60,ins:150},creamy:{hardness:45,cleansing:12,conditioning:60,bubbly:20,creamy:35,iodine:50,ins:155},hard:{hardness:50,cleansing:18,conditioning:48,bubbly:22,creamy:28,iodine:45,ins:165},gentle:{hardness:35,cleansing:10,conditioning:65,bubbly:15,creamy:20,iodine:65,ins:140},castile:{hardness:20,cleansing:5,conditioning:75,bubbly:10,creamy:15,iodine:80,ins:110},shampoo:{hardness:30,cleansing:22,conditioning:50,bubbly:30,creamy:25,iodine:60,ins:145},utility:{hardness:70,cleansing:50,conditioning:20,bubbly:50,creamy:20,iodine:10,ins:250},luxury:{hardness:55,cleansing:10,conditioning:55,bubbly:15,creamy:40,iodine:50,ins:150},palmFree:{hardness:42,cleansing:16,conditioning:58,bubbly:22,creamy:28,iodine:55,ins:155}},fatty_bar_colors:{lauric:"var(--color-primary)",myristic:"var(--color-info)",palmitic:"var(--color-warning)",stearic:"var(--color-muted)",ricinoleic:"var(--color-info-hover)",oleic:"var(--color-success)",linoleic:"var(--color-primary-hover)",linolenic:"var(--color-danger)"},fatty_display_keys:["lauric","myristic","palmitic","stearic","ricinoleic","oleic","linoleic","linolenic"],oil_tip_rules:[{pattern:"coconut|palm kernel|babassu|murumuru",flags:"i",tip:"High lauric oils trace fast and feel cleansing; keep superfat >= 5%."},{pattern:"olive|avocado|rice bran|canola|sunflower|safflower|almond|apricot|macadamia|camellia|grapeseed|hazelnut",flags:"i",tip:"High-oleic liquid oils trace slowly and stay softer early on; allow a longer cure."},{pattern:"castor",flags:"i",tip:"Castor boosts lather but can feel sticky above 10-15%."},{pattern:"cocoa|shea|mango|kokum|sal|illipe|tallow|lard|palm|stearic",flags:"i",tip:"Hard fats/butters set up quickly; melt fully and keep batter warm for a smooth pour."},{pattern:"beeswax|candelilla|carnauba|wax",flags:"i",tip:"Waxes harden fast and can seize; keep usage low and add hot."},{pattern:"hemp|flax|linseed|evening primrose|borage|rosehip|black currant|chia|pomegranate",flags:"i",tip:"High-PUFA oils shorten shelf life; keep low and add antioxidant."}],unit_factors:{g:1,oz:28.3495,lb:453.592},stage_configs:[{id:1,tab_id:"soapStage1Tab",pane_id:"soapStage1Pane",required:!0},{id:2,tab_id:"soapStage2Tab",pane_id:"soapStage2Pane",required:!0},{id:3,tab_id:"soapStage3Tab",pane_id:"soapStage3Pane",required:!0},{id:4,tab_id:"soapStage4Tab",pane_id:"soapStage4Pane",required:!1},{id:5,tab_id:"soapStage5Tab",pane_id:"soapStage5Pane",required:!1}],ingredient_category_filters:{oils:["Oils (Carrier & Fixed)","Butters & Solid Fats","Waxes"],fragrances:["Essential Oils","Fragrance Oils"],lactate_additives:["Aqueous Solutions & Blends","Preservatives & Additives"],sugar_additives:["Sugars & Syrups"],salt_additives:["Salts & Minerals"],citric_additives:["Preservatives & Additives","Salts & Minerals","Aqueous Solutions & Blends"]}};function m(d){return!d||typeof d!="object"||Array.isArray(d)?{}:d}function O(d,v=[]){return Array.isArray(d)?d.map(T=>typeof T=="string"?T.trim():"").filter(Boolean):v.slice()}function D(d,v){if(!Array.isArray(d)||d.length<2)return v.slice();let T=Number(d[0]),R=Number(d[1]);return!isFinite(T)||!isFinite(R)?v.slice():[T,R]}function H(d,v){let T=Number(d);return isFinite(T)?T:v}let q=m(P.soapToolPolicy),y={...l.quality_ranges,...m(q.quality_ranges)},S={...l.quality_hints,...m(q.quality_hints)},C={...l.quality_feel_hints,...m(q.quality_feel_hints)},f={...l.quality_base,...m(q.quality_base)},B={...l.quality_presets,...m(q.quality_presets)},i={...l.fatty_bar_colors,...m(q.fatty_bar_colors)},s={...l.unit_factors,...m(q.unit_factors)},o={...l.ingredient_category_filters,...m(q.ingredient_category_filters)},a={hardness:D(y.hardness,l.quality_ranges.hardness),cleansing:D(y.cleansing,l.quality_ranges.cleansing),conditioning:D(y.conditioning,l.quality_ranges.conditioning),bubbly:D(y.bubbly,l.quality_ranges.bubbly),creamy:D(y.creamy,l.quality_ranges.creamy)},n={hardness:S.hardness||l.quality_hints.hardness,cleansing:S.cleansing||l.quality_hints.cleansing,conditioning:S.conditioning||l.quality_hints.conditioning,bubbly:S.bubbly||l.quality_hints.bubbly,creamy:S.creamy||l.quality_hints.creamy},u={hardness:{...l.quality_feel_hints.hardness,...m(C.hardness)},cleansing:{...l.quality_feel_hints.cleansing,...m(C.cleansing)},conditioning:{...l.quality_feel_hints.conditioning,...m(C.conditioning)},bubbly:{...l.quality_feel_hints.bubbly,...m(C.bubbly)},creamy:{...l.quality_feel_hints.creamy,...m(C.creamy)}},p=D(q.iodine_range,l.iodine_range),c=H(q.iodine_scale_max,l.iodine_scale_max),w=D(q.ins_range,l.ins_range),F=H(q.ins_scale_max,l.ins_scale_max),A={hardness:H(f.hardness,(a.hardness[0]+a.hardness[1])/2),cleansing:H(f.cleansing,(a.cleansing[0]+a.cleansing[1])/2),conditioning:H(f.conditioning,(a.conditioning[0]+a.conditioning[1])/2),bubbly:H(f.bubbly,(a.bubbly[0]+a.bubbly[1])/2),creamy:H(f.creamy,(a.creamy[0]+a.creamy[1])/2)},_={};Object.entries(B).forEach(([d,v])=>{!v||typeof v!="object"||(_[d]={...v})});let Q={...i},r=O(q.fatty_display_keys,l.fatty_display_keys),t=(Array.isArray(q.oil_tip_rules)?q.oil_tip_rules:l.oil_tip_rules).map(d=>{let v=m(d),T=typeof v.pattern=="string"?v.pattern:"",R=typeof v.flags=="string"?v.flags:"i",K=typeof v.tip=="string"?v.tip:"";if(!T||!K)return null;try{return{match:new RegExp(T,R),tip:K}}catch{return null}}).filter(Boolean),h={g:H(s.g,l.unit_factors.g),oz:H(s.oz,l.unit_factors.oz),lb:H(s.lb,l.unit_factors.lb)},x=(Array.isArray(q.stage_configs)?q.stage_configs:l.stage_configs).map((d,v)=>{let T=m(d),R=l.stage_configs[v]||{},K=H(T.id,H(R.id,v+1)),j=T.tabId||T.tab_id||R.tabId||R.tab_id,U=T.paneId||T.pane_id||R.paneId||R.pane_id;return!j||!U?null:{id:K,tabId:j,paneId:U,required:typeof T.required=="boolean"?T.required:!!R.required}}).filter(Boolean),L=x.length?x:l.stage_configs.map(d=>({id:d.id,tabId:d.tab_id,paneId:d.pane_id,required:!!d.required})),M=new Set(O(o.oils,l.ingredient_category_filters.oils)),N=new Set(O(o.fragrances,l.ingredient_category_filters.fragrances)),k=new Set(O(o.lactate_additives,l.ingredient_category_filters.lactate_additives)),g=new Set(O(o.sugar_additives,l.ingredient_category_filters.sugar_additives)),b=new Set(O(o.salt_additives,l.ingredient_category_filters.salt_additives)),E=new Set(O(o.citric_additives,l.ingredient_category_filters.citric_additives));e.constants={QUALITY_RANGES:a,QUALITY_HINTS:n,QUALITY_FEEL_HINTS:u,IODINE_RANGE:p,IODINE_SCALE_MAX:c,INS_RANGE:w,INS_SCALE_MAX:F,QUALITY_BASE:A,QUALITY_PRESETS:_,FATTY_BAR_COLORS:Q,FATTY_DISPLAY_KEYS:r,OIL_TIP_RULES:t,UNIT_FACTORS:h,STAGE_CONFIGS:L,OIL_CATEGORY_SET:M,FRAGRANCE_CATEGORY_SET:N,LACTATE_CATEGORY_SET:k,SUGAR_CATEGORY_SET:g,SALT_CATEGORY_SET:b,CITRIC_CATEGORY_SET:E}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{toNumber:l}=e.helpers;function m(q){let y=0,S=0;return q.forEach(C=>{C.iodine>0&&(y+=C.grams,S+=C.iodine*C.grams)}),{iodine:y>0?S/y:0,coverageWeight:y}}function O(q){let y={},S=0;q.forEach(f=>{!f.fattyProfile||typeof f.fattyProfile!="object"||(S+=f.grams,Object.entries(f.fattyProfile).forEach(([B,i])=>{let s=l(i);s>0&&(y[B]=(y[B]||0)+f.grams*(s/100))}))});let C={};return S>0&&Object.entries(y).forEach(([f,B])=>{C[f]=B/S*100}),{percent:C,coveredWeight:S}}function D(q){let y=S=>q[S]||0;return{hardness:y("lauric")+y("myristic")+y("palmitic")+y("stearic"),cleansing:y("lauric")+y("myristic"),conditioning:y("oleic")+y("linoleic")+y("linolenic")+y("ricinoleic"),bubbly:y("lauric")+y("myristic")+y("ricinoleic"),creamy:y("palmitic")+y("stearic")+y("ricinoleic")}}function H(q){if(!q||typeof q!="object")return{hardness:0,cleansing:0,conditioning:0,bubbly:0,creamy:0};let y={lauric:l(q.lauric),myristic:l(q.myristic),palmitic:l(q.palmitic),stearic:l(q.stearic),ricinoleic:l(q.ricinoleic),oleic:l(q.oleic),linoleic:l(q.linoleic),linolenic:l(q.linolenic)},S=D(y);return{hardness:(S.hardness||0)/100,cleansing:(S.cleansing||0)/100,conditioning:(S.conditioning||0)/100,bubbly:(S.bubbly||0)/100,creamy:(S.creamy||0)/100}}e.calc={computeIodine:m,computeFattyAcids:O,computeQualities:D,computeOilQualityScores:H},P.SoapCalcService=e.calc})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{round:l,toNumber:m,clamp:O}=e.helpers,{UNIT_FACTORS:D}=e.constants,H=e.state;function q(i){return O(m(i),0)*(D[H.currentUnit]||1)}function y(i){return O(i,0)/(D[H.currentUnit]||1)}function S(i){return!isFinite(i)||i<=0?"--":`${l(y(i),2)} ${H.currentUnit}`}function C(i){return isFinite(i)?`${l(i,1)}%`:"--"}function f(){document.querySelectorAll(".unit-label").forEach(i=>{i.textContent=H.currentUnit}),document.querySelectorAll(".unit-suffix").forEach(i=>{i.dataset.suffix=H.currentUnit})}function B(i,s={}){if(!i)return;if(i===H.currentUnit){f();return}let o=H.currentUnit;if(H.currentUnit=i,f(),s.skipConvert)return;let a=(D[o]||1)/(D[i]||1);document.querySelectorAll(".oil-grams").forEach(p=>{let c=m(p.value);c>0&&(p.value=l(c*a,2))}),document.querySelectorAll(".fragrance-grams").forEach(p=>{let c=m(p.value);c>0&&(p.value=l(c*a,2))});let n=document.getElementById("oilTotalTarget");if(n&&n.value){let p=m(n.value);p>0&&(n.value=l(p*a,2))}let u=document.getElementById("moldWaterWeight");if(u&&u.value){let p=m(u.value);p>0&&(u.value=l(p*a,2))}e.oils.updateOilTotals(),e.mold.updateMoldSuggested(),e.additives.updateAdditivesOutput(e.oils.getTotalOilsGrams()),e.bulkOilsModal&&typeof e.bulkOilsModal.onUnitChanged=="function"&&e.bulkOilsModal.onUnitChanged(),s.skipAutoCalc||e.runner.calculateAll({consumeQuota:!1,showAlerts:!1})}e.units={toGrams:q,fromGrams:y,formatWeight:S,formatPercent:C,updateUnitLabels:f,setUnit:B}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},l=e.state,m={info:"fa-info-circle",warning:"fa-exclamation-triangle",danger:"fa-times-circle",success:"fa-check-circle"};function O(o){o&&(o.classList.remove("soap-number-pulse"),o.offsetWidth,o.classList.add("soap-number-pulse"))}function D(o){var n;let a=document.getElementById(o);return!a||!((n=P.bootstrap)!=null&&n.Toast)?null:bootstrap.Toast.getOrCreateInstance(a)}function H(){let o=Date.now();if(o-l.lastSaveToastAt<3500)return;l.lastSaveToastAt=o;let a=D("soapAutosaveToast");a&&a.show()}function q(o){let a=document.getElementById("soapUndoToast");if(!a)return;let n=a.querySelector(".toast-body");n&&(n.textContent=o||"Oil removed.");let u=D("soapUndoToast");u&&u.show()}function y(){let o=document.getElementById("resultsReadyBadge"),a=document.getElementById("resultsUpdatedAt");o&&o.classList.remove("d-none"),a&&(a.textContent=`Updated ${new Date().toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}`)}function S(o){let a=document.getElementById("lyeConcentrationWarning"),n=document.getElementById("waterRatioWarning");if(a){let u=(o==null?void 0:o.lyeConcentration)||0,p="";u>40&&(p="High concentration"),u>0&&u<25&&(p="Low concentration"),a.textContent=p,a.classList.toggle("d-none",!p)}if(n){let u=(o==null?void 0:o.waterRatio)||0,p="";u>0&&u<1.8&&(p="Low water"),u>2.7&&(p="High water"),n.textContent=p,n.classList.toggle("d-none",!p)}}function C(){document.querySelectorAll("#soapToolPage .form-text").forEach(o=>{let a=o.closest(".col-md-2, .col-md-3, .col-md-4, .col-md-6, .col-md-8, .col-lg-6, .col-lg-4, .col-12");a&&a.classList.add("soap-field")})}function f(o){if(!o||o.type!=="number")return;let a=o.value;if(a===""){o.classList.remove("is-invalid");return}let n=parseFloat(a),u=o.getAttribute("min"),p=o.getAttribute("max"),c=u!==null&&u!==""&&n<parseFloat(u),w=p!==null&&p!==""&&n>parseFloat(p);o.classList.toggle("is-invalid",!isFinite(n)||c||w)}function B(o){var n;if(!o)return;let a=((n=o.querySelector)==null?void 0:n.call(o,".soap-stage-card"))||o;a.classList.add("soap-stage-highlight"),setTimeout(()=>a.classList.remove("soap-stage-highlight"),900)}function i(o,a,n={}){var w;let u=document.getElementById("soapAlertStack");if(!u)return;let p=m[o]||m.info,c=document.createElement("div");c.className=`alert alert-${o} d-flex align-items-start gap-2`,c.innerHTML=`
      <i class="fas ${p} mt-1"></i>
      <div class="flex-grow-1">${a}</div>
      ${n.dismissible?'<button type="button" class="btn-close" data-role="dismiss"></button>':""}
    `,n.dismissible&&((w=c.querySelector('[data-role="dismiss"]'))==null||w.addEventListener("click",()=>c.remove())),u.prepend(c),n.persist||setTimeout(()=>{c.parentNode&&c.remove()},n.timeoutMs||4500)}function s(){let o=document.getElementById("soapAlertStack");o&&o.querySelectorAll(".alert").forEach(a=>a.remove())}e.ui={pulseValue:O,getToastInstance:D,showAutosaveToast:H,showUndoToast:q,updateResultsMeta:y,updateResultsWarnings:S,applyHelperVisibility:C,validateNumericField:f,flashStage:B,showSoapAlert:i,clearSoapAlerts:s}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{};function l(){let O=document.getElementById("soapStagePane"),D=document.getElementById("soapQualityCard");if(!O||!D)return;if(!P.matchMedia("(min-width: 768px)").matches){O.classList.remove("is-height-synced"),O.style.removeProperty("--soap-stage-height");return}let q=D.offsetHeight;if(!q){O.classList.remove("is-height-synced"),O.style.removeProperty("--soap-stage-height");return}O.style.setProperty("--soap-stage-height",`${q}px`),O.classList.add("is-height-synced")}let m=()=>{P.requestAnimationFrame(l)};e.layout={syncStageHeight:l,scheduleStageHeightSync:m}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{clamp:l,toNumber:m,round:O}=e.helpers,{toGrams:D,fromGrams:H}=e.units;function q(){let i=f(),s=document.getElementById("oilTotalTarget"),o=document.getElementById("oilTargetHint");s&&i.effectiveCapacity>0&&D(s.value)<=0&&(s.value=i.targetOils>0?O(H(i.targetOils),2):""),o&&(i.effectiveCapacity>0?o.textContent="Linked to mold sizing. Edit oil % or total oils target to update the other.":o.textContent="Auto-fills when mold sizing is set.");let a=document.getElementById("moldSuggestionNote");if(a){let n="Target oils are capped to the mold size above.";i.shape==="cylinder"&&i.waterWeight>0&&(i.useCylinder?n=`Cylinder correction applied (${O(i.cylinderFactor*100,0)}% of capacity).`:n="Cylinder mold selected. Apply a correction if you want headspace or a smaller fill."),a.textContent=n}y()}function y(i=null){var _;let s=document.getElementById("moldWetBatterWarning");if(!s)return;let o=()=>{s.classList.add("d-none"),s.textContent=""},a=f(),n=e.state||{},u=n.lastCalc||null,p=(_=e.oils)!=null&&_.getTotalOilsGrams?e.oils.getTotalOilsGrams():0,c=m(u==null?void 0:u.totalOils),w=m(i);if((!isFinite(w)||w<=0)&&(w=m(u==null?void 0:u.batchYield)),i==null&&c>0&&p>0&&Math.abs(c-p)>.01){o();return}if(!isFinite(w)||w<=0||a.effectiveCapacity<=0){o();return}let F=w-a.effectiveCapacity;if(F<=.01){o();return}let A=n.currentUnit||"g";s.textContent=`Full wet batter is ${O(H(w),2)} ${A}, exceeding mold capacity ${O(H(a.effectiveCapacity),2)} ${A} by ${O(H(F),2)} ${A}. Reduce oils target/% of mold or lower water/additives.`,s.classList.remove("d-none")}function S(){let i=document.getElementById("oilTotalTarget"),s=f();return i&&(s.effectiveCapacity>0&&(i.value=s.targetOils>0?O(H(s.targetOils),2):""),q()),s}function C(){let i=document.getElementById("oilTotalTarget"),s=document.getElementById("moldOilPct");if(!i||!s){let n=f();return q(),n}let o=f();if(o.effectiveCapacity>0){let n=D(i.value),u=l(n,0,o.effectiveCapacity);n>o.effectiveCapacity+.01&&(i.value=O(H(u),2));let p=u>0?u/o.effectiveCapacity*100:0;s.value=u>0?O(p,2):""}let a=f();return q(),a}function f(){var c,w,F;let i=D(document.getElementById("moldWaterWeight").value),s=l(m(document.getElementById("moldOilPct").value),0,100),o=((c=document.getElementById("moldShape"))==null?void 0:c.value)||"loaf",a=!!((w=document.getElementById("moldCylinderCorrection"))!=null&&w.checked),n=l(m((F=document.getElementById("moldCylinderFactor"))==null?void 0:F.value),.5,1),u=i>0?i*(a?n:1):0,p=u>0?u*(s/100):0;return{waterWeight:i,oilPct:s,shape:o,useCylinder:a,cylinderFactor:n,effectiveCapacity:u,targetOils:p}}function B(){var o;let i=((o=document.getElementById("moldShape"))==null?void 0:o.value)||"loaf",s=document.getElementById("moldCylinderOptions");s&&s.classList.toggle("d-none",i!=="cylinder"),q()}e.mold={updateMoldSuggested:q,updateWetBatterWarning:y,syncTargetFromMold:S,syncMoldPctFromTarget:C,getMoldSettings:f,updateMoldShapeUI:B}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{round:l,toNumber:m,clamp:O,buildSoapcalcSearchBuilder:D}=e.helpers,{toGrams:H,fromGrams:q}=e.units,{OIL_CATEGORY_SET:y,OIL_TIP_RULES:S}=e.constants,{computeQualities:C}=e.calc,f=e.state;function B(g){let b=g.querySelector(".oil-typeahead"),E=g.querySelector(".oil-sap-koh"),d=g.querySelector(".oil-iodine"),v=g.querySelector(".oil-fatty"),T=g.querySelector(".oil-gi-id"),R=g.querySelector(".oil-default-unit"),K=g.querySelector(".oil-category"),j=g.querySelector('[data-role="suggestions"]');if(!b||!j||typeof P.attachMergedInventoryGlobalTypeahead!="function")return;let U=D();P.attachMergedInventoryGlobalTypeahead({inputEl:b,listEl:j,mode:"public",giHiddenEl:T,includeInventory:!1,includeGlobal:!0,ingredientFirst:!0,globalUrlBuilder:U,searchType:"ingredient",resultFilter:(G,Y)=>N(G,y,Y),requireHidden:!1,onSelection:function(G){E&&(E.value=(G==null?void 0:G.saponification_value)||""),d&&(d.value=(G==null?void 0:G.iodine_value)||""),v&&(v.value=G!=null&&G.fatty_acid_profile?JSON.stringify(G.fatty_acid_profile):""),R&&(R.value=(G==null?void 0:G.default_unit)||""),K&&(K.value=(G==null?void 0:G.ingredient_category_name)||""),t(G),A(),e.storage.queueStateSave(),e.storage.queueAutoCalc()}}),b.addEventListener("input",function(){this.value.trim()||(E&&(E.value=""),d&&(d.value=""),v&&(v.value=""),T&&(T.value=""),R&&(R.value=""),K&&(K.value=""),I())})}function i(){var E,d;let g=document.getElementById("oilRowTemplate"),b=(d=(E=g==null?void 0:g.content)==null?void 0:E.querySelector(".oil-row"))==null?void 0:d.cloneNode(!0);return b?(b.querySelectorAll("input").forEach(v=>{v.value=""}),b.querySelectorAll(".form-text").forEach(v=>{let T=v.closest('.soap-field-stack, [class*="col-"]');T&&T.classList.add("soap-field")}),B(b),b.querySelectorAll(".unit-suffix").forEach(v=>{v.dataset.suffix=f.currentUnit}),b):document.createElement("div")}function s(){let g=document.getElementById("oilTotalTarget"),b=H(g==null?void 0:g.value);if(b>0)return b;let E=e.mold.getMoldSettings();return E.targetOils>0?E.targetOils:0}function o(g){let b=[];return g.forEach(d=>{var R,K;let v=H((R=d.querySelector(".oil-grams"))==null?void 0:R.value),T=O(m((K=d.querySelector(".oil-percent"))==null?void 0:K.value),0);v>0&&T>0&&b.push(v/(T/100))}),b.length?b.reduce((d,v)=>d+v,0)/b.length:0}function a(g,b){if(!g||!b||b<=0)return{allowedGrams:null,allowedPct:null};let E=Array.from(document.querySelectorAll("#oilRows .oil-row")),d=E.reduce((U,G)=>{var Y;return G===g?U:U+H((Y=G.querySelector(".oil-grams"))==null?void 0:Y.value)},0),v=E.reduce((U,G)=>{var Y;return G===g?U:U+O(m((Y=G.querySelector(".oil-percent"))==null?void 0:Y.value),0)},0),T=Math.max(0,100-v),R=Math.max(0,b-d),K=b*T/100;return{allowedGrams:Math.max(0,Math.min(R,K)),allowedPct:T}}function n(g,b,E){if(!g)return;let d=g.querySelector(`[data-role="oil-${b}-hint"]`);d&&(E?(d.textContent=E,d.classList.add("is-visible")):(d.textContent="",d.classList.remove("is-visible")))}function u(g){g&&(g.classList.remove("oil-input-bounce"),g.offsetWidth,g.classList.add("oil-input-bounce"))}function p(g,b,E={}){let d=s();if(!g||!d||d<=0){n(g,b,"");return}let v=g.querySelector(".oil-grams"),T=g.querySelector(".oil-percent"),R=a(g,d);if(b==="grams"&&v){let K=H(v.value),j="";if(K>d+.01?j="Entry exceeds the max oils allowed in stage 2.":R.allowedGrams!==null&&K>R.allowedGrams+.01&&(j=`Must be under ${l(q(R.allowedGrams),2)} ${f.currentUnit} to stay within the stage 2 oil limit.`),j){let U=R.allowedGrams!==null?l(q(R.allowedGrams),2):l(q(d),2);v.value=U>0?U:"",n(g,b,j),v.classList.add("oil-input-warning"),u(v),A()}else v.classList.remove("oil-input-warning"),n(g,b,"")}if(b==="percent"&&T){let K=O(m(T.value),0),j="";if(K>100.01?j="Entry exceeds the max oils allowed in stage 2.":R.allowedPct!==null&&K>R.allowedPct+.01&&(j=`Must be under ${l(R.allowedPct,2)}% to stay within the stage 2 oil limit.`),j){let U=R.allowedPct!==null?l(R.allowedPct,2):100;T.value=U>0?U:"",n(g,b,j),T.classList.add("oil-input-warning"),u(T),A()}else T.classList.remove("oil-input-warning"),n(g,b,"")}}function c(g,b={}){let E=Array.from(document.querySelectorAll("#oilRows .oil-row")),d=g!=null?g:s(),v=!!b.force;if(!d||d<=0||!E.length){f.lastOilTarget=d;return}let T=E.reduce((K,j)=>{var U;return K+O(m((U=j.querySelector(".oil-percent"))==null?void 0:U.value),0)},0),R=E.reduce((K,j)=>{var U;return K+H((U=j.querySelector(".oil-grams"))==null?void 0:U.value)},0);if(T<=0&&R<=0){f.lastOilTarget=d;return}if(!(!v&&f.lastOilTarget&&Math.abs(f.lastOilTarget-d)<.01)){if(T>0)E.forEach(K=>{let j=K.querySelector(".oil-percent"),U=K.querySelector(".oil-grams"),G=O(m(j==null?void 0:j.value),0),Y=T>0?G/T:0;U&&(U.value=Y>0?l(q(d*Y),2):""),j&&(j.value=Y>0?l(Y*100,2):"")});else if(R>0){let K=d/R;E.forEach(j=>{let U=j.querySelector(".oil-grams"),G=j.querySelector(".oil-percent"),Y=H(U==null?void 0:U.value);if(U){let z=Y>0?Y*K:0;U.value=z>0?l(q(z),2):""}if(G){let z=H(U==null?void 0:U.value);G.value=z>0?l(z/d*100,2):""}})}f.lastOilTarget=d,A({skipEnforce:!0})}}function w(g,b){if(!f.lastOilEdit||!f.lastOilEdit.row)return!1;let E=f.lastOilEdit.row,d=g.reduce((K,j)=>{var U;return j===E?K:K+H((U=j.querySelector(".oil-grams"))==null?void 0:U.value)},0),v=Math.max(0,b-d),T=E.querySelector(".oil-grams"),R=E.querySelector(".oil-percent");return!T||!R?!1:(T.value=v>0?l(q(v),2):"",R.value=v>0?l(v/b*100,2):"",f.wasCapped=!0,!0)}function F({totalWeight:g,totalPct:b,target:E,capped:d}){let v=document.getElementById("oilLimitWarning");if(!v)return;let T=[];if(d&&T.push("Oil total hit the mold cap and was adjusted."),E>0&&g>E+.01){let R=g-E;T.push(`Oil weights exceed the target by ${l(q(R),2)} ${f.currentUnit}.`)}b>100.01&&T.push(`Oil percentages are over 100% by ${l(b-100,2)}%.`),T.length?(v.classList.remove("d-none"),v.innerHTML=`${T.join(" ")} Adjust oils or mold % to continue.`):(v.classList.add("d-none"),v.textContent="")}function A(g={}){var K;g.skipEnforce||(f.wasCapped=!1);let b=Array.from(document.querySelectorAll("#oilRows .oil-row")),E=e.mold.getMoldSettings(),d=s();if(!d&&!E.targetOils){let j=o(b);if(j>0){d=j;let U=document.getElementById("oilTotalTarget");U&&!U.value&&(U.value=l(q(j),2))}}let v=0,T=0;if(b.forEach(j=>{let U=j.querySelector(".oil-grams"),G=j.querySelector(".oil-percent"),Y=H(U==null?void 0:U.value),z=O(m(G==null?void 0:G.value),0);d>0&&(f.lastOilEdit&&f.lastOilEdit.row===j&&f.lastOilEdit.field==="percent"?(Y=z>0?d*(z/100):0,U.value=z>0?l(q(Y),2):""):Y>0?(z=Y/d*100,G.value=l(z,2)):z>0&&(Y=d*(z/100),U.value=l(q(Y),2)),T+=z),Y>0&&(v+=Y)}),d<=0&&(v>0?(T=0,b.forEach(j=>{let U=j.querySelector(".oil-grams"),G=j.querySelector(".oil-percent"),Y=H(U==null?void 0:U.value);if(Y>0){let z=Y/v*100;G.value=l(z,2),T+=z}})):T=b.reduce((j,U)=>{var G;return j+O(m((G=U.querySelector(".oil-percent"))==null?void 0:G.value),0)},0)),!g.skipEnforce&&E.targetOils>0&&v>E.targetOils+.01&&w(b,E.targetOils))return A({skipEnforce:!0});f.totalOilsGrams=v;let R=document.getElementById("oilTotalComputed");return R&&(R.textContent=v>0?`${l(q(v),2)} ${f.currentUnit}`:"--"),document.getElementById("oilPercentTotal").textContent=l(T,2),F({totalWeight:v,totalPct:T,target:d,capped:f.wasCapped}),e.additives.updateAdditivesOutput(v),(K=e.fragrances)!=null&&K.updateFragranceTotals&&e.fragrances.updateFragranceTotals(v),e.mold.updateMoldSuggested(),x(),{totalWeight:v,totalPct:T,target:d}}function _(){let g=Array.from(document.querySelectorAll("#oilRows .oil-row"));if(!g.length)return;let b=s(),E=g.reduce((d,v)=>{var T;return d+O(m((T=v.querySelector(".oil-percent"))==null?void 0:T.value),0)},0);!E&&b>0&&(E=g.reduce((d,v)=>{var R;let T=H((R=v.querySelector(".oil-grams"))==null?void 0:R.value);return d+(T>0?T/b*100:0)},0)),!(E<=0)&&(g.forEach(d=>{let v=d.querySelector(".oil-percent"),T=d.querySelector(".oil-grams"),K=O(m(v.value),0)/E*100;v.value=l(K,2),b>0&&(T.value=K>0?l(q(b*(K/100)),2):"")}),A())}function Q(){let g=[];return document.querySelectorAll("#oilRows .oil-row").forEach(b=>{var Y,z,X,ee,oe,le,ae,te,re;let E=(z=(Y=b.querySelector(".oil-typeahead"))==null?void 0:Y.value)==null?void 0:z.trim(),d=H((X=b.querySelector(".oil-grams"))==null?void 0:X.value),v=m((ee=b.querySelector(".oil-sap-koh"))==null?void 0:ee.value),T=m((oe=b.querySelector(".oil-iodine"))==null?void 0:oe.value),R=((le=b.querySelector(".oil-fatty"))==null?void 0:le.value)||"",K=((ae=b.querySelector(".oil-gi-id"))==null?void 0:ae.value)||"",j=((te=b.querySelector(".oil-default-unit"))==null?void 0:te.value)||"",U=((re=b.querySelector(".oil-category"))==null?void 0:re.value)||"",G=null;if(R)try{G=JSON.parse(R)}catch{G=null}d<=0||g.push({name:E||null,grams:d,sapKoh:v,iodine:T,fattyProfile:G,global_item_id:K?parseInt(K):null,default_unit:j||null,ingredient_category_name:U||null})}),g}function r({name:g,sapKoh:b,iodine:E,fattyProfile:d}={}){let v=document.getElementById("oilProfileFloat"),T=(z,X)=>{let ee=document.getElementById(z);ee&&(ee.textContent=X)},R=g||"Pick an oil to preview";T("selectedOilName",R),T("selectedOilModalName",R),v&&v.classList.toggle("d-none",!g);let K=b>0?l(b,1):"--",j=E>0?l(E,1):"--";T("selectedOilSap",K),T("selectedOilModalSap",K),T("selectedOilIodine",j),T("selectedOilModalIodine",j);let U=d?C(d):{},G=(z,X)=>{let ee=isFinite(X)&&X>0?l(X,1):"--";T(z,ee)};G("selectedOilHardness",U.hardness),G("selectedOilModalHardness",U.hardness),G("selectedOilCleansing",U.cleansing),G("selectedOilModalCleansing",U.cleansing),G("selectedOilConditioning",U.conditioning),G("selectedOilModalConditioning",U.conditioning),G("selectedOilBubbly",U.bubbly),G("selectedOilModalBubbly",U.bubbly),G("selectedOilCreamy",U.creamy),G("selectedOilModalCreamy",U.creamy),["lauric","myristic","palmitic","stearic","ricinoleic","oleic","linoleic","linolenic"].forEach(z=>{let X=`selectedOil${z.charAt(0).toUpperCase()}${z.slice(1)}`,ee=`selectedOilModal${z.charAt(0).toUpperCase()}${z.slice(1)}`,oe=d?m(d[z]):0,le=oe>0?l(oe,1):"--";T(X,le),T(ee,le)})}function t(g){if(!g){I();return}f.selectedOilProfile=g;let b=g.fatty_acid_profile||null;if(typeof b=="string")try{b=JSON.parse(b)}catch{b=null}r({name:g.text||g.display_name||g.name,sapKoh:m(g.saponification_value),iodine:m(g.iodine_value),fattyProfile:b})}function h(g){var R,K,j,U,G;if(!g)return;let b=(K=(R=g.querySelector(".oil-typeahead"))==null?void 0:R.value)==null?void 0:K.trim(),E=m((j=g.querySelector(".oil-sap-koh"))==null?void 0:j.value),d=m((U=g.querySelector(".oil-iodine"))==null?void 0:U.value),v=((G=g.querySelector(".oil-fatty"))==null?void 0:G.value)||"",T=null;if(v)try{T=JSON.parse(v)}catch{T=null}r({name:b,sapKoh:E,iodine:d,fattyProfile:T})}function I(){f.selectedOilProfile=null,f.lastPreviewRow=null,r()}function x(){let g=document.getElementById("oilBlendTips");if(!g)return;let b=Q().filter(v=>v.grams>0||v.percent>0);if(!b.length){g.classList.add("d-none"),g.textContent="";return}let E=new Set;b.forEach(v=>{let T=(v.name||"").toLowerCase();if(T&&S.forEach(R=>{R.match.test(T)&&E.add(R.tip)}),v.fattyProfile&&typeof v.fattyProfile=="object"){let R=m(v.fattyProfile.lauric),K=m(v.fattyProfile.myristic),j=m(v.fattyProfile.palmitic),U=m(v.fattyProfile.stearic),G=m(v.fattyProfile.ricinoleic),Y=m(v.fattyProfile.oleic),z=m(v.fattyProfile.linoleic),X=m(v.fattyProfile.linolenic);R+K>=30&&E.add(`${v.name||"This oil"} is high in lauric/myristic; expect faster trace and stronger cleansing.`),j+U>=40&&E.add(`${v.name||"This oil"} is high in palmitic/stearic; expect a harder bar and quicker set-up.`),Y>=60&&E.add(`${v.name||"This oil"} is high oleic; trace may be slow and bars may start softer.`),z+X>=20&&E.add(`${v.name||"This oil"} is high in PUFAs; keep the % lower to reduce DOS risk.`),G>=60&&E.add(`${v.name||"This oil"} boosts lather but can feel tacky; keep under 10-15%.`)}});let d=Array.from(E).slice(0,6);if(!d.length){g.classList.add("d-none"),g.textContent="";return}g.classList.remove("d-none"),g.innerHTML=`<strong>Blend behavior tips:</strong><ul class="mb-0">${d.map(v=>`<li>${v}</li>`).join("")}</ul>`}function L(){return f.totalOilsGrams||0}function M(g){var b,E,d,v,T,R,K,j,U;return g?{name:((b=g.querySelector(".oil-typeahead"))==null?void 0:b.value)||"",grams:((E=g.querySelector(".oil-grams"))==null?void 0:E.value)||"",percent:((d=g.querySelector(".oil-percent"))==null?void 0:d.value)||"",sap:((v=g.querySelector(".oil-sap-koh"))==null?void 0:v.value)||"",iodine:((T=g.querySelector(".oil-iodine"))==null?void 0:T.value)||"",fattyRaw:((R=g.querySelector(".oil-fatty"))==null?void 0:R.value)||"",gi:((K=g.querySelector(".oil-gi-id"))==null?void 0:K.value)||"",defaultUnit:((j=g.querySelector(".oil-default-unit"))==null?void 0:j.value)||"",categoryName:((U=g.querySelector(".oil-category"))==null?void 0:U.value)||""}:null}function N(g,b,E){let d=k(g);return d?b.has(d):E==="inventory"}function k(g){return!g||typeof g!="object"?null:g.ingredient&&g.ingredient.ingredient_category_name||g.ingredient_category_name||g.ingredient_category&&g.ingredient_category.name||null}e.oils={attachOilTypeahead:B,buildOilRow:i,getOilTargetGrams:s,updateOilTotals:A,normalizeOils:_,collectOilData:Q,setSelectedOilProfileFromRow:h,clearSelectedOilProfile:I,updateOilTips:x,getTotalOilsGrams:L,serializeOilRow:M,validateOilEntry:p,scaleOilsToTarget:c}})(window);(function(P){"use strict";var r;let e=P.SoapTool=P.SoapTool||{},l=e.bulkOils=e.bulkOils||{},{toNumber:m,clamp:O}=e.helpers,D=e.state,H=Array.isArray((r=e.constants)==null?void 0:r.FATTY_DISPLAY_KEYS)?e.constants.FATTY_DISPLAY_KEYS.slice():["lauric","myristic","palmitic","stearic","ricinoleic","oleic","linoleic","linolenic"],q=new Set(["selected_pct","selected_weight_g"]),y=25,S=140,C=260,f={mode:"all",viewSelected:!1,query:"",sortKey:"name",sortDir:"asc",selection:{},recordByKey:{},visibleRecords:[],offset:0,totalCount:0,hasMore:!0,loading:!1,requestToken:0};function B(){var t,h;(h=(t=e.storage)==null?void 0:t.queueStateSave)==null||h.call(t)}function i(t,h){var I,x;(x=(I=e.ui)==null?void 0:I.showSoapAlert)==null||x.call(I,t,h,{dismissible:!0,timeoutMs:6e3})}function s(){return{modalEl:document.getElementById("bulkOilModal"),openBtn:document.getElementById("openBulkOilModal"),searchInput:document.getElementById("bulkOilSearchInput"),viewSelectedToggle:document.getElementById("bulkOilViewSelectedToggle"),statusEl:document.getElementById("bulkOilCatalogStatus"),summaryEl:document.getElementById("bulkOilSelectedSummary"),stageCountEl:document.getElementById("bulkOilSelectionCount"),bodyEl:document.getElementById("bulkOilCatalogBody"),scrollEl:document.getElementById("bulkOilCatalogScroll"),importBtn:document.getElementById("bulkOilImportBtn"),clearBtn:document.getElementById("bulkOilClearSelectionBtn"),unitLabelEl:document.getElementById("bulkOilWeightUnitLabel")}}function o(t){return t?t==="name"||q.has(t)?!0:H.includes(t):!1}function a(){(!D.bulkOilModal||typeof D.bulkOilModal!="object")&&(D.bulkOilModal=JSON.parse(JSON.stringify(f)));let t=D.bulkOilModal;return t.mode="all",t.viewSelected=!!t.viewSelected,t.query=typeof t.query=="string"?t.query:"",t.sortKey=o(t.sortKey)?t.sortKey:"name",t.sortDir=t.sortDir==="desc"?"desc":"asc",t.selection=t.selection&&typeof t.selection=="object"?t.selection:{},t.recordByKey=t.recordByKey&&typeof t.recordByKey=="object"?t.recordByKey:{},t.visibleRecords=Array.isArray(t.visibleRecords)?t.visibleRecords:[],t.offset=Math.max(0,parseInt(t.offset,10)||0),t.totalCount=Math.max(0,parseInt(t.totalCount,10)||0),t.hasMore=t.hasMore!==!1,t.loading=!!t.loading,t.requestToken=Math.max(0,parseInt(t.requestToken,10)||0),t}function n(t){let h={},I=t&&typeof t=="object"?t:{};return H.forEach(x=>{let L=m(I[x]);L>0&&(h[x]=L)}),h}function u(t){let h=n(t==null?void 0:t.fatty_profile),I=String((t==null?void 0:t.name)||"").trim(),x=String((t==null?void 0:t.source)||"soapcalc").trim().toLowerCase()||"soapcalc",L=Number.isInteger(t==null?void 0:t.global_item_id)?t.global_item_id:m(t==null?void 0:t.global_item_id)>0?parseInt(t.global_item_id,10):null;return{key:String((t==null?void 0:t.key)||(L?`global:${L}`:`${x}:${I.toLowerCase()}`)),name:I,sap_koh:m(t==null?void 0:t.sap_koh),iodine:m(t==null?void 0:t.iodine),fatty_profile:h,default_unit:String((t==null?void 0:t.default_unit)||"gram"),ingredient_category_name:String((t==null?void 0:t.ingredient_category_name)||"Oils (Carrier & Fixed)"),global_item_id:L,source:x,is_basic:!!(t!=null&&t.is_basic)}}function p(){let t=s(),h=a(),I=Object.keys(h.selection||{}).length,x=`Selected: ${I}`;t.summaryEl&&(t.summaryEl.textContent=x),t.stageCountEl&&(t.stageCountEl.textContent=String(I))}function c(t){var I;return((I=a().selection)==null?void 0:I[t])||null}function w(t,h={}){var M,N;let I=a();if(!t||!t.key)return null;let x=I.selection[t.key]||{},L={key:t.key,name:t.name,sap_koh:t.sap_koh,iodine:t.iodine,fatty_profile:t.fatty_profile||{},default_unit:t.default_unit||"gram",ingredient_category_name:t.ingredient_category_name||"",global_item_id:t.global_item_id||null,source:t.source||"soapcalc",is_basic:!!t.is_basic,selected_pct:O(m((M=h.selected_pct)!=null?M:x.selected_pct),0,100),selected_weight_g:O(m((N=h.selected_weight_g)!=null?N:x.selected_weight_g),0)};return I.selection[t.key]=L,L}function F(t){var I;let h=a();(I=h.selection)!=null&&I[t]&&delete h.selection[t]}function A(t){var I;return((I=a().recordByKey)==null?void 0:I[t])||null}function _(){let t=a();return{mode:"all",view_selected:!!t.viewSelected,query:t.query,sort_key:t.sortKey,sort_dir:t.sortDir,selections:Object.values(t.selection||{}).map(h=>({key:h.key,name:h.name,sap_koh:h.sap_koh,iodine:h.iodine,fatty_profile:h.fatty_profile||{},default_unit:h.default_unit,ingredient_category_name:h.ingredient_category_name,global_item_id:h.global_item_id,source:h.source,is_basic:!!h.is_basic,selected_pct:O(m(h.selected_pct),0,100),selected_weight_g:O(m(h.selected_weight_g),0)}))}}function Q(t){let h=a();h.mode="all",h.viewSelected=!!(t!=null&&t.view_selected),h.query=typeof(t==null?void 0:t.query)=="string"?t.query:"",h.sortKey=o(t==null?void 0:t.sort_key)?t.sort_key:"name",h.sortDir=(t==null?void 0:t.sort_dir)==="desc"?"desc":"asc";let I={};(Array.isArray(t==null?void 0:t.selections)?t.selections:[]).forEach(L=>{let M=String((L==null?void 0:L.key)||"").trim(),N=String((L==null?void 0:L.name)||"").trim();!M||!N||(I[M]={key:M,name:N,sap_koh:m(L==null?void 0:L.sap_koh),iodine:m(L==null?void 0:L.iodine),fatty_profile:n(L==null?void 0:L.fatty_profile),default_unit:String((L==null?void 0:L.default_unit)||"gram"),ingredient_category_name:String((L==null?void 0:L.ingredient_category_name)||""),global_item_id:m(L==null?void 0:L.global_item_id)>0?parseInt(L.global_item_id,10):null,source:String((L==null?void 0:L.source)||"soapcalc"),is_basic:!!(L!=null&&L.is_basic),selected_pct:O(m(L==null?void 0:L.selected_pct),0,100),selected_weight_g:O(m(L==null?void 0:L.selected_weight_g),0)})}),h.selection=I,h.visibleRecords=[],h.offset=0,h.totalCount=0,h.hasMore=!0,h.loading=!1,p()}l.shared={FATTY_KEYS:H,LOCAL_SORT_KEYS:q,PAGE_SIZE:y,SCROLL_FETCH_THRESHOLD:S,SEARCH_DEBOUNCE_MS:C,queueStateSave:B,showAlert:i,getRefs:s,ensureModalState:a,normalizeFattyProfile:n,normalizeCatalogRecord:u,updateSelectionCounters:p,selectionForRecordKey:c,setSelection:w,removeSelection:F,getRecordByKey:A,serializeSelection:_,restoreState:Q}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},l=e.bulkOils=e.bulkOils||{},m=l.shared;if(!m)return;let{round:O,toNumber:D}=e.helpers,{fromGrams:H}=e.units,{FATTY_KEYS:q,LOCAL_SORT_KEYS:y,getRefs:S,ensureModalState:C,selectionForRecordKey:f,updateSelectionCounters:B}=m;function i(r){let t=S();t.statusEl&&(t.statusEl.textContent=r)}function s(){let r=C();if(r.loading&&!r.visibleRecords.length){i("Loading oils...");return}if(!r.visibleRecords.length){let L=r.query?"No oils match that search.":"No oils available.";i(L);return}let t=r.visibleRecords.length,h=r.totalCount,I=r.hasMore?" \u2022 scroll for more":"",x=r.query?` \u2022 search: "${r.query}"`:"";i(`Showing ${t} of ${h} oils${x}${I}`)}function o(r,t,h){if(typeof r=="string"||typeof t=="string"){let L=String(r||"").toLowerCase(),M=String(t||"").toLowerCase();return L<M?h==="asc"?-1:1:L>M?h==="asc"?1:-1:0}let I=D(r),x=D(t);return I<x?h==="asc"?-1:1:I>x?h==="asc"?1:-1:0}function a(r,t){var h,I;return t==="selected_pct"?((h=f(r.key))==null?void 0:h.selected_pct)||0:t==="selected_weight_g"?((I=f(r.key))==null?void 0:I.selected_weight_g)||0:""}function n(){let r=C();y.has(r.sortKey)&&r.visibleRecords.sort((t,h)=>{let I=o(a(t,r.sortKey),a(h,r.sortKey),r.sortDir);return I!==0?I:o(t.name||"",h.name||"","asc")})}function u(){let r=C();if(!r.viewSelected)return;let t=[],h=[];r.visibleRecords.forEach(I=>{f(I.key)?t.push(I):h.push(I)}),r.visibleRecords=t.concat(h)}function p(){n(),u()}function c(r){let t=String(r||"").trim().toLowerCase();return t==="name"||q.includes(t)?t:"name"}function w(){let r=C();document.querySelectorAll(".bulk-oil-sort").forEach(t=>{t.dataset.label||(t.dataset.label=String(t.textContent||"").replace(/[]\s*$/,"").trim());let h=t.dataset.label||"",I=t.dataset.sortKey||"";r.sortKey===I?t.textContent=`${h} ${r.sortDir==="asc"?"\u25B2":"\u25BC"}`:t.textContent=h})}function F(r,t){let h=f(t.key),I=r.querySelector(".bulk-oil-check"),x=r.querySelector(".bulk-oil-pct"),L=r.querySelector(".bulk-oil-weight");I&&(I.checked=!!h),x&&(x.value=h&&h.selected_pct>0?O(h.selected_pct,2):""),L&&(L.value=h&&h.selected_weight_g>0?O(H(h.selected_weight_g),2):"")}function A(r){let t=document.createElement("td");t.className="bulk-oil-acid";let h=D(r);return t.textContent=h>0?O(h,1).toString():"--",t}function _(r){let t=document.createElement("tr");t.dataset.recordKey=r.key;let h=document.createElement("td");h.className="text-center";let I=document.createElement("input");I.type="checkbox",I.className="form-check-input bulk-oil-check",h.appendChild(I),t.appendChild(h);let x=document.createElement("td");x.className="bulk-oil-name";let L=document.createElement("div");L.className="fw-semibold small",L.textContent=r.name;let M=document.createElement("div");M.className="text-muted small";let N=r.ingredient_category_name?` \xB7 ${r.ingredient_category_name}`:"";M.textContent=`${r.source}${N}`,x.appendChild(L),x.appendChild(M),t.appendChild(x),q.forEach(d=>{var v;t.appendChild(A((v=r.fatty_profile)==null?void 0:v[d]))});let k=document.createElement("td"),g=document.createElement("input");g.type="number",g.min="0",g.max="100",g.step="0.1",g.className="form-control form-control-sm bulk-oil-input bulk-oil-pct",k.appendChild(g),t.appendChild(k);let b=document.createElement("td"),E=document.createElement("input");return E.type="number",E.min="0",E.step="0.1",E.className="form-control form-control-sm bulk-oil-input bulk-oil-weight",b.appendChild(E),t.appendChild(b),F(t,r),t}function Q(){let r=S(),t=C();if(!r.bodyEl)return;r.bodyEl.innerHTML="";let h=document.createDocumentFragment();t.visibleRecords.forEach(I=>{h.appendChild(_(I))}),r.bodyEl.appendChild(h),w(),B(),s()}l.render={updateStatusText:i,refreshCatalogStatus:s,applyLocalSelectionSortIfNeeded:n,applyViewSelectedOrderingIfNeeded:u,applyClientOrdering:p,normalizeServerSortKey:c,sortButtonsLabel:w,renderVisibleRecords:Q}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},l=e.bulkOils=e.bulkOils||{},m=l.shared,O=l.render;if(!m||!O)return;let{PAGE_SIZE:D,getRefs:H,ensureModalState:q,normalizeCatalogRecord:y}=m,{refreshCatalogStatus:S,normalizeServerSortKey:C,applyClientOrdering:f,renderVisibleRecords:B,updateStatusText:i}=O;function s(){let a=q(),n=H();a.visibleRecords=[],a.offset=0,a.totalCount=0,a.hasMore=!0,n.bodyEl&&(n.bodyEl.innerHTML=""),n.scrollEl&&(n.scrollEl.scrollTop=0)}async function o({reset:a=!1}={}){let n=q();if(!H().modalEl||n.loading&&!a||!n.hasMore&&!a)return;a&&s();let p=n.requestToken+1;n.requestToken=p,n.loading=!0,S();let c=new URLSearchParams;c.set("mode",n.mode),c.set("offset",String(n.offset)),c.set("limit",String(D)),c.set("q",n.query||""),c.set("sort_key",C(n.sortKey)),c.set("sort_dir",n.sortDir==="desc"?"desc":"asc");try{let w=await fetch(`/tools/api/soap/oils-catalog?${c.toString()}`);if(!w.ok)throw new Error("Unable to load oils catalog");let F=await w.json();if(!F||F.success!==!0||!F.result||!Array.isArray(F.result.records))throw new Error("Invalid oils catalog response");if(p!==n.requestToken)return;let A=F.result.records.map(y),_=Math.max(0,parseInt(F.result.next_offset,10)||n.offset+A.length),Q=Math.max(A.length,parseInt(F.result.count,10)||0),r=!!F.result.has_more;A.forEach(t=>{n.recordByKey[t.key]=t}),n.visibleRecords=a?A.slice():n.visibleRecords.concat(A),n.offset=_,n.totalCount=Q,n.hasMore=r,f(),B()}catch(w){throw p===n.requestToken&&i("Unable to load oils catalog."),w}finally{p===n.requestToken&&(n.loading=!1,S())}}l.api={fetchCatalogPage:o}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},l=e.bulkOils=e.bulkOils||{},m=l.shared,O=l.render,D=l.api;if(!m||!O||!D)return;let{round:H,toNumber:q,clamp:y}=e.helpers,{toGrams:S,fromGrams:C}=e.units,f=e.state,{LOCAL_SORT_KEYS:B,SCROLL_FETCH_THRESHOLD:i,SEARCH_DEBOUNCE_MS:s,queueStateSave:o,showAlert:a,getRefs:n,ensureModalState:u,updateSelectionCounters:p,setSelection:c,removeSelection:w,getRecordByKey:F,serializeSelection:A,restoreState:_}=m,{applyClientOrdering:Q,sortButtonsLabel:r,renderVisibleRecords:t}=O,{fetchCatalogPage:h}=D,I=null,x=null;function L(){var W;let $=n();$.modalEl&&(!I&&((W=P.bootstrap)!=null&&W.Modal)&&(I=P.bootstrap.Modal.getOrCreateInstance($.modalEl)),I&&I.hide())}function M(){return document.getElementById("oilRows")}function N(){return Array.from(document.querySelectorAll("#oilRows .oil-row"))}function k($){return String($||"").trim().toLowerCase()}function g($){var W;return k((W=$==null?void 0:$.querySelector(".oil-typeahead"))==null?void 0:W.value)}function b($){var V;let W=String(((V=$==null?void 0:$.querySelector(".oil-gi-id"))==null?void 0:V.value)||"").trim();return W||""}function E($,W){let V=String($||"").trim();if(!V)return null;let J=N(),Z=J.find(ie=>String(ie.dataset.bulkOilKey||"")===V);if(Z)return Z;let ne=String((W==null?void 0:W.global_item_id)||"").trim();if(ne&&(Z=J.find(ie=>b(ie)===ne),Z))return Z;let se=k(W==null?void 0:W.name);return se&&(Z=J.find(ie=>g(ie)===se),Z)?Z:null}function d($,W){if(!$||!W)return;$.dataset.bulkOilKey=W.key||"";let V=$.querySelector(".oil-typeahead"),J=$.querySelector(".oil-sap-koh"),Z=$.querySelector(".oil-iodine"),ne=$.querySelector(".oil-fatty"),se=$.querySelector(".oil-gi-id"),ie=$.querySelector(".oil-default-unit"),ce=$.querySelector(".oil-category"),ge=$.querySelector(".oil-grams"),me=$.querySelector(".oil-percent");V&&(V.value=W.name||""),J&&(J.value=W.sap_koh>0?H(W.sap_koh,3):""),Z&&(Z.value=W.iodine>0?H(W.iodine,3):""),ne&&(ne.value=W.fatty_profile&&Object.keys(W.fatty_profile).length?JSON.stringify(W.fatty_profile):""),se&&(se.value=W.global_item_id||""),ie&&(ie.value=W.default_unit||""),ce&&(ce.value=W.ingredient_category_name||""),me&&(me.value=W.selected_pct>0?H(W.selected_pct,2):""),ge&&(ge.value=W.selected_weight_g>0?H(C(W.selected_weight_g),2):"")}function v($){if(!$||!$.key)return null;let W=E($.key,$),V=M();return!W&&V&&(W=e.oils.buildOilRow(),W&&V.appendChild(W)),d(W,$),W}function T($,W){let V=E($,W);V&&(f.lastOilEdit&&f.lastOilEdit.row===V&&(f.lastOilEdit=null,e.oils.clearSelectedOilProfile()),V.remove())}function R(){N().forEach(W=>{f.lastOilEdit&&f.lastOilEdit.row===W&&(f.lastOilEdit=null),W.remove()}),e.oils.clearSelectedOilProfile()}function K(){e.oils.updateOilTotals(),e.stages.updateStageStatuses(),e.storage.queueStateSave(),e.storage.queueAutoCalc()}function j($,W,V){let J=String(V||"").trim();if(J)return J;let Z=String(W||"").trim();if(Z)return`global:${Z}`;let ne=k($);return ne?`soapcalc:${ne}`:""}function U(){let $={};return N().forEach(W=>{var he,ve,Se,_e,be,Ee,Ie,Ce,Te;let V=String(((he=W.querySelector(".oil-typeahead"))==null?void 0:he.value)||"").trim(),J=q((ve=W.querySelector(".oil-sap-koh"))==null?void 0:ve.value),Z=q((Se=W.querySelector(".oil-iodine"))==null?void 0:Se.value),ne=String(((_e=W.querySelector(".oil-gi-id"))==null?void 0:_e.value)||"").trim(),se=String(((be=W.querySelector(".oil-default-unit"))==null?void 0:be.value)||"gram"),ie=String(((Ee=W.querySelector(".oil-category"))==null?void 0:Ee.value)||""),ce=y(q((Ie=W.querySelector(".oil-percent"))==null?void 0:Ie.value),0,100),ge=y(S((Ce=W.querySelector(".oil-grams"))==null?void 0:Ce.value),0),me=String(((Te=W.querySelector(".oil-fatty"))==null?void 0:Te.value)||""),pe={};if(me)try{let qe=JSON.parse(me);pe=m.normalizeFattyProfile(qe)}catch{pe={}}let ye=j(V,ne,W.dataset.bulkOilKey);!ye||!(V||ce>0||ge>0||J>0||Z>0||Object.keys(pe).length>0)||(W.dataset.bulkOilKey=ye,$[ye]={key:ye,name:V||"Unnamed oil",sap_koh:J,iodine:Z,fatty_profile:pe,default_unit:se||"gram",ingredient_category_name:ie,global_item_id:ne?parseInt(ne,10):null,source:ne?"global":"soapcalc",is_basic:!ne,selected_pct:ce,selected_weight_g:ge})}),$}function G(){let $=u();$.selection=U(),p()}function Y(){let $=u(),W=Object.values($.selection||{}),V=new Set(W.map(J=>J.key));N().forEach(J=>{let Z=String(J.dataset.bulkOilKey||"").trim();(!Z||!V.has(Z))&&J.remove()}),W.slice().sort((J,Z)=>String(J.name||"").localeCompare(String(Z.name||""))).forEach(J=>{v(J)}),K()}async function z(){var V;let $=n(),W=u();if($.modalEl){G(),!I&&((V=P.bootstrap)!=null&&V.Modal)&&(I=P.bootstrap.Modal.getOrCreateInstance($.modalEl)),$.searchInput&&($.searchInput.value=W.query||""),$.viewSelectedToggle&&($.viewSelectedToggle.checked=!!W.viewSelected),$.unitLabelEl&&($.unitLabelEl.textContent=f.currentUnit||"g"),I&&I.show(),r(),p();try{await h({reset:!0})}catch{a("danger","Unable to load bulk oils catalog right now.")}}}function X($){let W=$.target;if(!(W instanceof HTMLElement))return;let V=W.closest("tr[data-record-key]");if(!V)return;let J=V.dataset.recordKey||"",Z=F(J);if(!Z)return;let ne=V.querySelector(".bulk-oil-check"),se=V.querySelector(".bulk-oil-pct"),ie=V.querySelector(".bulk-oil-weight"),ce=y(q(se==null?void 0:se.value),0,100),ge=y(S(ie==null?void 0:ie.value),0),me=ce>0||ge>0;if(!!(ne!=null&&ne.checked)||me){ne&&(ne.checked=!0);let he=c(Z,{selected_pct:ce,selected_weight_g:ge});v(he)}else w(J),T(J,Z);let ye=u();B.has(ye.sortKey)||ye.viewSelected?(Q(),t()):p(),K(),o()}function ee($){let W=u();W.viewSelected=!!$,Q(),t(),o()}async function oe($){let W=$.target instanceof HTMLElement?$.target.closest(".bulk-oil-sort"):null;if(!W)return;let V=W.getAttribute("data-sort-key")||"name",J=u();if(J.sortKey===V?J.sortDir=J.sortDir==="asc"?"desc":"asc":(J.sortKey=V,J.sortDir=V==="name"?"asc":"desc"),o(),B.has(J.sortKey)){Q(),t();return}try{await h({reset:!0})}catch{a("danger","Unable to load oils in that sort order.")}}function le(){let $=u();$.selection={},R(),(B.has($.sortKey)||$.viewSelected)&&Q(),t(),K(),o()}async function ae(){let $=n(),W=u();if(!(!$.scrollEl||W.loading||!W.hasMore||!($.scrollEl.scrollTop+$.scrollEl.clientHeight>=$.scrollEl.scrollHeight-i)))try{await h({reset:!1})}catch{a("danger","Unable to load more oils right now.")}}function te(){x&&P.clearTimeout(x),x=P.setTimeout(async()=>{try{await h({reset:!0})}catch{a("danger","Unable to search oils right now.")}},s)}function re(){Y(),o(),L()}function ue($,W){if(!($ instanceof HTMLInputElement))return!1;let J=n().bodyEl;if(!(J instanceof HTMLElement))return!1;let Z=$.classList.contains("bulk-oil-pct")?"bulk-oil-pct":$.classList.contains("bulk-oil-weight")?"bulk-oil-weight":"";if(!Z)return!1;let ne=Array.from(J.querySelectorAll(`input.${Z}`)),se=ne.indexOf($);if(se<0)return!1;let ie=se+W;if(ie<0||ie>=ne.length)return!1;let ce=ne[ie];return ce instanceof HTMLInputElement?(ce.focus(),typeof ce.select=="function"&&ce.select(),!0):!1}function fe(){var W;let $=n();$.unitLabelEl&&($.unitLabelEl.textContent=f.currentUnit||"g"),(W=$.modalEl)!=null&&W.classList.contains("show")&&t()}function de(){let $=n();$.modalEl&&($.openBtn&&$.openBtn.addEventListener("click",()=>{z()}),$.searchInput&&$.searchInput.addEventListener("input",()=>{let W=u();W.query=$.searchInput.value||"",o(),te()}),$.viewSelectedToggle&&$.viewSelectedToggle.addEventListener("change",()=>{ee(!!$.viewSelectedToggle.checked)}),$.scrollEl&&$.scrollEl.addEventListener("scroll",ae),$.bodyEl&&($.bodyEl.addEventListener("change",X),$.bodyEl.addEventListener("keydown",W=>{let V=W.target;if(!(!(V instanceof HTMLInputElement)||!(V.classList.contains("bulk-oil-pct")||V.classList.contains("bulk-oil-weight")))){if(W.key==="Enter"){W.preventDefault(),V.blur();return}W.key==="Tab"&&ue(V,W.shiftKey?-1:1)&&W.preventDefault()}})),$.modalEl.querySelectorAll(".bulk-oil-sort").forEach(W=>{W.addEventListener("click",oe)}),$.importBtn&&$.importBtn.addEventListener("click",()=>{re()}),$.clearBtn&&$.clearBtn.addEventListener("click",()=>{le()}),$.modalEl.addEventListener("shown.bs.modal",()=>{let W=n();W.searchInput&&W.searchInput.focus()}))}de(),p(),r(),e.bulkOilsModal={openModal:z,serializeSelection:A,restoreState:_,onUnitChanged:fe}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{toNumber:l,round:m,clamp:O,buildSoapcalcSearchBuilder:D}=e.helpers,{formatWeight:H,toGrams:q,fromGrams:y}=e.units,{FRAGRANCE_CATEGORY_SET:S}=e.constants,C=e.state;function f(r,t,h,I,x){var E;let L=document.getElementById(r),M=document.getElementById(t),N=I?document.getElementById(I):null,k=x?document.getElementById(x):null,g=(E=L==null?void 0:L.parentElement)==null?void 0:E.querySelector('[data-role="suggestions"]');if(!L||!g||typeof P.attachMergedInventoryGlobalTypeahead!="function")return;let b=D();P.attachMergedInventoryGlobalTypeahead({inputEl:L,listEl:g,mode:"public",giHiddenEl:M,includeInventory:!1,includeGlobal:!0,ingredientFirst:!1,globalUrlBuilder:b,searchType:"ingredient",resultFilter:(d,v)=>{let T=Q(d);return T?h.has(T):v==="inventory"},requireHidden:!1,onSelection:function(d){N&&(N.value=(d==null?void 0:d.default_unit)||""),k&&(k.value=(d==null?void 0:d.ingredient_category_name)||""),e.storage.queueStateSave()}}),L.addEventListener("input",function(){this.value.trim()||(N&&(N.value=""),k&&(k.value=""))})}function B({pctId:r,weightId:t}){var M,N,k;let h=document.getElementById(r),I=h==null?void 0:h.value;if(I!==""&&I!==null&&I!==void 0)return l(I);let x=O(((N=(M=e.oils)==null?void 0:M.getTotalOilsGrams)==null?void 0:N.call(M))||0,0);if(x<=0)return 0;let L=q((k=document.getElementById(t))==null?void 0:k.value);return L<=0?0:L/x*100}function i(){var x,L,M,N,k,g,b,E,d,v,T,R,K,j,U,G,Y,z,X,ee;let r=((x=document.getElementById("additiveLactateGi"))==null?void 0:x.value)||"",t=((L=document.getElementById("additiveSugarGi"))==null?void 0:L.value)||"",h=((M=document.getElementById("additiveSaltGi"))==null?void 0:M.value)||"",I=((N=document.getElementById("additiveCitricGi"))==null?void 0:N.value)||"";return{lactatePct:B({pctId:"additiveLactatePct",weightId:"additiveLactateWeight"}),sugarPct:B({pctId:"additiveSugarPct",weightId:"additiveSugarWeight"}),saltPct:B({pctId:"additiveSaltPct",weightId:"additiveSaltWeight"}),citricPct:B({pctId:"additiveCitricPct",weightId:"additiveCitricWeight"}),lactateName:((g=(k=document.getElementById("additiveLactateName"))==null?void 0:k.value)==null?void 0:g.trim())||"Sodium Lactate",sugarName:((E=(b=document.getElementById("additiveSugarName"))==null?void 0:b.value)==null?void 0:E.trim())||"Sugar",saltName:((v=(d=document.getElementById("additiveSaltName"))==null?void 0:d.value)==null?void 0:v.trim())||"Salt",citricName:((R=(T=document.getElementById("additiveCitricName"))==null?void 0:T.value)==null?void 0:R.trim())||"Citric Acid",lactateGlobalItemId:r?parseInt(r):void 0,sugarGlobalItemId:t?parseInt(t):void 0,saltGlobalItemId:h?parseInt(h):void 0,citricGlobalItemId:I?parseInt(I):void 0,lactateDefaultUnit:((K=document.getElementById("additiveLactateUnit"))==null?void 0:K.value)||void 0,sugarDefaultUnit:((j=document.getElementById("additiveSugarUnit"))==null?void 0:j.value)||void 0,saltDefaultUnit:((U=document.getElementById("additiveSaltUnit"))==null?void 0:U.value)||void 0,citricDefaultUnit:((G=document.getElementById("additiveCitricUnit"))==null?void 0:G.value)||void 0,lactateCategoryName:((Y=document.getElementById("additiveLactateCategory"))==null?void 0:Y.value)||void 0,sugarCategoryName:((z=document.getElementById("additiveSugarCategory"))==null?void 0:z.value)||void 0,saltCategoryName:((X=document.getElementById("additiveSaltCategory"))==null?void 0:X.value)||void 0,citricCategoryName:((ee=document.getElementById("additiveCitricCategory"))==null?void 0:ee.value)||void 0}}function s(){var t;return(((t=document.querySelector('input[name="lye_type"]:checked'))==null?void 0:t.value)||"NaOH")==="NaOH"?"NaOH":"KOH"}function o(r){let t=O(l(r),0),h=O(B({pctId:"additiveLactatePct",weightId:"additiveLactateWeight"}),0),I=O(B({pctId:"additiveSugarPct",weightId:"additiveSugarWeight"}),0),x=O(B({pctId:"additiveSaltPct",weightId:"additiveSaltWeight"}),0),L=O(B({pctId:"additiveCitricPct",weightId:"additiveCitricWeight"}),0),M=t*(h/100),N=t*(I/100),k=t*(x/100),g=t*(L/100),b=s()==="KOH"?.719:.624;return{lactatePct:h,sugarPct:I,saltPct:x,citricPct:L,lactateG:M,sugarG:N,saltG:k,citricG:g,citricLyeG:g*b}}function a({pctId:r,weightId:t,sourceField:h,totalOils:I}){let x=document.getElementById(r),L=document.getElementById(t);if(!x||!L)return;let M=O(l(I),0);if(M<=0)return;if(h==="weight"){let b=L.value;if(b===""||b===null||b===void 0){x.value="";return}let E=O(q(b),0),d=E>0?E/M*100:0;x.value=d>0?m(d,2):"";return}let N=x.value;if(N===""||N===null||N===void 0){L.value="";return}let k=O(l(N),0),g=M*(k/100);L.value=g>0?m(y(g),2):""}function n(r){let t=(I,x)=>{let L=document.getElementById(I);if(L)if(L.tagName==="INPUT"){if(document.activeElement===L)return;L.value=x}else L.textContent=x},h=I=>I>0?m(y(I),2):"";t("additiveLactateWeight",h(l(r==null?void 0:r.lactateG))),t("additiveSugarWeight",h(l(r==null?void 0:r.sugarG))),t("additiveSaltWeight",h(l(r==null?void 0:r.saltG))),t("additiveCitricWeight",h(l(r==null?void 0:r.citricG))),t("additiveCitricLyeOut",H(l(r==null?void 0:r.citricLyeG)))}function u(r){let t=O(l(r),0),h=o(t);return n(h),h}function p(r){let t=r.querySelector(".fragrance-typeahead"),h=r.querySelector(".fragrance-gi-id"),I=r.querySelector(".fragrance-default-unit"),x=r.querySelector(".fragrance-category"),L=r.querySelector('[data-role="suggestions"]');if(!t||!L||typeof P.attachMergedInventoryGlobalTypeahead!="function")return;let M=D();P.attachMergedInventoryGlobalTypeahead({inputEl:t,listEl:L,mode:"public",giHiddenEl:h,includeInventory:!1,includeGlobal:!0,ingredientFirst:!1,globalUrlBuilder:M,searchType:"ingredient",resultFilter:(N,k)=>{let g=Q(N);return g?S.has(g):k==="inventory"},requireHidden:!1,onSelection:function(N){I&&(I.value=(N==null?void 0:N.default_unit)||""),x&&(x.value=(N==null?void 0:N.ingredient_category_name)||""),e.storage.queueStateSave()}}),t.addEventListener("input",function(){this.value.trim()||(I&&(I.value=""),x&&(x.value=""))})}function c(){var h,I;let r=document.getElementById("fragranceRowTemplate"),t=(I=(h=r==null?void 0:r.content)==null?void 0:h.querySelector(".fragrance-row"))==null?void 0:I.cloneNode(!0);return t?(t.querySelectorAll("input").forEach(x=>{x.value=""}),p(t),t.querySelectorAll(".unit-suffix").forEach(x=>{x.dataset.suffix=C.currentUnit}),t):document.createElement("div")}function w(r){let t=Array.from(document.querySelectorAll("#fragranceRows .fragrance-row")),h=O(r||e.oils.getTotalOilsGrams()||0,0),I=0,x=0;t.forEach(N=>{let k=N.querySelector(".fragrance-grams"),g=N.querySelector(".fragrance-percent");if(!k||!g)return;let b=k.value,E=g.value,d=q(b),v=O(l(E),0),T=e.state.lastFragranceEdit,R=T&&T.row===N?T.field:null;h>0&&(R==="percent"?(d=h*(v/100),k.value=d>0?m(y(d),2):""):R==="grams"?(v=d/h*100,g.value=v>0?m(v,2):""):d>0?(v=d/h*100,document.activeElement!==g&&(g.value=m(v,2))):v>0&&(d=h*(v/100),document.activeElement!==k&&(k.value=m(y(d),2)))),d>0&&(I+=d),x+=v});let L=document.getElementById("fragrancePercentTotal");L&&(L.textContent=m(x,2));let M=document.getElementById("fragranceTotalComputed");return M&&(M.textContent=I>0?H(I):"--"),{totalGrams:I,totalPct:x}}function F(r){let t=[],h=O(r||e.oils.getTotalOilsGrams()||0,0);return document.querySelectorAll("#fragranceRows .fragrance-row").forEach(I=>{var d,v,T,R,K,j,U;let x=(v=(d=I.querySelector(".fragrance-typeahead"))==null?void 0:d.value)==null?void 0:v.trim(),L=((T=I.querySelector(".fragrance-gi-id"))==null?void 0:T.value)||"",M=((R=I.querySelector(".fragrance-default-unit"))==null?void 0:R.value)||"",N=((K=I.querySelector(".fragrance-category"))==null?void 0:K.value)||"",k=(j=I.querySelector(".fragrance-grams"))==null?void 0:j.value,g=(U=I.querySelector(".fragrance-percent"))==null?void 0:U.value,b=q(k),E=O(l(g),0);b<=0&&E>0&&h>0&&(b=h*(E/100)),!(!x&&!L&&b<=0)&&t.push({name:x||"Fragrance/Essential Oils",globalItemId:L?parseInt(L):void 0,defaultUnit:M||void 0,categoryName:N||void 0,grams:b,pct:E})}),t}function A(){let r=[];return document.querySelectorAll("#fragranceRows .fragrance-row").forEach(t=>{var k,g,b,E,d,v,T;let h=((g=(k=t.querySelector(".fragrance-typeahead"))==null?void 0:k.value)==null?void 0:g.trim())||"",I=((b=t.querySelector(".fragrance-grams"))==null?void 0:b.value)||"",x=((E=t.querySelector(".fragrance-percent"))==null?void 0:E.value)||"",L=((d=t.querySelector(".fragrance-gi-id"))==null?void 0:d.value)||"",M=((v=t.querySelector(".fragrance-default-unit"))==null?void 0:v.value)||"",N=((T=t.querySelector(".fragrance-category"))==null?void 0:T.value)||"";!h&&!I&&!x&&!L||r.push({name:h,grams:I,percent:x,gi:L,defaultUnit:M,categoryName:N})}),r}function _(r){let t=document.getElementById("soapVisualGuidanceList");if(!t)return;let h=Array.isArray(r==null?void 0:r.tips)&&r.tips.length?r.tips:["No visual flags detected for this formula."];t.innerHTML=h.map(I=>`<li>${I}</li>`).join("")}function Q(r){return!r||typeof r!="object"?null:r.ingredient&&r.ingredient.ingredient_category_name||r.ingredient_category_name||r.ingredient_category&&r.ingredient_category.name||null}e.additives={attachAdditiveTypeahead:f,collectAdditiveSettings:i,syncAdditivePair:a,applyComputedOutputs:n,updateAdditivesOutput:u,updateVisualGuidance:_},e.fragrances={buildFragranceRow:c,updateFragranceTotals:w,collectFragranceRows:F,collectFragranceData:A}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{toNumber:l}=e.helpers,{STAGE_CONFIGS:m}=e.constants;function O(y){var f;let S=m[y];if(!S)return;let C=document.getElementById(S.tabId);if(C){if((f=P.bootstrap)!=null&&f.Tab)bootstrap.Tab.getOrCreateInstance(C).show();else{document.querySelectorAll("#soapStageTabList .nav-link").forEach(i=>{i.classList.remove("active"),i.setAttribute("aria-selected","false")}),document.querySelectorAll("#soapStageTabContent .tab-pane").forEach(i=>{i.classList.remove("show","active")}),C.classList.add("active"),C.setAttribute("aria-selected","true");let B=document.getElementById(S.paneId);B&&B.classList.add("show","active")}e.layout.scheduleStageHeightSync(),C.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}function D(y){var S,C;if(y===1){let f=document.getElementById("unitGrams");f&&(f.checked=!0),e.units.setUnit("g",{skipAutoCalc:!0}),document.getElementById("moldWaterWeight").value="",document.getElementById("moldOilPct").value="65",document.getElementById("oilTotalTarget").value="",document.getElementById("moldShape").value="loaf";let B=document.getElementById("moldCylinderCorrection");B&&(B.checked=!1),document.getElementById("moldCylinderFactor").value="0.85",e.mold.updateMoldShapeUI(),(S=e.mold)!=null&&S.updateWetBatterWarning&&e.mold.updateWetBatterWarning(0)}if(y===2){let f=document.getElementById("oilRows");f&&(f.innerHTML="",f.appendChild(e.oils.buildOilRow())),e.oils.updateOilTotals()}if(y===3){let f=document.getElementById("lyeTypeNaoh");f&&(f.checked=!0);let B=document.getElementById("waterMethod");B&&(B.value="percent");let i=document.getElementById("lyeSuperfat");i&&(i.value="5");let s=document.getElementById("lyePurity");s&&(s.value="100");let o=document.getElementById("waterPct");o&&(o.value="33");let a=document.getElementById("lyeConcentration");a&&(a.value="33");let n=document.getElementById("waterRatio");n&&(n.value="2"),e.runner.applyLyeSelection(),e.runner.setWaterMethod(),e.additives.updateAdditivesOutput(e.oils.getTotalOilsGrams())}if(y===4&&(document.getElementById("additiveLactatePct").value="1",document.getElementById("additiveSugarPct").value="1",document.getElementById("additiveSaltPct").value="0.5",document.getElementById("additiveCitricPct").value="0",["additiveLactateName","additiveSugarName","additiveSaltName","additiveCitricName"].forEach(f=>{let B=document.getElementById(f);B&&(B.value="")}),["additiveLactateGi","additiveSugarGi","additiveSaltGi","additiveCitricGi"].forEach(f=>{let B=document.getElementById(f);B&&(B.value="")}),e.additives.updateAdditivesOutput(e.oils.getTotalOilsGrams())),y===5){let f=document.getElementById("fragranceRows");f&&(f.innerHTML="",(C=e.fragrances)!=null&&C.buildFragranceRow&&f.appendChild(e.fragrances.buildFragranceRow()));let B=document.getElementById("fragrancePercentTotal");B&&(B.textContent="0");let i=document.getElementById("fragranceTotalComputed");i&&(i.textContent="--")}e.storage.queueStateSave(),e.storage.queueAutoCalc(),q()}function H(y){var S;if(y===1){let C=l(document.getElementById("moldWaterWeight").value),f=l(document.getElementById("oilTotalTarget").value),B=l(document.getElementById("moldOilPct").value),s=!!document.querySelector('input[name="weight_unit"]:checked')&&(C>0||f>0)&&B>0;return{state:s?"complete":"incomplete",label:s?"Sized":"Needs target"}}if(y===2){let f=Array.from(document.querySelectorAll("#oilRows .oil-row")).some(B=>{var a,n,u,p;let i=(n=(a=B.querySelector(".oil-typeahead"))==null?void 0:a.value)==null?void 0:n.trim(),s=l((u=B.querySelector(".oil-grams"))==null?void 0:u.value),o=l((p=B.querySelector(".oil-percent"))==null?void 0:p.value);return i&&(s>0||o>0)});return{state:f?"complete":"incomplete",label:f?"Oils added":"Add oils"}}if(y===3){let C=l(document.getElementById("lyeSuperfat").value),f=(S=document.getElementById("waterMethod"))==null?void 0:S.value,i=!!document.querySelector('input[name="lye_type"]:checked')&&!!f&&C>=0;return{state:i?"complete":"incomplete",label:i?"Configured":"Set lye"}}return y===4?{state:"optional",label:["additiveLactatePct","additiveSugarPct","additiveSaltPct","additiveCitricPct"].some(f=>l(document.getElementById(f).value)>0)?"Added":"Optional"}:y===5?{state:"optional",label:Array.from(document.querySelectorAll("#fragranceRows .fragrance-row")).some(B=>{var a,n,u,p;let i=(n=(a=B.querySelector(".fragrance-typeahead"))==null?void 0:a.value)==null?void 0:n.trim(),s=l((u=B.querySelector(".fragrance-grams"))==null?void 0:u.value),o=l((p=B.querySelector(".fragrance-percent"))==null?void 0:p.value);return i||s>0||o>0})?"Added":"Optional"}:{state:"incomplete",label:"Incomplete"}}function q(){let y=document.getElementById("soapStageTabList");y&&y.querySelectorAll(".soap-stage-status").forEach(C=>C.remove());let S=document.getElementById("soapStageProgress");S&&(S.textContent="")}e.stages={openStageByIndex:O,resetStage:D,updateStageStatuses:q}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{round:l,toNumber:m,clamp:O}=e.helpers,{computeFattyAcids:D,computeQualities:H,computeOilQualityScores:q}=e.calc,{QUALITY_RANGES:y,QUALITY_HINTS:S,QUALITY_FEEL_HINTS:C,IODINE_RANGE:f,IODINE_SCALE_MAX:B,INS_RANGE:i,INS_SCALE_MAX:s,QUALITY_BASE:o,QUALITY_PRESETS:a,FATTY_BAR_COLORS:n,FATTY_DISPLAY_KEYS:u}=e.constants,{pulseValue:p,showSoapAlert:c}=e.ui;function w({barId:M,fillId:N,value:k,max:g,label:b}){let E=document.getElementById(M),d=document.getElementById(N);if(!E||!d)return null;let v=isFinite(k)?k:0,T=Math.max(0,Math.min(g,v)),R=g>0?T/g*100:0;return d.style.width=`${R}%`,E.setAttribute("aria-valuemin","0"),E.setAttribute("aria-valuemax",String(g)),E.setAttribute("aria-valuenow",T.toFixed(1)),b&&E.setAttribute("aria-label",b),{bar:E,fill:d,value:v}}function F(M,N,k){if(!(!M||!k)){if(M.classList.remove("bg-success","bg-warning","bg-danger","bg-secondary"),!isFinite(N)){M.classList.add("bg-secondary");return}N<k[0]?M.classList.add("bg-warning"):N>k[1]?M.classList.add("bg-danger"):M.classList.add("bg-success")}}function A(M,N,k,g,b,E){let d=w({barId:M,fillId:N,value:k,max:b,label:E});d&&F(d.fill,k,g)}function _(){let M={hardness:{range:y.hardness,scale:100},cleansing:{range:y.cleansing,scale:100},conditioning:{range:y.conditioning,scale:100},bubbly:{range:y.bubbly,scale:100},creamy:{range:y.creamy,scale:100},iodine:{range:f,scale:B},ins:{range:i,scale:s}};Object.entries(M).forEach(([N,k])=>{let[g,b]=k.range,E=k.scale,d=N.charAt(0).toUpperCase()+N.slice(1),v=N==="iodine"?"iodineBar":N==="ins"?"insBar":`quality${d}Bar`,T=document.getElementById(`quality${d}Safe`);if(T){let U=Math.max(0,Math.min(100,g/E*100)),G=Math.max(0,Math.min(100,(b-g)/E*100));T.style.left=`${U}%`,T.style.width=`${G}%`,T.title=`Safe range ${l(g,0)}-${l(b,0)}`}let R=document.getElementById(v);R&&(R.dataset.safeRange=`${l(g,0)}-${l(b,0)}`);let K=document.getElementById(`quality${d}RangeMin`),j=document.getElementById(`quality${d}RangeMax`);K&&(K.textContent=l(g,0)),j&&(j.textContent=l(b,0))})}function Q(M,N){let k=O(M.hardness||0,0,100),g=O(M.bubbly||0,0,100),b=O(M.conditioning||0,0,100),E=O(b+(N||0)*3,0,100),d=document.getElementById("feelHardness"),v=document.getElementById("feelBubbly"),T=document.getElementById("feelConditioning"),R=document.getElementById("feelGreasy");d&&(d.value=l(k,1)),v&&(v.value=l(g,1)),T&&(T.value=l(b,1)),R&&(R.value=l(E,1))}function r(M){u.forEach(N=>{let k=document.getElementById(`fattyBar${N.charAt(0).toUpperCase()}${N.slice(1)}`);if(!k)return;let g=O(m(M[N]),0,100),b=g;k.style.width=`${b}%`,k.style.backgroundColor=n[N]||"var(--color-muted)",k.title=`${N.charAt(0).toUpperCase()}${N.slice(1)}: ${l(g,1)}%`})}function t(){var g;let M=((g=document.getElementById("qualityPreset"))==null?void 0:g.value)||"balanced",N=Array.from(document.querySelectorAll(".quality-focus:checked"));if(M==="none"&&!N.length)return null;let k=M==="none"?{...o}:a[M]?{...a[M]}:{...o};return N.forEach(b=>{let E=b.dataset.attr,d=b.dataset.direction,v=y[E];v&&(k[E]=d==="low"?v[0]:v[1])}),k}function h(){let M=t(),N={hardness:document.getElementById("qualityHardnessTarget"),cleansing:document.getElementById("qualityCleansingTarget"),conditioning:document.getElementById("qualityConditioningTarget"),bubbly:document.getElementById("qualityBubblyTarget"),creamy:document.getElementById("qualityCreamyTarget"),iodine:document.getElementById("iodineTarget"),ins:document.getElementById("insTarget")};Object.entries(N).forEach(([k,g])=>{if(!g)return;let b=document.getElementById(`${g.id}Label`);if(!M){g.classList.add("d-none"),b&&(b.textContent="");return}let E=m(M[k]);if(!isFinite(E)){g.classList.add("d-none"),b&&(b.textContent="");return}let d=k==="iodine"?B:k==="ins"?s:100,v=O(E,0,d);g.classList.remove("d-none"),g.style.left=`${v/d*100}%`,g.setAttribute("aria-label",`Apply ${k} target`),g.setAttribute("role","button"),g.setAttribute("tabindex","0"),g.title=`Target ${k}: ${l(E,1)}`,b&&(b.textContent=l(E,1))})}function I(){let M=t();if(!M){c("info","Select a quality target to nudge the blend.",{dismissible:!0,timeoutMs:5e3});return}let k=Array.from(document.querySelectorAll("#oilRows .oil-row")).map(G=>{var ee,oe;let Y=e.units.toGrams((ee=G.querySelector(".oil-grams"))==null?void 0:ee.value),z=((oe=G.querySelector(".oil-fatty"))==null?void 0:oe.value)||"",X=null;if(z)try{X=JSON.parse(z)}catch{X=null}return{row:G,grams:Y,fattyProfile:X}}).filter(G=>G.grams>0);if(!k.length){c("warning","Add oils before nudging toward a target.",{dismissible:!0,timeoutMs:5e3});return}let g=D(k.map(G=>({grams:G.grams,fattyProfile:G.fattyProfile}))),b=H(g.percent),E={hardness:O((M.hardness-b.hardness)/100,-1,1),cleansing:O((M.cleansing-b.cleansing)/100,-1,1),conditioning:O((M.conditioning-b.conditioning)/100,-1,1),bubbly:O((M.bubbly-b.bubbly)/100,-1,1),creamy:O((M.creamy-b.creamy)/100,-1,1)},d=k.reduce((G,Y)=>G+Y.grams,0),v=[],T=0,R=.8,K=k.filter(G=>!G.fattyProfile||typeof G.fattyProfile!="object").length;if(K===k.length){c("warning","None of the selected oils have fatty acid data, so targets cannot be applied.",{dismissible:!0,timeoutMs:6e3});return}if(K&&c("info","Some oils are missing fatty acid data. The nudge will only use oils with profiles.",{dismissible:!0,timeoutMs:5e3}),k.forEach(G=>{let Y=q(G.fattyProfile),z=E.hardness*Y.hardness+E.cleansing*Y.cleansing+E.conditioning*Y.conditioning+E.bubbly*Y.bubbly+E.creamy*Y.creamy,X=O(1+z*R,.2,1.8),ee=G.grams*X;v.push({row:G.row,grams:ee}),T+=ee}),T<=0){c("warning","Unable to adjust blend with current data.",{dismissible:!0,timeoutMs:5e3});return}let j=d/T,U=e.oils.getOilTargetGrams()||d;v.forEach(G=>{let Y=G.grams*j,z=G.row.querySelector(".oil-grams"),X=G.row.querySelector(".oil-percent");if(z&&(z.value=Y>0?l(e.units.fromGrams(Y),2):""),X&&U>0){let ee=Y/U*100;X.value=ee>0?l(ee,2):""}}),e.oils.updateOilTotals(),e.storage.queueStateSave(),e.storage.queueAutoCalc(),c("info","Blend nudged toward selected targets. Re-check results and adjust as needed.",{dismissible:!0,timeoutMs:6e3})}function x(M){let{qualities:N,fattyPercent:k,coveragePct:g,iodine:b,ins:E,sapAvg:d,superfat:v,warnings:T}=M,R=g>0;function K(ae,te){var W,V;let re=document.getElementById(`quality${ae}Value`),ue=document.getElementById(`quality${ae}Hint`);if(!re)return;re.textContent=R&&isFinite(te)?l(te,1):"--",p(re);let fe=ae.toLowerCase(),de=y[fe],$=w({barId:`quality${ae}Bar`,fillId:`quality${ae}Fill`,value:R?te:0,max:100,label:ae});$&&de&&(F($.fill,te,de),R&&isFinite(te)?$.bar.title=`${ae}: ${l(te,1)} (safe ${de[0]}-${de[1]}). ${S[fe]||""}`.trim():$.bar.title=`${ae}: -- (safe ${de[0]}-${de[1]}). ${S[fe]||""}`.trim()),ue&&de&&(!R||!isFinite(te)?ue.textContent="":te<de[0]?ue.textContent=((W=C[fe])==null?void 0:W.low)||"":te>de[1]?ue.textContent=((V=C[fe])==null?void 0:V.high)||"":ue.textContent="")}K("Hardness",N.hardness),K("Cleansing",N.cleansing),K("Conditioning",N.conditioning),K("Bubbly",N.bubbly),K("Creamy",N.creamy);let j=document.getElementById("fattyCoverageNote");j&&(j.textContent=g>0?`Fatty acid coverage: ${l(g,1)}% of oils`:"Fatty acid coverage: not enough data yet");let U=document.getElementById("iodineValue"),G=document.getElementById("insValue"),Y=document.getElementById("sapAvgValue");U&&(U.textContent=b>0?l(b,1):"--",p(U)),G&&(G.textContent=E>0?l(E,1):"--",p(G)),Y&&(Y.textContent=d>0?l(d,1):"--",p(Y)),A("iodineBar","iodineFill",b,f,B,"Iodine"),A("insBar","insFill",E,i,s,"INS");let z=(k.lauric||0)+(k.myristic||0)+(k.palmitic||0)+(k.stearic||0),X=(k.ricinoleic||0)+(k.oleic||0)+(k.linoleic||0)+(k.linolenic||0),ee=document.getElementById("fattySatRatioResult");ee&&(ee.textContent=z+X>0?`${l(z,0)}:${l(X,0)}`:"--",p(ee)),u.forEach(ae=>{let te=`fatty${ae.charAt(0).toUpperCase()}${ae.slice(1)}`,re=k[ae];document.getElementById(te).textContent=R&&re?`${l(re,1)}%`:"--"}),Q(N,v||0),r(k),h();let oe=Array.isArray(T)?T.slice():[],le=document.getElementById("soapQualityWarnings");oe.length?(le.classList.remove("d-none"),le.innerHTML=`<strong>Guidance & flags:</strong><ul class="mb-0">${oe.map(ae=>`<li>${ae}</li>`).join("")}</ul>`):(le.classList.add("d-none"),le.textContent=""),e.layout.scheduleStageHeightSync()}function L(){var M;document.querySelectorAll(".soap-quality-help").forEach(N=>{let k=N.dataset.quality;S[k]&&N.setAttribute("title",S[k])}),(M=P.bootstrap)!=null&&M.Tooltip&&document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(N=>{bootstrap.Tooltip.getOrCreateInstance(N)})}e.quality={setQualityRangeBars:_,updateQualityTargets:h,applyQualityTargets:I,updateQualitiesDisplay:x,initQualityTooltips:L}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{};function l(q,y){let S=[];return document.querySelectorAll(`#${q} .row`).forEach(function(C){var a,n,u;let f=(n=(a=C.querySelector(".tool-typeahead"))==null?void 0:a.value)==null?void 0:n.trim(),B=((u=C.querySelector(".tool-gi-id"))==null?void 0:u.value)||"",i=C.querySelector(".tool-qty"),s=C.querySelector(".tool-unit"),o=i&&i.value!=="";!f&&!B||(y==="container"?S.push({name:f||void 0,global_item_id:B?parseInt(B):void 0,quantity:o?parseFloat(i.value):1}):S.push({name:f||void 0,global_item_id:B?parseInt(B):void 0,quantity:o?parseFloat(i.value):0,unit:((s==null?void 0:s.value)||"").trim()||"gram"}))}),S}function m(q){let y=e.config.isAuthenticated?"member":"public",S=e.config.isAuthenticated?"recipe":"public";return buildToolLineRow(q,{context:y,mode:S,unitOptionsHtml:e.config.unitOptionsHtml})}function O(q,y){let S=m(q),C=S.querySelector(".tool-typeahead"),f=S.querySelector(".tool-qty");C&&(C.value=y),f&&q==="container"&&(f.value=1),q==="container"?document.getElementById("tool-containers").appendChild(S):q==="consumable"?document.getElementById("tool-consumables").appendChild(S):document.getElementById("tool-ingredients").appendChild(S)}function D(q){if(!q||typeof q!="object")return null;try{let y=JSON.parse(JSON.stringify(q));return y&&typeof y=="object"&&delete y.export,y}catch{return null}}function H(q){var B,i;let y=D(q);if(!y)return null;let S=((B=document.getElementById("qualityPreset"))==null?void 0:B.value)||"balanced",C=Array.from(document.querySelectorAll(".quality-focus:checked")).map(s=>s.id),f=(i=e.mold)!=null&&i.getMoldSettings?e.mold.getMoldSettings():null;return{calc:y,draft_lines:{ingredients:l("tool-ingredients","ingredient"),consumables:l("tool-consumables","consumable"),containers:l("tool-containers","container")},context:{source:"soap_tool",schema_version:1,unit_display:e.state.currentUnit||"g",input_mode:"mixed",quality_preset:S,quality_focus:C,mold:f}}}e.recipePayload={collectDraftLines:l,buildLineRow:m,addStubLine:O,buildSoapRecipePayloadRequest:H}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{round:l,toNumber:m,clamp:O}=e.helpers,{formatWeight:D,formatPercent:H}=e.units;function q(){var w;let a=((w=document.querySelector('input[name="lye_type"]:checked'))==null?void 0:w.value)||"NaOH",n=document.getElementById("lyePurity"),u=n==null?void 0:n.value,p=m(n==null?void 0:n.value),c=a==="NaOH"?"NaOH":"KOH";return(u===""||u===null||u===void 0||!isFinite(p))&&(p=100),{selected:a,lyeType:c,purity:p}}function y(){let a=document.getElementById("lyePurity"),n=q();if(a)if(a.removeAttribute("readonly"),n.selected==="KOH90"){let u=document.getElementById("lyePurityHint");u&&(u.textContent="90% KOH selected. Safe default purity is 90%.")}else{let u=document.getElementById("lyePurityHint");u&&(u.textContent="Safe default is 100%.")}}function S(a){return a==="concentration"?"Concentration mode uses lye amount, so superfat and purity change water.":a==="ratio"?"Ratio mode uses lye amount, so superfat and purity change water.":"Percent mode uses oils total, so superfat changes lye but not water."}function C(a=null,n=null){var w;let u=document.getElementById("stageWaterOutput"),p=document.getElementById("stageWaterComputedHint"),c=n||(a==null?void 0:a.waterMethod)||((w=document.getElementById("waterMethod"))==null?void 0:w.value)||"percent";if(u){let F=a&&isFinite(a.waterG)&&a.waterG>0;u.textContent=F?D(a.waterG):"--"}if(p){if(!a||!isFinite(a.totalOils)||a.totalOils<=0){p.textContent=`Set oils in Stage 2 to calculate water. ${S(c)}`;return}if(c==="concentration"){let F=a.lyeConcentrationInput||a.lyeConcentration||0;p.textContent=`Using ${l(F,1)}% lye concentration from ${D(a.lyeAdjusted||0)} lye.`;return}if(c==="ratio"){let F=a.waterRatioInput||a.waterRatio||0;p.textContent=`Using ${l(F,2)} : 1 water-to-lye ratio from ${D(a.lyeAdjusted||0)} lye.`;return}p.textContent=`Using ${l(a.waterPct||0,1)}% of total oils (${D(a.totalOils)}).`}}function f(a=null,n=null){var x;let u=document.getElementById("lyeWaterPreviewAnchor"),p=document.getElementById("lyePreview"),c=document.getElementById("waterPreview"),w=document.getElementById("concPreview"),F=document.getElementById("ratioPreview");if(!u&&!p&&!c&&!w&&!F)return;let A=(L,M)=>{L&&(L.textContent=M)},_=n||(a==null?void 0:a.waterMethod)||((x=document.getElementById("waterMethod"))==null?void 0:x.value)||"percent",Q=m(a==null?void 0:a.totalOils),r=m(a==null?void 0:a.lyeAdjusted),t=m(a==null?void 0:a.waterG);if(Q<=0||r<=0){A(u,"Based on -- oils. All values update live as you change inputs."),A(p,"--"),A(c,"--"),A(w,"--"),A(F,"--");return}let h=m(a==null?void 0:a.lyeConcentration)>0?m(a==null?void 0:a.lyeConcentration):r+t>0?r/(r+t)*100:0,I=m(a==null?void 0:a.waterRatio)>0?m(a==null?void 0:a.waterRatio):r>0?t/r:0;if(A(u,`Based on ${D(Q)} oils. All values update live as you change inputs.`),A(p,D(r)),A(c,D(t)),A(w,h>0?H(h):"--"),A(F,I>0?`${l(I,2)} : 1`:"--"),_==="concentration"){let L=m(a==null?void 0:a.lyeConcentrationInput);L>0&&A(w,H(L))}if(_==="ratio"){let L=m(a==null?void 0:a.waterRatioInput);L>0&&A(F,`${l(L,2)} : 1`)}}function B(){var n;let a=((n=document.getElementById("waterMethod"))==null?void 0:n.value)||"percent";document.querySelectorAll(".water-input").forEach(u=>{u.classList.toggle("d-none",u.dataset.method!==a)}),C(null,a),f(null,a)}function i(){let a=e.oils.updateOilTotals(),n=a.totalWeight,u=a.totalPct,p=[],c=e.oils.collectOilData(),w=e.oils.getOilTargetGrams(),A=Array.from(document.querySelectorAll("#oilRows .oil-percent")).map(_=>O(m(_.value),0)).some(_=>_>0);return(!c.length||n<=0)&&p.push("Add at least one oil with a weight or percent."),!w&&n<=0&&A&&p.push("Enter a total oils target or weights to convert percentages."),w>0&&u>0&&Math.abs(u-100)>.5&&p.push("Oil percentages should total 100% (use Normalize to fix)."),w>0&&n>w+.01?p.push("Oil weights exceed the mold target."):!w&&u>100.01&&p.push("Oil percentages exceed 100%."),{ok:p.length===0,errors:p,totals:a,oils:c}}function s(){let a=document.getElementById("lyeSuperfat"),n=a==null?void 0:a.value,u=m(n);return(n===""||n===null||n===void 0||!isFinite(u))&&(u=5),u}function o(){var F,A,_,Q;let n=q().purity;isFinite(n)||(n=100);let u=((F=document.getElementById("waterMethod"))==null?void 0:F.value)||"percent",p=m((A=document.getElementById("waterPct"))==null?void 0:A.value),c=m((_=document.getElementById("lyeConcentration"))==null?void 0:_.value),w=m((Q=document.getElementById("waterRatio"))==null?void 0:Q.value);return{purity:n,waterMethod:u,waterPct:p,lyeConcentration:c,waterRatio:w}}e.runnerInputs={getLyeSelection:q,applyLyeSelection:y,setWaterMethod:B,updateStageWaterSummary:C,updateLiveCalculationPreview:f,validateCalculation:i,readSuperfatInput:s,sanitizeLyeInputs:o}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{getStorage:l}=e.helpers;function m(){if(!e.config.calcLimit)return{count:0,date:null};let y=l();if(!y)return{count:0,date:null};try{let S=y.getItem("soap_calc_usage"),C=new Date().toISOString().slice(0,10);if(!S)return{count:0,date:C};let f=JSON.parse(S);return!f||f.date!==C?{count:0,date:C}:{count:Number(f.count)||0,date:C}}catch{return{count:0,date:null}}}function O(y){if(!e.config.calcLimit)return;let S=l();if(!S)return;let C=new Date().toISOString().slice(0,10);try{S.setItem("soap_calc_usage",JSON.stringify({count:y,date:C}))}catch{}}function D(){return e.config.calcLimit&&m().count>=e.config.calcLimit?(e.ui.showSoapAlert("warning",`You have reached the ${e.config.calcLimit} calculation limit for ${e.config.calcTier} accounts. Create a free account or upgrade to keep calculating.`,{dismissible:!0}),!1):!0}function H(){if(!e.config.calcLimit)return;let S=m().count+1;O(S);let C=Math.max(0,e.config.calcLimit-S);C<=1&&e.ui.showSoapAlert("info",`You have ${C} calculation${C===1?"":"s"} left on the ${e.config.calcTier} tier today.`,{dismissible:!0,timeoutMs:6e3})}function q(y){if(!e.config.calcLimit||y===null||y>1)return;let S=document.getElementById("soapSignupModal");S&&(P.bootstrap&&P.bootstrap.Modal?P.bootstrap.Modal.getOrCreateInstance(S).show():e.ui.showSoapAlert("info","You are almost at the free limit. Create a free account to keep saving your work.",{dismissible:!0,timeoutMs:7e3}))}e.runnerQuota={canConsumeCalcQuota:D,consumeCalcQuota:H,maybeShowSignupModal:q}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},l=e.state;function m(){var y;return((y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:y.getAttribute("content"))||""}async function O(y,S,C=2500){let f=m(),B=new AbortController,i=P.setTimeout(()=>B.abort(),C);try{let s=await fetch(y,{method:"POST",signal:B.signal,headers:{"Content-Type":"application/json",...f?{"X-CSRFToken":f}:{}},body:JSON.stringify(S||{})});if(!s.ok)return null;let o=await s.json();return!o||o.success!==!0||typeof o.result!="object"?null:o.result}catch{return null}finally{P.clearTimeout(i)}}function D({oils:y,selection:S,superfat:C,purity:f,waterMethod:B,waterPct:i,lyeConcentration:s,waterRatio:o,totalOils:a}){var F,A;let n=e.additives.collectAdditiveSettings(),u=e.fragrances.collectFragranceRows(a||0),p=Array.from(document.querySelectorAll(".quality-focus:checked")).map(_=>_.id),c=((F=document.getElementById("qualityPreset"))==null?void 0:F.value)||"balanced",w=(A=e.mold)!=null&&A.getMoldSettings?e.mold.getMoldSettings():null;return{oils:(y||[]).map(_=>({name:_.name||null,grams:_.grams||0,sap_koh:_.sapKoh||0,iodine:_.iodine||0,fatty_profile:_.fattyProfile||null,global_item_id:_.global_item_id||null,default_unit:_.default_unit||null,ingredient_category_name:_.ingredient_category_name||null})),fragrances:u.map(_=>({name:_.name||"Fragrance/Essential Oils",grams:_.grams||0,pct:_.pct||0,global_item_id:_.globalItemId||null,default_unit:_.defaultUnit||null,ingredient_category_name:_.categoryName||null})),additives:{lactate_pct:n.lactatePct||0,sugar_pct:n.sugarPct||0,salt_pct:n.saltPct||0,citric_pct:n.citricPct||0,lactate_name:n.lactateName||"Sodium Lactate",sugar_name:n.sugarName||"Sugar",salt_name:n.saltName||"Salt",citric_name:n.citricName||"Citric Acid",lactate_global_item_id:n.lactateGlobalItemId||null,sugar_global_item_id:n.sugarGlobalItemId||null,salt_global_item_id:n.saltGlobalItemId||null,citric_global_item_id:n.citricGlobalItemId||null,lactate_default_unit:n.lactateDefaultUnit||null,sugar_default_unit:n.sugarDefaultUnit||null,salt_default_unit:n.saltDefaultUnit||null,citric_default_unit:n.citricDefaultUnit||null,lactate_category_name:n.lactateCategoryName||null,sugar_category_name:n.sugarCategoryName||null,salt_category_name:n.saltCategoryName||null,citric_category_name:n.citricCategoryName||null},lye:{selected:(S==null?void 0:S.selected)||"NaOH",superfat:C,purity:f},water:{method:B,water_pct:i,lye_concentration:s,water_ratio:o},meta:{unit_display:l.currentUnit||"g",quality_preset:c,quality_focus:p,mold:w}}}async function H(y){return O("/tools/api/soap/calculate",y,2500)}async function q(y){return O("/tools/api/soap/recipe-payload",y,3500)}e.runnerService={buildServicePayload:D,calculateWithSoapService:H,buildRecipePayload:q}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{round:l,toNumber:m}=e.helpers,{formatWeight:O,formatPercent:D}=e.units,H=e.state,q={lactateG:0,sugarG:0,saltG:0,citricG:0,citricLyeG:0,fragranceG:0,fragrancePct:0};function y(i){return(i||[]).map(s=>{var o;return{name:s.name||null,grams:m(s.grams),sapKoh:m((o=s.sap_koh)!=null?o:s.sapKoh),iodine:m(s.iodine),fattyProfile:s.fatty_profile||s.fattyProfile||null,global_item_id:s.global_item_id||null,default_unit:s.default_unit||null,ingredient_category_name:s.ingredient_category_name||null}})}function S(i,s){let o=document.getElementById(i);o&&(o.textContent=s)}function C({resultsCard:i,lyeAdjusted:s,waterData:o,batchYield:a,totalOils:n,superfat:u}){let p=document.getElementById("resultsCard");p&&(p.style.display="block");let c=m(i.water_lye_ratio)||o.waterRatio;S("lyeAdjustedOutput",O(m(i.lye_adjusted_g)||s)),S("waterOutput",O(m(i.water_g)||o.waterG)),S("batchYieldOutput",O(a)),S("lyeConcentrationOutput",D(m(i.lye_concentration_pct)||o.lyeConcentration)),S("waterRatioOutput",isFinite(c)&&c>0?l(c,2).toString():"--"),S("totalOilsOutput",O(n)),S("superfatOutput",D(u)),["lyeAdjustedOutput","waterOutput","batchYieldOutput","lyeConcentrationOutput","waterRatioOutput","totalOilsOutput","superfatOutput"].forEach(w=>e.ui.pulseValue(document.getElementById(w)))}function f({showAlerts:i,lyeTotals:s,purity:o,waterData:a}){if(!i)return;s.usedFallback&&e.ui.showSoapAlert("info","Some oils are missing SAP values, so an average SAP was used. Select oils with SAP data for the most accurate lye calculation.",{dismissible:!0,timeoutMs:7e3}),o<100&&e.ui.showSoapAlert("info",`Lye purity is set to ${l(o,1)}%. Adjusting lye to match your real-world purity.`,{dismissible:!0,timeoutMs:6e3}),(a.lyeConcentration<25||a.lyeConcentration>45)&&e.ui.showSoapAlert("warning","Your lye concentration is outside the common 25-45% range. Expect slower or faster trace.",{dismissible:!0,timeoutMs:7e3});let n=e.mold.getMoldSettings();n.shape==="cylinder"&&n.waterWeight>0&&!n.useCylinder&&e.ui.showSoapAlert("info","Cylinder mold selected. Enable the cylinder correction if you want to leave headspace or reduce spill risk.",{dismissible:!0,timeoutMs:7e3})}function B({serviceResult:i,validation:s,selection:o,superfat:a,purity:n,waterMethod:u,waterPct:p,lyeConcentrationInput:c,waterRatioInput:w,showAlerts:F}){var G;let A=i.lye_type||o.lyeType||"NaOH",_=i.lye_selected||o.selected||null,Q=m(i.total_oils_g)||s.totals.totalWeight,r=m(i.superfat_pct),t=isFinite(r)?r:a,h={sapAvg:m(i.sap_avg_koh),usedFallback:!!i.used_sap_fallback},I=m(i.lye_pure_g),L=Object.prototype.hasOwnProperty.call(i,"lye_adjusted_base_g")?m(i.lye_adjusted_base_g):null,M=m(i.lye_adjusted_g),N=m(i.lye_purity_pct)||n,k=i.water_method||u,g=m(i.water_pct)||p,b=m(i.lye_concentration_input_pct)||c,E=m(i.water_ratio_input)||w,d={waterG:m(i.water_g),lyeConcentration:m(i.lye_concentration_pct),waterRatio:m(i.water_lye_ratio)},v=i.results_card||{},T=i.quality_report||{},R=y(i.oils||s.oils),K={waterG:d.waterG,lyeAdjusted:M,totalOils:Q,waterMethod:k,waterPct:g,lyeConcentrationInput:b,waterRatioInput:E,lyeConcentration:d.lyeConcentration,waterRatio:d.waterRatio};e.runnerInputs.updateStageWaterSummary(K),e.runnerInputs.updateLiveCalculationPreview(K);let j=i.additives||q;e.additives.applyComputedOutputs&&e.additives.applyComputedOutputs(j);let U=m(v.batch_yield_g)||Q+M+d.waterG+j.fragranceG+j.lactateG+j.sugarG+j.saltG+j.citricG;return(G=e.mold)!=null&&G.updateWetBatterWarning&&e.mold.updateWetBatterWarning(U),C({resultsCard:v,lyeAdjusted:M,waterData:d,batchYield:U,totalOils:Q,superfat:t}),e.ui.updateResultsWarnings(d),e.ui.updateResultsMeta(),e.quality.updateQualitiesDisplay({qualities:T.qualities||{},fattyPercent:T.fatty_acids_pct||{},coveragePct:m(T.coverage_pct),iodine:m(T.iodine),ins:m(T.ins),sapAvg:h.sapAvg,superfat:t,waterData:d,additives:j,oils:R,totalOils:Q,warnings:T.warnings||[]}),e.additives.updateVisualGuidance({tips:T.visual_guidance||[]}),e.stages.updateStageStatuses(),f({showAlerts:F,lyeTotals:h,purity:N,waterData:d}),H.lastCalc={totalOils:Q,oils:R,lyeType:A,lyeSelected:_,superfat:t,purity:N,lyePure:I,lyeAdjustedBase:L,lyeAdjusted:M,water:d.waterG,waterMethod:k,waterPct:g,lyeConcentration:d.lyeConcentration,waterRatio:d.waterRatio,sapAvg:h.sapAvg,usedSapFallback:h.usedFallback,additives:j,batchYield:U,qualityReport:T,export:i.export||null},H.lastCalc}e.runnerRender={applyServiceResult:B}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},l=e.state,m=e.runnerInputs,O=e.runnerQuota,D=e.runnerService,H=e.runnerRender;async function q(S){let C=e.recipePayload.buildSoapRecipePayloadRequest(S);return C?D.buildRecipePayload(C):null}async function y(S={}){var f;let C={consumeQuota:!1,showAlerts:!0,...S};try{C.showAlerts&&e.ui.clearSoapAlerts();let B=m.validateCalculation();if(!B.ok)return m.updateStageWaterSummary(null),m.updateLiveCalculationPreview(null),(f=e.mold)!=null&&f.updateWetBatterWarning&&e.mold.updateWetBatterWarning(0),C.showAlerts&&e.ui.showSoapAlert("warning",`<strong>Missing info:</strong><ul class="mb-0">${B.errors.map(c=>`<li>${c}</li>`).join("")}</ul>`,{dismissible:!0,persist:!0}),null;if(C.consumeQuota&&!O.canConsumeCalcQuota())return null;let i=m.readSuperfatInput(),s=m.getLyeSelection(),o=m.sanitizeLyeInputs(),a=(l.calcRequestSeq||0)+1;l.calcRequestSeq=a;let n=D.buildServicePayload({oils:B.oils,selection:s,superfat:i,purity:o.purity,waterMethod:o.waterMethod,waterPct:o.waterPct,lyeConcentration:o.lyeConcentration,waterRatio:o.waterRatio,totalOils:B.totals.totalWeight}),u=await D.calculateWithSoapService(n);if(a!==l.calcRequestSeq)return l.lastCalc;if(!u)return C.showAlerts&&e.ui.showSoapAlert("danger","Soap calculator service is unavailable. Please try again.",{dismissible:!0,timeoutMs:6e3}),null;let p=H.applyServiceResult({serviceResult:u,validation:B,selection:s,superfat:i,purity:o.purity,waterMethod:o.waterMethod,waterPct:o.waterPct,lyeConcentrationInput:o.lyeConcentration,waterRatioInput:o.waterRatio,showAlerts:C.showAlerts});return C.consumeQuota&&O.consumeCalcQuota(),p}catch{return C.showAlerts&&e.ui.showSoapAlert("danger","Unable to run the soap calculation right now. Please try again.",{dismissible:!0,timeoutMs:6e3}),null}}e.runner={getLyeSelection:(...S)=>m.getLyeSelection(...S),applyLyeSelection:(...S)=>m.applyLyeSelection(...S),setWaterMethod:(...S)=>m.setWaterMethod(...S),updateLiveCalculationPreview:(...S)=>m.updateLiveCalculationPreview(...S),calculateAll:y,buildSoapRecipePayload:q,buildLineRow:(...S)=>e.recipePayload.buildLineRow(...S),addStubLine:(...S)=>e.recipePayload.addStubLine(...S),maybeShowSignupModal:(...S)=>O.maybeShowSignupModal(...S)}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{formatTime:l,getStorage:m}=e.helpers,O="soap_tool_state_v2";function D(o,a){let n=[];return document.querySelectorAll(`#${o} .row`).forEach(p=>{var Q,r,t;let c=(r=(Q=p.querySelector(".tool-typeahead"))==null?void 0:Q.value)==null?void 0:r.trim(),w=((t=p.querySelector(".tool-gi-id"))==null?void 0:t.value)||"",F=p.querySelector(".tool-qty"),A=p.querySelector(".tool-unit"),_=F&&F.value!==""?e.helpers.toNumber(F.value):null;!c&&!w||(a==="container"?n.push({name:c||"",global_item_id:w?parseInt(w):null,quantity:_&&_>0?_:1}):n.push({name:c||"",global_item_id:w?parseInt(w):null,quantity:_&&_>=0?_:0,unit:(A==null?void 0:A.value)||"gram"}))}),n}function H(){let o=[];return document.querySelectorAll("#oilRows .oil-row").forEach(a=>{var r,t,h,I,x,L,M,N,k,g;let n=((t=(r=a.querySelector(".oil-typeahead"))==null?void 0:r.value)==null?void 0:t.trim())||"",u=((h=a.querySelector(".oil-grams"))==null?void 0:h.value)||"",p=((I=a.querySelector(".oil-percent"))==null?void 0:I.value)||"",c=((x=a.querySelector(".oil-sap-koh"))==null?void 0:x.value)||"",w=((L=a.querySelector(".oil-iodine"))==null?void 0:L.value)||"",F=((M=a.querySelector(".oil-fatty"))==null?void 0:M.value)||"",A=((N=a.querySelector(".oil-gi-id"))==null?void 0:N.value)||"",_=((k=a.querySelector(".oil-default-unit"))==null?void 0:k.value)||"",Q=((g=a.querySelector(".oil-category"))==null?void 0:g.value)||"";!n&&!u&&!p&&!A||o.push({name:n,grams:u,percent:p,sap:c,iodine:w,fattyRaw:F,gi:A,defaultUnit:_,categoryName:Q})}),o}function q(){var a;if((a=e.fragrances)!=null&&a.collectFragranceData)return e.fragrances.collectFragranceData();let o=[];return document.querySelectorAll("#fragranceRows .fragrance-row").forEach(n=>{var _,Q,r,t,h,I,x;let u=((Q=(_=n.querySelector(".fragrance-typeahead"))==null?void 0:_.value)==null?void 0:Q.trim())||"",p=((r=n.querySelector(".fragrance-grams"))==null?void 0:r.value)||"",c=((t=n.querySelector(".fragrance-percent"))==null?void 0:t.value)||"",w=((h=n.querySelector(".fragrance-gi-id"))==null?void 0:h.value)||"",F=((I=n.querySelector(".fragrance-default-unit"))==null?void 0:I.value)||"",A=((x=n.querySelector(".fragrance-category"))==null?void 0:x.value)||"";!u&&!p&&!c&&!w||o.push({name:u,grams:p,percent:c,gi:w,defaultUnit:F,categoryName:A})}),o}function y(o,a){let n=document.getElementById("oilRows");if(!n||!o)return;let u=e.oils.buildOilRow();u.querySelector(".oil-typeahead").value=o.name||"",u.querySelector(".oil-grams").value=o.grams||"",u.querySelector(".oil-percent").value=o.percent||"",u.querySelector(".oil-sap-koh").value=o.sap||"",u.querySelector(".oil-iodine").value=o.iodine||"",u.querySelector(".oil-fatty").value=o.fattyRaw||"",u.querySelector(".oil-gi-id").value=o.gi||"";let p=u.querySelector(".oil-default-unit");p&&(p.value=o.defaultUnit||"");let c=u.querySelector(".oil-category");c&&(c.value=o.categoryName||"");let w=Array.from(n.children);return a>=w.length?n.appendChild(u):n.insertBefore(u,w[a]),u}function S(){var n,u,p,c,w,F,A,_,Q,r,t,h,I,x,L,M,N,k,g,b,E,d,v,T,R,K,j;let o=m();if(!o)return;let a={version:2,unit:e.state.currentUnit,oil_total_target:document.getElementById("oilTotalTarget").value||"",oils:H(),lye_form:{superfat:((n=document.getElementById("lyeSuperfat"))==null?void 0:n.value)||"5",lye_type:((u=document.querySelector('input[name="lye_type"]:checked'))==null?void 0:u.value)||"NaOH",lye_purity:((p=document.getElementById("lyePurity"))==null?void 0:p.value)||"100",water_method:((c=document.getElementById("waterMethod"))==null?void 0:c.value)||"percent",water_pct:((w=document.getElementById("waterPct"))==null?void 0:w.value)||"",lye_concentration:((F=document.getElementById("lyeConcentration"))==null?void 0:F.value)||"",water_ratio:((A=document.getElementById("waterRatio"))==null?void 0:A.value)||""},additives:{fragrances:q(),lactate_pct:document.getElementById("additiveLactatePct").value||"1",lactate_name:((_=document.getElementById("additiveLactateName"))==null?void 0:_.value)||"",lactate_gi:((Q=document.getElementById("additiveLactateGi"))==null?void 0:Q.value)||"",lactate_unit:((r=document.getElementById("additiveLactateUnit"))==null?void 0:r.value)||"",lactate_category:((t=document.getElementById("additiveLactateCategory"))==null?void 0:t.value)||"",sugar_pct:document.getElementById("additiveSugarPct").value||"1",sugar_name:((h=document.getElementById("additiveSugarName"))==null?void 0:h.value)||"",sugar_gi:((I=document.getElementById("additiveSugarGi"))==null?void 0:I.value)||"",sugar_unit:((x=document.getElementById("additiveSugarUnit"))==null?void 0:x.value)||"",sugar_category:((L=document.getElementById("additiveSugarCategory"))==null?void 0:L.value)||"",salt_pct:document.getElementById("additiveSaltPct").value||"0.5",salt_name:((M=document.getElementById("additiveSaltName"))==null?void 0:M.value)||"",salt_gi:((N=document.getElementById("additiveSaltGi"))==null?void 0:N.value)||"",salt_unit:((k=document.getElementById("additiveSaltUnit"))==null?void 0:k.value)||"",salt_category:((g=document.getElementById("additiveSaltCategory"))==null?void 0:g.value)||"",citric_pct:document.getElementById("additiveCitricPct").value||"0",citric_name:((b=document.getElementById("additiveCitricName"))==null?void 0:b.value)||"",citric_gi:((E=document.getElementById("additiveCitricGi"))==null?void 0:E.value)||"",citric_unit:((d=document.getElementById("additiveCitricUnit"))==null?void 0:d.value)||"",citric_category:((v=document.getElementById("additiveCitricCategory"))==null?void 0:v.value)||""},mold:{water_weight:document.getElementById("moldWaterWeight").value||"",oil_pct:document.getElementById("moldOilPct").value||"65",shape:((T=document.getElementById("moldShape"))==null?void 0:T.value)||"loaf",cylinder_correction:!!((R=document.getElementById("moldCylinderCorrection"))!=null&&R.checked),cylinder_factor:((K=document.getElementById("moldCylinderFactor"))==null?void 0:K.value)||"0.85"},quality:{preset:((j=document.getElementById("qualityPreset"))==null?void 0:j.value)||"balanced",focus:Array.from(document.querySelectorAll(".quality-focus:checked")).map(U=>U.id)},lines:{ingredients:D("tool-ingredients","ingredient"),consumables:D("tool-consumables","consumable"),containers:D("tool-containers","container")},bulk_oils:e.bulkOilsModal&&typeof e.bulkOilsModal.serializeSelection=="function"?e.bulkOilsModal.serializeSelection():{mode:"all",selections:[]},updated_at:Date.now()};try{o.setItem(O,JSON.stringify(a));let U=document.getElementById("soapLastSaved");U&&(U.textContent=l(a.updated_at)),e.ui.showAutosaveToast()}catch{}}function C(){var c,w,F;let o=m();if(!o)return;let a=o.getItem(O);if(!a)return;let n=null;try{n=JSON.parse(a)}catch{return}if(!n||typeof n!="object")return;if(n.unit){let A=document.querySelector(`input[name="weight_unit"][value="${n.unit}"]`);A&&(A.checked=!0),e.units.setUnit(n.unit,{skipConvert:!0,skipAutoCalc:!0})}n.oil_total_target!==void 0&&(document.getElementById("oilTotalTarget").value=n.oil_total_target);let u=document.getElementById("oilRows");if(u&&(u.innerHTML="",(Array.isArray(n.oils)&&n.oils.length?n.oils:[{}]).forEach(_=>{let Q=e.oils.buildOilRow();Q.querySelector(".oil-typeahead").value=_.name||"",Q.querySelector(".oil-grams").value=_.grams||"",Q.querySelector(".oil-percent").value=_.percent||"",Q.querySelector(".oil-sap-koh").value=_.sap||"",Q.querySelector(".oil-iodine").value=_.iodine||"",Q.querySelector(".oil-fatty").value=_.fattyRaw||"",Q.querySelector(".oil-gi-id").value=_.gi||"";let r=Q.querySelector(".oil-default-unit");r&&(r.value=_.defaultUnit||"");let t=Q.querySelector(".oil-category");t&&(t.value=_.categoryName||""),u.appendChild(Q)})),n.lye_form){let A=document.getElementById("lyeSuperfat");A&&(A.value=n.lye_form.superfat||"5");let _=document.querySelector(`input[name="lye_type"][value="${n.lye_form.lye_type||"NaOH"}"]`);_&&(_.checked=!0);let Q=document.getElementById("lyePurity");Q&&(Q.value=n.lye_form.lye_purity||"100");let r=document.getElementById("waterMethod");r&&(r.value=n.lye_form.water_method||"percent");let t=document.getElementById("waterPct");t&&(t.value=n.lye_form.water_pct||"");let h=document.getElementById("lyeConcentration");h&&(h.value=n.lye_form.lye_concentration||"");let I=document.getElementById("waterRatio");I&&(I.value=n.lye_form.water_ratio||""),e.runner.applyLyeSelection()}if(n.additives){let A=document.getElementById("fragranceRows");if(A&&((c=e.fragrances)!=null&&c.buildFragranceRow)){A.innerHTML="";let T=Array.isArray(n.additives.fragrances)&&n.additives.fragrances.length?n.additives.fragrances:null;if(T)T.forEach(R=>{let K=e.fragrances.buildFragranceRow();K.querySelector(".fragrance-typeahead").value=R.name||"",K.querySelector(".fragrance-grams").value=R.grams||"",K.querySelector(".fragrance-percent").value=R.percent||"",K.querySelector(".fragrance-gi-id").value=R.gi||"";let j=K.querySelector(".fragrance-default-unit");j&&(j.value=R.defaultUnit||"");let U=K.querySelector(".fragrance-category");U&&(U.value=R.categoryName||""),A.appendChild(K)});else if(n.additives.fragrance_pct||n.additives.fragrance_name||n.additives.fragrance_gi){let R=e.fragrances.buildFragranceRow();R.querySelector(".fragrance-typeahead").value=n.additives.fragrance_name||"",R.querySelector(".fragrance-percent").value=n.additives.fragrance_pct||"3",R.querySelector(".fragrance-gi-id").value=n.additives.fragrance_gi||"",A.appendChild(R)}}document.getElementById("additiveLactatePct").value=n.additives.lactate_pct||"1";let _=document.getElementById("additiveLactateName");_&&(_.value=n.additives.lactate_name||"");let Q=document.getElementById("additiveLactateGi");Q&&(Q.value=n.additives.lactate_gi||"");let r=document.getElementById("additiveLactateUnit");r&&(r.value=n.additives.lactate_unit||"");let t=document.getElementById("additiveLactateCategory");t&&(t.value=n.additives.lactate_category||""),document.getElementById("additiveSugarPct").value=n.additives.sugar_pct||"1";let h=document.getElementById("additiveSugarName");h&&(h.value=n.additives.sugar_name||"");let I=document.getElementById("additiveSugarGi");I&&(I.value=n.additives.sugar_gi||"");let x=document.getElementById("additiveSugarUnit");x&&(x.value=n.additives.sugar_unit||"");let L=document.getElementById("additiveSugarCategory");L&&(L.value=n.additives.sugar_category||""),document.getElementById("additiveSaltPct").value=n.additives.salt_pct||"0.5";let M=document.getElementById("additiveSaltName");M&&(M.value=n.additives.salt_name||"");let N=document.getElementById("additiveSaltGi");N&&(N.value=n.additives.salt_gi||"");let k=document.getElementById("additiveSaltUnit");k&&(k.value=n.additives.salt_unit||"");let g=document.getElementById("additiveSaltCategory");g&&(g.value=n.additives.salt_category||""),document.getElementById("additiveCitricPct").value=n.additives.citric_pct||"0";let b=document.getElementById("additiveCitricName");b&&(b.value=n.additives.citric_name||"");let E=document.getElementById("additiveCitricGi");E&&(E.value=n.additives.citric_gi||"");let d=document.getElementById("additiveCitricUnit");d&&(d.value=n.additives.citric_unit||"");let v=document.getElementById("additiveCitricCategory");v&&(v.value=n.additives.citric_category||"")}if(n.mold){document.getElementById("moldWaterWeight").value=n.mold.water_weight||"",document.getElementById("moldOilPct").value=n.mold.oil_pct||"65";let A=document.getElementById("moldShape");A&&(A.value=n.mold.shape||"loaf");let _=document.getElementById("moldCylinderCorrection");_&&(_.checked=!!n.mold.cylinder_correction);let Q=document.getElementById("moldCylinderFactor");Q&&(Q.value=n.mold.cylinder_factor||"0.85");let r=document.getElementById("oilTotalTarget");(w=e.mold)!=null&&w.syncMoldPctFromTarget&&((F=e.mold)!=null&&F.syncTargetFromMold)&&(e.units.toGrams(r==null?void 0:r.value)>0?e.mold.syncMoldPctFromTarget():e.mold.syncTargetFromMold())}if(n.quality){let A=document.getElementById("qualityPreset");if(A){let _=n.quality.preset||"balanced",Q=Array.from(A.options).find(r=>r.value===_);A.value=Q?_:"balanced"}document.querySelectorAll(".quality-focus").forEach(_=>{_.checked=Array.isArray(n.quality.focus)&&n.quality.focus.includes(_.id)})}function p(A,_,Q){let r=document.getElementById(A);r&&(r.innerHTML="",(_||[]).forEach(t=>{let h=e.runner.buildLineRow(Q),I=h.querySelector(".tool-typeahead"),x=h.querySelector(".tool-gi-id"),L=h.querySelector(".tool-qty"),M=h.querySelector(".tool-unit");I&&(I.value=t.name||""),x&&(x.value=t.global_item_id||""),L&&t.quantity!==void 0&&t.quantity!==null&&(L.value=t.quantity),M&&t.unit&&Array.from(M.options).find(k=>k.value===t.unit)&&(M.value=t.unit),r.appendChild(h)}))}if(n.lines&&(p("tool-ingredients",n.lines.ingredients,"ingredient"),p("tool-consumables",n.lines.consumables,"consumable"),p("tool-containers",n.lines.containers,"container")),e.bulkOilsModal&&typeof e.bulkOilsModal.restoreState=="function"&&e.bulkOilsModal.restoreState(n.bulk_oils||null),e.runner.setWaterMethod(),e.mold.updateMoldShapeUI(),e.quality.updateQualityTargets(),e.oils.updateOilTotals(),e.additives.updateAdditivesOutput(e.oils.getTotalOilsGrams()),e.mold.updateMoldSuggested(),e.runner.calculateAll({consumeQuota:!1,showAlerts:!1}),n.updated_at){let A=document.getElementById("soapLastSaved");A&&(A.textContent=l(n.updated_at))}e.stages.updateStageStatuses(),e.ui.showSoapAlert("info","Restored your last soap tool session from this device.",{dismissible:!0,timeoutMs:5e3})}let f=null;function B(){f&&clearTimeout(f),f=setTimeout(S,350)}let i=null;function s(){i&&clearTimeout(i),i=setTimeout(()=>{e.runner.calculateAll({consumeQuota:!1,showAlerts:!1})},350)}e.storage={saveState:S,restoreState:C,serializeLines:D,serializeOils:H,restoreOilRow:y,queueStateSave:B,queueAutoCalc:s}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{toNumber:l}=e.helpers,m=e.state;function O(i){return i&&typeof i=="object"&&i.export&&typeof i.export.csv_text=="string"&&i.export.csv_text.trim()&&typeof i.export.sheet_html=="string"&&i.export.sheet_html.trim()}function D(i){var a;let s=l(i==null?void 0:i.totalOils),o=(a=e.oils)!=null&&a.getTotalOilsGrams?e.oils.getTotalOilsGrams():0;return s<=0||o<=0?!1:Math.abs(s-o)>.01}async function H(){var s,o;let i=m.lastCalc;return(!i||D(i)||!O(i))&&(i=await e.runner.calculateAll({consumeQuota:!1,showAlerts:!0})),i?O(i)?i:((o=e.ui)!=null&&o.showSoapAlert&&e.ui.showSoapAlert("danger","Export payload is missing. Please run the calculation again.",{dismissible:!0,timeoutMs:6e3}),null):((s=e.ui)!=null&&s.showSoapAlert&&e.ui.showSoapAlert("warning","Run a calculation before exporting or printing.",{dismissible:!0,timeoutMs:6e3}),null)}function q(i,s){let o=new Blob([i],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}function y(i){var o;let s=P.open("","_blank","width=960,height=720");if(!s){(o=e.ui)!=null&&o.showSoapAlert&&e.ui.showSoapAlert("warning","Pop-up blocked. Allow pop-ups to print the sheet.",{dismissible:!0,timeoutMs:6e3});return}s.document.open(),s.document.write(i),s.document.close(),s.focus(),s.onload=()=>s.print()}function S(){let i=document.getElementById("saveSoapTool");i&&i.addEventListener("click",async function(){try{let s=m.lastCalc||await e.runner.calculateAll({consumeQuota:!1,showAlerts:!0});if(!s)return;let o=await e.runner.buildSoapRecipePayload(s);if(!o){e.ui.showSoapAlert("danger","Unable to prepare the recipe payload. Please try again.",{dismissible:!0,persist:!0});return}m.lastRecipePayload=o;try{let a=e.helpers.getStorage();a&&a.setItem("soap_recipe_payload",JSON.stringify(o))}catch{}P.SOAP_RECIPE_DTO=o,e.ui.showSoapAlert("info","Recipe payload is ready. Push is stubbed for now; no data has been sent.",{dismissible:!0,timeoutMs:7e3})}catch{e.ui.showSoapAlert("danger","Unable to prepare the recipe payload. Please try again.",{dismissible:!0,persist:!0})}})}function C(){let i=document.getElementById("exportSoapCsv");i&&i.addEventListener("click",async function(){let s=await H();s&&q(s.export.csv_text,"soap_formula.csv")})}function f(){let i=document.getElementById("printSoapSheet");i&&i.addEventListener("click",async function(){let s=await H();s&&y(s.export.sheet_html)})}function B(){S(),C(),f()}e.eventsExports={bind:B}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},l=e.state;function m(y){if(!y)return;let S=document.getElementById("addOil"),C=document.getElementById("normalizeOils");S&&(S.dataset.bound="direct",S.addEventListener("click",function(){y.appendChild(e.oils.buildOilRow()),e.stages.updateStageStatuses(),e.storage.queueStateSave()})),C&&(C.dataset.bound="direct",C.addEventListener("click",function(){e.oils.normalizeOils(),e.stages.updateStageStatuses(),e.storage.queueStateSave(),e.storage.queueAutoCalc()})),y.addEventListener("input",function(f){f.target.classList.contains("oil-grams")&&(l.lastOilEdit={row:f.target.closest(".oil-row"),field:"grams"}),f.target.classList.contains("oil-percent")&&(l.lastOilEdit={row:f.target.closest(".oil-row"),field:"percent"}),(f.target.classList.contains("oil-grams")||f.target.classList.contains("oil-percent")||f.target.classList.contains("oil-typeahead"))&&(f.target.classList.contains("oil-typeahead")&&e.oils.setSelectedOilProfileFromRow(f.target.closest(".oil-row")),e.oils.updateOilTotals(),e.storage.queueStateSave(),e.storage.queueAutoCalc())}),y.addEventListener("focusin",function(f){f.target.classList.contains("oil-typeahead")&&e.oils.setSelectedOilProfileFromRow(f.target.closest(".oil-row"))}),y.addEventListener("focusout",function(f){f.target.classList.contains("oil-typeahead")&&e.oils.clearSelectedOilProfile(),f.target.classList.contains("oil-grams")&&e.oils.validateOilEntry(f.target.closest(".oil-row"),"grams"),f.target.classList.contains("oil-percent")&&e.oils.validateOilEntry(f.target.closest(".oil-row"),"percent")}),y.addEventListener("keydown",function(f){f.key==="Enter"&&(f.target.classList.contains("oil-grams")&&(f.preventDefault(),e.oils.validateOilEntry(f.target.closest(".oil-row"),"grams")),f.target.classList.contains("oil-percent")&&(f.preventDefault(),e.oils.validateOilEntry(f.target.closest(".oil-row"),"percent")))}),y.addEventListener("mouseover",function(f){if(!f.target.classList.contains("oil-typeahead"))return;let B=f.target.closest(".oil-row");!B||B===l.lastPreviewRow||(l.lastPreviewRow=B,e.oils.setSelectedOilProfileFromRow(B))}),y.addEventListener("mouseout",function(f){f.target.classList.contains("oil-typeahead")&&e.oils.clearSelectedOilProfile()}),y.addEventListener("click",function(f){let B=f.target.closest(".oil-profile-open");if(B){let s=B.closest(".oil-row");if(s){e.oils.setSelectedOilProfileFromRow(s);let o=document.getElementById("oilProfileModal");o&&P.bootstrap&&P.bootstrap.Modal.getOrCreateInstance(o).show()}return}let i=f.target.closest(".remove-oil");if(i){let s=i.closest(".oil-row");s&&(l.lastRemovedOil=e.oils.serializeOilRow(s),l.lastRemovedOilIndex=Array.from(s.parentElement.children).indexOf(s),e.ui.showUndoToast("Oil removed.")),s&&l.lastOilEdit&&l.lastOilEdit.row===s&&(l.lastOilEdit=null,e.oils.clearSelectedOilProfile()),s&&s.remove(),e.oils.updateOilTotals(),e.stages.updateStageStatuses(),e.storage.queueStateSave()}})}function O(y){if(!y)return;let S=document.getElementById("addFragrance");S&&(S.dataset.bound="direct",S.addEventListener("click",function(){y.appendChild(e.fragrances.buildFragranceRow()),e.fragrances.updateFragranceTotals(e.oils.getTotalOilsGrams()),e.stages.updateStageStatuses(),e.storage.queueStateSave()})),y.addEventListener("input",function(C){C.target.classList.contains("fragrance-grams")&&(e.state.lastFragranceEdit={row:C.target.closest(".fragrance-row"),field:"grams"}),C.target.classList.contains("fragrance-percent")&&(e.state.lastFragranceEdit={row:C.target.closest(".fragrance-row"),field:"percent"}),(C.target.classList.contains("fragrance-grams")||C.target.classList.contains("fragrance-percent")||C.target.classList.contains("fragrance-typeahead"))&&(e.fragrances.updateFragranceTotals(e.oils.getTotalOilsGrams()),e.stages.updateStageStatuses(),e.storage.queueStateSave(),e.storage.queueAutoCalc())}),y.addEventListener("click",function(C){var i;let f=C.target.closest(".remove-fragrance");if(!f)return;let B=f.closest(".fragrance-row");B&&((i=e.state.lastFragranceEdit)==null?void 0:i.row)===B&&(e.state.lastFragranceEdit=null),B&&B.remove(),e.fragrances.updateFragranceTotals(e.oils.getTotalOilsGrams()),e.stages.updateStageStatuses(),e.storage.queueStateSave(),e.storage.queueAutoCalc()})}function D({oilRows:y,fragranceRows:S}){let C=document.getElementById("soapStageTabContent");if(!C)return;let f=()=>{let B=C.querySelector(".tab-pane.active")||C.querySelector(".tab-pane.show.active");return B?B.querySelector(".soap-stage-body")||B:null};C.addEventListener("wheel",B=>{let i=B.target;if(!(i instanceof HTMLElement))return;let s=i.closest('input[type="number"]');if(!(s instanceof HTMLInputElement))return;let o=f();if(!(o instanceof HTMLElement)||o.scrollHeight<=o.clientHeight+1)return;document.activeElement===s&&typeof s.blur=="function"&&s.blur();let a=o.scrollTop<=0,n=o.scrollTop+o.clientHeight>=o.scrollHeight-1;B.deltaY<0&&a||B.deltaY>0&&n||(o.scrollTop+=B.deltaY,B.preventDefault())},{passive:!1}),C.addEventListener("click",B=>{let i=B.target.closest("[data-stage-action]"),s=B.target.closest("[data-soap-action]");if(!i&&!s)return;if(B.preventDefault(),B.stopPropagation(),document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur(),s){if(s.dataset.bound==="direct")return;let n=s.dataset.soapAction;n==="add-oil"&&y&&(y.appendChild(e.oils.buildOilRow()),e.stages.updateStageStatuses(),e.storage.queueStateSave()),n==="normalize-oils"&&(e.oils.normalizeOils(),e.stages.updateStageStatuses(),e.storage.queueStateSave(),e.storage.queueAutoCalc()),n==="add-fragrance"&&S&&(S.appendChild(e.fragrances.buildFragranceRow()),e.fragrances.updateFragranceTotals(e.oils.getTotalOilsGrams()),e.stages.updateStageStatuses(),e.storage.queueStateSave());return}let o=i.dataset.stageAction,a=Number(i.dataset.stageIndex);Number.isNaN(a)||(o==="prev"&&e.stages.openStageByIndex(Math.max(0,a-1)),o==="next"&&e.stages.openStageByIndex(Math.min(e.constants.STAGE_CONFIGS.length-1,a+1)),o==="reset"&&e.stages.resetStage(a+1))})}function H(){let y=document.getElementById("soapUndoRemove");y&&y.addEventListener("click",()=>{l.lastRemovedOil&&(e.storage.restoreOilRow(l.lastRemovedOil,l.lastRemovedOilIndex||0),l.lastRemovedOil=null,l.lastRemovedOilIndex=null,e.oils.updateOilTotals(),e.storage.queueStateSave(),e.storage.queueAutoCalc())})}function q(){let y=document.getElementById("oilRows"),S=document.getElementById("fragranceRows");return m(y),O(S),D({oilRows:y,fragranceRows:S}),H(),{oilRows:y,fragranceRows:S}}e.eventsRows={bind:q}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{};function l(){let i=document.getElementById("soapStageTabList");if(!i)return;let s=()=>{i.querySelectorAll(".nav-item").forEach(a=>a.classList.remove("is-expanded"));let o=i.querySelector(".nav-link.active");o&&o.closest(".nav-item")&&o.closest(".nav-item").classList.add("is-expanded")};i.addEventListener("shown.bs.tab",()=>{s(),e.layout.scheduleStageHeightSync()}),s()}function m(){let i=document.getElementById("resultsCardToggle"),s=document.getElementById("resultsCard");!i||!s||i.addEventListener("click",()=>{s.classList.toggle("is-collapsed");let o=s.classList.contains("is-collapsed");i.setAttribute("aria-expanded",(!o).toString());let a=o?"Expand formula details":"Collapse formula details";i.setAttribute("aria-label",a),i.setAttribute("title",a);let n=i.querySelector("i");n&&(n.classList.toggle("fa-chevron-down",o),n.classList.toggle("fa-chevron-up",!o))})}function O(){document.querySelectorAll('input[name="weight_unit"]').forEach(i=>{i.addEventListener("change",function(){e.units.setUnit(this.value),e.storage.queueStateSave()})})}function D(){let i=()=>{var c;e.oils.scaleOilsToTarget(void 0,{force:!0}),e.oils.updateOilTotals(),(c=e.mold)!=null&&c.updateWetBatterWarning&&e.mold.updateWetBatterWarning(null)},s=document.getElementById("oilTotalTarget");s&&s.addEventListener("input",function(){e.mold.syncMoldPctFromTarget(),i(),e.storage.queueStateSave(),e.storage.queueAutoCalc()});let o=document.getElementById("moldWaterWeight");o&&o.addEventListener("input",function(){e.mold.syncTargetFromMold(),i(),e.storage.queueStateSave(),e.storage.queueAutoCalc()});let a=document.getElementById("moldOilPct");a&&a.addEventListener("input",function(){e.mold.syncTargetFromMold(),i(),e.storage.queueStateSave(),e.storage.queueAutoCalc()});let n=document.getElementById("moldShape");n&&n.addEventListener("change",function(){e.mold.updateMoldShapeUI(),e.mold.syncTargetFromMold(),i(),e.storage.queueStateSave(),e.storage.queueAutoCalc()});let u=document.getElementById("moldCylinderCorrection");u&&u.addEventListener("change",function(){e.mold.syncTargetFromMold(),i(),e.storage.queueStateSave(),e.storage.queueAutoCalc()});let p=document.getElementById("moldCylinderFactor");p&&p.addEventListener("input",function(){e.mold.syncTargetFromMold(),i(),e.storage.queueStateSave(),e.storage.queueAutoCalc()})}function H(){let i=document.getElementById("waterMethod");i&&i.addEventListener("change",function(){e.runner.setWaterMethod(),e.storage.queueStateSave(),e.storage.queueAutoCalc()}),document.querySelectorAll('input[name="lye_type"]').forEach(s=>{s.addEventListener("change",function(){e.runner.applyLyeSelection(),e.additives.updateAdditivesOutput(e.oils.getTotalOilsGrams()),e.storage.queueStateSave(),e.storage.queueAutoCalc()})}),["lyeSuperfat","lyePurity","waterPct","lyeConcentration","waterRatio"].forEach(s=>{let o=document.getElementById(s);o&&["input","change"].forEach(a=>{o.addEventListener(a,()=>{e.storage.queueStateSave(),e.storage.queueAutoCalc()})})})}function q(){[{pctId:"additiveLactatePct",weightId:"additiveLactateWeight"},{pctId:"additiveSugarPct",weightId:"additiveSugarWeight"},{pctId:"additiveSaltPct",weightId:"additiveSaltWeight"},{pctId:"additiveCitricPct",weightId:"additiveCitricWeight"}].forEach(({pctId:s,weightId:o})=>{let a=document.getElementById(s),n=document.getElementById(o);a&&a.addEventListener("input",()=>{let u=e.oils.getTotalOilsGrams();e.additives.syncAdditivePair({pctId:s,weightId:o,sourceField:"pct",totalOils:u}),e.additives.updateAdditivesOutput(u),e.stages.updateStageStatuses(),e.storage.queueStateSave(),e.storage.queueAutoCalc()}),n&&n.addEventListener("input",()=>{let u=e.oils.getTotalOilsGrams();e.additives.syncAdditivePair({pctId:s,weightId:o,sourceField:"weight",totalOils:u}),e.additives.updateAdditivesOutput(u),e.stages.updateStageStatuses(),e.storage.queueStateSave(),e.storage.queueAutoCalc()})}),document.querySelectorAll(".additive-typeahead").forEach(s=>{s.addEventListener("input",()=>{e.storage.queueStateSave()})})}function y(){let i=document.getElementById("qualityPreset");i&&i.addEventListener("change",function(){e.quality.updateQualityTargets(),e.storage.queueStateSave()}),document.querySelectorAll(".quality-focus").forEach(o=>{o.addEventListener("change",function(){e.quality.updateQualityTargets(),e.storage.queueStateSave()})});let s=document.getElementById("applyQualityTargets");s&&s.addEventListener("click",function(){e.quality.applyQualityTargets()}),document.querySelectorAll(".quality-target-marker").forEach(o=>{o.addEventListener("click",()=>e.quality.applyQualityTargets()),o.addEventListener("keydown",a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),e.quality.applyQualityTargets())})})}function S(){document.querySelectorAll(".stub-btn").forEach(s=>{s.addEventListener("click",function(){let o=this.dataset.stubKind,a=this.dataset.stubName;e.runner.addStubLine(o,a),e.storage.queueStateSave()})});let i=document.getElementById("soapToolPage");i&&(i.addEventListener("click",function(s){s.target.classList.contains("tool-remove")&&e.storage.queueStateSave()}),i.addEventListener("input",function(s){s.target.matches("input, select, textarea")&&(e.storage.queueStateSave(),e.ui.validateNumericField(s.target),e.stages.updateStageStatuses(),e.ui.flashStage(s.target.closest(".soap-stage-card")))}),i.addEventListener("change",function(s){s.target.matches("input, select, textarea")&&(e.storage.queueStateSave(),e.ui.validateNumericField(s.target),e.stages.updateStageStatuses())}))}function C(){let i=document.getElementById("addToolIngredient");i&&i.addEventListener("click",function(){let a=document.getElementById("tool-ingredients");a&&a.appendChild(e.runner.buildLineRow("ingredient")),e.storage.queueStateSave()});let s=document.getElementById("addToolConsumable");s&&s.addEventListener("click",function(){let a=document.getElementById("tool-consumables");a&&a.appendChild(e.runner.buildLineRow("consumable")),e.storage.queueStateSave()});let o=document.getElementById("addToolContainer");o&&o.addEventListener("click",function(){let a=document.getElementById("tool-containers");a&&a.appendChild(e.runner.buildLineRow("container")),e.storage.queueStateSave()})}function f(){let i=document.getElementById("calcLyeBtn");i&&i.addEventListener("click",async function(){await e.runner.calculateAll({consumeQuota:!0,showAlerts:!0}),e.storage.queueStateSave()})}function B(){l(),m(),O(),D(),H(),q(),y(),S(),C(),f()}e.eventsForms={bind:B}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{};function l(){let O=document.getElementById("soapMobileDrawer"),D=document.getElementById("soapMobileDrawerContent"),H=document.getElementById("soapMobileDrawerTitle"),q=document.getElementById("soapDrawerEmpty"),y=document.getElementById("soapDrawerClose"),S=document.getElementById("soapQualityCard"),C=document.getElementById("resultsCard");if(!O||!D||!H||!S||!C)return;let f=S.parentElement,B=C.parentElement,i=new Map,s=null,o=()=>P.matchMedia("(max-width: 767px)").matches,a=r=>r==="quality"?S:C,n=r=>r==="quality"?f:B,u=r=>r==="quality"?"Display":"Results",p=r=>{let t=i.get(r);t||(t=document.createElement("div"),t.className="soap-card-placeholder",i.set(r,t)),t.style.height=`${r.offsetHeight}px`,r.parentElement&&r.parentElement!==D&&!t.parentElement&&r.parentElement.insertBefore(t,r)},c=r=>{r&&(p(r),D.appendChild(r))},w=(r,t)=>{let h=i.get(r);h&&h.parentElement?h.replaceWith(r):t&&r.parentElement!==t&&t.appendChild(r)},F=()=>{if(!q)return;let r=s==="results",t=getComputedStyle(C).display!=="none";q.classList.toggle("d-none",!r||t)},A=r=>{o()&&(s&&s!==r&&w(a(s),n(s)),c(a(r)),H.textContent=u(r),s=r,O.classList.add("is-open"),F())},_=()=>{s&&(w(a(s),n(s)),s=null,O.classList.remove("is-open"),F())};O.querySelectorAll("[data-drawer-target]").forEach(r=>{r.addEventListener("click",()=>{let t=r.dataset.drawerTarget;t&&(O.classList.contains("is-open")&&s===t?_():A(t))})}),y&&y.addEventListener("click",_),P.addEventListener("resize",()=>{!o()&&s&&_()}),new MutationObserver(()=>F()).observe(C,{attributes:!0,attributeFilter:["style","class"]})}function m(){l(),P.addEventListener("resize",e.layout.scheduleStageHeightSync),P.addEventListener("load",e.layout.scheduleStageHeightSync)}e.eventsMobile={bind:m}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{},{LACTATE_CATEGORY_SET:l,SUGAR_CATEGORY_SET:m,SALT_CATEGORY_SET:O,CITRIC_CATEGORY_SET:D}=e.constants;function H({oilRows:q,fragranceRows:y}={}){var S,C;e.additives.attachAdditiveTypeahead("additiveLactateName","additiveLactateGi",l,"additiveLactateUnit","additiveLactateCategory"),e.additives.attachAdditiveTypeahead("additiveSugarName","additiveSugarGi",m,"additiveSugarUnit","additiveSugarCategory"),e.additives.attachAdditiveTypeahead("additiveSaltName","additiveSaltGi",O,"additiveSaltUnit","additiveSaltCategory"),e.additives.attachAdditiveTypeahead("additiveCitricName","additiveCitricGi",D,"additiveCitricUnit","additiveCitricCategory"),e.ui.applyHelperVisibility(),e.quality.initQualityTooltips(),e.runner.applyLyeSelection(),e.runner.setWaterMethod(),e.mold.updateMoldShapeUI(),e.quality.setQualityRangeBars(),e.units.updateUnitLabels(),e.quality.updateQualityTargets(),e.additives.updateAdditivesOutput(e.oils.getTotalOilsGrams()),e.stages.updateStageStatuses(),e.storage.restoreState(),q&&!q.querySelector(".oil-row")&&q.appendChild(e.oils.buildOilRow()),y&&!y.querySelector(".fragrance-row")&&(S=e.fragrances)!=null&&S.buildFragranceRow&&y.appendChild(e.fragrances.buildFragranceRow()),(C=e.fragrances)!=null&&C.updateFragranceTotals&&e.fragrances.updateFragranceTotals(e.oils.getTotalOilsGrams()),e.layout.scheduleStageHeightSync()}e.eventsInit={bind:H}})(window);(function(P){"use strict";let e=P.SoapTool=P.SoapTool||{};function l(){var O,D,H,q,y;let m=(O=e.eventsRows)!=null&&O.bind?e.eventsRows.bind():{oilRows:null,fragranceRows:null};(D=e.eventsForms)!=null&&D.bind&&e.eventsForms.bind(m),(H=e.eventsExports)!=null&&H.bind&&e.eventsExports.bind(m),(q=e.eventsMobile)!=null&&q.bind&&e.eventsMobile.bind(m),(y=e.eventsInit)!=null&&y.bind&&e.eventsInit.bind(m)}l()})(window);
