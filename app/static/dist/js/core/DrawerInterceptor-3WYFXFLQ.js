var o=class{constructor(e=3e4){this.cache=new Map,this.defaultTtl=e}get(e){if(this.cache.has(e)){let t=this.cache.get(e);if(Date.now()<t.expiresAt)return t.value;this.cache.delete(e)}return null}set(e,t,i){let r=Date.now()+(i||this.defaultTtl);this.cache.set(e,{value:t,expiresAt:r})}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}clearPrefix(e){for(let t of Array.from(this.cache.keys()))String(t).startsWith(e)&&this.cache.delete(t)}},s=new o,_=new o(3e4);(function(){if(window.__drawerInterceptorInstalled)return;window.__drawerInterceptorInstalled=!0;let h=window.fetch.bind(window),e=new Set;window.fetch=async function(t,i){let r=await h(t,i);try{let n=r.clone();if(!(n.headers.get("content-type")||"").includes("application/json"))return r;let a=await n.json(),c=a&&(a.drawer_payload||a.data&&a.data.drawer_payload),p=typeof t=="string"?t:t.url;if(c&&window.drawerProtocol){let d=c.correlation_id||`${c.error_type||"generic"}:${c.error_code||"unknown"}`,l=`drawer:${c.error_type}:${c.error_code}:${c.modal_url}`;if(s.get(l))return r;if(!e.has(d)){e.add(d),s.set(l,!0,3e4);let w={...c,retry_callback:c.retry_callback||null};window.dispatchEvent(new CustomEvent("openDrawer",{detail:w})),setTimeout(()=>{e.delete(d),s.delete(l)},6e4)}}}catch(n){console.warn("DrawerInterceptor: failed to inspect response",n)}return r}})();
