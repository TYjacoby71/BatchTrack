{% extends 'layout.html' %}

{% block title %}BatchTrack.com | Artisan Plan Signup{% endblock %}

{% block content %}
{% set primary_tier_id = (signup_primary_tier_id or preselected_tier or default_tier_id)|string %}
{% set primary_tier = available_tiers.get(primary_tier_id) if available_tiers else none %}
{% set primary_lifetime_offer = (lifetime_offers | first) if lifetime_offers else none %}
<div class="py-4">
    <div class="row justify-content-center">
        <div class="col-xl-10 col-xxl-9 signup-layout-col">
            <div class="signup-shell">
                <div class="text-center mb-5">
                    <h2 class="mb-1">
                        The Artisan Plan
                    </h2>
                    <p class="text-muted mb-0">Full Access to the BatchTrack Ecosystem</p>
                </div>
                <div>
                    {% if oauth_user_info %}
                    <div class="alert alert-success mb-4">
                        <i class="fas fa-check-circle me-2"></i>
                        Signed in with {{ (oauth_user_info.oauth_provider or 'OAuth')|title }} as <strong>{{ oauth_user_info.email }}</strong>
                    </div>
                    {% endif %}

                    {% set google_oauth_enabled = (oauth_providers.google if oauth_providers is defined else false) %}
                    {% set facebook_oauth_enabled = (oauth_providers.facebook if oauth_providers is defined else false) %}
                    {% if not oauth_user_info and (google_oauth_enabled or facebook_oauth_enabled) %}
                    <div class="text-center mb-4">
                        <p class="text-muted small mb-2">Optional: sign in before checkout for faster setup.</p>
                        <div class="d-flex flex-column flex-md-row gap-2 justify-content-center">
                            {% if google_oauth_enabled %}
                            <a href="{{ url_for('auth.oauth_google', next=request.full_path) }}" class="btn btn-outline-danger">
                                <i class="fab fa-google me-2"></i>Continue with Google
                            </a>
                            {% endif %}
                            {% if facebook_oauth_enabled %}
                            <a href="{{ url_for('auth.oauth_facebook', next=request.full_path) }}" class="btn btn-outline-primary">
                                <i class="fab fa-facebook-f me-2"></i>Continue with Facebook
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <section class="pricing-section mb-5">
                        {% if not primary_tier %}
                        <div class="alert alert-warning mb-0">
                            No customer-facing tier is configured yet. Please configure at least one Stripe-backed tier.
                        </div>
                        {% else %}
                        <h4 class="mb-3 text-center">Choose Your Access</h4>
                        <div class="pricing-cards-grid">
                            <article
                                class="plan-choice-card h-100 active-offer"
                                id="monthlyPlanCard"
                                data-plan-kind="monthly"
                                role="button"
                                tabindex="0"
                                aria-pressed="true"
                            >
                                <div class="plan-chip mb-2">Monthly</div>
                                <h4 class="h5 fw-bold mb-1">Monthly Artisan Subscription</h4>
                                <div class="plan-price mb-2" data-role="priceText">$24.99 / Month</div>
                                <p class="plan-includes mb-1">Full access to the core Batching Engine.</p>
                                <p class="plan-subtext mb-0" data-role="statusText">Includes a 14-day Free Trial.</p>
                                <p class="plan-subtext mb-0">Cancel anytime.</p>
                                <p class="plan-subtext text-muted mb-0 d-none" data-role="fallbackText"></p>
                            </article>

                            {% if has_lifetime_capacity and primary_lifetime_offer %}
                            <article
                                class="plan-choice-card h-100"
                                id="lifetimePlanCard"
                                data-plan-kind="lifetime"
                                role="button"
                                tabindex="0"
                                aria-pressed="false"
                            >
                                <div class="plan-chip plan-chip-lifetime mb-2">Founding Member</div>
                                <h4 class="h5 fw-bold mb-1">Founding Member Lifetime Pass</h4>
                                <div class="plan-price mb-2" data-role="priceText">$197 (One-Time Payment)</div>
                                <p class="plan-includes mb-1">Lifetime access to every feature listed above.</p>
                                <p class="plan-subtext mb-0">No monthly subscriptions or price hikes ever.</p>
                                <p class="plan-subtext mb-0">Early-access status to help finalize the Global Library.</p>
                                <p class="plan-subtext mb-0" data-role="statusText">
                                    Limited to the first 300 seats. Only {{ primary_lifetime_offer.display_spots_left }} remain.
                                </p>
                                <p class="plan-subtext text-muted mb-0 d-none" data-role="fallbackText"></p>
                            </article>
                            {% else %}
                            <article
                                class="plan-choice-card h-100"
                                id="yearlyPlanCard"
                                data-plan-kind="yearly"
                                role="button"
                                tabindex="0"
                                aria-pressed="false"
                            >
                                <div class="plan-chip mb-2">Yearly</div>
                                <h4 class="h5 fw-bold mb-1">Artisan Plan</h4>
                                <div class="plan-price mb-2" data-role="priceText">
                                    {{ primary_tier.yearly_price_display or 'Yearly pricing at secure checkout' }}
                                </div>
                                <p class="plan-includes mb-1">Full access to the core Batching Engine.</p>
                                <p class="plan-subtext mb-0" data-role="statusText">Billed yearly.</p>
                                <p class="plan-subtext text-muted mb-0 d-none" data-role="fallbackText"></p>
                            </article>
                            {% endif %}
                        </div>
                        {% endif %}
                    </section>

                    <div class="text-center mb-4" id="topCheckoutSection">
                        <button type="button" class="btn btn-success btn-lg px-4" data-role="proceedCheckoutBtn" onclick="proceedToPayment()">
                            <i class="fas fa-credit-card me-2"></i>Proceed to Checkout
                        </button>
                    </div>

                    <div class="card shadow-sm mb-5" id="tierFeaturesCard">
                        <div class="card-body p-4">
                            <h4 class="mb-1" id="featuresCardTitle">Full Access to the BatchTrack Ecosystem</h4>
                            <p class="text-muted mb-3" id="selectedTierText">Included with your Early-Access Seat</p>
                            <div id="lifetimeCounterMessage" class="alert alert-warning py-2 px-3 small d-none mb-3"></div>
                            <ul class="features-checklist mb-0" id="featuresChecklist"></ul>
                        </div>
                    </div>

                    <div class="text-center" id="confirmationSection">
                        <button type="button" class="btn btn-success btn-lg px-4" data-role="proceedCheckoutBtn" onclick="proceedToPayment()">
                            <i class="fas fa-credit-card me-2"></i>Proceed to Checkout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let selectedTier = {{ primary_tier_id|tojson }};
let selectedLifetimeTier = {{ selected_lifetime_tier|tojson }};
const initialBillingMode = {{ billing_mode|tojson }};
const standardBillingCycle = {{ standard_billing_cycle|tojson }};
const availableTiers = {{ available_tiers|tojson }};
const lifetimeOffers = {{ lifetime_offers|tojson }};
const signupSource = {{ signup_source|tojson }};
const referralCode = {{ referral_code|tojson }};
const initialPromoCode = {{ promo_code|tojson }};
const hasLifetimeCapacity = Boolean({{ has_lifetime_capacity|tojson }});
const VALID_PLAN_KINDS = ['lifetime', 'monthly', 'yearly'];

const lifetimeByKey = Object.fromEntries(
    lifetimeOffers
        .filter((offer) => offer && offer.key)
        .map((offer) => [String(offer.key), offer])
);
const lifetimeByTier = Object.fromEntries(
    lifetimeOffers
        .filter((offer) => offer && offer.tier_id)
        .map((offer) => [String(offer.tier_id), offer])
);

function getTierData() {
    return availableTiers[String(selectedTier || '')] || null;
}

function getLifetimeOffer() {
    return lifetimeByTier[String(selectedTier || '')] || null;
}

function isConfiguredPrice(priceCopy) {
    const normalized = String(priceCopy || '').trim().toLowerCase();
    return Boolean(normalized) && normalized !== 'contact sales';
}

function parsePriceAmount(priceCopy) {
    const normalized = String(priceCopy || '').replace(/,/g, '');
    const match = normalized.match(/(\d+(?:\.\d{1,2})?)/);
    if (!match) return null;
    const parsed = Number.parseFloat(match[1]);
    return Number.isFinite(parsed) ? parsed : null;
}

function formatUsd(amount) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    }).format(amount);
}

function getYearlyPriceDisplay(monthlyPrice, tierData) {
    const monthlyAmount = parsePriceAmount(monthlyPrice);
    if (monthlyAmount !== null) {
        return `${formatUsd(monthlyAmount * 10)} / year`;
    }
    return tierData.yearly_price_display || 'Yearly pricing at secure checkout';
}

function getInitialPlanKind() {
    if (initialBillingMode === 'lifetime' && hasLifetimeCapacity) {
        return 'lifetime';
    }
    if (
        initialBillingMode === 'standard'
        && standardBillingCycle === 'yearly'
        && !hasLifetimeCapacity
    ) {
        return standardBillingCycle;
    }
    return 'monthly';
}

let selectedPlanKind = getInitialPlanKind();

function getPlanState(planKind) {
    const tierData = getTierData();
    const monthlyPriceCopy = '$24.99 / Month';
    const lifetimePriceCopy = '$197 (One-Time Payment)';
    if (!tierData) {
        return {
            effectivePlanKind: 'unavailable',
            modeBadgeText: 'Unavailable',
            priceText: 'â€”',
            statusText: 'Tier configuration unavailable.',
            fallbackText: '',
            isUnavailable: true,
            lifetimeOffer: null,
            fallbackFromLifetime: false,
        };
    }

    const monthlyPrice = tierData.monthly_price_display || tierData.price_display || 'Contact Sales';
    const yearlyPrice = getYearlyPriceDisplay(monthlyPrice, tierData);
    const hasMonthly = isConfiguredPrice(monthlyPrice);
    const hasYearly = Boolean(yearlyPrice);
    const lifetimeOffer = getLifetimeOffer();
    const hasLifetime = Boolean(
        lifetimeOffer &&
        lifetimeOffer.tier_id &&
        lifetimeOffer.has_remaining &&
        lifetimeOffer.lifetime_lookup_key
    );

    let effectivePlanKind = planKind;
    let modeBadgeText = planKind === 'lifetime' ? 'Lifetime' : (planKind === 'yearly' ? 'Yearly' : 'Monthly');
    let priceText = monthlyPriceCopy;
    let statusText = 'Includes a 14-day Free Trial.';
    let fallbackText = '';
    let fallbackFromLifetime = false;
    let isUnavailable = false;

    if (planKind === 'lifetime') {
        if (hasLifetime) {
            effectivePlanKind = 'lifetime';
            modeBadgeText = 'Lifetime';
            priceText = lifetimePriceCopy;
            statusText = `Limited to the first 300 seats. Only ${lifetimeOffer.display_spots_left} remain.`;
        } else if (hasMonthly) {
            effectivePlanKind = 'monthly';
            modeBadgeText = 'Monthly fallback';
            priceText = monthlyPriceCopy;
            statusText = 'Founding Member Lifetime Pass is currently sold out.';
            fallbackText = 'Continuing with monthly billing.';
            fallbackFromLifetime = true;
        } else if (hasYearly) {
            effectivePlanKind = 'yearly';
            modeBadgeText = 'Yearly fallback';
            priceText = yearlyPrice;
            statusText = 'Founding Member Lifetime Pass is currently sold out.';
            fallbackText = 'Continuing with yearly billing.';
            fallbackFromLifetime = true;
        } else {
            effectivePlanKind = 'unavailable';
            modeBadgeText = 'Unavailable';
            priceText = 'Contact Sales';
            statusText = 'No checkout price configured yet.';
            isUnavailable = true;
        }
    } else if (planKind === 'yearly') {
        if (hasLifetimeCapacity) {
            effectivePlanKind = hasMonthly ? 'monthly' : 'unavailable';
            modeBadgeText = hasMonthly ? 'Monthly fallback' : 'Unavailable';
            priceText = hasMonthly ? monthlyPriceCopy : 'Contact Sales';
            statusText = hasMonthly ? 'Yearly is hidden while lifetime seats remain.' : 'Yearly is hidden while lifetime seats remain.';
            fallbackText = hasMonthly ? 'Continuing with monthly billing.' : '';
            isUnavailable = !hasMonthly;
        } else if (hasYearly) {
            effectivePlanKind = 'yearly';
            modeBadgeText = 'Yearly';
            priceText = yearlyPrice;
            statusText = 'Billed yearly subscription (10x monthly display).';
        } else if (hasMonthly) {
            effectivePlanKind = 'monthly';
            modeBadgeText = 'Monthly fallback';
            priceText = monthlyPriceCopy;
            statusText = 'Yearly pricing unavailable.';
            fallbackText = 'Continuing with monthly billing.';
        } else {
            effectivePlanKind = 'unavailable';
            modeBadgeText = 'Unavailable';
            priceText = 'Contact Sales';
            statusText = 'Yearly pricing unavailable.';
            isUnavailable = true;
        }
    } else {
        if (hasMonthly) {
            effectivePlanKind = 'monthly';
            modeBadgeText = 'Monthly';
            priceText = monthlyPriceCopy;
            statusText = 'Includes a 14-day Free Trial.';
        } else if (!hasLifetimeCapacity && hasYearly) {
            effectivePlanKind = 'yearly';
            modeBadgeText = 'Yearly fallback';
            priceText = yearlyPrice;
            statusText = 'Monthly pricing unavailable.';
            fallbackText = 'Continuing with yearly billing.';
        } else {
            effectivePlanKind = 'unavailable';
            modeBadgeText = 'Unavailable';
            priceText = 'Contact Sales';
            statusText = 'Monthly pricing unavailable.';
            isUnavailable = true;
        }
    }

    return {
        effectivePlanKind,
        modeBadgeText,
        priceText,
        statusText,
        fallbackText,
        isUnavailable,
        lifetimeOffer,
        fallbackFromLifetime,
    };
}

function updateOfferCards() {
    document.querySelectorAll('.plan-choice-card').forEach((card) => {
        const cardPlanKind = String(card.dataset.planKind || '');
        const planState = getPlanState(cardPlanKind);
        const isSelected = cardPlanKind === selectedPlanKind;

        card.classList.toggle('active-offer', isSelected);
        card.classList.toggle('is-disabled', planState.isUnavailable);
        card.classList.toggle('is-lifetime-fallback', cardPlanKind === 'lifetime' && planState.fallbackFromLifetime);
        card.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
        card.setAttribute('aria-disabled', planState.isUnavailable ? 'true' : 'false');

        const modeBadge = card.querySelector('[data-role="modeBadge"]');
        const priceText = card.querySelector('[data-role="priceText"]');
        const statusText = card.querySelector('[data-role="statusText"]');
        const fallbackText = card.querySelector('[data-role="fallbackText"]');

        if (modeBadge) {
            modeBadge.textContent = planState.modeBadgeText;
            modeBadge.dataset.mode = planState.effectivePlanKind || 'unavailable';
        }
        if (priceText) {
            priceText.textContent = planState.priceText;
        }
        if (statusText) {
            statusText.textContent = planState.statusText;
        }
        if (fallbackText) {
            fallbackText.textContent = planState.fallbackText || '';
            fallbackText.classList.toggle('d-none', !planState.fallbackText);
        }
    });
}

function updatePlanSummary() {
    const title = document.getElementById('featuresCardTitle');
    const selectedText = document.getElementById('selectedTierText');
    const featuresList = document.getElementById('featuresChecklist');
    const lifetimeCounterMessage = document.getElementById('lifetimeCounterMessage');
    const checkoutButtons = document.querySelectorAll('[data-role="proceedCheckoutBtn"]');
    const checkoutButtonHtml = '<i class="fas fa-credit-card me-2"></i>Proceed to Checkout';

    const tierData = getTierData();
    const planState = getPlanState(selectedPlanKind);

    featuresList.innerHTML = '';
    lifetimeCounterMessage.classList.add('d-none');
    lifetimeCounterMessage.classList.remove('alert-info');
    lifetimeCounterMessage.classList.add('alert-warning');

    const includedFeatures = [
        'Inventory Tracking (FIFO)',
        'Recipe Management & Versioning',
        'Production Planning',
        'Batch-in-Progress Tracker',
        'Container Fill Logic',
        'Immutable Batch Summary',
        'Product & SKU System',
        'Unit Conversion & Density Engine',
        'Neurodivergent-Friendly UI',
        'Batch Label Printing',
        'Contextual Error Handling',
    ];

    const futureFeatures = [
        'Global Inventory Library (25,000+ Items)',
        'AI Recipe & Inventory Parser',
        'Recipe Marketplace',
        'Shopify & Etsy Integration',
        'Supplier Integration',
    ];

    if (!tierData) {
        title.textContent = 'Full Access to the BatchTrack Ecosystem';
        selectedText.textContent = 'Tier configuration unavailable.';
        checkoutButtons.forEach((button) => {
            button.disabled = true;
            button.innerHTML = checkoutButtonHtml;
        });
        return;
    }

    includedFeatures.forEach((label) => {
        const item = document.createElement('li');
        const icon = document.createElement('i');
        icon.className = 'fas fa-check text-success me-2';
        const copy = document.createElement('span');
        copy.textContent = label;
        item.appendChild(icon);
        item.appendChild(copy);
        featuresList.appendChild(item);
    });

    const futureHeading = document.createElement('li');
    futureHeading.className = 'features-section-label';
    futureHeading.innerHTML = '<span>Included features coming soon</span>';
    featuresList.appendChild(futureHeading);

    futureFeatures.forEach((label) => {
        const item = document.createElement('li');
        const icon = document.createElement('i');
        icon.className = 'fas fa-clock text-muted me-2';
        const copy = document.createElement('span');
        copy.className = 'text-muted';
        copy.textContent = label;
        item.appendChild(icon);
        item.appendChild(copy);
        featuresList.appendChild(item);
    });

    if (planState.isUnavailable) {
        title.textContent = 'Full Access to the BatchTrack Ecosystem';
        selectedText.textContent = 'This plan is currently unavailable for checkout.';
        checkoutButtons.forEach((button) => {
            button.disabled = true;
            button.innerHTML = checkoutButtonHtml;
        });
        return;
    }

    title.textContent = 'Full Access to the BatchTrack Ecosystem';
    selectedText.textContent = 'Included with your Early-Access Seat';

    if (planState.effectivePlanKind === 'lifetime') {
        const lifetimeOffer = planState.lifetimeOffer;
        selectedLifetimeTier = lifetimeOffer ? lifetimeOffer.key : '';
        checkoutButtons.forEach((button) => {
            button.disabled = false;
            button.innerHTML = checkoutButtonHtml;
        });
        return;
    }

    selectedLifetimeTier = '';
    checkoutButtons.forEach((button) => {
        button.disabled = false;
        button.innerHTML = checkoutButtonHtml;
    });

    if (planState.fallbackText) {
        lifetimeCounterMessage.textContent = planState.fallbackText;
        lifetimeCounterMessage.classList.remove('d-none');
        lifetimeCounterMessage.classList.remove('alert-warning');
        lifetimeCounterMessage.classList.add('alert-info');
    }
}

function proceedToPayment() {
    const tierData = getTierData();
    if (!selectedTier || !tierData) {
        alert('The Artisan tier is not configured for checkout.');
        return;
    }

    const planState = getPlanState(selectedPlanKind);
    if (planState.isUnavailable || !VALID_PLAN_KINDS.includes(planState.effectivePlanKind)) {
        alert('This billing option is not available for checkout yet.');
        return;
    }

    let billingMode = 'standard';
    let billingCycle = planState.effectivePlanKind === 'yearly' ? 'yearly' : 'monthly';

    if (planState.effectivePlanKind === 'lifetime') {
        const offer = planState.lifetimeOffer;
        if (!offer || !offer.has_remaining || !offer.tier_id) {
            alert('Founding lifetime seats are sold out. Please choose monthly billing.');
            return;
        }
        selectedLifetimeTier = offer.key;
        selectedTier = String(offer.tier_id);
        billingMode = 'lifetime';
        billingCycle = 'lifetime';
    } else {
        selectedLifetimeTier = '';
    }

    if (window.BTAnalytics && typeof window.BTAnalytics.capture === 'function') {
        window.BTAnalytics.capture('signup_continue_to_payment_clicked', {
            selected_tier: String(selectedTier || ''),
            requested_plan_kind: selectedPlanKind,
            effective_plan_kind: planState.effectivePlanKind,
            billing_mode: billingMode,
            billing_cycle: billingCycle,
            signup_source: signupSource || null,
        });
    }

    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{{ url_for("core.signup_alias") }}';

    const entries = [
        ['csrf_token', '{{ csrf_token() }}'],
        ['selected_tier', selectedTier],
        ['billing_mode', billingMode],
        ['billing_cycle', billingCycle],
    ];

    if (signupSource) entries.push(['source', signupSource]);
    if (referralCode) entries.push(['ref', referralCode]);

    if (billingMode === 'lifetime' && selectedLifetimeTier && lifetimeByKey[selectedLifetimeTier]) {
        entries.push(['lifetime_tier', selectedLifetimeTier]);
        entries.push(['promo', lifetimeByKey[selectedLifetimeTier].coupon_code || '']);
    } else if (initialPromoCode) {
        entries.push(['promo', initialPromoCode]);
    }

    if (
        window.BTAnalytics &&
        typeof window.BTAnalytics.getFirstLandingAt === 'function'
    ) {
        const firstLandingAt = window.BTAnalytics.getFirstLandingAt();
        if (firstLandingAt) {
            entries.push(['client_first_landing_at', String(firstLandingAt)]);
        }
    }

    try {
        const detectedTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        entries.push(['detected_timezone', detectedTimezone]);
    } catch (error) {
        console.warn('Timezone detection failed', error);
    }

    {% if oauth_user_info %}
    entries.push(['oauth_signup', 'true']);
    {% endif %}

    entries.forEach(([name, value]) => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        input.value = value;
        form.appendChild(input);
    });

    document.body.appendChild(form);
    form.submit();
}

document.addEventListener('DOMContentLoaded', () => {
    const offerCards = Array.from(document.querySelectorAll('.plan-choice-card'));
    if (!VALID_PLAN_KINDS.includes(selectedPlanKind)) {
        selectedPlanKind = 'monthly';
    }

    offerCards.forEach((card) => {
        card.addEventListener('click', () => {
            const nextKind = String(card.dataset.planKind || '');
            if (!VALID_PLAN_KINDS.includes(nextKind)) return;
            selectedPlanKind = nextKind;
            updateOfferCards();
            updatePlanSummary();
        });

        card.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                const nextKind = String(card.dataset.planKind || '');
                if (!VALID_PLAN_KINDS.includes(nextKind)) return;
                selectedPlanKind = nextKind;
                updateOfferCards();
                updatePlanSummary();
            }
        });
    });

    if (window.BTAnalytics && typeof window.BTAnalytics.capture === 'function') {
        window.BTAnalytics.capture('signup_page_viewed', {
            selected_tier: String(selectedTier || ''),
            requested_plan_kind: selectedPlanKind,
            signup_source: signupSource || null,
        });
    }

    updateOfferCards();
    updatePlanSummary();
});
</script>

<style>
.signup-shell {
    background: #ffffff;
    border: 1px solid #e1e6f2;
    border-radius: 16px;
    box-shadow: 0 10px 26px rgba(22, 32, 61, 0.08);
    padding: 1rem 1rem 1.15rem;
}

.pricing-section {
    margin-bottom: 1.5rem;
}

.pricing-cards-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1rem;
}

.plan-choice-card {
    border: 2px solid #d6dff0;
    border-radius: var(--theme-ext-radius-1f2f59cc9c);
    background: #ffffff;
    padding: 1.15rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease, opacity 0.2s ease;
    cursor: pointer;
}

.plan-chip {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    background: #e8f0ff;
    border: 1px solid #9eb8ee;
    color: #244a97;
    font-size: 0.72rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    font-weight: 700;
    padding: 0.2rem 0.6rem;
}

.plan-chip-lifetime {
    background: #fff4de;
    border-color: #f2d18b;
    color: #7a4f00;
}

.plan-choice-card.active-offer {
    border-color: var(--theme-ext-color-7630a14d9f);
    box-shadow: var(--theme-ext-shadow-a9f9d9573c);
    transform: translateY(-2px);
}

.plan-choice-card.is-disabled {
    opacity: 0.72;
}

.plan-choice-card.is-lifetime-fallback {
    border-style: dashed;
    background: #f8f9fd;
}

.plan-price {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--theme-ext-color-7630a14d9f);
    line-height: 1.25;
}

.plan-includes {
    font-size: 1rem;
    color: #2f3a56;
}

.plan-subtext {
    font-size: 0.86rem;
    color: #5f6b84;
}

.soft-panel {
    background: #f8f9fd;
    border: 1px solid #e0e7f4;
    border-radius: var(--theme-ext-radius-1f2f59cc9c);
}

.features-checklist {
    list-style: none;
    padding: var(--theme-ext-space-369a047e0c);
    margin: var(--theme-ext-space-4cb477d5ee);
    columns: 1;
}

.features-checklist li {
    break-inside: avoid;
    display: flex;
    align-items: flex-start;
    margin-bottom: var(--theme-ext-space-7a506f4f36);
    font-size: var(--theme-ext-size-03c2698f9e);
}

.features-checklist li.features-section-label {
    margin-top: var(--theme-ext-space-685ff92249);
    margin-bottom: var(--theme-ext-space-21b301a6b6);
}

.features-checklist li.features-section-label span {
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-size: 0.8rem;
    font-weight: 700;
    color: #5f6b84;
}

@media (max-width: 768px) {
    .signup-shell {
        border-radius: 14px;
        box-shadow: 0 6px 18px rgba(22, 32, 61, 0.06);
        padding: 0.7rem 0.65rem 0.9rem;
    }

    .pricing-cards-grid {
        gap: 0.65rem;
    }

    .plan-choice-card {
        border: 1px solid #d8e0ef;
        border-radius: 12px;
        background: #ffffff;
        box-shadow: 0 1px 6px rgba(22, 32, 61, 0.06);
        padding: 0.75rem 0.65rem;
    }

    .plan-choice-card.is-lifetime-fallback {
        border-style: dashed;
        background: #fbfcff;
    }

    .plan-choice-card.active-offer {
        border: 1px solid var(--theme-ext-color-7630a14d9f);
        box-shadow: 0 4px 12px rgba(36, 74, 151, 0.16);
        transform: none;
        background: #ffffff;
    }

    .plan-chip {
        font-size: 0.58rem;
        padding: 0.15rem 0.45rem;
    }

    .plan-price {
        font-size: 0.95rem;
    }

    .plan-includes {
        font-size: 0.8rem;
    }

    .plan-subtext {
        font-size: 0.7rem;
    }
}

/* Phone-sized screens (e.g., Galaxy widths): keep white background,
   but remove visible outer shell edges/shadow to avoid nested look. */
@media (max-width: 430px) {
    .signup-layout-col {
        padding-left: 0.35rem;
        padding-right: 0.35rem;
    }

    .signup-shell {
        border: 0;
        border-radius: 0;
        box-shadow: none;
        background: #ffffff;
        padding: 0.45rem 0.25rem 0.75rem;
    }

    .pricing-section {
        margin-bottom: 1.15rem;
    }
}
</style>
{% endblock %}
