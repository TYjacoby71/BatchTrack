<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Active Lots{% if fifo_filter %} (Remaining > 0){% endif %}</h5>
    <span class="text-muted">{{ lots|length }} lot{{ 's' if lots|length != 1 else '' }}</span>
  </div>
  <div class="card-body p-0">
    <div style="overflow-x:auto;">
      <table class="table table-hover table-sm mb-0" style="min-width: 900px;">
        <thead>
          <tr>
            <th>Created</th>
            <th>FIFO Code</th>
            <th>Remaining</th>
            <th>Original</th>
            <th>Unit</th>
            <th>Unit Cost</th>
            <th>Expiration</th>
            <th>Source</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          {% for lot in lots %}
          {% set is_infinite_anchor = lot.source_type == 'infinite_anchor' %}
          <tr{% if is_infinite_anchor %} class="table-info"{% endif %}>
            <td>{{ TimezoneUtils.format_for_user(lot.created_at, '%Y-%m-%d %H:%M') }}</td>
            <td class="text-center">
                            <small class="text-muted">{{ lot.display_code }}</small>
                        </td>
            <td>
              {% if is_infinite_anchor %}
                <span class="badge bg-info text-dark">Infinite</span>
              {% else %}
                {{ '%.2f'|format(lot.remaining_quantity) }}
              {% endif %}
            </td>
            <td>
              {% if is_infinite_anchor %}
                <span class="badge bg-info text-dark">Infinite</span>
              {% else %}
                {{ '%.2f'|format(lot.original_quantity) }}
              {% endif %}
            </td>
            <td>{{ lot.unit }}</td>
            <td>${{ '%.2f'|format(lot.unit_cost or 0) }}</td>
            <td>
              {% if lot.expiration_date %}
                {{ TimezoneUtils.format_for_user(lot.expiration_date, '%Y-%m-%d') }}
              {% else %}-{% endif %}
            </td>
            <td>
              {% if is_infinite_anchor %}
                Infinite Anchor
              {% else %}
                {{ lot.source_type|replace('_',' ')|title }}
              {% endif %}
            </td>
            <td>{{ lot.source_notes or ('System anchor lot used when item tracking is set to Infinite.' if is_infinite_anchor else '-') }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>