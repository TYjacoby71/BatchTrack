{% extends 'layout.html' %}
{% set page_title = "BatchTrack.com | Free Maker Tools & Calculators" %}
{% set page_description = "Free batch tools for makers: soap formulator live now, candle, cosmetic, and fermentation tools coming soon. Batch-first and neurodivergent-friendly." %}

{% macro waitlist_cta(waitlist_key, label) %}
<div class="mt-3 pt-3 border-top">
  <form class="tool-waitlist-form" data-waitlist-key="{{ waitlist_key }}">
    <label class="form-label small mb-1 text-muted">{{ label }}</label>
    <input type="text" class="bot-trap-field" name="website" tabindex="-1" autocomplete="off" aria-hidden="true">
    <div class="input-group input-group-sm">
      <input type="email" class="form-control" name="email" placeholder="you@example.com" required>
      <button class="btn btn-outline-secondary" type="submit">
        <span class="label-default"><i class="fas fa-paper-plane me-1"></i>Notify me</span>
        <span class="label-loading d-none"><i class="fas fa-spinner fa-spin me-1"></i>Sending</span>
      </button>
    </div>
    <div class="small text-muted mt-1" data-role="helper">No spam. We'll email when this tool opens.</div>
    <div class="small text-success mt-1 d-none" data-role="success">You're on the list!</div>
    <div class="small text-danger mt-1 d-none" data-role="error">Something went wrong. Try again?</div>
  </form>
</div>
{% endmacro %}
{% block content %}
<div class="py-1 tools-index">
  <div class="tools-hero mb-4">
    <div class="tools-hero-inner">
      <div>
        <div class="tools-eyebrow">Batch-first maker tools</div>
        <h1 class="mb-1">Maker Tools</h1>
        <p class="text-muted mb-0">Free calculators and converters. Create your first export, then save to BatchTrack.</p>
      </div>
      <div class="tools-hero-badge">
        <i class="fas fa-seedling"></i>
        Calm, neurodivergent-friendly
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 tool-category-card" style="--accent-color: var(--color-primary);">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <h5 class="card-title mb-1">Soap Tools</h5>
              <p class="card-text small text-muted">Lye calculator, superfat, water %, oil profiles.</p>
            </div>
            {% if not tool_flags.soap %}
            <span class="badge bg-secondary">Coming Soon</span>
            {% endif %}
          </div>
          <div class="tool-tiles">
            {% if tool_flags.soap %}
            <a class="tool-tile" href="/tools/soap" aria-label="Open Soap Formulator">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Soap Formulator</div>
                <div class="tool-tile-meta small text-muted">Build formulas, review quality, and export recipes.</div>
              </div>
              <div class="tool-tile-icon text-muted">
                <i class="fas fa-arrow-right"></i>
              </div>
            </a>
            {% else %}
            <div class="tool-tile tool-tile--disabled" aria-disabled="true">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Soap Formulator</div>
                <div class="tool-tile-meta small text-muted">Preview the calculator layout and join the waitlist.</div>
              </div>
              <span class="badge bg-light text-dark border">Coming Soon</span>
            </div>
            {{ waitlist_cta('tools.soap', 'Soap tools waitlist') }}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 tool-category-card" style="--accent-color: var(--color-warning);">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <h5 class="card-title mb-1">Candle Tools</h5>
              <p class="card-text small text-muted">Fragrance load, wax blend %, vessel sizing.</p>
            </div>
            {% if not tool_flags.candles %}
            <span class="badge bg-secondary">Coming Soon</span>
            {% endif %}
          </div>
          <div class="tool-tiles">
            {% if tool_flags.candles %}
            <a class="tool-tile" href="/tools/candles" aria-label="Open Candle Formulator">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Candle Formulator</div>
                <div class="tool-tile-meta small text-muted">Set wax ratios, fragrance load, and vessel math.</div>
              </div>
              <div class="tool-tile-icon text-muted">
                <i class="fas fa-arrow-right"></i>
              </div>
            </a>
            {% else %}
            <div class="tool-tile tool-tile--disabled" aria-disabled="true">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Candle Formulator</div>
                <div class="tool-tile-meta small text-muted">See what’s shipping next—calculators land soon.</div>
              </div>
              <span class="badge bg-light text-dark border">Coming Soon</span>
            </div>
            {{ waitlist_cta('tools.candles', 'Candle tools waitlist') }}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 tool-category-card" style="--accent-color: var(--color-info);">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <h5 class="card-title mb-1">Lotion & Cosmetic Tools</h5>
              <p class="card-text small text-muted">Phase % calculator, preservative %, temps.</p>
            </div>
            {% if not tool_flags.lotions %}
            <span class="badge bg-secondary">Coming Soon</span>
            {% endif %}
          </div>
          <div class="tool-tiles">
            {% if tool_flags.lotions %}
            <a class="tool-tile" href="/tools/lotions" aria-label="Open Lotion Formulator">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Lotion Formulator</div>
                <div class="tool-tile-meta small text-muted">Plan phases, preservative targets, and temps.</div>
              </div>
              <div class="tool-tile-icon text-muted">
                <i class="fas fa-arrow-right"></i>
              </div>
            </a>
            {% else %}
            <div class="tool-tile tool-tile--disabled" aria-disabled="true">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Lotion Formulator</div>
                <div class="tool-tile-meta small text-muted">Phase calculators and preservative planners arrive shortly.</div>
              </div>
              <span class="badge bg-light text-dark border">Coming Soon</span>
            </div>
            {{ waitlist_cta('tools.lotions', 'Lotion & cosmetics waitlist') }}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 tool-category-card" style="--accent-color: var(--color-success);">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <h5 class="card-title mb-1">Herbalist Tools</h5>
              <p class="card-text small text-muted">Tincture ratios, oil infusions, dilutions.</p>
            </div>
            {% if not tool_flags.herbal %}
            <span class="badge bg-secondary">Coming Soon</span>
            {% endif %}
          </div>
          <div class="tool-tiles">
            {% if tool_flags.herbal %}
            <a class="tool-tile" href="/tools/herbal" aria-label="Open Herbalist Formulator">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Herbalist Formulator</div>
                <div class="tool-tile-meta small text-muted">Plan tinctures, infusions, and dilutions.</div>
              </div>
              <div class="tool-tile-icon text-muted">
                <i class="fas fa-arrow-right"></i>
              </div>
            </a>
            {% else %}
            <div class="tool-tile tool-tile--disabled" aria-disabled="true">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Herbalist Formulator</div>
                <div class="tool-tile-meta small text-muted">Tincture ratios and infusion helpers are in preview.</div>
              </div>
              <span class="badge bg-light text-dark border">Coming Soon</span>
            </div>
            {{ waitlist_cta('tools.herbal', 'Herbal tools waitlist') }}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 tool-category-card" style="--accent-color: var(--color-dark);">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <h5 class="card-title mb-1">Baker Tools</h5>
              <p class="card-text small text-muted">Baker’s %, hydration, preferments, scaling.</p>
            </div>
            {% if not tool_flags.baker %}
            <span class="badge bg-secondary">Coming Soon</span>
            {% endif %}
          </div>
          <div class="tool-tiles">
            {% if tool_flags.baker %}
            <a class="tool-tile" href="/tools/baker" aria-label="Open Baker Formulator">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Baker Formulator</div>
                <div class="tool-tile-meta small text-muted">Scale dough, hydration, and preferments fast.</div>
              </div>
              <div class="tool-tile-icon text-muted">
                <i class="fas fa-arrow-right"></i>
              </div>
            </a>
            {% else %}
            <div class="tool-tile tool-tile--disabled" aria-disabled="true">
              <div class="tool-tile-body">
                <div class="tool-tile-title">Baker Formulator</div>
                <div class="tool-tile-meta small text-muted">Formula scaling and hydration helpers launch soon.</div>
              </div>
              <span class="badge bg-light text-dark border">Coming Soon</span>
            </div>
            {{ waitlist_cta('tools.baker', 'Baker tools waitlist') }}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<style>
.tools-index {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.tools-hero {
  border-radius: var(--radius-3);
  border: 1px solid var(--color-border);
  background: linear-gradient(120deg, var(--overlay-primary-weak), transparent 60%),
    var(--color-surface);
  padding: var(--space-6);
  box-shadow: var(--shadow-2);
}

.tools-hero-inner {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-4);
  align-items: center;
  justify-content: space-between;
}

.tools-eyebrow {
  font-size: 0.75rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--color-primary);
  font-weight: 600;
}

.tools-hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.85rem;
  border-radius: 999px;
  background: var(--color-subtle-bg);
  color: var(--color-text);
  font-size: 0.85rem;
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-1);
}

.tool-category-card {
  border: 1px solid var(--color-border, #e6e9ef);
  box-shadow: 0 0.35rem 0.9rem rgba(20, 30, 55, 0.06);
  position: relative;
  overflow: hidden;
  background: linear-gradient(180deg, var(--color-surface), var(--color-subtle-bg));
}

.tool-category-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  height: 4px;
  width: 100%;
  background: var(--accent-color, var(--color-primary));
}

.tool-tiles {
  display: grid;
  gap: 0.75rem;
}

.tool-tile {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  padding: 0.85rem 1rem;
  border-radius: 0.85rem;
  border: 1px solid var(--color-border, #e6e9ef);
  background: color-mix(in srgb, var(--accent-color, var(--color-primary)) 8%, var(--color-surface));
  color: inherit;
  text-decoration: none;
  transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease, background-color 160ms ease;
  border-left: 4px solid var(--accent-color, var(--color-primary));
}

.tool-tile:hover,
.tool-tile:focus {
  transform: translateY(-1px);
  box-shadow: 0 0.75rem 1.25rem color-mix(in srgb, var(--accent-color, #000) 15%, transparent);
  border-color: color-mix(in srgb, var(--accent-color, #000) 30%, var(--color-border));
  background: var(--color-surface);
  text-decoration: none;
}

.tool-tile-title {
  font-weight: 600;
  font-size: 0.95rem;
}

.tool-tile-meta {
  margin-top: 0.25rem;
  line-height: 1.4;
}

.tool-tile-icon {
  color: var(--accent-color, var(--color-primary));
}

.tool-tile--disabled {
  opacity: 0.65;
  cursor: not-allowed;
  border-left-color: var(--color-border);
}

.tool-tile--disabled:hover,
.tool-tile--disabled:focus {
  transform: none;
  box-shadow: none;
  border-color: var(--color-border, #e6e9ef);
  background: var(--color-breadcrumb-bg, #f8f9fb);
}
</style>
<script>
(function(){
  function toggleState(form, state){
    const btn = form.querySelector('button[type="submit"]');
    const helper = form.querySelector('[data-role="helper"]');
    const success = form.querySelector('[data-role="success"]');
    const error = form.querySelector('[data-role="error"]');
    const defaultLabel = form.querySelector('.label-default');
    const loadingLabel = form.querySelector('.label-loading');

    if (state === 'loading'){
      btn.disabled = true;
      defaultLabel.classList.add('d-none');
      loadingLabel.classList.remove('d-none');
      success.classList.add('d-none');
      error.classList.add('d-none');
      helper.classList.remove('d-none');
    } else {
      btn.disabled = false;
      defaultLabel.classList.remove('d-none');
      loadingLabel.classList.add('d-none');
    }

    if (state === 'success'){
      helper.classList.add('d-none');
      success.classList.remove('d-none');
      error.classList.add('d-none');
    } else if (state === 'error'){
      helper.classList.add('d-none');
      success.classList.add('d-none');
      error.classList.remove('d-none');
    } else if (state === 'idle'){
      helper.classList.remove('d-none');
      success.classList.add('d-none');
      error.classList.add('d-none');
    }
  }

  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('.tool-waitlist-form').forEach(function(form){
      form.addEventListener('submit', async function(ev){
        ev.preventDefault();
        const emailInput = form.querySelector('input[name="email"]');
        const trapInput = form.querySelector('input[name="website"]');
        const waitlistKey = form.dataset.waitlistKey || 'public_tools';
        if (!emailInput.value){
          return;
        }
        toggleState(form, 'loading');
        try{
          const response = await fetch('/api/waitlist', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              email: emailInput.value,
              website: trapInput ? trapInput.value : '',
              waitlist_key: waitlistKey,
              source: waitlistKey,
              context: 'tools_page',
              notes: `tools_index:${waitlistKey}`
            })
          });
          if (!response.ok){
            throw new Error('Failed request');
          }
          toggleState(form, 'success');
          emailInput.value = '';
        }catch(err){
          console.error('Waitlist error', err);
          toggleState(form, 'error');
        }finally{
          setTimeout(() => toggleState(form, 'idle'), 1500);
        }
      });
    });
  });
})();
</script>
{% endblock %}