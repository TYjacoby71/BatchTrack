<div class="tab-pane fade" id="soapStage3Pane" role="tabpanel" aria-labelledby="soapStage3Tab">
  <div class="soap-stage-body p-3" data-stage-index="2">
    <div class="position-relative">
      <div class="row g-2 soap-stage-grid">
        <div class="col-12">
          <div id="oilRows"></div>
          <template id="oilRowTemplate">
            <div class="row g-2 align-items-end oil-row mb-1">
              <div class="col-lg-6 col-md-6 soap-field-stack oil-name-col">
                <label class="form-label">Oil, fat, or wax</label>
                <div class="position-relative">
                  <input type="text" class="form-control oil-typeahead" placeholder="Search oils, butters, waxes...">
                  <input type="hidden" class="oil-sap-koh">
                  <input type="hidden" class="oil-iodine">
                  <input type="hidden" class="oil-fatty">
                  <input type="hidden" class="oil-gi-id">
                  <div class="list-group position-absolute w-100 d-none" data-role="suggestions" style="z-index:1050"></div>
                </div>
                <div class="form-text small text-muted">Filtered to oils, butters, and waxes.</div>
              </div>
              <div class="col-lg-3 col-md-3 soap-field-stack oil-weight-col">
                <label class="form-label">Weight</label>
                <div class="input-group">
                  <input type="number" class="form-control oil-grams" min="0" step="0.1">
                  <span class="input-group-text unit-label">g</span>
                </div>
                <div class="small text-warning oil-limit-hint" data-role="oil-grams-hint"></div>
              </div>
              <div class="col-lg-2 col-md-2 soap-field-stack oil-percent-col">
                <label class="form-label">Percent</label>
                <div class="input-group">
                  <input type="number" class="form-control oil-percent" min="0" step="0.1">
                  <span class="input-group-text">%</span>
                </div>
                <div class="small text-warning oil-limit-hint" data-role="oil-percent-hint"></div>
              </div>
              <div class="col-lg-1 col-md-1 d-flex align-items-end justify-content-center oil-remove-col">
                <button class="btn btn-outline-danger soap-icon-btn remove-oil" type="button" aria-label="Remove oil" title="Remove oil">
                  <i class="fas fa-times" aria-hidden="true"></i>
                </button>
              </div>
              <div class="col-12 d-lg-none mt-2">
                <button class="btn btn-sm btn-outline-secondary w-100 oil-profile-open" type="button">View oil profile</button>
              </div>
            </div>
          </template>
        </div>
        <div class="d-flex flex-wrap gap-1 align-items-center mt-2">
          <button class="btn btn-sm btn-outline-primary" id="addOil" type="button">Add Oil</button>
          <button class="btn btn-sm btn-outline-secondary" id="normalizeOils" type="button">Normalize to 100%</button>
          <div class="small text-muted">Total %: <span id="oilPercentTotal">0</span>%</div>
          <div class="small text-muted">Current oils: <span id="oilTotalComputed">--</span></div>
        </div>
        {% set stage_index = 2 %}
        {% include 'tools/soaps/stages/_stage_actions.html' %}
        <div class="alert alert-warning small mt-1 d-none" id="oilLimitWarning"></div>
        <div class="alert alert-light border small mt-1 d-none" id="oilBlendTips"></div>
      </div>
    </div>
    <div class="card oil-profile-float d-none" id="oilProfileFloat">
      <div class="card-body p-2">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <strong class="small">Selected oil profile</strong>
            <span class="small text-muted" id="selectedOilName">Pick an oil to preview</span>
          </div>
          <div class="small text-muted">SAP (KOH): <span id="selectedOilSap">--</span> Â· Iodine: <span id="selectedOilIodine">--</span></div>
          <div class="mt-2">
            <div class="small text-muted">Qualities</div>
            <div class="d-flex justify-content-between"><span>Hardness</span><span id="selectedOilHardness">--</span></div>
            <div class="d-flex justify-content-between"><span>Cleansing</span><span id="selectedOilCleansing">--</span></div>
            <div class="d-flex justify-content-between"><span>Conditioning</span><span id="selectedOilConditioning">--</span></div>
            <div class="d-flex justify-content-between"><span>Bubbly</span><span id="selectedOilBubbly">--</span></div>
            <div class="d-flex justify-content-between"><span>Creamy</span><span id="selectedOilCreamy">--</span></div>
          </div>
          <div class="mt-2">
            <div class="small text-muted">Fatty acids</div>
            <div class="table-responsive">
              <table class="table table-sm soap-oil-profile mb-0">
                <tbody>
                  <tr><td>Lauric</td><td class="text-end" id="selectedOilLauric">--</td></tr>
                  <tr><td>Myristic</td><td class="text-end" id="selectedOilMyristic">--</td></tr>
                  <tr><td>Palmitic</td><td class="text-end" id="selectedOilPalmitic">--</td></tr>
                  <tr><td>Stearic</td><td class="text-end" id="selectedOilStearic">--</td></tr>
                  <tr><td>Ricinoleic</td><td class="text-end" id="selectedOilRicinoleic">--</td></tr>
                  <tr><td>Oleic</td><td class="text-end" id="selectedOilOleic">--</td></tr>
                  <tr><td>Linoleic</td><td class="text-end" id="selectedOilLinoleic">--</td></tr>
                  <tr><td>Linolenic</td><td class="text-end" id="selectedOilLinolenic">--</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
    </div>
  </div>
</div>
