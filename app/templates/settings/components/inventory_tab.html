
<div class="row">
    <div class="col-12">
        <div class="mb-3">
            <h5><i class="fas fa-boxes"></i> Inventory Management</h5>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-layer-group"></i> Batch Management</h6>
            </div>
            <div class="card-body">
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" x-model="systemSettings.batch_rules.require_timer_completion" @change="updateSystemSetting('batch_rules', 'require_timer_completion', $event.target.checked)">
                    <label class="form-check-label">Require Timer Completion</label>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" x-model="systemSettings.batch_rules.allow_intermediate_tags" @change="updateSystemSetting('batch_rules', 'allow_intermediate_tags', $event.target.checked)">
                    <label class="form-check-label">Allow Intermediate Tags</label>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" x-model="systemSettings.batch_rules.require_finish_confirmation" @change="updateSystemSetting('batch_rules', 'require_finish_confirmation', $event.target.checked)">
                    <label class="form-check-label">Require Finish Confirmation</label>
                </div>

                <div class="mb-3">
                    <label class="form-label">Stuck Batch Hours</label>
                    <input type="number" class="form-control" x-model.number="systemSettings.batch_rules.stuck_batch_hours" min="1" max="168" @change="updateSystemSetting('batch_rules', 'stuck_batch_hours', $event.target.value)">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-calculator"></i> Inventory Cost Method</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <label class="form-label">Cost Valuation Method</label>
                    <select class="form-select" x-model="organization.inventory_cost_method" @change="saveOrgCostMethod($event.target.value)">
                        <option value="fifo">FIFO (lot cost)</option>
                        <option value="average">Moving Average</option>
                    </select>
                </div>
                <small class="text-muted">Affects new events and batches started after change. Existing events and in-progress batches are not changed.</small>
            </div>
        </div>
    </div>
</div>

<script>
    function saveOrgCostMethod(method) {
        fetch('/organization/update-settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ inventory_cost_method: method })
        }).then(r => r.json()).then(resp => {
            if (!resp.success) {
                alert(resp.error || 'Failed to update cost method');
            }
        }).catch(() => alert('Failed to update cost method'));
    }
</script>
