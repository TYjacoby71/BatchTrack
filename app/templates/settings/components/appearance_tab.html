<div class="row">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-palette"></i> Theme</h5>
      </div>
      <div class="card-body" x-data="{
        theme: (localStorage.getItem('bt_theme') || 'system'),
        async applyTheme(newTheme) {
          this.theme = newTheme;
          try {
            if (newTheme && newTheme !== 'system') {
              document.documentElement.setAttribute('data-theme', newTheme);
              localStorage.setItem('bt_theme', newTheme);
            } else {
              document.documentElement.removeAttribute('data-theme');
              localStorage.removeItem('bt_theme');
            }
            // Persist for users that have preferences
            const res = await fetch('/settings/api/user-preferences', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('meta[name=csrf-token]').getAttribute('content')
              },
              body: JSON.stringify({ theme: newTheme })
            });
            // No hard failure if not allowed (e.g., developers)
          } catch (e) { /* ignore */ }
        }
      }">
        <div class="mb-3">
          <label class="form-label">Choose theme</label>
          <select class="form-select" x-model="theme" @change="applyTheme($event.target.value)">
            <option value="system">System Default</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="warm">Soft Pastels & Neutral</option>
          </select>
          <small class="text-muted">Changes apply immediately and save to your profile.</small>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-secondary" @click="applyTheme('system')">System</button>
          <button class="btn btn-outline-secondary" @click="applyTheme('light')">Light</button>
          <button class="btn btn-outline-secondary" @click="applyTheme('dark')">Dark</button>
          <button class="btn btn-outline-secondary" @click="applyTheme('warm')">Warm</button>
        </div>
      </div>
    </div>
  </div>
</div>
