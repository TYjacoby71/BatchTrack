
{% extends 'layout.html' %}

{% block title %}Container Management - Developer{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Breadcrumbs -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('developer.dashboard') }}">Developer Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">Container Management</li>
        </ol>
    </nav>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="fas fa-box-open text-primary"></i> Container Management
                    </h3>
                    <p class="text-muted mb-0">Curate container materials, types, colors, and styles for the global library</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Materials Section -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Materials</h5>
                </div>
                <div class="card-body">
                    <h6>Currently Used ({{ materials|length }})</h6>
                    <div class="mb-3">
                        {% for material in materials %}
                        <span class="badge bg-light text-dark me-1 mb-1">{{ material }}</span>
                        {% endfor %}
                    </div>
                    
                    <h6>Curated Options</h6>
                    <div class="mb-3">
                        {% for material in curated_materials %}
                        <span class="badge bg-primary me-1 mb-1">{{ material }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Types Section -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Types</h5>
                </div>
                <div class="card-body">
                    <h6>Currently Used ({{ types|length }})</h6>
                    <div class="mb-3">
                        {% for type in types %}
                        <span class="badge bg-light text-dark me-1 mb-1">{{ type }}</span>
                        {% endfor %}
                    </div>
                    
                    <h6>Curated Options</h6>
                    <div class="mb-3">
                        {% for type in curated_types %}
                        <span class="badge bg-success me-1 mb-1">{{ type }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Styles Section -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Styles</h5>
                </div>
                <div class="card-body">
                    <h6>Currently Used ({{ styles|length }})</h6>
                    <div class="mb-3">
                        {% for style in styles %}
                        <span class="badge bg-light text-dark me-1 mb-1">{{ style }}</span>
                        {% endfor %}
                    </div>
                    
                    <h6>Curated Options</h6>
                    <div class="mb-3">
                        {% for style in curated_styles %}
                        <span class="badge bg-info me-1 mb-1">{{ style }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Colors Section -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Colors</h5>
                </div>
                <div class="card-body">
                    <h6>Currently Used ({{ colors|length }})</h6>
                    <div class="mb-3">
                        {% for color in colors %}
                        <span class="badge bg-light text-dark me-1 mb-1">{{ color }}</span>
                        {% endfor %}
                    </div>
                    
                    <h6>Curated Options</h6>
                    <div class="mb-3">
                        {% for color in curated_colors %}
                        <span class="badge bg-warning me-1 mb-1">{{ color }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Curated Lists Section -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Edit Curated Lists</h5>
                    <p class="text-muted mb-0">Manage the curated options that appear as suggestions when creating containers</p>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Edit Materials -->
                        <div class="col-md-6 mb-4">
                            <div class="border rounded p-3">
                                <h6>Edit Curated Materials</h6>
                                <div id="curatedMaterialsList">
                                    {% for material in curated_materials %}
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-primary me-2">{{ material }}</span>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeCuratedItem('materials', '{{ material }}')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="input-group mt-3">
                                    <input type="text" class="form-control" id="newMaterialInput" placeholder="Add new material...">
                                    <button class="btn btn-success" onclick="addCuratedItem('materials')">Add</button>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Types -->
                        <div class="col-md-6 mb-4">
                            <div class="border rounded p-3">
                                <h6>Edit Curated Types</h6>
                                <div id="curatedTypesList">
                                    {% for type in curated_types %}
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-success me-2">{{ type }}</span>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeCuratedItem('types', '{{ type }}')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="input-group mt-3">
                                    <input type="text" class="form-control" id="newTypeInput" placeholder="Add new type...">
                                    <button class="btn btn-success" onclick="addCuratedItem('types')">Add</button>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Styles -->
                        <div class="col-md-6 mb-4">
                            <div class="border rounded p-3">
                                <h6>Edit Curated Styles</h6>
                                <div id="curatedStylesList">
                                    {% for style in curated_styles %}
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-info me-2">{{ style }}</span>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeCuratedItem('styles', '{{ style }}')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="input-group mt-3">
                                    <input type="text" class="form-control" id="newStyleInput" placeholder="Add new style...">
                                    <button class="btn btn-success" onclick="addCuratedItem('styles')">Add</button>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Colors -->
                        <div class="col-md-6 mb-4">
                            <div class="border rounded p-3">
                                <h6>Edit Curated Colors</h6>
                                <div id="curatedColorsList">
                                    {% for color in curated_colors %}
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-warning me-2">{{ color }}</span>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeCuratedItem('colors', '{{ color }}')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="input-group mt-3">
                                    <input type="text" class="form-control" id="newColorInput" placeholder="Add new color...">
                                    <button class="btn btn-success" onclick="addCuratedItem('colors')">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <button class="btn btn-primary" onclick="saveCuratedLists()">
                            <i class="fas fa-save"></i> Save All Changes
                        </button>
                        <button class="btn btn-secondary ms-2" onclick="location.reload()">
                            <i class="fas fa-undo"></i> Reset Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions Section -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Management Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="d-grid">
                                <a href="{{ url_for('developer.global_items_admin', type='container') }}" class="btn btn-outline-primary">
                                    <i class="fas fa-boxes"></i> View Container Items
                                </a>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-grid">
                                <a href="{{ url_for('developer.create_global_item') }}" class="btn btn-outline-success">
                                    <i class="fas fa-plus"></i> Add New Container
                                </a>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-grid">
                                <button class="btn btn-outline-info" onclick="exportContainerData()">
                                    <i class="fas fa-download"></i> Export Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Store current curated lists
let curatedLists = {
    materials: {{ curated_materials|tojson }},
    types: {{ curated_types|tojson }},
    styles: {{ curated_styles|tojson }},
    colors: {{ curated_colors|tojson }}
};

function addCuratedItem(listType) {
    const inputId = `new${listType.charAt(0).toUpperCase() + listType.slice(0, -1)}Input`;
    const input = document.getElementById(inputId);
    const value = input.value.trim();
    
    if (!value) {
        alert('Please enter a value');
        return;
    }
    
    if (curatedLists[listType].includes(value)) {
        alert('This item already exists in the list');
        return;
    }
    
    curatedLists[listType].push(value);
    input.value = '';
    renderCuratedList(listType);
}

function removeCuratedItem(listType, item) {
    const index = curatedLists[listType].indexOf(item);
    if (index > -1) {
        curatedLists[listType].splice(index, 1);
        renderCuratedList(listType);
    }
}

function renderCuratedList(listType) {
    const listId = `curated${listType.charAt(0).toUpperCase() + listType.slice(0, -1)}sList`;
    const container = document.getElementById(listId);
    
    const badgeColors = {
        materials: 'primary',
        types: 'success', 
        styles: 'info',
        colors: 'warning'
    };
    
    container.innerHTML = '';
    
    curatedLists[listType].forEach(item => {
        const div = document.createElement('div');
        div.className = 'd-flex align-items-center mb-2';
        div.innerHTML = `
            <span class="badge bg-${badgeColors[listType]} me-2">${item}</span>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeCuratedItem('${listType}', '${item}')">
                <i class="fas fa-times"></i>
            </button>
        `;
        container.appendChild(div);
    });
}

function saveCuratedLists() {
    const saveBtn = document.querySelector('button[onclick="saveCuratedLists()"]');
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    saveBtn.disabled = true;
    
    fetch('/developer/container-management/save-curated', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        },
        body: JSON.stringify({
            curated_lists: curatedLists
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Curated lists saved successfully!');
            location.reload();
        } else {
            alert('Error saving curated lists: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving curated lists');
    })
    .finally(() => {
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
    });
}

function exportContainerData() {
    // Simple export functionality
    const data = {
        materials: {{ materials|tojson }},
        types: {{ types|tojson }},
        styles: {{ styles|tojson }},
        colors: {{ colors|tojson }},
        curated: curatedLists
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'container_data.json';
    link.click();
    URL.revokeObjectURL(url);
}

// Allow Enter key to add items
document.addEventListener('DOMContentLoaded', function() {
    const inputs = ['newMaterialInput', 'newTypeInput', 'newStyleInput', 'newColorInput'];
    const listTypes = ['materials', 'types', 'styles', 'colors'];
    
    inputs.forEach((inputId, index) => {
        const input = document.getElementById(inputId);
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addCuratedItem(listTypes[index]);
            }
        });
    });
});
</script>
{% endblock %}
