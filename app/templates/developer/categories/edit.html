{% extends 'layout.html' %}
{% block content %}
<h2>Edit Product Category</h2>
<form method="post">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <div class="mb-3">
    <label class="form-label">Name</label>
    <input type="text" name="name" class="form-control" value="{{ category.name }}" required>
  </div>
  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" id="is_typically_portioned" name="is_typically_portioned" {% if category.is_typically_portioned %}checked{% endif %}>
    <label class="form-check-label" for="is_typically_portioned">Typically Portioned</label>
  </div>
  <div class="mb-3">
    <label class="form-label">SKU Name Template</label>
    <input type="text" class="form-control" name="sku_name_template" value="{{ category.sku_name_template or '' }}" placeholder="{variant} {product} ({size_label})">
    <small class="text-muted">Tokens: {product}, {variant}, {container}, {size_label}, {yield_value}, {yield_unit}, {portion_name}, {portion_count}</small>
    <div class="mt-2 d-flex flex-wrap gap-2">
      <span class="badge bg-light text-dark token" data-token="{product}">{product}</span>
      <span class="badge bg-light text-dark token" data-token="{variant}">{variant}</span>
      <span class="badge bg-light text-dark token" data-token="{container}">{container}</span>
      <span class="badge bg-light text-dark token" data-token="{size_label}">{size_label}</span>
      <span class="badge bg-light text-dark token" data-token="{yield_value}">{yield_value}</span>
      <span class="badge bg-light text-dark token" data-token="{yield_unit}">{yield_unit}</span>
      <span class="badge bg-light text-dark token" data-token="{portion_name}">{portion_name}</span>
      <span class="badge bg-light text-dark token" data-token="{portion_count}">{portion_count}</span>
    </div>
    <div class="mt-2">
      <label class="form-label">Live Preview</label>
      <div class="form-text" id="skuPreview"></div>
    </div>
  </div>
  <div class="d-flex gap-2">
    <a href="{{ url_for('developer.product_categories') }}" class="btn btn-secondary">Cancel</a>
    <button type="submit" class="btn btn-success">Save</button>
  </div>
</form>
<script>
(function(){
  const input = document.querySelector('input[name="sku_name_template"]');
  const preview = document.getElementById('skuPreview');
  const sample = { product: 'Salt Soap', variant: 'Lavender', container: '4 oz Jar', size_label: '4.5 oz Bar' };
  function render(tpl){
    if (!tpl) return '';
    return tpl.replace('{product}', sample.product)
              .replace('{variant}', sample.variant)
              .replace('{container}', sample.container)
              .replace('{size_label}', sample.size_label)
              .replace('{yield_value}', '32')
              .replace('{yield_unit}', 'oz')
              .replace('{portion_name}', 'Bar')
              .replace('{portion_count}', '8');
  }
  function update(){ preview.textContent = render(input.value || ''); }
  if (input && preview){ input.addEventListener('input', update); update(); }
  document.querySelectorAll('.token').forEach(el => {
    el.addEventListener('click', () => {
      const token = el.getAttribute('data-token');
      const start = input.selectionStart || input.value.length;
      const end = input.selectionEnd || input.value.length;
      input.value = input.value.slice(0, start) + token + input.value.slice(end);
      input.focus();
      input.setSelectionRange(start + token.length, start + token.length);
      update();
    });
  });
})();
</script>
{% endblock %}

