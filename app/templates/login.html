{% extends 'layout.html' %}

{% block title %}Sign Up - BatchTrack{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <h4 class="mb-0">
                                <i class="fas fa-user-plus"></i> 
                                {{ current_offer.name if current_offer else "Create Account" }}
                            </h4>
                        </div>
                        <div class="col-auto">
                            {% if current_offer %}
                            <span class="badge bg-success fs-6">
                                {{ current_offer.days }} Days FREE
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Trial Offer Banner -->
                    {% if current_offer %}
                    <div class="alert alert-success mb-4">
                        <div class="row align-items-center">
                            <div class="col">
                                <i class="fas fa-gift me-2"></i>
                                <strong>{{ current_offer.name }}:</strong> 
                                {{ current_offer.days }} days of full access to all features.
                                {% if current_offer.requires_billing %}
                                A payment method is required but you won't be charged until your trial ends.
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <form method="POST" id="signupForm">
                        <!-- Hidden fields for tracking -->
                        <input type="hidden" name="signup_source" value="{{ signup_source }}">
                        {% if referral_code %}
                        <input type="hidden" name="referral_code" value="{{ referral_code }}">
                        {% endif %}

                        <!-- Promo Code Section -->
                        <div class="mb-4">
                            <div class="row align-items-end">
                                <div class="col-md-8">
                                    <label for="promo_code" class="form-label">Promo Code (Optional)</label>
                                    <input type="text" class="form-control" id="promo_code" name="promo_code" 
                                           value="{{ promo_code or (form_data.promo_code if form_data else '') }}"
                                           placeholder="Enter promo code for additional savings">
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-primary" onclick="validatePromoCode()">
                                        Apply Code
                                    </button>
                                </div>
                            </div>
                            <div id="promoMessage" class="mt-2"></div>
                        </div>

                        <div class="row">
                            <!-- Left Column - Organization & Account -->
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <h5 class="text-muted">Organization Details</h5>
                                    <div class="mb-3">
                                        <label for="org_name" class="form-label">Organization Name *</label>
                                        <input type="text" class="form-control" id="org_name" name="org_name" required 
                                               value="{{ form_data.org_name if form_data else '' }}"
                                               placeholder="Your Company Name">
                                    </div>
                                </div>

                                <hr class="my-4">
                                <h5 class="text-muted">Your Account Details</h5>

                                <div class="mb-3">
