{% extends "layout.html" %}

{% block content %}
<div class="container">
    <h2>Upgrade Your Subscription</h2>

    <div class="current-plan">
        <h3>Current Plan: {{ current_tier.title() }}</h3>
    </div>

    <div class="pricing-cards">
        {% for tier_name, tier_data in pricing_data.items() %}
        <div class="pricing-card {% if tier_name == 'team' %}featured{% endif %}">
            <h3>{{ tier_name.title() }}</h3>
            <p class="price">{{ tier_data.price }}/month</p>
            <ul>
                {% for feature in tier_data.features %}
                <li>{{ feature }}</li>
                {% endfor %}
            </ul>
            {% if current_tier != tier_name %}
            <a href="{{ url_for('billing.checkout', tier=tier_name) }}" class="btn btn-primary">
                {% if current_tier == 'free' or 
                     (tier_name == 'team' and current_tier == 'solo') or
                     (tier_name == 'enterprise' and current_tier in ['free', 'solo', 'team']) %}
                    Upgrade to {{ tier_name.title() }}
                {% else %}
                    Switch to {{ tier_name.title() }}
                {% endif %}
            </a>
            {% else %}
            <button class="btn btn-secondary" disabled>Current Plan</button>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    {% if current_tier != 'free' %}
    <div class="cancel-section">
        <h3>Need to Cancel?</h3>
        <button id="cancel-subscription" class="btn btn-danger">Cancel Subscription</button>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cancelBtn = document.getElementById('cancel-subscription');
    if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to cancel your subscription? This action cannot be undone.')) {
                fetch('/billing/cancel-subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Failed to cancel subscription. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                });
            }
        });
    }
});
</script>
{% endblock %}