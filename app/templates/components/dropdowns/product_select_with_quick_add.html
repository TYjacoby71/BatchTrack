
{% macro product_select_dropdown(name="product_name", required=true, selected_value="", show_quick_add=true, css_class="form-select") %}
<div class="input-group">
  <select name="{{ name }}" class="{{ css_class }}" {% if required %}required{% endif %} onchange="handleProductChange(this)">
    <option value="">Select Product...</option>
    {% for product in get_all_products() %}
      <option value="{{ product.name }}" {% if product.name == selected_value %}selected{% endif %}>
        {{ product.name }}
      </option>
    {% endfor %}
  </select>
  {% if show_quick_add %}
  <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#quickAddProductModal" title="Quick Add Product">
    <i class="fas fa-plus"></i>
  </button>
  {% endif %}
</div>

<script>
function handleProductChange(selectElement) {
  const selectedProduct = selectElement.value;
  
  // Update variant dropdown if it exists
  const variantSelect = document.querySelector('select[name="variant_name"]');
  if (variantSelect && selectedProduct) {
    // Fetch variants for selected product
    fetch(`/api/products/${encodeURIComponent(selectedProduct)}/variants`)
      .then(response => response.json())
      .then(data => {
        // Clear existing options
        variantSelect.innerHTML = '<option value="">Select Variant...</option>';
        
        // Add variants
        data.variants.forEach(variant => {
          const option = document.createElement('option');
          option.value = variant.name;
          option.textContent = variant.name;
          variantSelect.appendChild(option);
        });
      })
      .catch(error => console.error('Error fetching variants:', error));
  }
}
</script>
{% endmacro %}
