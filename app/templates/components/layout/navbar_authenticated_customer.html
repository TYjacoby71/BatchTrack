{#
Synopsis:
Authenticated customer navigation and role-aware menu sections.
#}
<!-- Customer Navigation -->
<div class="navbar-nav me-auto">
</div>
{% if not has_nav_center %}
<ul class="navbar-nav mx-auto d-none d-md-flex">
    <li class="nav-item">
        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#unitConverterModal">
            ğŸ§® Converter
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="/tools">
            ğŸ”§ Tools
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('help_routes.help_overview') }}">
            â“ Help
        </a>
    </li>
    <li class="nav-item">
        <div class="navbar-text">
            <span id="header-clock" class="text-muted">ğŸ• Loading...</span>
        </div>
    </li>
</ul>
{% endif %}
<div class="dropdown ms-auto">
    <button class="btn btn-light dropdown-toggle" type="button" id="directoryDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-bars"></i> Menu
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="directoryDropdown">
        {% if not recipes_ingredients_tier_nav %}
        <!-- User Dashboard -->
        <li><a class="dropdown-item" href="{{ url_for('app_routes.dashboard') }}">User Dashboard</a></li>
        <li><hr class="dropdown-divider"></li>
        {% endif %}
        <!-- Core Features -->
        <li><h6 class="dropdown-header">Core Features</h6></li>
        {% if customer_can_view_inventory and (not recipes_ingredients_tier_nav or tier_can_adjust_inventory) %}
        <li><a class="dropdown-item" href="{{ url_for('inventory.list_inventory') }}">Inventory</a></li>
        {% elif recipes_ingredients_tier_nav %}
        <li>
            <button type="button"
                    class="dropdown-item d-flex justify-content-between align-items-center feature-locked-trigger"
                    data-bs-toggle="modal"
                    data-bs-target="#featureUpgradeModal"
                    data-feature-name="Inventory"
                    data-feature-description="Inventory management is available on upgraded plans.">
                Inventory
                <span class="badge bg-warning text-dark"><i class="fas fa-lock me-1"></i>Upgrade</span>
            </button>
        </li>
        {% endif %}
        {% if customer_can_view_recipes %}
        <li><a class="dropdown-item" href="{{ url_for('recipes.list_recipes') }}">Recipes</a></li>
        {% endif %}
        {% if customer_can_view_batches %}
        <li><a class="dropdown-item" href="{{ url_for('batches.list_batches') }}">Batches</a></li>
        {% endif %}
        {% if customer_can_view_products %}
        <li><a class="dropdown-item" href="{{ url_for('products.list_products') }}">Products</a></li>
        {% elif recipes_ingredients_tier_nav %}
        <li>
            <button type="button"
                    class="dropdown-item d-flex justify-content-between align-items-center feature-locked-trigger"
                    data-bs-toggle="modal"
                    data-bs-target="#featureUpgradeModal"
                    data-feature-name="Products"
                    data-feature-description="Product catalog and SKU outputs are available on upgraded plans.">
                Products
                <span class="badge bg-warning text-dark"><i class="fas fa-lock me-1"></i>Upgrade</span>
            </button>
        </li>
        {% endif %}
        <li><hr class="dropdown-divider"></li>
        {% if recipes_ingredients_tier_nav %}
        <!-- Free Tools -->
        <li><h6 class="dropdown-header">Free Tools</h6></li>
        <li>
            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#unitConverterModal">
                ğŸ§® Converter
            </a>
        </li>
        <li><a class="dropdown-item" href="/tools">ğŸ”§ Tools</a></li>
        <li><a class="dropdown-item" href="{{ url_for('help_routes.help_overview') }}">â“ Help</a></li>
        <li><hr class="dropdown-divider"></li>
        <!-- Settings -->
        <li><h6 class="dropdown-header">Settings</h6></li>
        {% if current_user.is_authenticated %}
        <li><a class="dropdown-item" href="{{ url_for('settings.index') }}">Settings</a></li>
        {% endif %}
        {% else %}
        <!-- Production Tools -->
        <li><h6 class="dropdown-header">Production Tools</h6></li>
        <li>
            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#unitConverterModal">
                ğŸ§® Converter
            </a>
        </li>
        <li>
            <a class="dropdown-item d-flex justify-content-between align-items-center" href="{{ url_for('expiration.alerts') }}">
                Expiration
                <span id="expiration-badge" class="badge bg-danger" style="display: none;">0</span>
            </a>
        </li>
        {% if customer_can_view_batches %}
        <li><a class="dropdown-item" href="{{ url_for('timers.list_timers') }}">Timers</a></li>
        {% endif %}
        {% if has_role('developer') or has_role('organization_owner') or has_permission(current_user, 'organization.manage') %}
        <li><a class="dropdown-item" href="{{ url_for('reservation.list_reservations') }}">Reservations</a></li>
        {% endif %}
        {% if customer_can_view_products and bulk_stock_check_enabled %}
        <li><a class="dropdown-item" href="{{ url_for('bulk_stock.bulk_stock_check') }}">Bulk Stock Check</a></li>
        {% endif %}
        {% if current_user.is_authenticated and has_permission(current_user, 'inventory.edit') and bulk_inventory_updates_enabled %}
        <li><a class="dropdown-item" href="{{ url_for('inventory.bulk_inventory_updates') }}">Bulk Inventory Updates</a></li>
        {% endif %}
        <li><hr class="dropdown-divider"></li>
        <!-- Resources -->
        <li><h6 class="dropdown-header">Resources</h6></li>
        {% if global_library_enabled %}
        <li><a class="dropdown-item" href="{{ url_for('global_library_bp.global_library') }}">Global Inventory Library</a></li>
        {% endif %}
        {% if show_recipe_library_link %}
        <li><a class="dropdown-item" href="{{ url_for('recipe_library_bp.recipe_library') }}">Recipe Library</a></li>
        {% endif %}
        <li><a class="dropdown-item" href="/tools">ğŸ”§ Tools</a></li>
        <li><a class="dropdown-item" href="{{ url_for('help_routes.help_overview') }}">â“ Help</a></li>
        <li><hr class="dropdown-divider"></li>
        <!-- Admin -->
        <li><h6 class="dropdown-header">Admin</h6></li>
        {% if current_user.is_authenticated and has_permission(current_user, 'organization.view') %}
        {% if current_user.user_type != 'developer' or session.get('dev_selected_org_id') %}
        <li><a class="dropdown-item" href="{{ url_for('organization.dashboard') }}">Organization Dashboard</a></li>
        {% endif %}
        {% endif %}
        {% if current_user.is_authenticated %}
        <li><a class="dropdown-item" href="{{ url_for('settings.index') }}">Settings</a></li>
        {% endif %}
        {% endif %}
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Logout</a></li>
    </ul>
</div>
