
<div class="modal fade" id="quickAddVariantModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Quick Add Variant</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="quickAddVariantForm">
          <input type="hidden" name="product_name" id="quickAddVariantProductName">
          <div class="mb-3">
            <label class="form-label">Product</label>
            <input type="text" id="quickAddVariantProductDisplay" class="form-control" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Variant Name</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="description" class="form-control" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary btn-sm" onclick="submitQuickAddVariant()">Add Variant</button>
      </div>
    </div>
  </div>
</div>

<script>
function openQuickAddVariant(productName) {
  document.getElementById('quickAddVariantProductName').value = productName || '';
  document.getElementById('quickAddVariantProductDisplay').value = productName || 'Select a product first';
  
  const modal = new bootstrap.Modal(document.getElementById('quickAddVariantModal'));
  modal.show();
}

function submitQuickAddVariant() {
  const form = document.getElementById('quickAddVariantForm');
  if (!form) return;

  const formData = new FormData(form);
  const data = Object.fromEntries(formData);
  const csrfToken = document.querySelector('input[name="csrf_token"]');
  
  if (!data.product_name) {
    alert('Please select a product first');
    return;
  }

  fetch(`/products/${encodeURIComponent(data.product_name)}/variants`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': csrfToken ? csrfToken.value : ''
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Close modal
      bootstrap.Modal.getInstance(document.getElementById('quickAddVariantModal')).hide();
      
      // Add to dropdown if it exists
      const variantSelect = document.querySelector('select[name="variant_name"]');
      if (variantSelect) {
        const option = document.createElement('option');
        option.value = data.variant.name;
        option.textContent = data.variant.name;
        option.selected = true;
        variantSelect.appendChild(option);
      }
      
      // Show success message
      if (typeof showAlert === 'function') {
        showAlert('Variant added successfully!', 'success');
      }
    } else {
      alert('Error: ' + (data.message || data.error));
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred while adding the variant.');
  });
}
</script>
