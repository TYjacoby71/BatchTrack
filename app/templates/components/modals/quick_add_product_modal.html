
<div class="modal fade" id="quickAddProductModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Quick Add Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="quickAddProductForm">
          <div class="mb-3">
            <label class="form-label">Product Name</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Product Base Unit</label>
            <select name="product_base_unit" class="form-select" required>
              {% for unit in get_global_unit_list() %}
                <option value="{{ unit.name }}">{{ unit.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Low Stock Threshold</label>
            <input type="number" name="low_stock_threshold" class="form-control" 
                   value="10" step="0.01" min="0">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary btn-sm" onclick="submitQuickAddProduct()">Add Product</button>
      </div>
    </div>
  </div>
</div>

<script>
function submitQuickAddProduct() {
  const form = document.getElementById('quickAddProductForm');
  if (!form) return;

  const formData = new FormData(form);
  const data = Object.fromEntries(formData);
  const csrfToken = document.querySelector('input[name="csrf_token"]');

  fetch("{{ url_for('products.add_product') }}", {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': csrfToken ? csrfToken.value : ''
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Close modal
      bootstrap.Modal.getInstance(document.getElementById('quickAddProductModal')).hide();
      
      // Add to dropdown if it exists
      const productSelect = document.querySelector('select[name="product_name"]');
      if (productSelect) {
        const option = document.createElement('option');
        option.value = data.product.name;
        option.textContent = data.product.name;
        option.selected = true;
        productSelect.appendChild(option);
        
        // Trigger change event
        productSelect.dispatchEvent(new Event('change'));
      }
      
      // Show success message
      if (typeof showAlert === 'function') {
        showAlert('Product added successfully!', 'success');
      }
    } else {
      alert('Error: ' + (data.message || data.error));
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred while adding the product.');
  });
}
</script>
