<div class="modal fade" id="quickAddContainerModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Quick Add Container</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="quickAddContainerForm">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="mb-3">
            <label for="container-name" class="form-label">Container Name</label>
            <input type="text" class="form-control" id="container-name" name="name" required>
          </div>
          <div class="mb-3">
            <label for="storage-amount" class="form-label">Storage Amount</label>
            <input type="number" class="form-control" id="storage-amount" name="storage_amount" step="0.01" required>
          </div>
          <div class="mb-3">
            <label for="storage-unit" class="form-label">Storage Unit</label>
            <select class="form-control" id="storage-unit" name="storage_unit" required>
              {% for unit in units %}
                <option value="{{ unit.name }}">{{ unit.name }}</option>
              {% endfor %}
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary" form="quickAddContainerForm">Add Container</button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('quickAddContainerForm');
  if (!form) return;

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(form);
    const submitBtn = form.querySelector('button[type="submit"]');

    submitBtn.disabled = true;
    submitBtn.textContent = 'Adding...';

    fetch('/quick-add/container', {
      method: 'POST',
      headers: {
        'X-CSRFToken': formData.get('csrf_token'),
        'Accept': 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      },
      body: formData
    })
    .then(response => {
      if (!response.ok) {
        return response.json().then(err => Promise.reject(err));
      }
      return response.json();
    })
    .then(data => {
            // Add to container dropdowns on the page
            document.querySelectorAll('select[name="allowed_containers[]"], .container-select').forEach(select => {
                const option = new Option(`${data.name} (${data.storage_amount} ${data.storage_unit})`, data.id);
                option.dataset.storageAmount = data.storage_amount;
                option.dataset.storageUnit = data.storage_unit;
                option.dataset.type = 'container';
                select.add(option);
            });

            // Show success message
            showAlert('success', 'Container added successfully!');

            // Reset form
            form.reset();

            // Hide modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('quickAddContainerModal'));
            modal.hide();
    })
    .catch(error => {
      console.error('Error:', error);
      alert(error.error || 'Failed to add container');
    })
    .finally(() => {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Add Container';
    });
  });
});
</script>