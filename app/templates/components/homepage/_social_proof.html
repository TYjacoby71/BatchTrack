<!-- Social Proof Section -->
<section class="social-proof">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Trusted by Makers Like You</h2>
            <p class="text-muted">See what our customers are saying</p>
        </div>

        {% set fallback_reviews = [
            {
                'name': 'River & Pine Studio',
                'title': 'Small-batch soap maker',
                'quote': 'BatchTrack keeps our batches and inventory flow clear without adding extra overhead.',
                'logo': None,
                'photo': None
            },
            {
                'name': 'Northline Candle Co.',
                'title': 'Candle maker',
                'quote': 'Planning and running batches is faster now because everything is tracked in one place.',
                'logo': None,
                'photo': None
            },
            {
                'name': 'Hearth & Grain Kitchen',
                'title': 'Baker and maker',
                'quote': 'We finally have a clean process for formulas, lot usage, and finished output records.',
                'logo': None,
                'photo': None
            }
        ] %}

        <div class="row justify-content-center">
            {% for idx in range(3) %}
            {% set fallback = fallback_reviews[idx] %}
            {% set source = (marketing_reviews[idx] if marketing_reviews|length > idx else fallback) %}
            {% set review_name = source.name or fallback.name %}
            {% set review_title = source.title or fallback.title %}
            {% set review_quote = source.quote or fallback.quote %}
            {% set customer_key = 'customer-' ~ (idx + 1) %}
            {% set customer_media = (homepage_testimonial_media.get(customer_key) if homepage_testimonial_media is defined else none) %}
            {% set logo_media = (customer_media.get('logo') if customer_media else none) %}
            {% set photo_media = (customer_media.get('photo') if customer_media else none) %}
            <div class="col-lg-4 homepage-card-col">
                <div class="testimonial-card h-100">
                    <div class="mb-3" style="height: 80px; display: flex; align-items: center; justify-content: center;">
                        {% if logo_media %}
                            {% if logo_media.kind == 'video' %}
                        <video class="testimonial-logo-media" autoplay muted loop playsinline preload="metadata" aria-label="{{ review_name }} logo media">
                            <source src="{{ url_for('static', filename=logo_media.path) }}">
                        </video>
                            {% elif logo_media.kind == 'youtube' and logo_media.embed_url %}
                        <iframe
                            class="testimonial-logo-media media-embed-frame"
                            src="{{ logo_media.embed_url }}"
                            title="{{ review_name }} logo media"
                            loading="lazy"
                            referrerpolicy="strict-origin-when-cross-origin"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowfullscreen
                        ></iframe>
                            {% else %}
                        <img src="{{ url_for('static', filename=logo_media.path) }}"
                             alt="{{ review_name }} logo"
                             class="testimonial-logo-media"
                             loading="lazy"
                             decoding="async">
                            {% endif %}
                        {% else %}
                        <div class="fw-semibold text-muted">{{ review_name }}</div>
                        {% endif %}
                    </div>
                    <p class="fst-italic">"{{ review_quote }}"</p>
                    <div class="d-flex align-items-center">
                        <div class="me-3" style="width: 50px; height: 50px;">
                            {% if photo_media %}
                                {% if photo_media.kind == 'video' %}
                            <video class="testimonial-photo-media" autoplay muted loop playsinline preload="metadata" aria-label="{{ review_name }} profile media">
                                <source src="{{ url_for('static', filename=photo_media.path) }}">
                            </video>
                                {% elif photo_media.kind == 'youtube' and photo_media.embed_url %}
                            <iframe
                                class="testimonial-photo-media media-embed-frame"
                                src="{{ photo_media.embed_url }}"
                                title="{{ review_name }} profile media"
                                loading="lazy"
                                referrerpolicy="strict-origin-when-cross-origin"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                allowfullscreen
                            ></iframe>
                                {% else %}
                            <img src="{{ url_for('static', filename=photo_media.path) }}"
                                 alt="{{ review_name }}"
                                 class="testimonial-photo-media"
                                 width="50"
                                 height="50"
                                 loading="lazy"
                                 decoding="async">
                                {% endif %}
                            {% else %}
                            <div class="rounded-circle d-flex align-items-center justify-content-center border bg-light text-muted fw-semibold" style="width: 50px; height: 50px;">{{ review_name[:1]|upper }}</div>
                            {% endif %}
                        </div>
                        <div>
                            <strong>{{ review_name }}</strong><br>
                            <small class="text-muted">{{ review_title }}</small>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
