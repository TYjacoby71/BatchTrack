<div class="card mb-4" id="categorySpecificCard" style="display:none;">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">
      <i class="fas fa-sliders-h"></i> Category Aids
    </h5>
  </div>
  <div class="card-body">
    <!-- Soap: lye and water calculators summary fields -->
    <div data-cat="Soaps" class="category-aid d-none">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label small">Superfat (%)</label>
          <input type="number" class="form-control" id="soap_superfat" name="soap_superfat" placeholder="e.g., 5" min="0" max="20" step="0.1">
        </div>
        <div class="col-md-3">
          <label class="form-label small">Water (% of oils)</label>
          <input type="number" class="form-control" id="soap_water_pct" name="soap_water_pct" placeholder="e.g., 33" min="10" max="50" step="0.1">
        </div>
        <div class="col-md-3">
          <label class="form-label small">Lye Type</label>
          <select id="soap_lye_type" name="soap_lye_type" class="form-select">
            <option value="NaOH">NaOH</option>
            <option value="KOH">KOH</option>
          </select>
        </div>
      </div>
      <small class="text-muted">Detailed per-oil SAP handled in Global Library; this is an aid.</small>
    </div>

    <!-- Candles: fragrance load -->
    <div data-cat="Candles" class="category-aid d-none">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label small">Fragrance Load (%)</label>
          <input type="number" class="form-control" id="candle_fragrance_pct" name="candle_fragrance_pct" placeholder="e.g., 8" min="0" max="20" step="0.1">
        </div>
        <div class="col-md-3">
          <label class="form-label small">Vessel Volume (ml)</label>
          <input type="number" class="form-control" id="candle_vessel_ml" name="candle_vessel_ml" placeholder="e.g., 240" min="0" step="1">
        </div>
      </div>
      <small class="text-muted">Advanced wick/vessel guidance coming soon.</small>
    </div>

    <!-- Cosmetics/Lotions: phases -->
    <div data-cat="Cosmetics" class="category-aid d-none">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label small">Preservative (%)</label>
          <input type="number" class="form-control" id="cosm_preservative_pct" name="cosm_preservative_pct" placeholder="e.g., 0.8" min="0" max="5" step="0.1">
        </div>
        <div class="col-md-3">
          <label class="form-label small">Emulsifier (%)</label>
          <input type="number" class="form-control" id="cosm_emulsifier_pct" name="cosm_emulsifier_pct" placeholder="e.g., 6" min="0" max="20" step="0.1">
        </div>
      </div>
      <small class="text-muted">Phase breakdown UI planned; using summary % for now.</small>
    </div>

    <!-- Baked Goods: baker's % -->
    <div data-cat="Baked Goods" class="category-aid d-none">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label small">Base Flour (g)</label>
          <input type="number" class="form-control" id="baker_base_flour_g" name="baker_base_flour_g" placeholder="e.g., 1000" min="0" step="1">
        </div>
      </div>
      <small class="text-muted">Use grams and bakerâ€™s % relative to flour.</small>
    </div>

    <!-- Herbalist: tincture ratio -->
    <div data-cat="Herbal" class="category-aid d-none">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label small">Tincture Ratio (g:ml)</label>
          <input type="text" class="form-control" id="herbal_ratio" name="herbal_ratio" placeholder="e.g., 1:5">
        </div>
      </div>
      <small class="text-muted">Basic ratio helper; full herbal profiles later.</small>
    </div>
  </div>
</div>

<script>
(function(){
  const categorySelect = document.getElementById('category_id');
  const card = document.getElementById('categorySpecificCard');
  function currentCategory(){
    if (categorySelect) {
      return categorySelect.options[categorySelect.selectedIndex]?.text?.trim() || '';
    }
    if (window && window.RECIPE_CATEGORY_NAME) {
      return String(window.RECIPE_CATEGORY_NAME);
    }
    return '';
  }
  function syncAids(){
    const selected = currentCategory();
    const aids = document.querySelectorAll('.category-aid');
    let any=false;
    aids.forEach(div => {
      const match = (div.getAttribute('data-cat')||'').toLowerCase();
      const on = selected && match && selected.toLowerCase().includes(match);
      div.classList.toggle('d-none', !on);
      any = any || on;
    });
    if (card) card.style.display = any ? 'block' : 'none';
  }
  if (categorySelect){
    categorySelect.addEventListener('change', syncAids);
  }
  syncAids();
})();
</script>
