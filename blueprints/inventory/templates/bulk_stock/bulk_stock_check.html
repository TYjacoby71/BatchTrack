
{% extends 'layout.html' %}
{% block content %}
<div class="container">
    <h2 class="mb-4">Bulk Stock Check</h2>

    <form method="post" class="mb-4">
        {{ csrf_token() }}
        <div class="form-group">
            <label for="recipe_ids">Select Recipes:</label>
            <select name="recipe_ids" id="recipe_ids" class="form-control" multiple size="6" required>
                {% for recipe in recipes %}
                <option value="{{ recipe.id }}">{{ recipe.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group mt-3">
            <label for="scale">Scale (applied to all):</label>
            <input type="number" step="0.1" name="scale" id="scale" class="form-control" value="1.0">
        </div>

        <button type="submit" class="btn btn-primary mt-3">Check Stock</button>
    </form>

    {% if summary %}
    <div class="card mt-4">
        <div class="card-header">
            <h3 class="card-title">Stock Summary</h3>
        </div>
        <div class="card-body">
            <table class="table">
                <thead>
                    <tr>
                        <th>Ingredient</th>
                        <th>Needed</th>
                        <th>Available</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in summary %}
                    <tr>
                        <td>{{ row.name }}</td>
                        <td>{{ "%.2f"|format(row.needed) }} {{ row.unit }}</td>
                        <td>{{ "%.2f"|format(row.available) }} {{ row.unit }}</td>
                        <td>
                            {% if row.status == 'OK' %}
                            <span class="text-success">✓</span>
                            {% elif row.status == 'LOW' %}
                            <span class="text-warning">⚠</span>
                            {% else %}
                            <span class="text-danger">✗</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <a href="{{ url_for('bulk_stock.export_shopping_list_csv') }}" class="btn btn-secondary">
                Download Shopping List
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
