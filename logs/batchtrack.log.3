2025-07-07 21:35:19,591 INFO: SKU lookup result: <ProductSKU Admin Apple Sauce - Base - Bulk> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:31]
2025-07-07 21:35:19,592 INFO: SKU details - inventory_item_id: 4, Product: Admin Apple Sauce, Variant: Base [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:33]
2025-07-07 21:35:19,593 INFO: SKU inventory item: <InventoryItem 4> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:34]
2025-07-07 21:35:19,593 INFO: Current inventory quantity: 1.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:36]
2025-07-07 21:35:19,593 INFO: Form request data: {'csrf_token': 'ImJmMDMzMGUyZTY5OTkzY2EzMTY5YTcyNWI5ZGIzOWI1MzY2NGFlYTMi.aGw9jw.Df0srprejGEPtc8MQidz8uwXA6A', 'action': 'adjust_fifo', 'inventory_id': '', 'change_type': 'sale', 'quantity': '1', 'notes': '', 'order_id': '', 'sale_price': '10.99', 'restock_cost': '', 'expiration_minutes': '30'} [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:53]
2025-07-07 21:35:19,593 INFO: Extracted quantity: 1 (type: <class 'str'>) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:59]
2025-07-07 21:35:19,593 INFO: Extracted change_type: sale [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:60]
2025-07-07 21:35:19,594 INFO: Converting quantity '1' to float [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:86]
2025-07-07 21:35:19,594 INFO: Converted quantity: 1.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:88]
2025-07-07 21:35:19,594 INFO: Optional fields extracted: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:102]
2025-07-07 21:35:19,594 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:103]
2025-07-07 21:35:19,594 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:104]
2025-07-07 21:35:19,594 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:105]
2025-07-07 21:35:19,594 INFO:   - sale_price: 10.99 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:106]
2025-07-07 21:35:19,595 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:107]
2025-07-07 21:35:19,595 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:108]
2025-07-07 21:35:19,595 INFO: === CALLING CENTRALIZED INVENTORY ADJUSTMENT === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:125]
2025-07-07 21:35:19,595 INFO: Parameters: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:126]
2025-07-07 21:35:19,595 INFO:   - item_id (inventory_item_id): 4 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:127]
2025-07-07 21:35:19,595 INFO:   - quantity: 1.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:128]
2025-07-07 21:35:19,595 INFO:   - change_type: sale [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:129]
2025-07-07 21:35:19,595 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:130]
2025-07-07 21:35:19,596 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:131]
2025-07-07 21:35:19,596 INFO:   - created_by: 2 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:132]
2025-07-07 21:35:19,596 INFO:   - item_type: product [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:133]
2025-07-07 21:35:19,596 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:134]
2025-07-07 21:35:19,596 INFO:   - sale_price: 10.99 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:135]
2025-07-07 21:35:19,596 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:136]
2025-07-07 21:35:19,596 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:137]
2025-07-07 21:35:19,597 INFO:   - custom_expiration_date: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:138]
2025-07-07 21:35:19,597 INFO:   - custom_shelf_life_days: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:139]
2025-07-07 21:35:19,607 ERROR: Exception in SKU inventory adjustment: Error adjusting inventory: (sqlite3.IntegrityError) NOT NULL constraint failed: product_sku_history.sku_id
[SQL: INSERT INTO product_sku_history (inventory_item_id, timestamp, change_type, quantity_change, remaining_quantity, original_quantity, unit, unit_cost, sale_price, customer, fifo_code, fifo_reference_id, fifo_source, is_perishable, shelf_life_days, expiration_date, batch_id, container_id, notes, note, created_by, order_id, reservation_id, is_reserved, sale_location, quantity_used, batch_number, lot_number, temperature_at_time, location_id, location_name, quality_status, compliance_status, quality_checked_by, marketplace_order_id, marketplace_source, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (4, '2025-07-07 21:35:19.606228', 'sale', 1.0, 0.0, None, 'floz', 1.0, 10.99, None, None, None, None, 0, None, None, None, None, '', None, 2, '', None, 0, None, 0.0, None, None, None, None, None, None, None, None, None, None, 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:203]
