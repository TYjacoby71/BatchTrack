2025-08-21 03:10:31,437 ERROR: Failed to record audit entry for item 1: (builtins.ValueError) could not convert string to float: 'Small deduction 50'
[SQL: INSERT INTO unified_inventory_history (inventory_item_id, timestamp, change_type, quantity_change, unit, unit_cost, remaining_quantity, fifo_reference_id, fifo_code, batch_id, created_by, notes, quantity_used, used_for_batch_id, is_perishable, shelf_life_days, expiration_date, location_id, location_name, temperature_at_time, quality_status, compliance_status, quality_checked_by, customer, sale_price, order_id, reservation_id, is_reserved, sale_location, marketplace_order_id, marketplace_source, batch_number, lot_number, container_id, fifo_source, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: [{'unit': 'g', 'remaining_quantity': 0.0, 'inventory_item_id': 1, 'quantity_change': 'Small deduction 50', 'change_type': 'initial_stock', 'organizatio ... (525 characters truncated) ... id': None, 'fifo_source': None, 'location_id': None, 'compliance_status': None, 'unit_cost': None, 'shelf_life_days': None, 'used_for_batch_id': None}]] [in /home/runner/workspace/app/services/inventory_adjustment/_audit.py:107]
2025-08-21 03:10:32,067 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 03:10:32,067 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 03:10:32,819 INFO: CANONICAL DISPATCHER: item_id=1, quantity=100.0, change_type=restock, caller=tests/test_inventory_comprehensive.py:test_item_update_with_quantity_change [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:37]
2025-08-21 03:10:32,819 INFO: CANONICAL DISPATCHER: item_id=1, quantity=100.0, change_type=restock, caller=tests/test_inventory_comprehensive.py:test_item_update_with_quantity_change [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:37]
2025-08-21 03:10:32,842 INFO: INITIAL STOCK: Detected item 1 has no FIFO history, using initial_stock handler [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:50]
2025-08-21 03:10:32,842 INFO: INITIAL STOCK: Detected item 1 has no FIFO history, using initial_stock handler [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:50]
2025-08-21 03:10:32,894 INFO: FIFO: Updating inventory item 1 quantity: 0.0 → 100.0 [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:213]
2025-08-21 03:10:32,894 INFO: FIFO: Updating inventory item 1 quantity: 0.0 → 100.0 [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:213]
2025-08-21 03:10:32,908 ERROR: Failed to record audit entry for item 1: (sqlite3.IntegrityError) NOT NULL constraint failed: unified_inventory_history.unit
[SQL: INSERT INTO unified_inventory_history (inventory_item_id, timestamp, change_type, quantity_change, unit, unit_cost, remaining_quantity, fifo_reference_id, fifo_code, batch_id, created_by, notes, quantity_used, used_for_batch_id, is_perishable, shelf_ ... 348 characters truncated ...  ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id]
[parameters: (1, '2025-08-21 03:10:32.893997', 'initial_stock', 100.0, None, 0.5, 100.0, None, None, None, 2, 'Initial stock entry', 0.0, None, 0, None, None, None, None, None, None, None, None, None, None, None, None, 0, None, None, None, None, None, None, None, 2)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /home/runner/workspace/app/services/inventory_adjustment/_audit.py:107]
2025-08-21 03:10:32,908 ERROR: Failed to record audit entry for item 1: (sqlite3.IntegrityError) NOT NULL constraint failed: unified_inventory_history.unit
[SQL: INSERT INTO unified_inventory_history (inventory_item_id, timestamp, change_type, quantity_change, unit, unit_cost, remaining_quantity, fifo_reference_id, fifo_code, batch_id, created_by, notes, quantity_used, used_for_batch_id, is_perishable, shelf_ ... 348 characters truncated ...  ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id]
[parameters: (1, '2025-08-21 03:10:32.893997', 'initial_stock', 100.0, None, 0.5, 100.0, None, None, None, 2, 'Initial stock entry', 0.0, None, 0, None, None, None, None, None, None, None, None, None, None, None, None, 0, None, None, None, None, None, None, None, 2)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /home/runner/workspace/app/services/inventory_adjustment/_audit.py:107]
2025-08-21 03:10:32,930 ERROR: Failed to record audit entry for item 1: (builtins.ValueError) could not convert string to float: 'initial_stock: 100.0'
[SQL: INSERT INTO unified_inventory_history (inventory_item_id, timestamp, change_type, quantity_change, unit, unit_cost, remaining_quantity, fifo_reference_id, fifo_code, batch_id, created_by, notes, quantity_used, used_for_batch_id, is_perishable, shelf_life_days, expiration_date, location_id, location_name, temperature_at_time, quality_status, compliance_status, quality_checked_by, customer, sale_price, order_id, reservation_id, is_reserved, sale_location, marketplace_order_id, marketplace_source, batch_number, lot_number, container_id, fifo_source, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: [{'unit': 'g', 'remaining_quantity': 0.0, 'inventory_item_id': 1, 'quantity_change': 'initial_stock: 100.0', 'change_type': 'initial_stock', 'organizat ... (526 characters truncated) ... id': None, 'fifo_source': None, 'location_id': None, 'compliance_status': None, 'unit_cost': None, 'shelf_life_days': None, 'used_for_batch_id': None}]] [in /home/runner/workspace/app/services/inventory_adjustment/_audit.py:107]
2025-08-21 03:10:32,930 ERROR: Failed to record audit entry for item 1: (builtins.ValueError) could not convert string to float: 'initial_stock: 100.0'
[SQL: INSERT INTO unified_inventory_history (inventory_item_id, timestamp, change_type, quantity_change, unit, unit_cost, remaining_quantity, fifo_reference_id, fifo_code, batch_id, created_by, notes, quantity_used, used_for_batch_id, is_perishable, shelf_life_days, expiration_date, location_id, location_name, temperature_at_time, quality_status, compliance_status, quality_checked_by, customer, sale_price, order_id, reservation_id, is_reserved, sale_location, marketplace_order_id, marketplace_source, batch_number, lot_number, container_id, fifo_source, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: [{'unit': 'g', 'remaining_quantity': 0.0, 'inventory_item_id': 1, 'quantity_change': 'initial_stock: 100.0', 'change_type': 'initial_stock', 'organizat ... (526 characters truncated) ... id': None, 'fifo_source': None, 'location_id': None, 'compliance_status': None, 'unit_cost': None, 'shelf_life_days': None, 'used_for_batch_id': None}]] [in /home/runner/workspace/app/services/inventory_adjustment/_audit.py:107]
2025-08-21 03:10:33,506 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 03:10:33,506 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
