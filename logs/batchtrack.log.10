2025-07-11 19:51:41,358 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:118]
2025-07-11 19:51:41,359 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:119]
2025-07-11 19:51:41,359 INFO: === CALLING CENTRALIZED INVENTORY ADJUSTMENT === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:185]
2025-07-11 19:51:41,359 INFO: Parameters: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:186]
2025-07-11 19:51:41,359 INFO:   - item_id (inventory_item_id): 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:187]
2025-07-11 19:51:41,359 INFO:   - quantity: 1.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:188]
2025-07-11 19:51:41,359 INFO:   - change_type: gift [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:189]
2025-07-11 19:51:41,359 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:190]
2025-07-11 19:51:41,360 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:191]
2025-07-11 19:51:41,360 INFO:   - created_by: 2 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:192]
2025-07-11 19:51:41,360 INFO:   - item_type: product [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:193]
2025-07-11 19:51:41,360 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:194]
2025-07-11 19:51:41,360 INFO:   - sale_price: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:195]
2025-07-11 19:51:41,360 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:196]
2025-07-11 19:51:41,360 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:197]
2025-07-11 19:51:41,360 INFO:   - custom_expiration_date: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:198]
2025-07-11 19:51:41,361 INFO:   - custom_shelf_life_days: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:199]
2025-07-11 19:51:41,439 INFO: === PRODUCT INVENTORY ADJUSTMENT END === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:235]
2025-07-11 19:51:41,440 INFO: Redirecting to SKU view: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:237]
2025-07-11 19:51:49,460 INFO: === PRODUCT INVENTORY ADJUSTMENT START === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:19]
2025-07-11 19:51:49,460 INFO: Inventory Item ID: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:20]
2025-07-11 19:51:49,461 INFO: User: 2 (admin) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:21]
2025-07-11 19:51:49,461 INFO: Organization: 1 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:22]
2025-07-11 19:51:49,461 INFO: Request method: POST [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:23]
2025-07-11 19:51:49,461 INFO: Request is JSON: False [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:24]
2025-07-11 19:51:49,463 INFO: SKU lookup result: <ProductSKU Admin Apple Sauce - Base - Bulk> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:32]
2025-07-11 19:51:49,463 INFO: SKU details - inventory_item_id: 3, Product: Admin Apple Sauce, Variant: Base [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:34]
2025-07-11 19:51:49,463 INFO: SKU inventory item: <InventoryItem 3> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:35]
2025-07-11 19:51:49,463 INFO: Current inventory quantity: 26.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:37]
2025-07-11 19:51:49,464 INFO: Form request data: {'csrf_token': 'ImUyYjY5MzZmMTkzMWM4M2MzNjM3MWRkNDNjZDE4NmQ3NTQ1MjQ5MTUi.aHFrTQ.aU3ht_k4Ze9Wwv-GnvOVcY2l6Hs', 'action': 'adjust_fifo', 'inventory_id': '', 'change_type': 'recount', 'quantity': '28', 'notes': '', 'order_id': '', 'sale_price': '', 'restock_cost': '', 'expiration_minutes': '30'} [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:54]
2025-07-11 19:51:49,464 INFO: Extracted quantity: 28 (type: <class 'str'>) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:60]
2025-07-11 19:51:49,464 INFO: Extracted change_type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:61]
2025-07-11 19:51:49,464 INFO: Converting quantity '28' to float [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:87]
2025-07-11 19:51:49,464 INFO: Converted quantity: 28.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:89]
2025-07-11 19:51:49,464 INFO: Optional fields extracted: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:113]
2025-07-11 19:51:49,464 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:114]
2025-07-11 19:51:49,465 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:115]
2025-07-11 19:51:49,465 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:116]
2025-07-11 19:51:49,465 INFO:   - sale_price: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:117]
2025-07-11 19:51:49,465 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:118]
2025-07-11 19:51:49,465 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:119]
2025-07-11 19:51:49,465 INFO: === USING DIRECT FIFO RECOUNT (like raw inventory) === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:137]
2025-07-11 19:51:49,465 INFO: Recounting inventory item 3 to 28.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:138]
2025-07-11 19:51:49,507 INFO: === PRODUCT INVENTORY ADJUSTMENT END === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:235]
2025-07-11 19:51:49,507 INFO: Redirecting to SKU view: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:237]
2025-07-11 19:51:58,250 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 19:52:01,190 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 19:52:01,917 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 19:55:28,352 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 19:55:32,126 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 19:55:32,830 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 19:58:35,751 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 19:58:39,593 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 19:58:40,358 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 20:00:08,872 INFO: Batch AAS-2025-020: Total ingredient cost $1.13, Unit cost $0.28 per floz [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:151]
2025-07-11 20:00:08,874 INFO: Processing container: Admin Glass Jars (ID: 2), 1 containers [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:232]
2025-07-11 20:00:08,874 INFO: Container cost calculation: 1 used Ã— $0.75 = $0.75, divided by 1 passed = $0.75 per container [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:233]
2025-07-11 20:00:08,874 INFO: Creating container SKU with container: Admin Glass Jars, quantity: 1 [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:268]
2025-07-11 20:00:08,874 INFO: Container cost breakdown: $1.13 ingredients + $0.75 container = $1.88 per container [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:283]
2025-07-11 20:00:08,942 ERROR: Error creating container SKU: Inventory adjustment failed validation: SYNC ERROR: Admin Apple Sauce - Base - 4.0 floz Admin Glass Jars inventory (7.0) != FIFO total (0) [includes frozen expired] [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:310]
2025-07-11 20:00:08,943 ERROR: Full traceback: Traceback (most recent call last):
  File "/home/runner/workspace/app/blueprints/batches/finish_batch.py", line 295, in _create_container_sku
    process_inventory_adjustment(
  File "/home/runner/workspace/app/services/inventory_adjustment.py", line 237, in process_inventory_adjustment
    raise e
  File "/home/runner/workspace/app/services/inventory_adjustment.py", line 231, in process_inventory_adjustment
    raise ValueError(f"Inventory adjustment failed validation: {error_msg}")
ValueError: Inventory adjustment failed validation: SYNC ERROR: Admin Apple Sauce - Base - 4.0 floz Admin Glass Jars inventory (7.0) != FIFO total (0) [includes frozen expired]
 [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:312]
2025-07-11 20:00:08,943 ERROR: Error processing container 2: Inventory adjustment failed validation: SYNC ERROR: Admin Apple Sauce - Base - 4.0 floz Admin Glass Jars inventory (7.0) != FIFO total (0) [includes frozen expired] [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:257]
