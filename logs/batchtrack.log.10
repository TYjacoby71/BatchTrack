2025-07-11 21:34:22,517 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 21:34:23,413 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 21:34:43,306 INFO: === PRODUCT INVENTORY ADJUSTMENT START === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:19]
2025-07-11 21:34:43,306 INFO: Inventory Item ID: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:20]
2025-07-11 21:34:43,307 INFO: User: 2 (admin) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:21]
2025-07-11 21:34:43,307 INFO: Organization: 1 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:22]
2025-07-11 21:34:43,307 INFO: Request method: POST [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:23]
2025-07-11 21:34:43,307 INFO: Request is JSON: False [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:24]
2025-07-11 21:34:43,309 INFO: SKU lookup result: <ProductSKU Admin Apple Sauce - Base - Bulk> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:32]
2025-07-11 21:34:43,310 INFO: SKU details - inventory_item_id: 3, Product: Admin Apple Sauce, Variant: Base [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:34]
2025-07-11 21:34:43,311 INFO: SKU inventory item: <InventoryItem 3> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:35]
2025-07-11 21:34:43,311 INFO: Current inventory quantity: 4.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:37]
2025-07-11 21:34:43,311 INFO: Form request data: {'csrf_token': 'ImUyYjY5MzZmMTkzMWM4M2MzNjM3MWRkNDNjZDE4NmQ3NTQ1MjQ5MTUi.aHGDaw.kAaiQZQvIWskmM2_DtKba2SXUf8', 'action': 'adjust_fifo', 'inventory_id': '', 'change_type': 'recount', 'quantity': '3', 'notes': '', 'order_id': '', 'sale_price': '', 'restock_cost': '', 'expiration_minutes': '30'} [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:54]
2025-07-11 21:34:43,312 INFO: Extracted quantity: 3 (type: <class 'str'>) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:60]
2025-07-11 21:34:43,312 INFO: Extracted change_type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:61]
2025-07-11 21:34:43,312 INFO: Converting quantity '3' to float [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:87]
2025-07-11 21:34:43,313 INFO: Converted quantity: 3.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:89]
2025-07-11 21:34:43,313 INFO: Optional fields extracted: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:113]
2025-07-11 21:34:43,314 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:114]
2025-07-11 21:34:43,314 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:115]
2025-07-11 21:34:43,315 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:116]
2025-07-11 21:34:43,316 INFO:   - sale_price: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:117]
2025-07-11 21:34:43,317 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:118]
2025-07-11 21:34:43,318 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:119]
2025-07-11 21:34:43,319 INFO: === CALLING CENTRALIZED INVENTORY ADJUSTMENT === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:137]
2025-07-11 21:34:43,320 INFO: Parameters: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:138]
2025-07-11 21:34:43,321 INFO:   - item_id (inventory_item_id): 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:139]
2025-07-11 21:34:43,321 INFO:   - quantity: 3.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:140]
2025-07-11 21:34:43,322 INFO:   - change_type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:141]
2025-07-11 21:34:43,322 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:142]
2025-07-11 21:34:43,322 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:143]
2025-07-11 21:34:43,322 INFO:   - created_by: 2 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:144]
2025-07-11 21:34:43,322 INFO:   - item_type: product [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:145]
2025-07-11 21:34:43,323 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:146]
2025-07-11 21:34:43,323 INFO:   - sale_price: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:147]
2025-07-11 21:34:43,323 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:148]
2025-07-11 21:34:43,324 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:149]
2025-07-11 21:34:43,324 INFO:   - custom_expiration_date: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:150]
2025-07-11 21:34:43,324 INFO:   - custom_shelf_life_days: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:151]
2025-07-11 21:34:43,399 ERROR: Exception in SKU inventory adjustment: Error adjusting inventory: cannot access local variable 'remaining_to_add' where it is not associated with a value [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:180]
2025-07-11 21:34:43,400 ERROR: Full traceback: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:181]
Traceback (most recent call last):
  File "/home/runner/workspace/app/blueprints/products/product_inventory_routes.py", line 153, in adjust_sku_inventory
    success = process_inventory_adjustment(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/app/services/inventory_adjustment.py", line 238, in process_inventory_adjustment
    raise e
  File "/home/runner/workspace/app/services/inventory_adjustment.py", line 98, in process_inventory_adjustment
    return handle_recount_adjustment(item_id, quantity, notes, created_by, item_type)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/app/services/inventory_adjustment.py", line 411, in handle_recount_adjustment
    raise e
  File "/home/runner/workspace/app/services/inventory_adjustment.py", line 360, in handle_recount_adjustment
    if remaining_to_add > 0:
       ^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'remaining_to_add' where it is not associated with a value
2025-07-11 21:34:43,403 INFO: === PRODUCT INVENTORY ADJUSTMENT END === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:187]
2025-07-11 21:34:43,403 INFO: Redirecting to SKU view: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:189]
2025-07-11 21:51:22,134 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 21:51:23,072 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-11 21:52:35,907 INFO: === PRODUCT INVENTORY ADJUSTMENT START === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:19]
2025-07-11 21:52:35,908 INFO: Inventory Item ID: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:20]
2025-07-11 21:52:35,908 INFO: User: 2 (admin) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:21]
2025-07-11 21:52:35,908 INFO: Organization: 1 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:22]
2025-07-11 21:52:35,908 INFO: Request method: POST [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:23]
2025-07-11 21:52:35,908 INFO: Request is JSON: False [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:24]
2025-07-11 21:52:35,911 INFO: SKU lookup result: <ProductSKU Admin Apple Sauce - Base - Bulk> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:32]
2025-07-11 21:52:35,911 INFO: SKU details - inventory_item_id: 3, Product: Admin Apple Sauce, Variant: Base [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:34]
2025-07-11 21:52:35,911 INFO: SKU inventory item: <InventoryItem 3> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:35]
2025-07-11 21:52:35,911 INFO: Current inventory quantity: 4.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:37]
2025-07-11 21:52:35,912 INFO: Form request data: {'csrf_token': 'ImUyYjY5MzZmMTkzMWM4M2MzNjM3MWRkNDNjZDE4NmQ3NTQ1MjQ5MTUi.aHGHnA.m1KtlvRqSYBfnTcey_r4anyM7BQ', 'action': 'adjust_fifo', 'inventory_id': '', 'change_type': 'sale', 'quantity': '1', 'notes': '', 'order_id': '', 'sale_price': '10.0', 'restock_cost': '', 'expiration_minutes': '30'} [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:54]
2025-07-11 21:52:35,912 INFO: Extracted quantity: 1 (type: <class 'str'>) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:60]
2025-07-11 21:52:35,912 INFO: Extracted change_type: sale [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:61]
2025-07-11 21:52:35,912 INFO: Converting quantity '1' to float [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:87]
2025-07-11 21:52:35,912 INFO: Converted quantity: 1.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:89]
