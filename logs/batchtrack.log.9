2025-07-11 20:00:08,943 ERROR: Container processing traceback: Traceback (most recent call last):
  File "/home/runner/workspace/app/blueprints/batches/finish_batch.py", line 236, in _process_container_allocations
    container_sku = _create_container_sku(
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/app/blueprints/batches/finish_batch.py", line 295, in _create_container_sku
    process_inventory_adjustment(
  File "/home/runner/workspace/app/services/inventory_adjustment.py", line 237, in process_inventory_adjustment
    raise e
  File "/home/runner/workspace/app/services/inventory_adjustment.py", line 231, in process_inventory_adjustment
    raise ValueError(f"Inventory adjustment failed validation: {error_msg}")
ValueError: Inventory adjustment failed validation: SYNC ERROR: Admin Apple Sauce - Base - 4.0 floz Admin Glass Jars inventory (7.0) != FIFO total (0) [includes frozen expired]
 [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:259]
2025-07-11 20:00:08,973 ERROR: Error creating bulk SKU: Inventory adjustment failed validation: SYNC ERROR: Admin Apple Sauce - Base - Bulk inventory (32.0) != FIFO total (0) [includes frozen expired] [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:344]
2025-07-11 20:00:08,974 ERROR: Error creating product output: Inventory adjustment failed validation: SYNC ERROR: Admin Apple Sauce - Base - Bulk inventory (32.0) != FIFO total (0) [includes frozen expired] [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:180]
2025-07-11 20:00:08,974 ERROR: Error completing batch 20: Inventory adjustment failed validation: SYNC ERROR: Admin Apple Sauce - Base - Bulk inventory (32.0) != FIFO total (0) [includes frozen expired] [in /home/runner/workspace/app/blueprints/batches/finish_batch.py:74]
2025-07-11 20:01:58,033 INFO: === PRODUCT INVENTORY ADJUSTMENT START === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:19]
2025-07-11 20:01:58,033 INFO: Inventory Item ID: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:20]
2025-07-11 20:01:58,034 INFO: User: 2 (admin) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:21]
2025-07-11 20:01:58,034 INFO: Organization: 1 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:22]
2025-07-11 20:01:58,034 INFO: Request method: POST [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:23]
2025-07-11 20:01:58,034 INFO: Request is JSON: False [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:24]
2025-07-11 20:01:58,036 INFO: SKU lookup result: <ProductSKU Admin Apple Sauce - Base - Bulk> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:32]
2025-07-11 20:01:58,036 INFO: SKU details - inventory_item_id: 3, Product: Admin Apple Sauce, Variant: Base [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:34]
2025-07-11 20:01:58,036 INFO: SKU inventory item: <InventoryItem 3> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:35]
2025-07-11 20:01:58,037 INFO: Current inventory quantity: 32.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:37]
2025-07-11 20:01:58,037 INFO: Form request data: {'csrf_token': 'ImUyYjY5MzZmMTkzMWM4M2MzNjM3MWRkNDNjZDE4NmQ3NTQ1MjQ5MTUi.aHFtiw.91M3BQ0SGIsHYktIzG_iBqTV08A', 'action': 'adjust_fifo', 'inventory_id': '', 'change_type': 'recount', 'quantity': '34', 'notes': '', 'order_id': '', 'sale_price': '', 'restock_cost': '', 'expiration_minutes': '30'} [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:54]
2025-07-11 20:01:58,037 INFO: Extracted quantity: 34 (type: <class 'str'>) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:60]
2025-07-11 20:01:58,037 INFO: Extracted change_type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:61]
2025-07-11 20:01:58,037 INFO: Converting quantity '34' to float [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:87]
2025-07-11 20:01:58,037 INFO: Converted quantity: 34.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:89]
2025-07-11 20:01:58,038 INFO: Optional fields extracted: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:113]
2025-07-11 20:01:58,038 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:114]
2025-07-11 20:01:58,038 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:115]
2025-07-11 20:01:58,038 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:116]
2025-07-11 20:01:58,038 INFO:   - sale_price: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:117]
2025-07-11 20:01:58,038 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:118]
2025-07-11 20:01:58,038 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:119]
2025-07-11 20:01:58,039 INFO: === USING DIRECT FIFO RECOUNT (like raw inventory) === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:137]
2025-07-11 20:01:58,039 INFO: Recounting inventory item 3 to 34.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:138]
2025-07-11 20:01:58,079 INFO: === PRODUCT INVENTORY ADJUSTMENT END === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:235]
2025-07-11 20:01:58,079 INFO: Redirecting to SKU view: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:237]
2025-07-11 20:02:22,841 INFO: === PRODUCT INVENTORY ADJUSTMENT START === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:19]
2025-07-11 20:02:22,842 INFO: Inventory Item ID: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:20]
2025-07-11 20:02:22,842 INFO: User: 2 (admin) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:21]
2025-07-11 20:02:22,842 INFO: Organization: 1 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:22]
2025-07-11 20:02:22,842 INFO: Request method: POST [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:23]
2025-07-11 20:02:22,842 INFO: Request is JSON: False [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:24]
2025-07-11 20:02:22,844 INFO: SKU lookup result: <ProductSKU Admin Apple Sauce - Base - Bulk> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:32]
2025-07-11 20:02:22,844 INFO: SKU details - inventory_item_id: 3, Product: Admin Apple Sauce, Variant: Base [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:34]
2025-07-11 20:02:22,845 INFO: SKU inventory item: <InventoryItem 3> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:35]
2025-07-11 20:02:22,845 INFO: Current inventory quantity: 34.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:37]
2025-07-11 20:02:22,845 INFO: Form request data: {'csrf_token': 'ImUyYjY5MzZmMTkzMWM4M2MzNjM3MWRkNDNjZDE4NmQ3NTQ1MjQ5MTUi.aHFttg.aRJ7d-XmOv5OGswVkw6Cs2P-aWM', 'action': 'adjust_fifo', 'inventory_id': '', 'change_type': 'recount', 'quantity': '35', 'notes': '', 'order_id': '', 'sale_price': '', 'restock_cost': '', 'expiration_minutes': '30'} [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:54]
2025-07-11 20:02:22,845 INFO: Extracted quantity: 35 (type: <class 'str'>) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:60]
2025-07-11 20:02:22,846 INFO: Extracted change_type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:61]
2025-07-11 20:02:22,846 INFO: Converting quantity '35' to float [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:87]
2025-07-11 20:02:22,846 INFO: Converted quantity: 35.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:89]
2025-07-11 20:02:22,846 INFO: Optional fields extracted: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:113]
2025-07-11 20:02:22,846 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:114]
2025-07-11 20:02:22,847 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:115]
2025-07-11 20:02:22,847 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:116]
2025-07-11 20:02:22,847 INFO:   - sale_price: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:117]
2025-07-11 20:02:22,847 INFO:   - order_id:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:118]
2025-07-11 20:02:22,847 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:119]
2025-07-11 20:02:22,847 INFO: === USING DIRECT FIFO RECOUNT (like raw inventory) === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:137]
2025-07-11 20:02:22,847 INFO: Recounting inventory item 3 to 35.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:138]
2025-07-11 20:02:22,912 INFO: === PRODUCT INVENTORY ADJUSTMENT END === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:235]
2025-07-11 20:02:22,912 INFO: Redirecting to SKU view: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:237]
2025-07-11 20:02:34,086 INFO: === PRODUCT INVENTORY ADJUSTMENT START === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:19]
2025-07-11 20:02:34,086 INFO: Inventory Item ID: 3 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:20]
