2025-07-09 18:14:46,235 INFO: Request method: POST [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:23]
2025-07-09 18:14:46,242 INFO: Request is JSON: False [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:24]
2025-07-09 18:14:46,244 INFO: SKU lookup result: <ProductSKU Admin Apple Sauce - Base - Bulk> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:32]
2025-07-09 18:14:46,244 INFO: SKU details - inventory_item_id: 4, Product: Admin Apple Sauce, Variant: Base [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:34]
2025-07-09 18:14:46,244 INFO: SKU inventory item: <InventoryItem 4> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:35]
2025-07-09 18:14:46,245 INFO: Current inventory quantity: 19.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:37]
2025-07-09 18:14:46,245 INFO: Form request data: {'csrf_token': 'IjgxZjU0NjFhZGZhNTJjMzA1YTc3OGI5ZmMyZGI2ZTVlYTViYmEyMWEi.aG6xgQ.V0FyWJ7xJUMFeMCU1rOoS-uekT0', 'change_type': 'recount', 'available_quantity': '0', 'reserved_quantity': '0', 'notes': ''} [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:54]
2025-07-09 18:14:46,245 INFO: Extracted quantity: None (type: <class 'NoneType'>) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:60]
2025-07-09 18:14:46,245 INFO: Extracted change_type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:61]
2025-07-09 18:14:46,245 INFO: Empty quantity detected. Change type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:65]
2025-07-09 18:14:46,245 INFO: Set quantity to 0 for recount operation [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:68]
2025-07-09 18:14:46,245 INFO: Converting quantity '0' to float [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:90]
2025-07-09 18:14:46,245 INFO: Converted quantity: 0.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:92]
2025-07-09 18:14:46,245 INFO: Optional fields extracted: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:116]
2025-07-09 18:14:46,246 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:117]
2025-07-09 18:14:46,246 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:118]
2025-07-09 18:14:46,246 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:119]
2025-07-09 18:14:46,246 INFO:   - sale_price: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:120]
2025-07-09 18:14:46,246 INFO:   - order_id: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:121]
2025-07-09 18:14:46,246 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:122]
2025-07-09 18:14:46,246 INFO: === DUAL RECOUNT: Available + Reserved === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:210]
2025-07-09 18:14:46,247 INFO: Recounting inventory item 4: 0.0 available, 0.0 reserved [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:216]
2025-07-09 18:14:46,250 ERROR: Exception in SKU inventory adjustment: Error adjusting inventory: name 'original_quantity' is not defined [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:339]
2025-07-09 18:14:46,250 ERROR: Full traceback: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:340]
Traceback (most recent call last):
  File "/home/runner/workspace/app/blueprints/products/product_inventory_routes.py", line 262, in adjust_sku_inventory
    qty_change = quantity - original_quantity
                            ^^^^^^^^^^^^^^^^^
NameError: name 'original_quantity' is not defined
2025-07-09 18:14:46,251 INFO: === PRODUCT INVENTORY ADJUSTMENT END === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:346]
2025-07-09 18:14:46,251 INFO: Redirecting to SKU view: 4 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:348]
2025-07-09 18:14:55,203 INFO: === PRODUCT INVENTORY ADJUSTMENT START === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:19]
2025-07-09 18:14:55,203 INFO: Inventory Item ID: 4 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:20]
2025-07-09 18:14:55,204 INFO: User: 2 (admin) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:21]
2025-07-09 18:14:55,204 INFO: Organization: 1 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:22]
2025-07-09 18:14:55,204 INFO: Request method: POST [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:23]
2025-07-09 18:14:55,204 INFO: Request is JSON: False [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:24]
2025-07-09 18:14:55,206 INFO: SKU lookup result: <ProductSKU Admin Apple Sauce - Base - Bulk> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:32]
2025-07-09 18:14:55,207 INFO: SKU details - inventory_item_id: 4, Product: Admin Apple Sauce, Variant: Base [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:34]
2025-07-09 18:14:55,207 INFO: SKU inventory item: <InventoryItem 4> [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:35]
2025-07-09 18:14:55,207 INFO: Current inventory quantity: 19.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:37]
2025-07-09 18:14:55,208 INFO: Form request data: {'csrf_token': 'IjgxZjU0NjFhZGZhNTJjMzA1YTc3OGI5ZmMyZGI2ZTVlYTViYmEyMWEi.aG6xlg.8FSA8zs3X5MtvULeAWnVDxwpK9I', 'change_type': 'recount', 'available_quantity': '0', 'reserved_quantity': '2.0', 'notes': ''} [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:54]
2025-07-09 18:14:55,208 INFO: Extracted quantity: None (type: <class 'NoneType'>) [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:60]
2025-07-09 18:14:55,208 INFO: Extracted change_type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:61]
2025-07-09 18:14:55,208 INFO: Empty quantity detected. Change type: recount [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:65]
2025-07-09 18:14:55,209 INFO: Set quantity to 0 for recount operation [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:68]
2025-07-09 18:14:55,209 INFO: Converting quantity '0' to float [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:90]
2025-07-09 18:14:55,209 INFO: Converted quantity: 0.0 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:92]
2025-07-09 18:14:55,209 INFO: Optional fields extracted: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:116]
2025-07-09 18:14:55,210 INFO:   - notes:  [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:117]
2025-07-09 18:14:55,210 INFO:   - unit: floz [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:118]
2025-07-09 18:14:55,210 INFO:   - customer: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:119]
2025-07-09 18:14:55,210 INFO:   - sale_price: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:120]
2025-07-09 18:14:55,211 INFO:   - order_id: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:121]
2025-07-09 18:14:55,211 INFO:   - cost_override: None [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:122]
2025-07-09 18:14:55,211 INFO: === DUAL RECOUNT: Available + Reserved === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:210]
2025-07-09 18:14:55,211 INFO: Recounting inventory item 4: 0.0 available, 2.0 reserved [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:216]
2025-07-09 18:14:55,214 ERROR: Exception in SKU inventory adjustment: Error adjusting inventory: name 'original_quantity' is not defined [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:339]
2025-07-09 18:14:55,215 ERROR: Full traceback: [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:340]
Traceback (most recent call last):
  File "/home/runner/workspace/app/blueprints/products/product_inventory_routes.py", line 262, in adjust_sku_inventory
    qty_change = quantity - original_quantity
                            ^^^^^^^^^^^^^^^^^
NameError: name 'original_quantity' is not defined
2025-07-09 18:14:55,216 INFO: === PRODUCT INVENTORY ADJUSTMENT END === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:346]
2025-07-09 18:14:55,216 INFO: Redirecting to SKU view: 4 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:348]
2025-07-09 18:15:43,044 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-09 18:15:48,931 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-09 18:15:49,700 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-09 18:15:52,973 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-09 18:15:53,915 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:17]
2025-07-09 18:16:09,197 INFO: === PRODUCT INVENTORY ADJUSTMENT START === [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:19]
2025-07-09 18:16:09,198 INFO: Inventory Item ID: 4 [in /home/runner/workspace/app/blueprints/products/product_inventory_routes.py:20]
