2025-08-21 05:39:36,580 WARNING: FIFO: History entry created but lot creation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:39:36.579711', '2025-08-21 05:39:36.579722', None, None, 'recount', 'Recount overflow - new lot: +10.0', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:116]
2025-08-21 05:39:36,581 ERROR: Error in _internal_add_fifo_entry_enhanced: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:39:36.579711', '2025-08-21 05:39:36.579722', None, None, 'recount', 'Recount overflow - new lot: +10.0', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a) [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:127]
2025-08-21 05:39:36,660 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:39:36,696 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:39:36,700 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:40:38,874 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:40:51,078 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:40:52,918 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:40:53,525 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,109 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,171 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,172 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,173 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,174 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,175 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,176 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,177 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:05,194 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,334 INFO: ADJUST INVENTORY - Item: Admin Apples (ID: 2) [in /home/runner/workspace/app/blueprints/inventory/routes.py:238]
2025-08-21 05:42:11,334 INFO: Form data received: {'quantity': '10', 'input_unit': 'acre', 'change_type': 'restock', 'cost_entry_type': 'no_change', 'csrf_token': 'IjNmY2I2MDg5Mzc0Y2YyYWMwMzcyYjRjNGY1ODU1NWU5ODA2OTRlNGYi.aKaxrQ.A5wXCceI5UVGb0yd1dHbyAA7KC8'} [in /home/runner/workspace/app/blueprints/inventory/routes.py:239]
2025-08-21 05:42:11,439 INFO: CANONICAL DISPATCHER: item_id=2, quantity=10.0, change_type=restock, caller=app/blueprints/inventory/routes.py:adjust_inventory [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:36]
2025-08-21 05:42:11,448 WARNING: FIFO: History entry created but lot creation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:42:11.447854', '2025-08-21 05:42:11.447861', None, None, 'restock', 'Restocked inventory', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:116]
2025-08-21 05:42:11,448 ERROR: Error in _internal_add_fifo_entry_enhanced: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:42:11.447854', '2025-08-21 05:42:11.447861', None, None, 'restock', 'Restocked inventory', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a) [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:127]
2025-08-21 05:42:11,450 ERROR: Error executing handler for restock on item 2: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:42:11.447854', '2025-08-21 05:42:11.447861', None, None, 'restock', 'Restocked inventory', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a) [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:85]
2025-08-21 05:42:11,542 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,590 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,644 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,895 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,927 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,928 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,929 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,930 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,931 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,933 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,933 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:11,945 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:42:19,706 INFO: ADJUST INVENTORY - Item: Admin Apples (ID: 2) [in /home/runner/workspace/app/blueprints/inventory/routes.py:238]
2025-08-21 05:42:19,706 INFO: Form data received: {'quantity': '10', 'input_unit': 'count', 'change_type': 'restock', 'cost_entry_type': 'no_change', 'csrf_token': 'IjNmY2I2MDg5Mzc0Y2YyYWMwMzcyYjRjNGY1ODU1NWU5ODA2OTRlNGYi.aKaxsw.6dP_PVFxNbTcsfUhX0PkhbI6TXE'} [in /home/runner/workspace/app/blueprints/inventory/routes.py:239]
2025-08-21 05:42:19,707 INFO: CANONICAL DISPATCHER: item_id=2, quantity=10.0, change_type=restock, caller=app/blueprints/inventory/routes.py:adjust_inventory [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:36]
2025-08-21 05:42:19,709 WARNING: FIFO: History entry created but lot creation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:42:19.709418', '2025-08-21 05:42:19.709425', None, None, 'restock', 'Restocked inventory', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:116]
