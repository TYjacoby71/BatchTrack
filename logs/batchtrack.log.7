2025-08-21 10:14:31,688 ERROR:     Entry 5: 10.0 (restock, 2025-08-21 08:17:52.969595) [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:39]
2025-08-21 10:14:31,689 ERROR:     Entry 6: 10.0 (restock, 2025-08-21 09:58:03.312339) [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:39]
2025-08-21 10:14:31,690 ERROR:     Entry 7: 10.0 (restock, 2025-08-21 10:07:17.816094) [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:39]
2025-08-21 10:14:31,690 ERROR:     Entry 8: 10.0 (restock, 2025-08-21 10:14:26.474986) [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:39]
2025-08-21 10:14:31,690 ERROR: FIFO VALIDATION FAILED before commit for item 2: FIFO sync error: inventory=70.0, fifo_total=80.0, diff=10.0 [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:84]
2025-08-21 10:14:31,690 ERROR: Adjustment failed: FIFO validation failed: FIFO sync error: inventory=70.0, fifo_total=80.0, diff=10.0 [in /home/runner/workspace/app/blueprints/inventory/routes.py:338]
2025-08-21 10:14:31,757 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:14:31,784 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:14:31,789 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:14:44,020 INFO: EDIT INVENTORY - Item: Admin Apples (ID: 2) [in /home/runner/workspace/app/blueprints/inventory/routes.py:373]
2025-08-21 10:14:44,021 INFO: Form data received: {'csrf_token': 'IjNmY2I2MDg5Mzc0Y2YyYWMwMzcyYjRjNGY1ODU1NWU5ODA2OTRlNGYi.aKbxhw.sRyDKEjg0zuillFeTxdpoGBkvF8', 'name': 'Admin Apples', 'quantity': '0', 'type': 'ingredient', 'is_perishable': 'on', 'shelf_life_days': '1', 'category_id': '', 'unit': 'count', 'density': '0.0', 'cost_per_unit': '3.0', 'confirm_unit_change': 'false', 'convert_inventory': 'false', 'change_type': 'recount'} [in /home/runner/workspace/app/blueprints/inventory/routes.py:374]
2025-08-21 10:14:44,021 INFO: QUANTITY RECOUNT: Target quantity 0.0 for item Admin Apples [in /home/runner/workspace/app/blueprints/inventory/routes.py:383]
2025-08-21 10:14:44,021 INFO: CANONICAL: item_id=2, qty=0.0, type=recount [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:14]
2025-08-21 10:14:44,022 INFO: RECOUNT: Item 2 current=80.0, target=0.0, delta=-80.0 [in /home/runner/workspace/app/services/inventory_adjustment/_recount_logic.py:35]
2025-08-21 10:14:44,022 INFO: RECOUNT: Removing 80.0 from existing lots [in /home/runner/workspace/app/services/inventory_adjustment/_recount_logic.py:61]
2025-08-21 10:14:44,025 INFO: RECOUNT: Zeroed lot LOTMIER82QM (was 10.0) [in /home/runner/workspace/app/services/inventory_adjustment/_recount_logic.py:98]
2025-08-21 10:14:44,026 INFO: RECOUNT: Zeroed lot LOT13KJ1M2O0 (was 10.0) [in /home/runner/workspace/app/services/inventory_adjustment/_recount_logic.py:98]
2025-08-21 10:14:44,026 INFO: RECOUNT: Zeroed all lots, 60.0 units deducted beyond available FIFO [in /home/runner/workspace/app/services/inventory_adjustment/_recount_logic.py:125]
2025-08-21 10:14:44,026 INFO: RECOUNT SUCCESS: Item 2 FIFO reconciled for target 0.0 [in /home/runner/workspace/app/services/inventory_adjustment/_recount_logic.py:185]
2025-08-21 10:14:44,120 INFO: SUCCESS: recount completed for item 2 (FIFO validated) [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:96]
2025-08-21 10:14:44,121 INFO: RECOUNT SUCCESS: Inventory recounted to 0.0 [in /home/runner/workspace/app/blueprints/inventory/routes.py:398]
2025-08-21 10:14:44,193 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:14:44,212 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:14:44,215 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:08,752 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:08,793 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:08,799 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:11,402 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:11,428 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:11,432 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:14,928 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:14,970 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:14,975 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:17,403 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:17,423 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:17,427 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,712 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,747 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,748 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,749 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,750 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,751 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,753 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,754 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:21,771 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:27,458 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:27,477 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:27,480 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:29,732 INFO: ADJUST INVENTORY - Item: wine (ID: 16) [in /home/runner/workspace/app/blueprints/inventory/routes.py:280]
2025-08-21 10:16:29,732 INFO: Form data received: {'csrf_token': 'IjNmY2I2MDg5Mzc0Y2YyYWMwMzcyYjRjNGY1ODU1NWU5ODA2OTRlNGYi.aKbx-w.835hkAbkW-_nXf3IV2exzNLdtSc', 'change_type': 'restock', 'quantity': '20', 'input_unit': 'gallon', 'cost_entry_type': 'no_change', 'cost_per_unit': '0', 'notes': ''} [in /home/runner/workspace/app/blueprints/inventory/routes.py:281]
2025-08-21 10:16:29,732 INFO: Attempting to adjust inventory for item wine with quantity 20.0, change type restock, unit gallon [in /home/runner/workspace/app/blueprints/inventory/routes.py:317]
2025-08-21 10:16:29,732 INFO: CANONICAL: item_id=16, qty=20.0, type=restock [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:14]
2025-08-21 10:16:29,733 INFO: RESTOCK: Adding 20.0 to item 16 [in /home/runner/workspace/app/services/inventory_adjustment/_additive_ops.py:20]
2025-08-21 10:16:29,733 INFO: FIFO: Created lot LOT1HFAYGGM1 with 20.0 gallon for item 16 (perishable: False) [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:98]
2025-08-21 10:16:29,734 INFO: RESTOCK SUCCESS: Will increase item 16 by 20.0 [in /home/runner/workspace/app/services/inventory_adjustment/_additive_ops.py:46]
2025-08-21 10:16:29,734 INFO: QUANTITY UPDATE: Item 16 quantity -10.0 + 20.0 = 10.0 [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:72]
2025-08-21 10:16:29,738 ERROR: FIFO SYNC MISMATCH for item 16 (wine): [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:31]
2025-08-21 10:16:29,738 ERROR:   Item quantity: 10.0 [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:32]
2025-08-21 10:16:29,738 ERROR:   FIFO total: 60.0 [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:33]
2025-08-21 10:16:29,738 ERROR:   Difference: 50.0 [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:34]
2025-08-21 10:16:29,739 ERROR:   Active FIFO entries: 4 [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:35]
2025-08-21 10:16:29,739 ERROR:     Entry 1: 10.0 (initial_stock, 2025-08-21 07:07:45.433520) [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:39]
2025-08-21 10:16:29,739 ERROR:     Entry 2: 10.0 (restock, 2025-08-21 08:08:51.039081) [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:39]
2025-08-21 10:16:29,739 ERROR:     Entry 3: 20.0 (restock, 2025-08-21 08:12:24.907911) [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:39]
2025-08-21 10:16:29,739 ERROR:     Entry 4: 20.0 (restock, 2025-08-21 10:16:29.736564) [in /home/runner/workspace/app/services/inventory_adjustment/_validation.py:39]
2025-08-21 10:16:29,740 ERROR: FIFO VALIDATION FAILED before commit for item 16: FIFO sync error: inventory=10.0, fifo_total=60.0, diff=50.0 [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:84]
2025-08-21 10:16:29,740 ERROR: Adjustment failed: FIFO validation failed: FIFO sync error: inventory=10.0, fifo_total=60.0, diff=50.0 [in /home/runner/workspace/app/blueprints/inventory/routes.py:338]
2025-08-21 10:16:29,804 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:29,832 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 10:16:29,837 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
