2025-08-21 05:46:08,756 INFO: CANONICAL DISPATCHER: item_id=1, quantity=50.0, change_type=restock, caller=tests/test_inventory_basic_operations.py:test_cost_tracking_basic [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:36]
2025-08-21 05:46:08,775 INFO: INITIAL STOCK: Detected item 1 has no FIFO history, using initial_stock handler [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:49]
2025-08-21 05:52:42,502 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:52:53,646 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:52:55,497 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:52:55,905 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,133 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,214 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,216 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,217 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,218 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,220 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,222 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,224 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:35,240 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:36,904 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:36,947 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:36,999 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:39,135 INFO: ADJUST INVENTORY - Item: Admin Apples (ID: 2) [in /home/runner/workspace/app/blueprints/inventory/routes.py:238]
2025-08-21 05:54:39,135 INFO: Form data received: {'csrf_token': 'IjNmY2I2MDg5Mzc0Y2YyYWMwMzcyYjRjNGY1ODU1NWU5ODA2OTRlNGYi.aKa0nA.H_F5Hvw3d4yZ833M35_jvVzqR5w', 'change_type': 'restock', 'quantity': '10', 'input_unit': 'count', 'cost_entry_type': 'no_change', 'cost_per_unit': '3', 'notes': ''} [in /home/runner/workspace/app/blueprints/inventory/routes.py:239]
2025-08-21 05:54:39,215 INFO: CANONICAL DISPATCHER: item_id=2, quantity=10.0, change_type=restock, caller=app/blueprints/inventory/routes.py:adjust_inventory [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:36]
2025-08-21 05:54:39,223 WARNING: FIFO: History entry created but lot creation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:54:39.222794', '2025-08-21 05:54:39.222802', None, None, 'restock', 'Restocked inventory', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:116]
2025-08-21 05:54:39,223 ERROR: Error in _internal_add_fifo_entry_enhanced: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:54:39.222794', '2025-08-21 05:54:39.222802', None, None, 'restock', 'Restocked inventory', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a) [in /home/runner/workspace/app/services/inventory_adjustment/_fifo_ops.py:127]
2025-08-21 05:54:39,225 ERROR: Error executing handler for restock on item 2: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlite3.IntegrityError) UNIQUE constraint failed: inventory_lot.fifo_code
[SQL: INSERT INTO inventory_lot (inventory_item_id, remaining_quantity, original_quantity, unit, unit_cost, created_at, received_date, expiration_date, shelf_life_days, source_type, source_notes, created_by, fifo_code, organization_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (2, 10.0, 10.0, 'count', 3.0, '2025-08-21 05:54:39.222794', '2025-08-21 05:54:39.222802', None, None, 'restock', 'Restocked inventory', 2, 'LOT', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a) [in /home/runner/workspace/app/services/inventory_adjustment/_core.py:85]
2025-08-21 05:54:39,292 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:39,311 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:54:39,314 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:55:00,631 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:55:23,793 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:55:25,738 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:55:26,129 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:55:42,672 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:04,028 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:06,339 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:06,756 INFO: Getting global unit list [in /home/runner/workspace/app/utils/unit_utils.py:32]
2025-08-21 05:56:17,442 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:21,715 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:21,920 INFO: ADJUST INVENTORY - Item: New Item (ID: 1) [in /home/runner/workspace/app/blueprints/inventory/routes.py:238]
2025-08-21 05:56:21,921 INFO: Form data received: {'change_type': 'restock', 'quantity': '100.0', 'input_unit': 'g', 'cost_entry_type': 'no_change', 'notes': 'Initial stock'} [in /home/runner/workspace/app/blueprints/inventory/routes.py:239]
2025-08-21 05:56:22,051 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:22,051 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:22,094 INFO: ADJUST INVENTORY - Item: Test Item (ID: 1) [in /home/runner/workspace/app/blueprints/inventory/routes.py:238]
2025-08-21 05:56:22,094 INFO: ADJUST INVENTORY - Item: Test Item (ID: 1) [in /home/runner/workspace/app/blueprints/inventory/routes.py:238]
2025-08-21 05:56:22,094 INFO: Form data received: {'change_type': 'recount', 'quantity': '80', 'notes': 'Physical count adjustment'} [in /home/runner/workspace/app/blueprints/inventory/routes.py:239]
2025-08-21 05:56:22,094 INFO: Form data received: {'change_type': 'recount', 'quantity': '80', 'notes': 'Physical count adjustment'} [in /home/runner/workspace/app/blueprints/inventory/routes.py:239]
2025-08-21 05:56:22,323 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:22,323 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:22,323 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,330 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,330 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,330 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,330 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,510 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,510 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,510 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,510 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,510 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,770 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,770 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,770 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,770 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,770 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
2025-08-21 05:56:23,770 INFO: BatchTrack startup [in /home/runner/workspace/app/utils/unit_utils.py:28]
