
<!DOCTYPE html>
<html>
<head>
    <title>Start Batch - {{ recipe.name }}</title>
</head>
<body>
    <h1>Start Batch - {{ recipe.name }}</h1>
    
    <form method="POST">
        <div>
            <label>Scale:</label><br>
            <strong>{{ scale }}x</strong>
            <input type="hidden" name="scale" value="{{ scale }}">
        </div>

        <div>
            <label for="notes">Notes:</label><br>
            <textarea name="notes" id="notes"></textarea>
        </div>

        <div>
            <label for="tags">Tags (comma-separated):</label><br>
            <input type="text" name="tags" id="tags">
        </div>

        <div style="margin-top: 20px;">
            <a href="/recipes" class="button">Back to Planning</a>
            <button type="submit" name="continue_batch">Continue</button>
        </div>
    </form>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const input = document.getElementById("tags");
  const suggestionsBox = document.getElementById("tagSuggestions");
  let allTags = [];

  fetch("/tags.json")
    .then(res => res.json())
    .then(data => allTags = data);

  input.addEventListener("input", function() {
    const query = input.value.toLowerCase();
    const used = query.split(',').map(s => s.trim());
    const current = used[used.length - 1];

    suggestionsBox.innerHTML = '';
    if (current.length === 0) return;

    allTags.filter(tag => tag.includes(current) && !used.includes(tag))
           .slice(0, 5)
           .forEach(tag => {
              const li = document.createElement("li");
              li.textContent = tag;
              li.style.cursor = "pointer";
              li.onclick = () => {
                used[used.length - 1] = tag;
                input.value = used.join(', ') + ', ';
                suggestionsBox.innerHTML = '';
              };
              suggestionsBox.appendChild(li);
           });
  });
});
</script>
</body>
</html>
