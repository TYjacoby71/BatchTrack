
<!DOCTYPE html>
<html>
<head>
    <title>Start Batch - {{ recipe.name }}</title>
</head>
<body>
    <h1>Start Batch - {{ recipe.name }}</h1>
    
    <form method="POST">
        <h3>Ingredients:</h3>
        <ul>
        {% for ingredient in recipe.ingredients %}
            <li>{{ ingredient.name }}: {{ ingredient.quantity }} {{ ingredient.unit }}</li>
        {% endfor %}
        </ul>

        <div>
            <label for="notes">Notes:</label><br>
            <textarea name="notes" id="notes"></textarea>
        </div>

        <div>
            <label for="tags">Tags (comma-separated):</label><br>
            <input type="text" name="tags" id="tags">
        </div>

        <button type="submit">Start Batch</button>
    </form>

    <a href="/recipes">Back to Recipes</a>
<label>Tags (comma-separated):</label>
<input type="text" id="tagsInput" name="tags" placeholder="e.g. lavender, night-use">
<ul id="tagSuggestions" style="list-style: none; padding: 0; margin: 0;"></ul>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const input = document.getElementById("tagsInput");
  const suggestionsBox = document.getElementById("tagSuggestions");
  let allTags = [];

  fetch("/tags.json")
    .then(res => res.json())
    .then(data => allTags = data);

  input.addEventListener("input", function() {
    const query = input.value.toLowerCase();
    const used = query.split(',').map(s => s.trim());
    const current = used[used.length - 1];

    suggestionsBox.innerHTML = '';
    if (current.length === 0) return;

    allTags.filter(tag => tag.includes(current) && !used.includes(tag))
           .slice(0, 5)
           .forEach(tag => {
              const li = document.createElement("li");
              li.textContent = tag;
              li.style.cursor = "pointer";
              li.onclick = () => {
                used[used.length - 1] = tag;
                input.value = used.join(', ') + ', ';
                suggestionsBox.innerHTML = '';
              };
              suggestionsBox.appendChild(li);
           });
  });
});
</script>
</body>
</html>
