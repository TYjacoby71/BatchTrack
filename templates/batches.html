
{% extends "layout.html" %}
{% block content %}
<h1>📦 Batches</h1>
<p><a href="/recipes"><button>+ Start New Batch</button></a></p>

<div style="margin-bottom: 20px;">
  <a href="/ingredients/usage">View Ingredient Usage</a> |
  <a href="/batches/export?tag={{ request.args.get('tag', '') }}&recipe={{ request.args.get('recipe', '') }}">Export to CSV</a>
</div>

<form method="get" style="margin-bottom: 20px;">
  <label>Filter by tag:</label>
  <input type="text" name="tag" value="{{ request.args.get('tag', '') }}">
  <label>Recipe name:</label>
  <input type="text" name="recipe" value="{{ request.args.get('recipe', '') }}">
  <button type="submit">Apply</button>
  <a href="/batches">Clear</a>
</form>

<table border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr>
      <th>Recipe</th>
      <th>Date</th>
      <th>Total Cost</th>
      <th>Tags</th>
      <th>Notes</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for batch in batches %}
      <tr>
        <td>
          {{ batch.recipe_name }}
          {% if 'repeat' in batch.tags %}
            <span title="Popular batch">⭐</span>
          {% endif %}
        </td>
        <td>{{ batch.timestamp }}</td>
        <td>${{ batch.total_cost|default(0.00) }}</td>
        <td>
          {% for tag in batch.tags|default([]) %}
            <a href="/batches?tag={{ tag }}" style="margin-right: 5px; text-decoration:none;">
              <span style="background:#eee; border-radius:4px; padding:2px 6px;">#{{ tag }}</span>
            </a>
          {% endfor %}
        </td>
        <td>{{ batch.notes[:60] ~ ("..." if batch.notes|length > 60 else "") if batch.notes else "" }}</td>
        <td>
          <a href="/batches/{{ batch.id }}/edit-notes">📝 Edit</a> |
          <a href="/batches/{{ batch.id }}/print" target="_blank">🖨️ Print</a> |
          <a href="/batches/{{ batch.id }}/favorite">{% if 'favorite' in batch.tags %}⭐ Unfav{% else %}☆ Fav{% endif %}</a> |
          <a href="/batches/{{ batch.id }}/repeat">🔁 Repeat</a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
