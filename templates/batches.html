{% extends "layout.html" %}
{% block content %}
<h2>Batches</h2>

<div style="margin-bottom: 20px;">
  <a href="/ingredients/usage">View Ingredient Usage</a> |
  <a href="/batches/export?tag={{ request.args.get('tag', '') }}&recipe={{ request.args.get('recipe', '') }}">Export to CSV</a>
</div>

<form method="get" style="margin-bottom: 20px;">
  <label>Filter by tag:</label>
  <input type="text" name="tag" value="{{ request.args.get('tag', '') }}">
  <label>Recipe name:</label>
  <input type="text" name="recipe" value="{{ request.args.get('recipe', '') }}">
  <button type="submit">Apply</button>
  <a href="/batches">Clear</a>
</form>

<table border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr>
      <th>Recipe</th>
      <th>Date</th>
      <th>Total Cost</th>
      <th>Tags</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for batch in batches %}
      <tr>
        <td>{{ batch.recipe_name }}</td>
        <td>{{ batch.timestamp }}</td>
        <td>${{ batch.total_cost|default(0.00) }}</td>
        <td>{{ batch.tags|join(', ') if batch.tags else '' }}</td>
        <td><a href="/batches/{{ batch.id }}/print" target="_blank">üñ®Ô∏è Print</a></td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}