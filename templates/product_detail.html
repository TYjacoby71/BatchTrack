{% extends 'layout.html' %}
{% block content %}
<h2>Product: {{ product.name }}</h2>
<p>Quantity: {{ product.quantity }} {{ product.unit }}</p>
<p>Expires: {{ product.expiration_date }}</p>
{% if product.image %}
  <img src="{{ url_for('static', filename=product.image.split('static/')[-1]) }}" width="150">
{% endif %}

<h3>Log Event</h3>
<form method="post">
  {{ csrf_token() }}
  <label>Type:</label>
  <select name="event_type">
    <option value="sold">Sold</option>
    <option value="spoiled">Spoiled</option>
    <option value="sample">Sample</option>
  </select><br>
  <label>Note:</label><br>
  <textarea name="note" rows="3"></textarea><br>
  <button type="submit">Log Event</button>
</form>

<h3>History</h3>
<ul>
  {% for event in events %}
    <li>[{{ event.timestamp.strftime('%Y-%m-%d') }}] {{ event.event_type }} â€” {{ event.note }}</li>
  {% endfor %}
</ul>
{% if not events %}
<p>No events logged yet.</p>
{% endif %}

<div class="card mt-4">
  <div class="card-body">
    <h4>Manual FIFO Deduction</h4>
    <form method="POST" action="{{ url_for('product.deduct_product', product_id=product.id) }}">
      {{ csrf_token() }}
      <input type="text" name="variant" placeholder="Variant (e.g. 4 oz)" class="form-control mb-2" required>
      <input type="text" name="unit" placeholder="Unit (e.g. Jar)" class="form-control mb-2" required>
      <input type="number" step="1" name="quantity" placeholder="Qty to deduct" class="form-control mb-2" required>
      <button type="submit" class="btn btn-warning">Deduct FIFO</button>
    </form>
  </div>
</div>
<a href="/">Back to Home</a>
{% endblock %}