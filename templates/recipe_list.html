{% extends "layout.html" %}
{% block content %}
<h1>ðŸ“˜ Recipes</h1>
<p><a href="/recipes/new"><button>+ Add New Recipe</button></a></p>

<div>
  <label for="tagFilter">Filter by Tag:</label>
  <select id="tagFilter" onchange="filterByTag()">
    <option value="">-- All Tags --</option>
    {% for tag in all_tags %}
      <option value="{{ tag }}">{{ tag }}</option>
    {% endfor %}
  </select>
</div>

<div class="recipe-list">
    {% for recipe in recipes %}
    <div class="recipe" data-tags="{{ recipe.tags|join(',') if recipe.tags else '' }}">
        <h2>{{ recipe.name }}</h2>
        {% if recipe.tags %}
          <small>[{{ recipe.tags|join(', ') }}]</small>
        {% endif %}
        <div class="actions">
            <a href="/recipes/{{ recipe.id }}">View</a> |
            <a href="/recipes/{{ recipe.id }}/edit">Edit</a> |
            <a href="/recipes/{{ recipe.id }}/clone">ðŸ“„ Clone</a> |
            <a href="/start-batch/{{ recipe.id }}">Start Batch</a> |
            <a href="/stock/check/{{ recipe.id }}">Check Stock</a> |
            <form style="display: inline;" action="/recipes/{{ recipe.id }}/delete" method="POST">
                <button type="submit">Delete</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>

<script>
function filterByTag() {
  const selected = document.getElementById('tagFilter').value.toLowerCase();
  const recipes = document.querySelectorAll('.recipe');
  
  recipes.forEach(recipe => {
    const recipeTags = recipe.getAttribute('data-tags') || '';
    const match = !selected || recipeTags.toLowerCase().includes(selected);
    recipe.style.display = match ? '' : 'none';
  });
}
</script>
{% endblock %}