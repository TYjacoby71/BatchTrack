{% extends "layout.html" %}
{% block content %}
<h2>Edit Batch Notes & Tags</h2>

<p><strong>Batch ID:</strong> {{ batch.id }}</p>
<p><strong>Recipe:</strong> {{ batch.recipe_name }}</p>
<p><strong>Date:</strong> {{ batch.timestamp }}</p>

<form method="post">
  <label>Notes:</label><br>
  <textarea name="notes" rows="5" cols="50">{{ batch.notes|default('') }}</textarea><br><br>

  <label>Tags (comma-separated):</label><br>
  <input type="text" id="tags" name="tags" value="{{ ','.join(batch.tags) if batch.tags else '' }}" class="awesomplete">
    <script>
        fetch('/tags.json')
            .then(response => response.json())
            .then(tags => {
                new Awesomplete(document.getElementById("tags"), {
                    list: tags,
                    filter: function(text, input) {
                        return Awesomplete.FILTER_CONTAINS(text, input.match(/[^,]*$/)[0].trim());
                    },
                    replace: function(text) {
                        var before = this.input.value.match(/^.+,\s*|/)[0];
                        this.input.value = before + text + ", ";
                    }
                });
            });
    </script><br><br>

  <input type="submit" value="Save Changes">
</form>

<p><a href="/batches">Back to Batches</a></p>
{% endblock %}