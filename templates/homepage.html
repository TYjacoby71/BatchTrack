
{% extends 'layout.html' %}
{% block content %}

<h2>Hi {{ current_user.username or 'there' }}, what do you want to do?</h2>

<div style="margin-top: 2rem;">
  {% if active_batch %}
    <a href="{{ url_for('batch_view.view_batch', batch_id=active_batch.id) }}" class="button" style="margin-right: 1rem;">Finish Batch</a>
  {% endif %}
  <button onclick="document.getElementById('startFlowModal').style.display='block'" class="button">Start Flow</button>
</div>

<!-- Modal for Start Flow -->
<div id="startFlowModal" style="display:none; padding: 1rem; margin-top: 2rem; background: #f9f9f9; border: 1px solid #ccc;">
  <form method="post" action="{{ url_for('recipes.plan_production', recipe_id=recipe.id) }}" id="productionForm">
    <label for="recipe_id">Select Recipe:</label>
    <select name="recipe_id" id="recipeSelect" required onchange="updateFormAction(this.value)">
      {% for recipe in recipes %}
        <option value="{{ recipe.id }}">{{ recipe.name }}</option>
      {% endfor %}
    </select><br><br>

    <script>
    function updateFormAction(recipeId) {
      document.getElementById('productionForm').action = "{{ url_for('recipes.plan_production', recipe_id=0) }}".replace('0', recipeId);
    }
    window.onload = function() {
      var select = document.getElementById('recipeSelect');
      if(select.value) {
        updateFormAction(select.value);
      }
    }
    </script>

    <label for="scale">Scale:</label>
    <input type="number" step="0.1" name="scale" value="1.0" required><br><br>

    <button type="submit" class="button">Continue</button>
    <button type="button" onclick="document.getElementById('startFlowModal').style.display='none'" class="button-secondary">Cancel</button>
  </form>
</div>

{% if alert %}
<div style="margin-top: 2rem; background-color: #ffe0e0; padding: 1rem; border-radius: 8px;">
  ⚠️ <strong>{{ alert }}</strong>
</div>
{% endif %}

{% endblock %}
