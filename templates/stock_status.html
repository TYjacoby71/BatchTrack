
{% extends "layout.html" %}
{% block content %}
<h1>📋 Stock Check for {{ recipe.name }}</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

{% if session.get('needed_items') %}
<div class="alert alert-warning">
    <h3>🛒 Shopping List:</h3>
    <ul>
        {% for name, info in session.get('needed_items').items() %}
            <li>{{ name }}: {{ "%.2f"|format(info.total) }} {{ info.unit }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% if stock_check %}
<table border="1">
    <tr>
        <th>Ingredient</th>
        <th>Needed</th>
        <th>Available Stock</th>
        <th>Status</th>
    </tr>
    {% for item in stock_check %}
    <tr>
        <td>{{ item.name }}</td>
        <td>{{ item.needed }}</td>
        <td>{{ item.available }}</td>
        <td{% if item.status != 'OK' %} style="color: red;"{% endif %}>
            {% if item.status == 'OK' %}
                ✅ OK
            {% elif item.status == 'LOW' %}
                ⚠️ LOW
            {% else %}
                ❌ ORDER NEEDED
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No stock check data available.</p>
{% endif %}

<br>
<a href="/recipes">← Back to Recipes</a> |
<a href="/start-batch/{{ recipe.id }}" class="button">Start Batch</a>
{% endblock %}% endblock %}
