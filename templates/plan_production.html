
{% extends 'layout.html' %}
{% block content %}
<h2>Plan Production: {{ recipe.name }}</h2>

<form id="planProductionForm">
  <input type="hidden" name="recipe_id" value="{{ recipe.id }}">

  <!-- Scale and Projected Yield -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="form-group">
        <label for="scale">Scale:</label>
        <input type="number" class="form-control" name="scale" id="scale" value="1" min="0.1" step="0.1" required onchange="updateProjectedYield()">
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-group">
        <label>Projected Yield:</label>
        <div id="projectedYield" class="form-control-plaintext" data-base-yield="{{ recipe.predicted_yield if recipe else 0 }}">
          {{ recipe.predicted_yield if recipe else 0 }} {{ recipe.predicted_yield_unit if recipe else '' }}
        </div>
      </div>
    </div>
  </div>

  <button type="button" class="btn btn-primary mb-4" onclick="handleFormSubmit(event)">Check Stock</button>

  <!-- Stock Check Results (Initially Hidden) -->
  <div id="stockCheckSection" style="display: none;">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Stock Check Results</h5>
      </div>
      <div class="card-body">
        <div id="stockCheckResults" class="table-responsive">
          <!-- Stock check results will be inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Mode Toggles -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="form-group">
        <label for="flexMode">Flexible Mode</label>
        <div class="toggle-switch">
          <input type="checkbox" id="flexMode" name="flex_mode">
          <label class="toggle-label" for="flexMode"></label>
        </div>
        <small class="form-text text-muted">If off, strict container rules will apply.</small>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-group" id="autoFillSection">
        <label for="autoFill">Auto-Fill Containers</label>
        <div class="toggle-switch">
          <input type="checkbox" id="autoFill" name="auto_fill" checked>
          <label class="toggle-label" for="autoFill"></label>
        </div>
        <small class="form-text text-muted">Automatically pick best matching containers.</small>
      </div>
    </div>
  </div>

  <!-- Stock Check Results -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Stock Check Results</h5>
    </div>
    <div class="card-body">
      <div id="stockCheckResults" class="table-responsive">
        <!-- Stock check results will be inserted here -->
      </div>
    </div>
  </div>

  <!-- Container Selection -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Container Selection</h5>
      <button type="button" id="addContainerBtn" class="btn btn-sm btn-outline-primary">Add Container</button>
    </div>
    <div class="card-body">
      <div id="containerSelectionArea">
        <!-- Container rows will be inserted here -->
      </div>
      
      <!-- Container Fill Progress -->
      <div class="mt-3">
        <label>Batch Containment Progress:</label>
        <div class="progress" style="height: 20px;">
          <div id="fillProgressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
        </div>
        <small id="remainingToContain" class="form-text text-muted mt-1"></small>
      </div>
      <div id="containmentError" class="alert alert-danger mt-2" style="display: none;"></div>
    </div>
  </div>

  

  <!-- Action Buttons -->
  <div class="d-flex justify-content-between">
    <div>
      <button type="button" id="exportShoppingListBtn" class="btn btn-warning" style="display: none;">
        Export Shopping List
      </button>
    </div>
    <div>
      <a href="{{ url_for('recipes.list_recipes') }}" class="btn btn-secondary me-2">Cancel</a>
      <button type="submit" id="startBatchButton" class="btn btn-success" style="display: none;">
        Start Batch
      </button>
    </div>
  </div>
</form>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/plan_production.js') }}"></script>
{% endblock %}
