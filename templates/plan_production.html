{% extends 'layout.html' %}
{% block content %}
<div class="plan-container">
    <h2>Plan Production: {{ recipe.name }}</h2>

    <form method="post" action="{{ url_for('batches.start_batch') }}">
        <div class="form-group">
            <label for="scale">Scale Factor:</label>
            <input type="number" id="scale" name="scale" value="{{ scale }}" step="0.1" min="0.1" required>
            <input type="hidden" name="recipe_id" value="{{ recipe.id }}">
        </div>
        <button type="submit" class="button">Check Stock</button>
    </form>

    {% if stock_check %}
    <div class="stock-summary">
        <h3>Stock Check Results</h3>
        {% for item in stock_check %}
        <div class="stock-item {{ item.status.lower() }}">
            <span class="name">{{ item.name }}</span>
            <span class="amount">Need: {{ "%.2f"|format(item.needed) }} {{ item.unit }}</span>
            <span class="available">Have: {{ "%.2f"|format(item.available) }} {{ item.unit }}</span>
            <span class="status">Status: {{ item.status }}</span>
        </div>
        {% endfor %}

        {% if all_ok %}
        <div class="action-buttons">
            <form method="post" action="{{ url_for('batches.start_batch') }}">
                <input type="hidden" name="recipe_id" value="{{ recipe.id }}">
                <input type="hidden" name="scale" value="{{ scale }}">
                <div class="form-group">
                    <label>Batch Notes:</label><br>
                    <textarea name="notes" rows="3"></textarea>
                </div>
                <button type="submit" class="button">Start Batch</button>
            </form>
        </div>
        {% else %}
        <div class="warning">
            <p>Cannot start batch - insufficient ingredients</p>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}