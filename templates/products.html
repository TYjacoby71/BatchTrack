
{% extends "layout.html" %}
{% block content %}
<h2>ðŸ“¦ Finished Product Batches</h2>
<a href='/products/export'>Export CSV</a><br><br>

{% if products %}
  <table>
    <tr>
      <th>Product</th>
      <th>On Hand</th>
      <th>Unit</th>
      <th>Label Info</th>
      <th>Batch ID</th>
      <th>Created</th>
    </tr>
    {% for p in products %}
    <tr>
      <td>{{ p.product }}</td>
      <td>{{ p.yield if p.yield is not none else 'N/A' }}</td>
      <td>{{ p.unit }}</td>
      <td>{{ p.label_info or '' }}</td>
      <td>
        {% if p.batch_id %}
          <a href="/batches/view/{{ p.batch_id }}">#{{ p.batch_id }}</a>
        {% else %}
          -
        {% endif %}
      </td>
      <td>{{ p.timestamp or 'N/A' }}</td>
    </tr>
    <tr>
      <td colspan="6">
        <form method="POST" action="/products/event/{{ loop.index0 }}">
          <label>Log Event: </label>
          <select name="event_type">
            <option value="sold">Sold</option>
            <option value="spoiled">Spoiled</option>
            <option value="sampled">Sampled</option>
          </select>
          Qty: <input type="number" name="quantity" required style="width: 60px;">
          <input type="text" name="method" placeholder="POS / Shopify / Farmer's Market" style="width: 160px;">
          <input type="text" name="note" placeholder="optional note" style="width: 200px;">
          <button type="submit">Submit</button>
        </form>
        <form method="POST" action="/products/delete/{{ loop.index0 }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
          <button type="submit" style="background-color: #ff4444;">Delete Product</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>
{% else %}
  <p>No finished product batches recorded yet.</p>
{% endif %}
{% endblock %}
