DEBUG: Billing blueprint imported successfully: <Blueprint 'billing'>
DEBUG: Billing blueprint name: billing
DEBUG: Billing blueprint url_prefix: /billing
DEBUG: Billing blueprint registered successfully
Registered API routes: ['/api/reservations/create', '/api/reservations/release/<int:reservation_id>', '/api/reservations/convert-to-sale/<int:reservation_id>', '/api/reservations/expire-old', '/api/products/<int:product_id>/variants', '/api/dismiss-alert', '/api/dashboard-alerts', '/api/server-time', '/api/server-time', '/api/dismiss-alert', '/api/dashboard-alerts', '/api/check-stock', '/api/categories', '/api/ingredient/<int:id>/density', '/api/debug-containers', '/api/available-containers/<int:recipe_id>', '/api/containers/available', '/api/batches/<int:batch_id>/containers', '/api/batches/<int:batch_id>/containers/<int:container_id>', '/api/batches/<int:batch_id>/containers/<int:container_id>/adjust', '/api/api/fifo-details/<int:inventory_id>', '/api/api/batch-inventory-summary/<int:batch_id>', '/api/api/reservations/create', '/api/api/reservations/release/<int:reservation_id>', '/api/api/reservations/convert-to-sale/<int:reservation_id>', '/api/api/reservations/expire-old', '/api/dashboard-alerts', '/api/dismiss-alert', '/api/units', '/api/convert-units']
Container routes found: ['/settings/bulk-update-containers', '/api/debug-containers', '/api/available-containers/<int:recipe_id>', '/api/containers/available', '/api/batches/<int:batch_id>/containers', '/api/batches/<int:batch_id>/containers/<int:container_id>', '/api/batches/<int:batch_id>/containers/<int:container_id>/adjust', '/debug-containers', '/available-containers/<int:recipe_id>', '/containers/available', '/batches/<int:batch_id>/containers', '/batches/<int:batch_id>/containers/<int:container_id>', '/batches/<int:batch_id>/containers/<int:container_id>/adjust']
Billing routes found: ['/billing/reconciliation-needed', '/billing/reconcile-to-free', '/billing/upgrade', '/billing/checkout/<tier>/<billing_cycle>', '/billing/checkout/<tier>', '/billing/customer-portal', '/billing/cancel-subscription', '/billing/webhooks/stripe', '/billing/complete-signup-from-stripe', '/billing/debug']
Billing endpoints: [('/billing/reconciliation-needed', 'billing.reconciliation_needed'), ('/billing/reconcile-to-free', 'billing.reconcile_to_free'), ('/billing/upgrade', 'billing.upgrade'), ('/billing/checkout/<tier>/<billing_cycle>', 'billing.checkout'), ('/billing/checkout/<tier>', 'billing.checkout'), ('/billing/customer-portal', 'billing.customer_portal'), ('/billing/cancel-subscription', 'billing.cancel_subscription'), ('/billing/webhooks/stripe', 'billing.stripe_webhook'), ('/billing/complete-signup-from-stripe', 'billing.complete_signup_from_stripe'), ('/billing/debug', 'billing.debug_billing')]
[2025-07-31 21:29:40,984] INFO in unit_utils: BatchTrack startup
=== CURRENT DATABASE TABLES ===
✅ alembic_version
   Columns: 1
     - version_num (VARCHAR(32))

✅ batch
   Columns: 26
     - id (INTEGER)
     - recipe_id (INTEGER)
     - label_code (VARCHAR(32))
     - batch_type (VARCHAR(32))
     - projected_yield (FLOAT)
     ... and 21 more columns

✅ batch_container
   Columns: 9
     - id (INTEGER)
     - batch_id (INTEGER)
     - container_id (INTEGER)
     - container_quantity (INTEGER)
     - quantity_used (INTEGER)
     ... and 4 more columns

✅ batch_ingredient
   Columns: 8
     - id (INTEGER)
     - batch_id (INTEGER)
     - inventory_item_id (INTEGER)
     - quantity_used (FLOAT)
     - unit (VARCHAR(32))
     ... and 3 more columns

✅ batch_inventory_log
   Columns: 10
     - id (INTEGER)
     - batch_id (INTEGER)
     - inventory_item_id (INTEGER)
     - action (VARCHAR(32))
     - quantity_change (FLOAT)
     ... and 5 more columns

✅ batch_timer
   Columns: 9
     - id (INTEGER)
     - batch_id (INTEGER)
     - name (VARCHAR(128))
     - duration_seconds (INTEGER)
     - start_time (DATETIME)
     ... and 4 more columns

✅ billing_snapshots
   Columns: 12
     - id (INTEGER)
     - organization_id (INTEGER)
     - confirmed_tier (VARCHAR(32))
     - confirmed_status (VARCHAR(32))
     - period_start (DATETIME)
     ... and 7 more columns

✅ conversion_log
   Columns: 10
     - id (INTEGER)
     - user_id (INTEGER)
     - timestamp (DATETIME)
     - amount (FLOAT)
     - from_unit (VARCHAR(32))
     ... and 5 more columns

✅ custom_unit_mapping
   Columns: 8
     - id (INTEGER)
     - from_unit (VARCHAR(64))
     - to_unit (VARCHAR(64))
     - conversion_factor (FLOAT)
     - notes (TEXT)
     ... and 3 more columns

✅ developer_permission
   Columns: 6
     - id (INTEGER)
     - name (VARCHAR(128))
     - description (TEXT)
     - category (VARCHAR(64))
     - is_active (BOOLEAN)
     ... and 1 more columns

✅ developer_role
   Columns: 6
     - id (INTEGER)
     - name (VARCHAR(64))
     - description (TEXT)
     - category (VARCHAR(32))
     - is_active (BOOLEAN)
     ... and 1 more columns

✅ developer_role_permission
   Columns: 2
     - developer_role_id (INTEGER)
     - developer_permission_id (INTEGER)

✅ extra_batch_container
   Columns: 10
     - id (INTEGER)
     - batch_id (INTEGER)
     - container_id (INTEGER)
     - container_quantity (INTEGER)
     - quantity_used (INTEGER)
     ... and 5 more columns

✅ extra_batch_ingredient
   Columns: 8
     - id (INTEGER)
     - batch_id (INTEGER)
     - inventory_item_id (INTEGER)
     - quantity_used (FLOAT)
     - unit (VARCHAR(32))
     ... and 3 more columns

✅ ingredient_category
   Columns: 9
     - id (INTEGER)
     - name (VARCHAR(64))
     - description (TEXT)
     - color (VARCHAR(7))
     - default_density (FLOAT)
     ... and 4 more columns

✅ inventory_history
   Columns: 19
     - id (INTEGER)
     - inventory_item_id (INTEGER)
     - timestamp (DATETIME)
     - change_type (VARCHAR(32))
     - quantity_change (FLOAT)
     ... and 14 more columns

✅ inventory_item
   Columns: 20
     - id (INTEGER)
     - name (VARCHAR(128))
     - category_id (INTEGER)
     - quantity (FLOAT)
     - unit (VARCHAR(32))
     ... and 15 more columns

✅ organization
   Columns: 10
     - id (INTEGER)
     - name (VARCHAR(128))
     - contact_email (VARCHAR(256))
     - created_at (DATETIME)
     - is_active (BOOLEAN)
     ... and 5 more columns

✅ organization_stats
   Columns: 15
     - id (INTEGER)
     - organization_id (INTEGER)
     - total_batches (INTEGER)
     - completed_batches (INTEGER)
     - failed_batches (INTEGER)
     ... and 10 more columns

✅ permission
   Columns: 6
     - id (INTEGER)
     - name (VARCHAR(128))
     - description (TEXT)
     - category (VARCHAR(64))
     - is_active (BOOLEAN)
     ... and 1 more columns

✅ pricing_snapshots
   Columns: 14
     - id (INTEGER)
     - stripe_price_id (VARCHAR(128))
     - stripe_lookup_key (VARCHAR(64))
     - stripe_product_id (VARCHAR(128))
     - unit_amount (INTEGER)
     ... and 9 more columns

✅ product
   Columns: 16
     - id (INTEGER)
     - name (VARCHAR(128))
     - description (TEXT)
     - base_unit (VARCHAR(32))
     - category (VARCHAR(64))
     ... and 11 more columns

✅ product_sku
   Columns: 49
     - inventory_item_id (INTEGER)
     - product_id (INTEGER)
     - variant_id (INTEGER)
     - size_label (VARCHAR(64))
     - sku_code (VARCHAR(64))
     ... and 44 more columns

✅ product_sku_history
   Columns: 37
     - id (INTEGER)
     - inventory_item_id (INTEGER)
     - timestamp (DATETIME)
     - change_type (VARCHAR(32))
     - quantity_change (FLOAT)
     ... and 32 more columns

✅ product_variant
   Columns: 11
     - id (INTEGER)
     - product_id (INTEGER)
     - name (VARCHAR(128))
     - description (TEXT)
     - color (VARCHAR(32))
     ... and 6 more columns

✅ recipe
   Columns: 12
     - id (INTEGER)
     - name (VARCHAR(128))
     - instructions (TEXT)
     - label_prefix (VARCHAR(8))
     - qr_image (VARCHAR(128))
     ... and 7 more columns

✅ recipe_ingredient
   Columns: 8
     - id (INTEGER)
     - recipe_id (INTEGER)
     - inventory_item_id (INTEGER)
     - quantity (FLOAT)
     - unit (VARCHAR(32))
     ... and 3 more columns

✅ reservation
   Columns: 21
     - id (INTEGER)
     - order_id (VARCHAR(128))
     - reservation_id (VARCHAR(128))
     - product_item_id (INTEGER)
     - reserved_item_id (INTEGER)
     ... and 16 more columns

✅ role
   Columns: 8
     - id (INTEGER)
     - name (VARCHAR(64))
     - description (TEXT)
     - is_active (BOOLEAN)
     - is_system_role (BOOLEAN)
     ... and 3 more columns

✅ role_permission
   Columns: 2
     - role_id (INTEGER)
     - permission_id (INTEGER)

✅ subscription_tier
   Columns: 27
     - id (INTEGER)
     - name (VARCHAR(64))
     - key (VARCHAR(32))
     - description (TEXT)
     - user_limit (INTEGER)
     ... and 22 more columns

✅ subscription_tier_permission
   Columns: 2
     - tier_id (INTEGER)
     - permission_id (INTEGER)

✅ tag
   Columns: 8
     - id (INTEGER)
     - name (VARCHAR(64))
     - color (VARCHAR(7))
     - description (TEXT)
     - is_active (BOOLEAN)
     ... and 3 more columns

✅ unit
   Columns: 12
     - id (INTEGER)
     - name (VARCHAR(64))
     - symbol (VARCHAR(16))
     - type (VARCHAR(32))
     - base_unit (VARCHAR(64))
     ... and 7 more columns

✅ user
   Columns: 17
     - id (INTEGER)
     - username (VARCHAR(64))
     - password_hash (VARCHAR(255))
     - first_name (VARCHAR(64))
     - last_name (VARCHAR(64))
     ... and 12 more columns

✅ user_preferences
   Columns: 16
     - id (INTEGER)
     - user_id (INTEGER)
     - organization_id (INTEGER)
     - max_dashboard_alerts (INTEGER)
     - show_expiration_alerts (BOOLEAN)
     ... and 11 more columns

✅ user_role_assignment
   Columns: 8
     - id (INTEGER)
     - user_id (INTEGER)
     - role_id (INTEGER)
     - developer_role_id (INTEGER)
     - organization_id (INTEGER)
     ... and 3 more columns

✅ user_stats
   Columns: 15
     - id (INTEGER)
     - user_id (INTEGER)
     - organization_id (INTEGER)
     - total_batches (INTEGER)
     - completed_batches (INTEGER)
     ... and 10 more columns

Total tables: 38
