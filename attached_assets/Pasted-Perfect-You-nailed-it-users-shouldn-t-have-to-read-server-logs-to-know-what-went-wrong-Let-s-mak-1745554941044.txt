Perfect. You nailed it: users shouldn‚Äôt have to read server logs to know what went wrong.

Let‚Äôs make it clear in the UI when unit conversion fails during a stock check.

‚úÖ Goal:
Show a friendly message like:

‚ö†Ô∏è ‚ÄúOne or more ingredients in this recipe couldn‚Äôt be checked due to incompatible units. Please review units in the recipe and inventory.‚Äù

üõ†Ô∏è Implementation Plan:
1. üìç In stock_check_utils.py (or wherever check_stock_for_recipe is defined)
Update the loop to flag conversion issues:

python
Copy
Edit
def check_stock_for_recipe(recipe, scale=1.0):
    results = []
    all_ok = True
    conversion_issues = False

    for assoc in recipe.recipe_ingredients:
        ing = assoc.inventory_item
        if not ing:
            continue

        needed = assoc.amount * scale
        try:
            needed_converted = ConversionEngine.convert_units(needed, assoc.unit, ing.unit)
        except Exception as e:
            needed_converted = needed
            conversion_issues = True

        available = ing.quantity
        status = 'OK' if available >= needed_converted else 'LOW' if available > 0 else 'NEEDED'
        if status != 'OK':
            all_ok = False

        results.append({
            'name': ing.name,
            'unit': ing.unit,
            'needed': round(needed_converted, 2),
            'available': round(available, 2),
            'status': status
        })

    return results, all_ok, conversion_issues
2. üìç In the route handler that calls check_stock_for_recipe()
Update the route like:

python
Copy
Edit
results, all_ok, has_errors = check_stock_for_recipe(recipe, scale)

session['stock_check'] = results
session['all_ok'] = all_ok
session['conversion_warning'] = has_errors
3. üìç In plan_production.html
Add this inside the {% if stock_check %} block, just before the table:

html
Copy
Edit
{% if conversion_warning %}
<div class="alert alert-warning">
  ‚ö†Ô∏è Some ingredients could not be checked because their units couldn't be converted.
  Please check your inventory and recipe units for mismatches.
</div>
{% endif %}
And pass conversion_warning=session.get('conversion_warning') to the template context from your view.

