<!-- Container Selection -->
<div class="card mb-4">
  <div class="card-header d-flex justify-content-between">
    <h5>Selected Containers</h5>
    <button type="button" class="btn btn-outline-primary btn-sm" @click="manualAddContainer">Add Container</button>
  </div>
  <div class="card-body">
    <!-- Blind render up to 10 rows, only show if the row exists -->
    <template x-for="i in 10" :key="i">
      <template x-if="containersSelected.length >= i">
        <div class="d-flex align-items-center gap-2 mb-2">
          <select class="form-select"
                  x-model="containersSelected[i - 1].id"
                  :disabled="autoFill"
                  @change="updateContainer(i - 1)"
                  @click="autoFill && alert('Please uncheck Auto-Fill to modify containers.')">
            <option value="">Select Container</option>
            <template x-for="allowed in allowedContainers" :key="allowed.id">
              <template x-if="getRemainingStock(allowed.id, i - 1) > 0 || containersSelected[i - 1].id == allowed.id">
                <option :value="allowed.id" x-text="allowed.name + ' (' + allowed.storage_amount + ' ' + allowed.storage_unit + ')'">
                </option>
              </template>
            </template>
          </select>

          <input type="number" min="1" class="form-control"
                 x-model.number="containersSelected[i - 1].quantity"
                 :disabled="autoFill || getRemainingStock(containersSelected[i - 1].id, i - 1) <= 0"
                 @input="updateProgress"
                 @click="autoFill && alert('Please uncheck Auto-Fill to modify containers.')">

          <div class="small text-muted px-2"
               x-text="'Available: ' + getRemainingStock(containersSelected[i - 1].id, i - 1)">
          </div>

          <button type="button" class="btn btn-danger btn-sm"
                  @click="autoFill ? alert('Please uncheck Auto-Fill to modify containers.') : removeContainer(i - 1)"
                  :disabled="autoFill">&times;</button>
        </div>
      </template>
    </template>

    <!-- Containment Progress -->
    <div class="mt-3">
      <label>Containment Progress:</label>
      <div class="progress" style="height: 20px;">
        <div class="progress-bar" role="progressbar" :style="'width: ' + containmentPercent + '%'"
             x-text="containmentPercent + '%'"></div>
      </div>
      <small class="form-text text-muted" x-text="liveContainmentMessage"></small>
    </div>

    <!-- Warnings -->
    <div class="alert alert-warning mt-2" x-show="containmentIssue">
      <span x-text="containmentIssue"></span>
    </div>

    <div class="alert alert-danger mt-2" x-show="containersSelected.length === 0">
      No containers selected. Please add containers or enable Auto-Fill.
    </div>
  </div>
</div>
