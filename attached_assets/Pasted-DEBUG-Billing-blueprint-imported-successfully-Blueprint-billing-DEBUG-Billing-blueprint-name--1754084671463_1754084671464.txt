DEBUG: Billing blueprint imported successfully: <Blueprint 'billing'>
DEBUG: Billing blueprint name: billing
DEBUG: Billing blueprint url_prefix: /billing
DEBUG: Billing blueprint registered successfully
Registered API routes: ['/api/reservations/create', '/api/reservations/release/<int:reservation_id>', '/api/reservations/convert-to-sale/<int:reservation_id>', '/api/reservations/expire-old', '/api/products/<int:product_id>/variants', '/api/dismiss-alert', '/api/dashboard-alerts', '/api/server-time', '/api/server-time', '/api/dismiss-alert', '/api/dashboard-alerts', '/api/check-stock', '/api/categories', '/api/ingredient/<int:id>/density', '/api/debug-containers', '/api/available-containers/<int:recipe_id>', '/api/containers/available', '/api/batches/<int:batch_id>/containers', '/api/batches/<int:batch_id>/containers/<int:container_id>', '/api/batches/<int:batch_id>/containers/<int:container_id>/adjust', '/api/api/fifo-details/<int:inventory_id>', '/api/api/batch-inventory-summary/<int:batch_id>', '/api/api/reservations/create', '/api/api/reservations/release/<int:reservation_id>', '/api/api/reservations/convert-to-sale/<int:reservation_id>', '/api/api/reservations/expire-old', '/api/dashboard-alerts', '/api/dismiss-alert', '/api/units', '/api/convert-units']
Container routes found: ['/settings/bulk-update-containers', '/api/debug-containers', '/api/available-containers/<int:recipe_id>', '/api/containers/available', '/api/batches/<int:batch_id>/containers', '/api/batches/<int:batch_id>/containers/<int:container_id>', '/api/batches/<int:batch_id>/containers/<int:container_id>/adjust', '/debug-containers', '/available-containers/<int:recipe_id>', '/containers/available', '/batches/<int:batch_id>/containers', '/batches/<int:batch_id>/containers/<int:container_id>', '/batches/<int:batch_id>/containers/<int:container_id>/adjust']
Billing routes found: ['/billing/reconciliation-needed', '/billing/reconcile-to-free', '/billing/upgrade', '/billing/checkout/<tier>/<billing_cycle>', '/billing/checkout/<tier>', '/billing/customer-portal', '/billing/cancel-subscription', '/billing/webhooks/stripe', '/billing/complete-signup-from-stripe', '/billing/debug']
Billing endpoints: [('/billing/reconciliation-needed', 'billing.reconciliation_needed'), ('/billing/reconcile-to-free', 'billing.reconcile_to_free'), ('/billing/upgrade', 'billing.upgrade'), ('/billing/checkout/<tier>/<billing_cycle>', 'billing.checkout'), ('/billing/checkout/<tier>', 'billing.checkout'), ('/billing/customer-portal', 'billing.customer_portal'), ('/billing/cancel-subscription', 'billing.cancel_subscription'), ('/billing/webhooks/stripe', 'billing.stripe_webhook'), ('/billing/complete-signup-from-stripe', 'billing.complete_signup_from_stripe'), ('/billing/debug', 'billing.debug_billing')]
[2025-08-01 21:43:38,234] INFO in unit_utils: BatchTrack startup
INFO  [alembic.env] Imported model module: app.models.batch
INFO  [alembic.env] Imported model module: app.models.billing_snapshot
INFO  [alembic.env] Imported model module: app.models.category
INFO  [alembic.env] Imported model module: app.models.developer_permission
INFO  [alembic.env] Imported model module: app.models.developer_role
INFO  [alembic.env] Imported model module: app.models.inventory
INFO  [alembic.env] Imported model module: app.models.mixins
INFO  [alembic.env] Imported model module: app.models.models
INFO  [alembic.env] Imported model module: app.models.permission
INFO  [alembic.env] Imported model module: app.models.pricing_snapshot
INFO  [alembic.env] Imported model module: app.models.product
INFO  [alembic.env] Imported model module: app.models.recipe
INFO  [alembic.env] Imported model module: app.models.reservation
INFO  [alembic.env] Imported model module: app.models.role
INFO  [alembic.env] Imported model module: app.models.statistics
INFO  [alembic.env] Imported model module: app.models.subscription_tier
INFO  [alembic.env] Imported model module: app.models.unit
INFO  [alembic.env] Imported model module: app.models.user_preferences
INFO  [alembic.env] Imported model module: app.models.user_role_assignment
INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade add_unit_timestamps -> add_missing_created_at_columns, add missing created_at and updated_at columns to all models
=== Adding missing timestamp columns to all models ===
   Checking table: batch
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'batch' timestamp columns up to date
   ⚠️  Table 'billing_snapshot' doesn't exist, skipping
   ⚠️  Skipping 'ingredient_category' - timestamps intentionally excluded
   Checking table: inventory_item
      ✅ Added created_at column
      ✅ Added updated_at column
   Checking table: permission
      ✅ Added created_at column
      ✅ Added updated_at column
   ⚠️  Table 'pricing_snapshot' doesn't exist, skipping
   Checking table: product
      ✅ Added created_at column
      ✅ Added updated_at column
   Checking table: product_sku
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'product_sku' timestamp columns up to date
   Checking table: product_sku_history
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'product_sku_history' timestamp columns up to date
   Checking table: product_variant
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'product_variant' timestamp columns up to date
   Checking table: recipe
      ✅ Added created_at column
      ✅ Added updated_at column
   Checking table: recipe_ingredient
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'recipe_ingredient' timestamp columns up to date
   Checking table: reservation
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'reservation' timestamp columns up to date
   Checking table: role
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'role' timestamp columns up to date
   ⚠️  Table 'statistics' doesn't exist, skipping
   Checking table: subscription_tier
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'subscription_tier' timestamp columns up to date
   Checking table: user_role_assignment
      ✅ Added created_at column
      ℹ️  updated_at column already exists
   Checking table: developer_role
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'developer_role' timestamp columns up to date
   Checking table: organization
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'organization' timestamp columns up to date
   Checking table: user
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'user' timestamp columns up to date
   Checking table: custom_unit_mapping
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'custom_unit_mapping' timestamp columns up to date
   Checking table: conversion_log
      ℹ️  created_at column already exists
      ℹ️  updated_at column already exists
      ✅ Table 'conversion_log' timestamp columns up to date
   Checking table: tag
      ✅ Added created_at column
      ✅ Added updated_at column
✅ Migration completed: Added 11 timestamp columns across all tables
⚠️  All timestamp columns added as nullable for safety
