_saponification_value column added successfully
   ‚úÖ show_iodine_value column added successfully
   ‚úÖ show_melting_point column added successfully
   ‚úÖ show_flash_point column added successfully
   ‚úÖ show_ph_value column added successfully
   ‚úÖ show_moisture_content column added successfully
   ‚úÖ show_shelf_life_months column added successfully
   ‚úÖ show_comedogenic_rating column added successfully
‚úÖ Visibility control fields migration completed
INFO  [alembic.runtime.migration] Running upgrade 20250930_4 -> 20250930_5, Set default visibility flags for global ingredient categories
Setting visibility defaults for global ingredient categories from JSON files...
   ‚ö†Ô∏è  Category 'Miscellaneous' not found in database
   ‚ö†Ô∏è  Category 'Essential Oils' not found in database
   ‚ö†Ô∏è  Category 'Preservatives & Additives' not found in database
   ‚ö†Ô∏è  Category 'Starches & Thickeners' not found in database
   ‚ö†Ô∏è  Category 'Oils (Carrier & Fixed)' not found in database
   ‚ö†Ô∏è  Category 'Surfactants & Emulsifiers' not found in database
   ‚ö†Ô∏è  Category 'Yeast & Cultures' not found in database
   ‚ö†Ô∏è  Category 'Liquids (Aqueous)' not found in database
   ‚ö†Ô∏è  Category 'Salts & Minerals (Crystalline)' not found in database
   ‚ö†Ô∏è  Category 'Clays' not found in database
   ‚ö†Ô∏è  Category 'Flours & Powders (Organic)' not found in database
   ‚ö†Ô∏è  Category 'Sugars & Syrups' not found in database
   ‚ö†Ô∏è  Category 'Fragrance Oils' not found in database
   ‚ö†Ô∏è  Category 'Fruits, Nuts & Seeds (Whole/Chopped)' not found in database
   ‚ö†Ô∏è  Category 'Botanicals (Dried & Whole/Parts)' not found in database
   ‚ö†Ô∏è  Category 'Butters & Solid Fats' not found in database
   ‚ö†Ô∏è  Category 'Active Ingredients (Cosmetics)' not found in database
   ‚ö†Ô∏è  Category 'Colorants (Pigments)' not found in database
   ‚ö†Ô∏è  Category 'Herbs & Spices (Dried & Ground)' not found in database
   ‚ö†Ô∏è  Category 'Waxes' not found in database
   ‚ö†Ô∏è  Category 'Extracts & Alcohols (Solvents)' not found in database
‚úÖ Category visibility defaults set successfully!
INFO  [alembic.runtime.migration] Running upgrade 20250930_5 -> 20251001_1, add addon models and tier allowed addons
=== Adding addon table and tier allowed addons ===
Creating addon table...
‚úÖ Created addon table
   ‚úÖ allowed_addon_keys column added successfully
‚úÖ Addon models and tier allowed addons migration completed
INFO  [alembic.runtime.migration] Running upgrade 20251001_1 -> 20251001_2, add function_key and retention_extension_days to addon
=== Adding function_key and retention_extension_days to addon ===
   ‚úÖ function_key column already exists - skipping
   ‚úÖ retention_extension_days column already exists - skipping
‚úÖ Addon fields migration completed
INFO  [alembic.runtime.migration] Running upgrade 20251001_2 -> 20251006_1, Add category_data JSON column to recipe table
INFO  [alembic.runtime.migration] Running upgrade 20251006_1 -> 20251006_2, Add ui_config JSON column to product_category
INFO  [alembic.runtime.migration] Running upgrade 20251006_2 -> 20251008_1, Add generated columns for hot recipe fields and basic indexes
INFO  [alembic.runtime.migration] Running upgrade 20251008_1 -> 20251008_2, Add generated columns for hot batch fields (from plan_snapshot.category_extension) and indexes
INFO  [alembic.runtime.migration] Running upgrade 20251008_2 -> 20251008_3, Add optional GIN index on recipe.category_data for ad-hoc queries
INFO  [alembic.runtime.migration] Running upgrade 20251008_3 -> 20251009_1, Add missing retention policy columns to subscription_tier
=== Adding missing retention policy columns to subscription_tier ===
   ‚úÖ retention_policy column added successfully
   ‚úÖ data_retention_days column already exists - skipping
   ‚úÖ retention_notice_days column already exists - skipping
   ‚úÖ storage_addon_retention_days column already exists - skipping
   ‚úÖ tier_type column already exists - skipping
   ‚úÖ billing_provider column already exists - skipping
   ‚úÖ stripe_lookup_key column already exists - skipping
   ‚úÖ stripe_storage_lookup_key column already exists - skipping
   ‚úÖ whop_product_key column already exists - skipping
‚úÖ Migration completed - attempted to add missing columns to subscription_tier
INFO  [alembic.runtime.migration] Running upgrade 20251009_1 -> 20251009_2, Repair keep-list indexes/tables and add tier_included_addon
INFO  [alembic.runtime.migration] Running upgrade 20251009_2 -> 20251009_3, Align models to own keep-list indexes, projections, and association table
render@srv-d21alungi27c73dn1440-9467858f-dcqkb:~/project/src$ flask init-production
/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_limiter/extension.py:333: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(

=== Blueprint Registration Summary ===
‚úÖ Successful: 29
   - Authentication
   - Admin
   - Developer
   - Inventory
   - Recipes
   - Batches
   - Organization
   - Billing
   - Settings
   - Timers
   - Expiration
   - Conversion
   - Products Main
   - Public API
   - Main API
   - Drawer Actions
   - Density Reference
   - Retention Drawer API
   - Global Link Drawer API
   - App Routes
   - Legal Routes
   - Bulk Stock
   - Fault Log
   - Tag Manager
   - Global Library Public
   - Waitlist
   - Public Tools
   - Production Planning
   - Exports

üéâ All blueprints registered successfully!
üöÄ BatchTrack Production Seeding Starting...
‚ö†Ô∏è  Assumes database schema is already migrated (flask db upgrade)
=== Step 1: System foundations (Organization Independent) ===
=== Seeding Consolidated Permissions System ===
Seeding organization permissions...
Processing category: Main dashboard and overview features
  Updated: dashboard.view
Processing category: All inventory tracking, adjustments, and stock management
  Updated: inventory.view
  Updated: inventory.edit
  Updated: inventory.adjust
  Updated: inventory.reserve
  Updated: inventory.delete
  Updated: inventory.view_costs
Processing category: Recipe creation, editing, and production planning
  Updated: recipes.view
  Updated: recipes.create
  Updated: recipes.edit
  Updated: recipes.delete
  Updated: recipes.scale
  Updated: recipes.plan_production
Processing category: Production batch tracking from start to finish
  Updated: batches.view
  Updated: batches.create
  Updated: batches.edit
  Updated: batches.finish
  Updated: batches.cancel
  Updated: batches.view_costs
Processing category: Product catalog, SKUs, and sales tracking
  Updated: products.view
  Updated: products.create
  Updated: products.edit
  Updated: products.delete
  Updated: products.manage_variants
  Updated: products.sales_tracking
Processing category: Organization settings, users, and roles management
  Updated: organization.view
  Updated: organization.edit
  Updated: organization.manage_users
  Updated: organization.manage_roles
  Updated: organization.manage_billing
  Updated: organization.view_audit_logs
Processing category: Alert management and notification preferences
  Updated: alerts.view
  Updated: alerts.manage
  Updated: alerts.dismiss
Processing category: Reporting, analytics, and business insights
  Updated: reports.view
  Updated: reports.export
  Updated: reports.advanced
  Updated: reports.custom
Processing category: Third-party integrations and marketplace connections
  Updated: integrations.shopify
  Updated: integrations.marketplace
  Updated: integrations.api_access
Processing category: AI-powered features and automation
  Updated: ai.recipe_optimization
  Updated: ai.demand_forecasting
  Updated: ai.quality_insights
‚úÖ Organization permissions seeded successfully!
Seeding developer permissions...
Processing category: Core system administration and management
  Updated: dev.system_admin
  Updated: dev.dashboard
  Updated: dev.debug_mode
  Updated: dev.access_logs
  Updated: dev.system_settings
Processing category: Database management and migration operations
  Updated: dev.run_migrations
  Updated: dev.seed_data
  Updated: dev.backup_restore
Processing category: Cross-organization management and oversight
  Updated: dev.all_organizations
  Updated: dev.create_organizations
  Updated: dev.modify_any_organization
  Updated: dev.delete_organizations
Processing category: Global user and permission management
  Updated: dev.manage_users
  Updated: dev.manage_roles
  Updated: dev.assign_permissions
Processing category: Subscription tiers and billing oversight
  Updated: dev.manage_tiers
  Updated: dev.billing_override
  Updated: dev.view_all_billing
Processing category: All organization-level permissions available to developers
  Updated: app.dashboard.view
  Updated: app.inventory.view
  Updated: app.inventory.edit
  Updated: app.inventory.adjust
  Updated: app.inventory.reserve
  Updated: app.inventory.delete
  Updated: app.inventory.view_costs
  Updated: app.recipes.view
  Updated: app.recipes.create
  Updated: app.recipes.edit
  Updated: app.recipes.delete
  Updated: app.recipes.scale
  Updated: app.recipes.plan_production
  Updated: app.batches.view
  Updated: app.batches.create
  Updated: app.batches.edit
  Updated: app.batches.finish
  Updated: app.batches.cancel
  Updated: app.batches.view_costs
  Updated: app.products.view
  Updated: app.products.create
  Updated: app.products.edit
  Updated: app.products.delete
  Updated: app.products.manage_variants
  Updated: app.products.sales_tracking
  Updated: app.organization.view
  Updated: app.organization.edit
  Updated: app.organization.manage_users
  Updated: app.organization.manage_roles
  Updated: app.organization.manage_billing
  Updated: app.organization.view_audit_logs
  Updated: app.alerts.view
  Updated: app.alerts.manage
  Updated: app.alerts.dismiss
  Updated: app.reports.view
  Updated: app.reports.export
  Updated: app.reports.advanced
  Updated: app.reports.custom
  Updated: app.integrations.shopify
  Updated: app.integrations.marketplace
  Updated: app.integrations.api_access
  Updated: app.ai.recipe_optimization
  Updated: app.ai.demand_forecasting
  Updated: app.ai.quality_insights
‚úÖ Developer permissions seeded successfully!
üîß Seeding developer roles...
   Current developer roles in DB: 3
‚úÖ Created/updated system_admin role with 62 permissions
‚úÖ Created/updated developer role with 7 permissions
‚úÖ Created/updated support role with 8 permissions
‚úÖ Developer roles seeded successfully! (Total: 3)
   ‚úÖ system_admin role confirmed (ID: 1)
=== Seeding Organization System Roles ===
‚ÑπÔ∏è  organization_owner system role already exists
‚úÖ Organization system roles seeded successfully!
‚úÖ Assigned 0 permissions to fresh organization owner role
‚úÖ Cleaned up old permissions
‚úÖ Consolidated permissions system seeded successfully!

üìä Summary:
Organization permissions: 44
Developer permissions: 62
‚úÖ Permissions, organization roles, and developer roles seeded
=== Seeding Exempt Subscription Tier Only ===
=== Seeding Subscription Tiers (Exempt Only) ===
‚ÑπÔ∏è  Exempt tier already exists
‚úÖ Subscription tiers seeded successfully!
   - Only exempt tier created - all other tiers managed through Stripe
=== Migrating Organizations to Tier IDs ===
‚úÖ Organization migration completed!
‚úÖ Subscription tiers seeding completed!
   - Exempt tier created with unlimited permissions
   - All other tiers managed through Stripe integration
   - Ready for user seeder to create organizations
‚úÖ Subscription tiers seeded
‚úÖ Addons seeded
‚úÖ Add-ons seeded
=== Seeding 49 standard units ===
‚úÖ Added 0 new units
‚ÑπÔ∏è  Total units in database: 49
‚úÖ Units seeded
=== Step 2: Organization-dependent setup ===
‚ÑπÔ∏è  Developer roles should now exist for user assignment...
=== Creating Default Organization with Essential Users ===
‚ÑπÔ∏è  Found 1 existing organizations - using first organization
‚ÑπÔ∏è  Using organization: BatchTrack Organization (ID: 1)
   - Subscription tier: exempt (Exempt Plan)
‚úÖ Found system_admin developer role (ID: 1)
‚ÑπÔ∏è  Developer user 'dev' already exists
‚ÑπÔ∏è  Admin user 'admin' already exists (org_id: 1)
‚ÑπÔ∏è  Manager user 'manager' already exists (org_id: 1)
‚ÑπÔ∏è  Operator user 'operator' already exists (org_id: 1)
‚úÖ Default organization and essential users created successfully
   - Organization: BatchTrack Organization (Exempt tier)
   - 1 System developer (dev/dev123)
   - 3 Organization users (admin, manager, operator)
‚úÖ Organization and users seeded
=== Step 3: Organization-specific data ===
‚ö†Ô∏è  Category seeding issue: (psycopg2.errors.UndefinedColumn) column inventory_item.container_type does not exist
LINE 1: ...er_material AS inventory_item_container_material, inventory_...
                                                             ^
HINT:  Perhaps you meant to reference the column "inventory_item.container_shape".

[SQL: SELECT inventory_item.id AS inventory_item_id, inventory_item.name AS inventory_item_name, inventory_item.category_id AS inventory_item_category_id, inventory_item.inventory_category_id AS inventory_item_inventory_category_id, inventory_item.quantity AS inventory_item_quantity, inventory_item.unit AS inventory_item_unit, inventory_item.cost_per_unit AS inventory_item_cost_per_unit, inventory_item.low_stock_threshold AS inventory_item_low_stock_threshold, inventory_item.density AS inventory_item_density, inventory_item.type AS inventory_item_type, inventory_item.is_active AS inventory_item_is_active, inventory_item.is_archived AS inventory_item_is_archived, inventory_item.is_perishable AS inventory_item_is_perishable, inventory_item.shelf_life_days AS inventory_item_shelf_life_days, inventory_item.expiration_date AS inventory_item_expiration_date, inventory_item.capacity AS inventory_item_capacity, inventory_item.capacity_unit AS inventory_item_capacity_unit, inventory_item.container_material AS inventory_item_container_material, inventory_item.container_type AS inventory_item_container_type, inventory_item.container_style AS inventory_item_container_style, inventory_item.container_color AS inventory_item_container_color, inventory_item.created_by AS inventory_item_created_by, inventory_item.created_at AS inventory_item_created_at, inventory_item.reference_item_name AS inventory_item_reference_item_name, inventory_item.density_source AS inventory_item_density_source, inventory_item.intermediate AS inventory_item_intermediate, inventory_item.saponification_value AS inventory_item_saponification_value, inventory_item.iodine_value AS inventory_item_iodine_value, inventory_item.melting_point_c AS inventory_item_melting_point_c, inventory_item.flash_point_c AS inventory_item_flash_point_c, inventory_item.ph_value AS inventory_item_ph_value, inventory_item.moisture_content_percent AS inventory_item_moisture_content_percent, inventory_item.shelf_life_months AS inventory_item_shelf_life_months, inventory_item.comedogenic_rating AS inventory_item_comedogenic_rating, inventory_item.global_item_id AS inventory_item_global_item_id, inventory_item.ownership AS inventory_item_ownership, inventory_item.organization_id AS inventory_item_organization_id 
FROM inventory_item 
WHERE inventory_item.category_id = %(category_id_1)s AND inventory_item.organization_id = %(organization_id_1)s]
[parameters: {'category_id_1': 26, 'organization_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
‚úÖ Production seeding complete!
üîí Login: admin/admin (CHANGE IMMEDIATELY)
üìù Note: This command can be run multiple times safely
üìä Database status:
   - Status check failed: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT count(*) AS count_1 
FROM (SELECT organization.id AS organization_id, organization.name AS organization_name, organization.contact_email AS organization_contact_email, organization.created_at AS organization_created_at, organization.is_active AS organization_is_active, organization.signup_source AS organization_signup_source, organization.promo_code AS organization_promo_code, organization.referral_code AS organization_referral_code, organization.subscription_tier_id AS organization_subscription_tier_id, organization.whop_license_key AS organization_whop_license_key, organization.whop_product_tier AS organization_whop_product_tier, organization.whop_verified AS organization_whop_verified, organization.stripe_subscription_id AS organization_stripe_subscription_id, organization.stripe_customer_id AS organization_stripe_customer_id, organization.billing_info AS organization_billing_info, organization.next_billing_date AS organization_next_billing_date, organization.subscription_status AS organization_subscription_status, organization.billing_status AS organization_billing_status, organization.last_online_sync AS organization_last_online_sync, organization.offline_tier_cache AS organization_offline_tier_cache, organization.inventory_cost_method AS organization_inventory_cost_method, organization.inventory_cost_method_changed_at AS organization_inventory_cost_method_changed_at 
FROM organization) AS anon_1]
(Background on this error at: https://sqlalche.me/e/20/2j85)
render@srv-d21alungi27c73dn1440-9467858f-dcqkb:~/project/src$ 