/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask_limiter/extension.py:333: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(
=== Blueprint Registration Summary ===
✅ Successful: 27
   - Authentication
   - Admin
   - Developer
   - Inventory
   - Recipes
   - Batches
   - Organization
   - Billing
   - Settings
   - Timers
   - Expiration
   - Conversion
   - Products Main
   - Product Inventory
   - Reservations
   - SKU Management
   - Product Variants
   - Product Alerts
   - Public API
   - Main API
   - Stock API
   - App Routes
   - Legal Routes
   - Bulk Stock
   - Fault Log
   - Tag Manager
   - Waitlist

🎉 All blueprints registered successfully!
[2025-08-25 16:45:26,548] INFO in unit_utils: BatchTrack startup
INFO  [alembic.env] Imported model module: app.models.batch
INFO  [alembic.env] Imported model module: app.models.billing_snapshot
INFO  [alembic.env] Imported model module: app.models.category
INFO  [alembic.env] Imported model module: app.models.developer_permission
INFO  [alembic.env] Imported model module: app.models.developer_role
INFO  [alembic.env] Imported model module: app.models.inventory
INFO  [alembic.env] Imported model module: app.models.inventory_lot
INFO  [alembic.env] Imported model module: app.models.mixins
INFO  [alembic.env] Imported model module: app.models.models
INFO  [alembic.env] Imported model module: app.models.permission
INFO  [alembic.env] Imported model module: app.models.pricing_snapshot
INFO  [alembic.env] Imported model module: app.models.product
INFO  [alembic.env] Imported model module: app.models.recipe
INFO  [alembic.env] Imported model module: app.models.reservation
INFO  [alembic.env] Imported model module: app.models.role
INFO  [alembic.env] Imported model module: app.models.statistics
INFO  [alembic.env] Imported model module: app.models.stripe_event
INFO  [alembic.env] Imported model module: app.models.subscription_tier
INFO  [alembic.env] Imported model module: app.models.unified_inventory_history
INFO  [alembic.env] Imported model module: app.models.unit
INFO  [alembic.env] Imported model module: app.models.user_preferences
INFO  [alembic.env] Imported model module: app.models.user_role_assignment
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade add_batch_id_to_inventory_lot -> add_affected_lot_id_simple, Add batch_id to inventory_lot table
INFO  [alembic.runtime.migration] Running downgrade add_affected_lot_id_simple -> create_inventory_lot, Add affected_lot_id to unified_inventory_history
✅ Downgrade completed
INFO  [alembic.runtime.migration] Running downgrade create_inventory_lot -> fix_product_sku_id_autoincrement, Create inventory_lot table for proper FIFO tracking
INFO  [alembic.runtime.migration] Running downgrade fix_product_sku_id_autoincrement -> simplify_tiers_add_tier_type, fix product sku id autoincrement
   ⚠️  Downgrade not implemented - would recreate problematic autoincrement
INFO  [alembic.runtime.migration] Running downgrade simplify_tiers_add_tier_type -> fix_all_missing_tier_columns, simplify tiers add tier_type
INFO  [alembic.runtime.migration] Running downgrade fix_all_missing_tier_columns -> fix_missing_max_users_column, fix all missing tier columns
INFO  [alembic.runtime.migration] Running downgrade fix_missing_max_users_column -> 758a11548815, fix missing max_users column
INFO  [alembic.runtime.migration] Running downgrade 758a11548815 -> clean_subscription_tier_billing, clean subscription tier model use lookup keys
INFO  [alembic.runtime.migration] Running downgrade clean_subscription_tier_billing -> 57d6ce45a761, clean subscription tier billing structure
INFO  [alembic.runtime.migration] Running downgrade 57d6ce45a761 -> 6f9bc65166b3, empty message
INFO  [alembic.runtime.migration] Running downgrade 6f9bc65166b3 -> add_email_verified_at_column, Create unified inventory history and merge data
=== Reverting unified inventory history migration ===
   WARNING: Downgrade will lose unified history data!
   ✅ Unified inventory history table dropped
   NOTE: Original inventory_history and product_sku_history tables
         should be restored from backup if needed
INFO  [alembic.runtime.migration] Running downgrade add_email_verified_at_column -> add_is_verified_to_user, add email_verified_at column
=== Removing email_verified_at column (no-op) ===
   No changes to revert
✅ Downgrade completed
INFO  [alembic.runtime.migration] Running downgrade add_is_verified_to_user -> 39e309ff02d1, add is_verified field to user table
=== Removing is_verified field from user table ===
✅ is_verified column removed successfully
✅ Downgrade completed
INFO  [alembic.runtime.migration] Running downgrade 39e309ff02d1 -> add_legacy_compatibility_fields, add legacy compatibility fields to subscription tier
=== Removing legacy compatibility fields ===
   Column stripe_price_id_yearly does not exist - skipping
   Column stripe_price_id_monthly does not exist - skipping
   Column stripe_price_id does not exist - skipping
   Column whop_plan_id does not exist - skipping
   ✅ No columns to remove
✅ Legacy compatibility fields removal completed
INFO  [alembic.runtime.migration] Running downgrade add_legacy_compatibility_fields -> add_tier_key_column, add legacy compatibility fields to subscription tier
=== No-op downgrade: add_legacy_compatibility_fields ===
✅ No changes to revert
INFO  [alembic.runtime.migration] Running downgrade add_tier_key_column -> add_unique_constraint_stripe, add tier_key column to subscription_tier
=== Removing tier_key and related columns ===
   ℹ️  Constraint uq_subscription_tier_tier_key does not exist - skipping
   ℹ️  Column tier_key does not exist - skipping
✅ tier_key column and constraints removal completed
INFO  [alembic.runtime.migration] Running downgrade add_unique_constraint_stripe -> fix_product_sku_name_column, add unique constraint on stripe event id
INFO  [alembic.runtime.migration] Running downgrade fix_product_sku_name_column -> c8f2e5a9b1d4, fix product_sku name column mismatch
INFO  [alembic.runtime.migration] Running downgrade c8f2e5a9b1d4 -> fix_unit_symbol_nullable, fix fallback_price column type from Numeric to String
=== Reverting fallback_price column type ===
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column "fallback_price" of relation "subscription_tier" does not exist


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/bin/flask", line 8, in <module>
    sys.exit(main())
             ^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/cli.py", line 1131, in main
    cli.main()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         ^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/click/core.py", line 1830, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/click/core.py", line 1830, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/click/decorators.py", line 34, in new_func
    return f(get_current_context(), *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/cli.py", line 400, in decorator
    return ctx.invoke(f, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask_migrate/cli.py", line 168, in downgrade
    _downgrade(directory, revision, sql, tag, x_arg)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask_migrate/__init__.py", line 111, in wrapped
    f(*args, **kwargs)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask_migrate/__init__.py", line 210, in downgrade
    command.downgrade(config, revision, sql=sql, tag=tag)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/command.py", line 455, in downgrade
    script.run_env()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/script/base.py", line 586, in run_env
    util.load_python_file(self.dir, "env.py")
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/util/pyfiles.py", line 95, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/util/pyfiles.py", line 113, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/home/runner/workspace/migrations/env.py", line 145, in <module>
    run_migrations_online()
  File "/home/runner/workspace/migrations/env.py", line 139, in run_migrations_online
    context.run_migrations()
  File "<string>", line 8, in run_migrations
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/runtime/environment.py", line 946, in run_migrations
    self.get_context().run_migrations(**kw)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/runtime/migration.py", line 623, in run_migrations
    step.migration_fn(**kw)
  File "/home/runner/workspace/migrations/versions/fix_fallback_price_column_type.py", line 53, in downgrade
    with op.batch_alter_table('subscription_tier', schema=None) as batch_op:
  File "/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/contextlib.py", line 144, in __exit__
    next(self.gen)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/operations/base.py", line 397, in batch_alter_table
    impl.flush()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/operations/batch.py", line 115, in flush
    fn(*arg, **kw)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/ddl/postgresql.py", line 175, in alter_column
    self._exec(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/alembic/ddl/impl.py", line 246, in _exec
    return conn.execute(construct, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py", line 187, in _execute_on_connection
    return connection._execute_ddl(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1527, in _execute_ddl
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "fallback_price" of relation "subscription_tier" does not exist

[SQL: ALTER TABLE subscription_tier ALTER COLUMN fallback_price TYPE NUMERIC(10, 2) ]
(Background on this error at: https://sqlalche.me/e/20/f405)
