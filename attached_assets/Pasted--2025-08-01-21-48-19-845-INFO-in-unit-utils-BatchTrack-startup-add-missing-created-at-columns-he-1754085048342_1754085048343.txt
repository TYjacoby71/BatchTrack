[2025-08-01 21:48:19,845] INFO in unit_utils: BatchTrack startup
add_missing_created_at_columns (head)
render@srv-d21alungi27c73dn1440-869567fc94-r8svx:~/project/src$ flask init-production
DEBUG: Billing blueprint imported successfully: <Blueprint 'billing'>
DEBUG: Billing blueprint name: billing
DEBUG: Billing blueprint url_prefix: /billing
DEBUG: Billing blueprint registered successfully
Registered API routes: ['/api/reservations/create', '/api/reservations/release/<int:reservation_id>', '/api/reservations/convert-to-sale/<int:reservation_id>', '/api/reservations/expire-old', '/api/products/<int:product_id>/variants', '/api/dismiss-alert', '/api/dashboard-alerts', '/api/server-time', '/api/server-time', '/api/dismiss-alert', '/api/dashboard-alerts', '/api/check-stock', '/api/categories', '/api/ingredient/<int:id>/density', '/api/debug-containers', '/api/available-containers/<int:recipe_id>', '/api/containers/available', '/api/batches/<int:batch_id>/containers', '/api/batches/<int:batch_id>/containers/<int:container_id>', '/api/batches/<int:batch_id>/containers/<int:container_id>/adjust', '/api/api/fifo-details/<int:inventory_id>', '/api/api/batch-inventory-summary/<int:batch_id>', '/api/api/reservations/create', '/api/api/reservations/release/<int:reservation_id>', '/api/api/reservations/convert-to-sale/<int:reservation_id>', '/api/api/reservations/expire-old', '/api/dashboard-alerts', '/api/dismiss-alert', '/api/units', '/api/convert-units']
Container routes found: ['/settings/bulk-update-containers', '/api/debug-containers', '/api/available-containers/<int:recipe_id>', '/api/containers/available', '/api/batches/<int:batch_id>/containers', '/api/batches/<int:batch_id>/containers/<int:container_id>', '/api/batches/<int:batch_id>/containers/<int:container_id>/adjust', '/debug-containers', '/available-containers/<int:recipe_id>', '/containers/available', '/batches/<int:batch_id>/containers', '/batches/<int:batch_id>/containers/<int:container_id>', '/batches/<int:batch_id>/containers/<int:container_id>/adjust']
Billing routes found: ['/billing/reconciliation-needed', '/billing/reconcile-to-free', '/billing/upgrade', '/billing/checkout/<tier>/<billing_cycle>', '/billing/checkout/<tier>', '/billing/customer-portal', '/billing/cancel-subscription', '/billing/webhooks/stripe', '/billing/complete-signup-from-stripe', '/billing/debug']
Billing endpoints: [('/billing/reconciliation-needed', 'billing.reconciliation_needed'), ('/billing/reconcile-to-free', 'billing.reconcile_to_free'), ('/billing/upgrade', 'billing.upgrade'), ('/billing/checkout/<tier>/<billing_cycle>', 'billing.checkout'), ('/billing/checkout/<tier>', 'billing.checkout'), ('/billing/customer-portal', 'billing.customer_portal'), ('/billing/cancel-subscription', 'billing.cancel_subscription'), ('/billing/webhooks/stripe', 'billing.stripe_webhook'), ('/billing/complete-signup-from-stripe', 'billing.complete_signup_from_stripe'), ('/billing/debug', 'billing.debug_billing')]
[2025-08-01 21:48:30,767] INFO in unit_utils: BatchTrack startup
üöÄ BatchTrack Production Seeding Starting...
‚ö†Ô∏è  Assumes database schema is already migrated (flask db upgrade)
=== Step 1: System foundations ===
=== Seeding Consolidated Permissions System ===
Seeding organization permissions...
Processing category: Main dashboard and overview features
  Updated: dashboard.view
Processing category: All inventory tracking, adjustments, and stock management
  Updated: inventory.view
  Updated: inventory.edit
  Updated: inventory.adjust
  Updated: inventory.reserve
  Updated: inventory.delete
  Updated: inventory.view_costs
Processing category: Recipe creation, editing, and production planning
  Updated: recipes.view
  Updated: recipes.create
  Updated: recipes.edit
  Updated: recipes.delete
  Updated: recipes.scale
  Updated: recipes.plan_production
Processing category: Production batch tracking from start to finish
  Updated: batches.view
  Updated: batches.create
  Updated: batches.edit
  Updated: batches.finish
  Updated: batches.cancel
  Updated: batches.view_costs
Processing category: Product catalog, SKUs, and sales tracking
  Updated: products.view
  Updated: products.create
  Updated: products.edit
  Updated: products.delete
  Updated: products.manage_variants
  Updated: products.sales_tracking
Processing category: Organization settings, users, and roles management
  Updated: organization.view
  Updated: organization.edit
  Updated: organization.manage_users
  Updated: organization.manage_roles
  Updated: organization.manage_billing
  Updated: organization.view_audit_logs
Processing category: Alert management and notification preferences
  Updated: alerts.view
  Updated: alerts.manage
  Updated: alerts.dismiss
Processing category: Reporting, analytics, and business insights
  Updated: reports.view
  Updated: reports.export
  Updated: reports.advanced
  Updated: reports.custom
Processing category: Third-party integrations and marketplace connections
  Updated: integrations.shopify
  Updated: integrations.marketplace
  Updated: integrations.api_access
Processing category: AI-powered features and automation
  Updated: ai.recipe_optimization
  Updated: ai.demand_forecasting
  Updated: ai.quality_insights
‚úÖ Organization permissions seeded successfully!
Seeding developer permissions...
Processing category: Core system administration and management
  Updated: dev.system_admin
  Updated: dev.dashboard
  Updated: dev.debug_mode
  Updated: dev.access_logs
  Updated: dev.system_settings
Processing category: Database management and migration operations
  Updated: dev.run_migrations
  Updated: dev.seed_data
  Updated: dev.backup_restore
Processing category: Cross-organization management and oversight
  Updated: dev.all_organizations
  Updated: dev.create_organizations
  Updated: dev.modify_any_organization
  Updated: dev.delete_organizations
Processing category: Global user and permission management
  Updated: dev.manage_users
  Updated: dev.manage_roles
  Updated: dev.assign_permissions
Processing category: Subscription tiers and billing oversight
  Updated: dev.manage_tiers
  Updated: dev.billing_override
  Updated: dev.view_all_billing
Processing category: All organization-level permissions available to developers
  Updated: app.dashboard.view
  Updated: app.inventory.view
  Updated: app.inventory.edit
  Updated: app.inventory.adjust
  Updated: app.inventory.reserve
  Updated: app.inventory.delete
  Updated: app.inventory.view_costs
  Updated: app.recipes.view
  Updated: app.recipes.create
  Updated: app.recipes.edit
  Updated: app.recipes.delete
  Updated: app.recipes.scale
  Updated: app.recipes.plan_production
  Updated: app.batches.view
  Updated: app.batches.create
  Updated: app.batches.edit
  Updated: app.batches.finish
  Updated: app.batches.cancel
  Updated: app.batches.view_costs
  Updated: app.products.view
  Updated: app.products.create
  Updated: app.products.edit
  Updated: app.products.delete
  Updated: app.products.manage_variants
  Updated: app.products.sales_tracking
  Updated: app.organization.view
  Updated: app.organization.edit
  Updated: app.organization.manage_users
  Updated: app.organization.manage_roles
  Updated: app.organization.manage_billing
  Updated: app.organization.view_audit_logs
  Updated: app.alerts.view
  Updated: app.alerts.manage
  Updated: app.alerts.dismiss
  Updated: app.reports.view
  Updated: app.reports.export
  Updated: app.reports.advanced
  Updated: app.reports.custom
  Updated: app.integrations.shopify
  Updated: app.integrations.marketplace
  Updated: app.integrations.api_access
  Updated: app.ai.recipe_optimization
  Updated: app.ai.demand_forecasting
  Updated: app.ai.quality_insights
‚úÖ Developer permissions seeded successfully!
Seeding developer roles...
‚úÖ Created/updated system_admin role with 62 permissions
‚úÖ Created/updated developer role with 7 permissions
‚úÖ Created/updated support role with 8 permissions
‚úÖ Developer roles seeded successfully!
=== Seeding Organization System Roles ===
‚ÑπÔ∏è  organization_owner system role already exists
‚úÖ Organization system roles seeded successfully!
‚úÖ Assigned 0 permissions to fresh organization owner role
‚úÖ Cleaned up old permissions
‚úÖ Consolidated permissions system seeded successfully!

üìä Summary:
Organization permissions: 44
Developer permissions: 62
‚úÖ Permissions seeded
=== Seeding Subscription Tiers Only ===
=== Seeding Subscription Tiers (Create Only Mode) ===
‚ÑπÔ∏è  Exempt tier already exists
‚ÑπÔ∏è  Tier 'free' already exists - PRESERVING existing configuration
‚ÑπÔ∏è  Tier 'solo' already exists - PRESERVING existing configuration
‚ÑπÔ∏è  Tier 'team' already exists - PRESERVING existing configuration
‚ÑπÔ∏è  Tier 'enterprise' already exists - PRESERVING existing configuration
‚úÖ Subscription tiers seeded successfully!
   - Existing tiers were PRESERVED and not modified
   - Only new tiers were created from JSON configuration
=== Migrating Organizations to Tier IDs ===
‚úÖ Organization migration completed!
‚úÖ Subscription tiers seeding completed!
   - Exempt tier created with unlimited permissions
   - New tiers created from JSON configuration
   - Existing tier configurations were PRESERVED
   - Ready for user seeder to create organizations
‚úÖ Subscription tiers seeded
=== Seeding 45 standard units ===
‚úÖ Added 0 new units
‚ÑπÔ∏è  Total units in database: 45
‚úÖ Units seeded
=== Step 2: Initial admin setup ===
=== Creating Default Organization with Essential Users ===
‚ÑπÔ∏è  No organizations found - creating default organization
‚úÖ Created default organization: BatchTrack Organization (ID: 3)
‚ÑπÔ∏è  Using organization: BatchTrack Organization (ID: 3)
   - Subscription tier: exempt (Exempt Plan)
‚ö†Ô∏è  User/organization seeding issue: (psycopg2.errors.StringDataRightTruncation) value too long for type character varying(120)

[SQL: INSERT INTO "user" (username, password_hash, first_name, last_name, email, phone, organization_id, user_type, is_organization_owner, is_active, created_at, last_login, timezone, deleted_at, deleted_by, is_deleted) VALUES (%(username)s, %(password_hash)s, %(first_name)s, %(last_name)s, %(email)s, %(phone)s, %(organization_id)s, %(user_type)s, %(is_organization_owner)s, %(is_active)s, %(created_at)s, %(last_login)s, %(timezone)s, %(deleted_at)s, %(deleted_by)s, %(is_deleted)s) RETURNING "user".id]
[parameters: {'username': 'dev', 'password_hash': 'scrypt:32768:8:1$OmtWpnG4oHdrs2WO$963cdfc214681f94726dde6f630a06365d6896c6a238d198660ee13ec814f641ed3bdaa1b85798061d95a6772f9c956c36b4bfc2659aac847b7e7697e211e460', 'first_name': 'System', 'last_name': 'Developer', 'email': 'dev@batchtrack.com', 'phone': '000-000-0000', 'organization_id': None, 'user_type': 'developer', 'is_organization_owner': False, 'is_active': True, 'created_at': datetime.datetime(2025, 8, 1, 21, 48, 31, 561111), 'last_login': None, 'timezone': 'UTC', 'deleted_at': None, 'deleted_by': None, 'is_deleted': False}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
   Continuing with remaining steps...
=== Step 3: Organization setup ===
‚ö†Ô∏è  Category seeding issue: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.StringDataRightTruncation) value too long for type character varying(120)

[SQL: INSERT INTO "user" (username, password_hash, first_name, last_name, email, phone, organization_id, user_type, is_organization_owner, is_active, created_at, last_login, timezone, deleted_at, deleted_by, is_deleted) VALUES (%(username)s, %(password_hash)s, %(first_name)s, %(last_name)s, %(email)s, %(phone)s, %(organization_id)s, %(user_type)s, %(is_organization_owner)s, %(is_active)s, %(created_at)s, %(last_login)s, %(timezone)s, %(deleted_at)s, %(deleted_by)s, %(is_deleted)s) RETURNING "user".id]
[parameters: {'username': 'dev', 'password_hash': 'scrypt:32768:8:1$OmtWpnG4oHdrs2WO$963cdfc214681f94726dde6f630a06365d6896c6a238d198660ee13ec814f641ed3bdaa1b85798061d95a6772f9c956c36b4bfc2659aac847b7e7697e211e460', 'first_name': 'System', 'last_name': 'Developer', 'email': 'dev@batchtrack.com', 'phone': '000-000-0000', 'organization_id': None, 'user_type': 'developer', 'is_organization_owner': False, 'is_active': True, 'created_at': datetime.datetime(2025, 8, 1, 21, 48, 31, 561111), 'last_login': None, 'timezone': 'UTC', 'deleted_at': None, 'deleted_by': None, 'is_deleted': False}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) (Background on this error at: https://sqlalche.me/e/20/7s2a)
‚úÖ Production seeding complete!
üîí Login: admin/admin (CHANGE IMMEDIATELY)
üìù Note: This command can be run multiple times safely
üìä Database status:
   - Status check failed: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.StringDataRightTruncation) value too long for type character varying(120)

[SQL: INSERT INTO "user" (username, password_hash, first_name, last_name, email, phone, organization_id, user_type, is_organization_owner, is_active, created_at, last_login, timezone, deleted_at, deleted_by, is_deleted) VALUES (%(username)s, %(password_hash)s, %(first_name)s, %(last_name)s, %(email)s, %(phone)s, %(organization_id)s, %(user_type)s, %(is_organization_owner)s, %(is_active)s, %(created_at)s, %(last_login)s, %(timezone)s, %(deleted_at)s, %(deleted_by)s, %(is_deleted)s) RETURNING "user".id]
[parameters: {'username': 'dev', 'password_hash': 'scrypt:32768:8:1$OmtWpnG4oHdrs2WO$963cdfc214681f94726dde6f630a06365d6896c6a238d198660ee13ec814f641ed3bdaa1b85798061d95a6772f9c956c36b4bfc2659aac847b7e7697e211e460', 'first_name': 'System', 'last_name': 'Developer', 'email': 'dev@batchtrack.com', 'phone': '000-000-0000', 'organization_id': None, 'user_type': 'developer', 'is_organization_owner': False, 'is_active': True, 'created_at': datetime.datetime(2025, 8, 1, 21, 48, 31, 561111), 'last_login': None, 'timezone': 'UTC', 'deleted_at': None, 'deleted_by': None, 'is_deleted': False}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) (Background on this error at: https://sqlalche.me/e/20/7s2a)
render@srv-d21alungi27c73dn1440-869567fc94-r8svx:~/project/src$ 