Here's the full code batch to safely patch your app for better handling of:

ðŸ¥š Count-based items like "eggs"

ðŸ§® Empty, invalid, or missing quantities

ðŸ“¢ Logging for debugging bad entries

âœ… Code Patch: Safe Quantity Handling Across the App
ðŸ“„ In unit_converter.py â€” update check_stock_availability
Replace the function with:

python
Copy
Edit
def check_stock_availability(recipe_qty, recipe_unit, stock_qty, stock_unit):
    """
    Check if there's enough stock for a recipe
    Returns: (bool available, float converted_stock_qty, float needed_qty)
    """
    try:
        # Safe float fallback
        recipe_qty = float(recipe_qty or 0)
        stock_qty = float(stock_qty or 0)

        converted_stock = converter.convert(stock_qty, stock_unit, recipe_unit)
        if converted_stock is None:
            print(f"[WARN] Unit mismatch: {stock_unit} â†’ {recipe_unit}")
            return False, 0, recipe_qty

        return converted_stock >= recipe_qty, converted_stock, recipe_qty

    except (ValueError, TypeError) as e:
        print(f"[ERROR] Stock check failed for {stock_qty} {stock_unit}: {e}")
        return False, 0, 0
ðŸ“„ In any file that processes ingredients or inventory (examples: routes/stock/routes.py, batches.py), wrap quantity usage like this:
python
Copy
Edit
def safe_float(val):
    try:
        return float(val)
    except (ValueError, TypeError):
        print(f"[WARN] Invalid quantity: {val} â†’ defaulting to 0")
        return 0
Then replace raw float() uses with:

python
Copy
Edit
qty = safe_float(ingredient.get("quantity", 0))
ðŸ“„ Optionally in utils.py (or wherever global tools live)
Add:

python
Copy
Edit
def safe_float(val):
    try:
        return float(val)
    except (ValueError, TypeError):
        return 0
Then update your templates or calculations to use this instead of raw float() calls.

âœ… Summary of What This Fixes
Issue	Result
"egg" with no quantity	Now shows as 0 and triggers restock warning
"banana": ""	Logs a warning and doesnâ€™t crash stock logic
float('abc') in form	No crash â€” logs warning and uses 0
Units like egg, count	Treated as countable units (future expansion)