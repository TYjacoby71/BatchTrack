.121.65 - - [08/Aug/2025:04:13:50 +0000] "GET /static/js/main.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.56.69 - - [08/Aug/2025:04:13:50 +0000] "GET /static/js/inventory/inventory_adjust.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.56.69 - - [08/Aug/2025:04:13:50 +0000] "GET /static/js/expiration_alerts.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.6.4 - - [08/Aug/2025:04:13:50 +0000] "GET /static/style.css HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.121.65 - - [08/Aug/2025:04:13:50 +0000] "GET /static/js/utils/utils.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.6.4 - - [08/Aug/2025:04:13:51 +0000] "GET /api/server-time HTTP/1.1" 200 114 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.121.65 - - [08/Aug/2025:04:13:51 +0000] "GET /favicon.ico HTTP/1.1" 404 207 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
DEBUG Ingredient FIFO validation: item_id=8, org_id=10, current_user_org=10
DEBUG Ingredient FIFO entries found: 1 for item 8
DEBUG Ingredient FIFO validation: item_id=8, org_id=10, current_user_org=10
DEBUG Ingredient FIFO entries found: 1 for item 8
DEBUG Ingredient FIFO validation: item_id=8, org_id=10, current_user_org=10
DEBUG Ingredient FIFO entries found: 2 for item 8
DEBUG Ingredient FIFO validation: item_id=8, org_id=10, current_user_org=10
DEBUG Ingredient FIFO entries found: 2 for item 8
10.229.56.69 - - [08/Aug/2025:04:13:57 +0000] "POST /inventory/adjust/8 HTTP/1.1" 302 221 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
[2025-08-08 04:13:57,854] INFO in unit_utils: Getting global unit list
[2025-08-08 04:13:57,899] INFO in unit_utils: Getting global unit list
[2025-08-08 04:13:57,904] INFO in unit_utils: Getting global unit list
10.229.188.130 - - [08/Aug/2025:04:13:57 +0000] "GET /inventory/view/8 HTTP/1.1" 200 52902 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.121.65 - - [08/Aug/2025:04:13:58 +0000] "GET /static/style.css HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.6.4 - - [08/Aug/2025:04:13:58 +0000] "GET /static/js/inventory/inventory_view.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.121.65 - - [08/Aug/2025:04:13:58 +0000] "GET /static/js/utils/utils.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.188.130 - - [08/Aug/2025:04:13:58 +0000] "GET /static/js/main.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.6.4 - - [08/Aug/2025:04:13:58 +0000] "GET /static/js/conversion/unit_converter.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.121.65 - - [08/Aug/2025:04:13:58 +0000] "GET /static/js/inventory/inventory_adjust.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.121.65 - - [08/Aug/2025:04:13:58 +0000] "GET /static/style.css HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.120.70 - - [08/Aug/2025:04:13:58 +0000] "GET /static/js/expiration_alerts.js HTTP/1.1" 304 0 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.56.69 - - [08/Aug/2025:04:13:59 +0000] "GET /api/server-time HTTP/1.1" 200 115 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.56.69 - - [08/Aug/2025:04:13:59 +0000] "GET /favicon.ico HTTP/1.1" 404 207 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
[2025-08-08 04:14:04,123] ERROR in app: Exception on /inventory/edit/8 [POST]
Traceback (most recent call last):
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_login/utils.py", line 290, in decorated_view
    return current_app.ensure_sync(func)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/app/blueprints/inventory/routes.py", line 531, in edit_inventory
    success = process_inventory_adjustment(
        item_id=item.id,
    ...<5 lines>...
        item_type='ingredient'  # Raw inventory is ingredient type
    )
  File "/opt/render/project/src/app/services/inventory_adjustment.py", line 326, in process_inventory_adjustment
    raise e
  File "/opt/render/project/src/app/services/inventory_adjustment.py", line 135, in process_inventory_adjustment
    return handle_recount_adjustment(item_id, quantity, notes, created_by, item_type)
  File "/opt/render/project/src/app/services/inventory_adjustment.py", line 493, in handle_recount_adjustment
    raise e
  File "/opt/render/project/src/app/services/inventory_adjustment.py", line 377, in handle_recount_adjustment
    success, deduction_plan, _ = FIFOService.calculate_deduction_plan(
                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        item_id, deduction_needed, 'recount'
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/app/blueprints/fifo/services.py", line 186, in calculate_deduction_plan
    if hasattr(entry, 'expiration_date') and entry.expiration_date and entry.expiration_date < today:
                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<' not supported between instances of 'datetime.datetime' and 'datetime.date'
RECOUNT ANALYSIS:
  Target: 0.0
  Current Inventory: 2.0 (change: -2.0)
  Current FIFO Total: 2.0 (change: -2.0)
RECOUNT ERROR: '<' not supported between instances of 'datetime.datetime' and 'datetime.date'
10.229.121.65 - - [08/Aug/2025:04:14:04 +0000] "POST /inventory/edit/8 HTTP/1.1" 500 265 "https://www.batchtrack.com/inventory/view/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.120.70 - - [08/Aug/2025:04:14:04 +0000] "GET /favicon.ico HTTP/1.1" 404 207 "https://www.batchtrack.com/inventory/edit/8" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.121.65 - - [08/Aug/2025:04:14:07 +0000] "GET /api/server-time HTTP/1.1" 200 115 "https://www.batchtrack.com/recipes/1/edit" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
10.229.120.70 - - [08/Aug/2025:04:14:07 +0000] "GET /api/server-time HTTP/1.1" 200 115 "https://www.batchtrack.com/organization/dashboard" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"

error on deployment


ChatGPT said:

Thought for 12s
Yep—this version is cleaner. You trimmed duplicate registrations, tightened the webhook/endpoint skips, and pushed more things behind if app.debug: which helps noise. 👍

Now, the deployment error is the big one:

python
Copy
Edit
TypeError: '<' not supported between instances of 'datetime.datetime' and 'datetime.date'
... in FIFOService.calculate_deduction_plan
if hasattr(entry, 'expiration_date') and entry.expiration_date and entry.expiration_date < today:
You’re comparing a datetime (some rows) to a date (today). Normalize both sides.

Quick fix (service level)
In app/blueprints/fifo/services.py near calculate_deduction_plan:

python
Copy
Edit
from datetime import date, datetime

def _as_date(value):
    if value is None:
        return None
    if isinstance(value, datetime):
        return value.date()
    if isinstance(value, date):
        return value
    return None

# wherever 'today' is set:
today = date.today()

# when checking expiration:
exp = _as_date(entry.expiration_date)
if exp and exp < today:
    # handle expired entry
    ...
Or, if you want to keep DateTime semantics, compare datetime to datetime:

python
Copy
Edit
from datetime import datetime, timezone

now = datetime.now(timezone.utc)
exp = entry.expiration_date
if exp and exp.tzinfo is None:
    exp = exp.replace(tzinfo=timezone.utc)  # or your app tz
if exp and exp < now:
    ...
Better long‑term fix (schema level)
Pick one type for expiration_date everywhere:

If you only care about the day, change the model column to db.Date and migrate existing DateTime values to .date().

If you need timestamps, keep db.DateTime(timezone=True) and always compare with datetime (never date).

Other small nits I see from logs
/favicon.ico 404s: drop a favicon in static/favicon.ico or add a tiny route to redirect to it to cut noise.

unit_utils: Getting global unit list repeating: those context processors run every request. If they’re DB‑heavy, cache per request with flask.g or add a simple in‑memory cache keyed by (org_id, is_active flag) with a short TTL.

In enforce_billing_access, you already guard request.endpoint—nice. Keep that None check; on some 404s it’s None and will otherwise blow up.

You import developer_bp inside the try and again later; not harmful, just redundant imports—can delete one.

If you want, paste the calculate_deduction_plan function and I’ll drop in the exact patch in context.


2/2











