render@srv-d21alungi27c73dn1440-85f5d859f5-52jjl:~/project/src$ flask db upgrade
/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_limiter/extension.py:333: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(

=== Blueprint Registration Summary ===
✅ Successful: 29
   - Authentication
   - Admin
   - Developer
   - Inventory
   - Recipes
   - Batches
   - Organization
   - Billing
   - Settings
   - Timers
   - Expiration
   - Conversion
   - Products Main
   - Public API
   - Main API
   - Drawer Actions
   - Density Reference
   - Retention Drawer API
   - Global Link Drawer API
   - App Routes
   - Legal Routes
   - Bulk Stock
   - Fault Log
   - Tag Manager
   - Global Library Public
   - Waitlist
   - Public Tools
   - Production Planning
   - Exports

🎉 All blueprints registered successfully!
INFO  [alembic.env] Imported model module: app.models.addon
INFO  [alembic.env] Imported model module: app.models.batch
INFO  [alembic.env] Imported model module: app.models.billing_snapshot
INFO  [alembic.env] Imported model module: app.models.category
INFO  [alembic.env] Imported model module: app.models.developer_permission
INFO  [alembic.env] Imported model module: app.models.developer_role
INFO  [alembic.env] Imported model module: app.models.domain_event
INFO  [alembic.env] Imported model module: app.models.freshness_snapshot
INFO  [alembic.env] Imported model module: app.models.global_item
INFO  [alembic.env] Imported model module: app.models.global_item_alias
INFO  [alembic.env] Imported model module: app.models.inventory
INFO  [alembic.env] Imported model module: app.models.inventory_lot
INFO  [alembic.env] Imported model module: app.models.mixins
INFO  [alembic.env] Imported model module: app.models.models
INFO  [alembic.env] Imported model module: app.models.permission
INFO  [alembic.env] Imported model module: app.models.pricing_snapshot
INFO  [alembic.env] Imported model module: app.models.product
INFO  [alembic.env] Imported model module: app.models.product_category
INFO  [alembic.env] Imported model module: app.models.recipe
INFO  [alembic.env] Imported model module: app.models.reservation
INFO  [alembic.env] Imported model module: app.models.retention
INFO  [alembic.env] Imported model module: app.models.role
INFO  [alembic.env] Imported model module: app.models.statistics
INFO  [alembic.env] Imported model module: app.models.stripe_event
INFO  [alembic.env] Imported model module: app.models.subscription_tier
INFO  [alembic.env] Imported model module: app.models.unified_inventory_history
INFO  [alembic.env] Imported model module: app.models.unit
INFO  [alembic.env] Imported model module: app.models.user_preferences
INFO  [alembic.env] Imported model module: app.models.user_role_assignment
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
render@srv-d21alungi27c73dn1440-85f5d859f5-52jjl:~/project/src$ flask db history
/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_limiter/extension.py:333: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(

=== Blueprint Registration Summary ===
✅ Successful: 29
   - Authentication
   - Admin
   - Developer
   - Inventory
   - Recipes
   - Batches
   - Organization
   - Billing
   - Settings
   - Timers
   - Expiration
   - Conversion
   - Products Main
   - Public API
   - Main API
   - Drawer Actions
   - Density Reference
   - Retention Drawer API
   - Global Link Drawer API
   - App Routes
   - Legal Routes
   - Bulk Stock
   - Fault Log
   - Tag Manager
   - Global Library Public
   - Waitlist
   - Public Tools
   - Production Planning
   - Exports

🎉 All blueprints registered successfully!
20251009_2 -> 20251009_3 (head), Align models to own keep-list indexes, projections, and association table
20251009_1 -> 20251009_2, Repair keep-list indexes/tables and add tier_included_addon
20251008_3 -> 20251009_1, Add missing retention policy columns to subscription_tier
20251008_2 -> 20251008_3, Add optional GIN index on recipe.category_data for ad-hoc queries
20251008_1 -> 20251008_2, Add generated columns for hot batch fields (from plan_snapshot.category_extension) and indexes
20251006_2 -> 20251008_1, Add generated columns for hot recipe fields and basic indexes
20251006_1 -> 20251006_2, Add ui_config JSON column to product_category
20251001_2 -> 20251006_1, Add category_data JSON column to recipe table
20251001_1 -> 20251001_2, add function_key and retention_extension_days to addon
20250930_5 -> 20251001_1, add addon models and tier allowed addons
20250930_4 -> 20250930_5, Set default visibility flags for global ingredient categories
20250930_3 -> 20250930_4, Add visibility control fields for soap-making attributes to ingredient categories
20250930_2 -> 20250930_3, Add soap making and cosmetic formulation attributes to global_item table
20250930_1 -> 20250930_2, Add soap making and cosmetic formulation attributes to inventory items
20250925_04 -> 20250930_1, Add global_item_alias table and performance indexes
20250925_03 -> 20250925_04, Add container structured attributes to inventory_item and global_item
20250925_02 -> 20250925_03, Add portion_unit_id FK to recipe and batch
20250925_01 -> 20250925_02, Add plan_snapshot JSON to batch
20250924_01 -> 20250925_01, Add portion columns to recipe and batch: is_portioned, portion_name, counts
20250923_04 -> 20250924_01, Drop Product.base_unit column
20250923_03 -> 20250923_04, Add sku_name_template to product_category
20250923_02 -> 20250923_03, Add portioning_data JSON to recipe and batch
20250923_01 -> 20250923_02, Add category_id to product and recipe, backfill to Uncategorized, set NOT NULL
20250922_02 -> 20250923_01, Create product_category table
20250922_01_align_extras -> 20250922_02, Add inventory cost method toggle and valuation method fields
d953779b55a3 -> 20250922_01_align_extras, Align naming for extras and ensure consumable tables and indexes exist
20250912_01 -> d953779b55a3, empty message
20250913014500 -> 20250912_01, Add domain_event and freshness_snapshot tables
20250911_06 -> 20250913014500, rename is_reference_category to is_global_category
20250911_05 -> 20250911_06, Fix inventory item name constraint to be organization-scoped
20250911_04 -> 20250911_05, Add missing timestamp columns to global_item
20250911_03 -> 20250911_04, Add missing timestamp columns to ingredient_category
20250911_02 -> 20250911_03, Remove reference_category field from global_item table
20250911_01 -> 20250911_02, Add reference_category field to global_item table
20250908_01 -> 20250911_01, cleanup redundant category fields
2025090502 -> 20250908_01, Add organization_id column to recipe_consumable table
20250906_01 -> 2025090502, Add consumables tables for recipes and batches
20250905_01 -> 20250906_01, Add foreign key from global_item to ingredient_category
20250904_04a -> 20250905_01, Add soft-delete fields to global_item and ownership to inventory_item
20250904_04 -> 20250904_04a, Add reference_category to global_item
20250904_03 -> 20250904_04, Add missing inventory_category_id column to inventory_item table
20250904_02 -> 20250904_03, Set ON DELETE SET NULL for inventory_item.global_item_id
20250904_01a -> 20250904_02, Extend GlobalItem with synonyms and perishable defaults
20250904_01 -> 20250904_01a, Repair: ensure global_item exists with indexes and FK
add_reference_guide_integration -> 20250904_01, Global items table, link to inventory_item, and performance indexes
add_capacity_fields -> add_reference_guide_integration, Add reference guide integration fields
add_comprehensive_stats -> add_capacity_fields, Add container capacity columns
fix_perm_unit_schema -> add_comprehensive_stats, Add comprehensive statistics models
edb302e17958 -> fix_perm_unit_schema, fix permission and unit schema mismatch
add_perm_category_col -> edb302e17958, empty message
add_missing_user_columns -> add_perm_category_col, add missing permission category column
add_missing_last_login_column -> add_missing_user_columns, add missing user columns
add_batch_id_to_inventory_lot -> add_missing_last_login_column, add missing last_login column
add_affected_lot_id_simple -> add_batch_id_to_inventory_lot, Add batch_id to inventory_lot table
create_inventory_lot -> add_affected_lot_id_simple, Add affected_lot_id to unified_inventory_history
fix_product_sku_id_autoincrement -> create_inventory_lot, Create inventory_lot table for proper FIFO tracking
simplify_tiers_add_tier_type -> fix_product_sku_id_autoincrement, fix product sku id autoincrement
fix_all_missing_tier_columns -> simplify_tiers_add_tier_type, simplify tiers add tier_type
fix_missing_max_users_column -> fix_all_missing_tier_columns, fix all missing tier columns
758a11548815 -> fix_missing_max_users_column, fix missing max_users column
clean_subscription_tier_billing -> 758a11548815, clean subscription tier model use lookup keys
57d6ce45a761 -> clean_subscription_tier_billing, clean subscription tier billing structure
6f9bc65166b3 -> 57d6ce45a761, empty message
add_email_verified_at_column -> 6f9bc65166b3, Create unified inventory history and merge data
add_is_verified_to_user -> add_email_verified_at_column, add email_verified_at column
39e309ff02d1 -> add_is_verified_to_user, add is_verified field to user table
add_legacy_compatibility_fields -> 39e309ff02d1, add legacy compatibility fields to subscription tier
add_tier_key_column -> add_legacy_compatibility_fields, add legacy compatibility fields to subscription tier
add_unique_constraint_stripe -> add_tier_key_column, add tier_key column to subscription_tier
fix_product_sku_name_column -> add_unique_constraint_stripe, add unique constraint on stripe event id
c8f2e5a9b1d4 -> fix_product_sku_name_column, fix product_sku name column mismatch
fix_unit_symbol_nullable -> c8f2e5a9b1d4, fix fallback_price column type from Numeric to String
b5c7d8e9f1a2 -> fix_unit_symbol_nullable, make unit symbol nullable for custom units
9a2b8c4d5e6f -> b5c7d8e9f1a2, replace billing provider booleans with enum fields
add_fallback_price_column -> 9a2b8c4d5e6f, fix missing oauth columns postgresql
fix_missing_email_verification -> add_fallback_price_column, add_fallback_price_column
4246268c4e7c -> fix_missing_email_verification, fix missing email verification columns
3f7a8b9c2d5e -> 4246268c4e7c, add_oauth_and_email_verification_fields
add_offline_billing_support -> 3f7a8b9c2d5e, Add offline billing support and missing billing fields
drop_deprecated_billing_columns -> add_offline_billing_support, Add offline billing support
f4e5d6c7b8a9 -> drop_deprecated_billing_columns, drop deprecated billing columns
0e15af770cb3 -> f4e5d6c7b8a9, remove nonexistent billing columns
a1b2c3d4e5f6789012345678901234ab -> 0e15af770cb3, simplify subscription tier model - remove billing fields
whop_integration -> a1b2c3d4e5f6789012345678901234ab, Add Whop integration fields to SubscriptionTier
add_billing_columns_org -> whop_integration, Add Whop integration fields to Organization
1a2b3c4d5e6f -> add_billing_columns_org, add billing columns to organization
9d2a5c7f8b1e -> 1a2b3c4d5e6f, force drop unwanted columns
8b7aa70df87d -> 9d2a5c7f8b1e, fix inventory history constraints
fix_password_hash_length -> 8b7aa70df87d, fix user_role_assignment constraints to allow NULL role_id for developer roles
add_missing_table_schemas -> fix_password_hash_length, fix password_hash column length
add_missing_created_at_columns -> add_missing_table_schemas, add missing table schemas for billing_snapshot, pricing_snapshot, and statistics
add_unit_timestamps -> add_missing_created_at_columns, add missing created_at and updated_at columns to all models
fix_nullable_constraints -> add_unit_timestamps, add missing timestamp columns to unit table
add_missing_timestamps -> fix_nullable_constraints, fix nullable columns and add constraints
f3b0e59fe9c1 -> add_missing_timestamps, add missing timestamp columns
132971c1d456 -> f3b0e59fe9c1, add missing recipe columns
4481595c5f02 -> 132971c1d456, add all missing columns to match model definitions
<base> -> 4481595c5f02, empty message
render@srv-d21alungi27c73dn1440-85f5d859f5-52jjl:~/project/src$ flask downgrade 4481595c5f02
/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_limiter/extension.py:333: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(

=== Blueprint Registration Summary ===
✅ Successful: 29
   - Authentication
   - Admin
   - Developer
   - Inventory
   - Recipes
   - Batches
   - Organization
   - Billing
   - Settings
   - Timers
   - Expiration
   - Conversion
   - Products Main
   - Public API
   - Main API
   - Drawer Actions
   - Density Reference
   - Retention Drawer API
   - Global Link Drawer API
   - App Routes
   - Legal Routes
   - Bulk Stock
   - Fault Log
   - Tag Manager
   - Global Library Public
   - Waitlist
   - Public Tools
   - Production Planning
   - Exports

🎉 All blueprints registered successfully!
Usage: flask [OPTIONS] COMMAND [ARGS]...
Try 'flask --help' for help.

Error: No such command 'downgrade'.
render@srv-d21alungi27c73dn1440-85f5d859f5-52jjl:~/project/src$ flask db downgrade 4481595c5f02
/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_limiter/extension.py:333: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(

=== Blueprint Registration Summary ===
✅ Successful: 29
   - Authentication
   - Admin
   - Developer
   - Inventory
   - Recipes
   - Batches
   - Organization
   - Billing
   - Settings
   - Timers
   - Expiration
   - Conversion
   - Products Main
   - Public API
   - Main API
   - Drawer Actions
   - Density Reference
   - Retention Drawer API
   - Global Link Drawer API
   - App Routes
   - Legal Routes
   - Bulk Stock
   - Fault Log
   - Tag Manager
   - Global Library Public
   - Waitlist
   - Public Tools
   - Production Planning
   - Exports

🎉 All blueprints registered successfully!
INFO  [alembic.env] Imported model module: app.models.addon
INFO  [alembic.env] Imported model module: app.models.batch
INFO  [alembic.env] Imported model module: app.models.billing_snapshot
INFO  [alembic.env] Imported model module: app.models.category
INFO  [alembic.env] Imported model module: app.models.developer_permission
INFO  [alembic.env] Imported model module: app.models.developer_role
INFO  [alembic.env] Imported model module: app.models.domain_event
INFO  [alembic.env] Imported model module: app.models.freshness_snapshot
INFO  [alembic.env] Imported model module: app.models.global_item
INFO  [alembic.env] Imported model module: app.models.global_item_alias
INFO  [alembic.env] Imported model module: app.models.inventory
INFO  [alembic.env] Imported model module: app.models.inventory_lot
INFO  [alembic.env] Imported model module: app.models.mixins
INFO  [alembic.env] Imported model module: app.models.models
INFO  [alembic.env] Imported model module: app.models.permission
INFO  [alembic.env] Imported model module: app.models.pricing_snapshot
INFO  [alembic.env] Imported model module: app.models.product
INFO  [alembic.env] Imported model module: app.models.product_category
INFO  [alembic.env] Imported model module: app.models.recipe
INFO  [alembic.env] Imported model module: app.models.reservation
INFO  [alembic.env] Imported model module: app.models.retention
INFO  [alembic.env] Imported model module: app.models.role
INFO  [alembic.env] Imported model module: app.models.statistics
INFO  [alembic.env] Imported model module: app.models.stripe_event
INFO  [alembic.env] Imported model module: app.models.subscription_tier
INFO  [alembic.env] Imported model module: app.models.unified_inventory_history
INFO  [alembic.env] Imported model module: app.models.unit
INFO  [alembic.env] Imported model module: app.models.user_preferences
INFO  [alembic.env] Imported model module: app.models.user_role_assignment
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 20251009_3 -> 20251009_2, Align models to own keep-list indexes, projections, and association table
INFO  [alembic.runtime.migration] Running downgrade 20251009_2 -> 20251009_1, Repair keep-list indexes/tables and add tier_included_addon
INFO  [alembic.runtime.migration] Running downgrade 20251009_1 -> 20251008_3, Add missing retention policy columns to subscription_tier
=== Removing retention policy columns from subscription_tier ===
✅ Dropped retention_policy from subscription_tier
✅ Dropped data_retention_days from subscription_tier
✅ Dropped retention_notice_days from subscription_tier
✅ Dropped storage_addon_retention_days from subscription_tier
✅ Dropped tier_type from subscription_tier
✅ Dropped billing_provider from subscription_tier
✅ Dropped stripe_lookup_key from subscription_tier
✅ Dropped stripe_storage_lookup_key from subscription_tier
✅ Dropped whop_product_key from subscription_tier
✅ Downgrade completed
INFO  [alembic.runtime.migration] Running downgrade 20251008_3 -> 20251008_2, Add optional GIN index on recipe.category_data for ad-hoc queries
INFO  [alembic.runtime.migration] Running downgrade 20251008_2 -> 20251008_1, Add generated columns for hot batch fields (from plan_snapshot.category_extension) and indexes
INFO  [alembic.runtime.migration] Running downgrade 20251008_1 -> 20251006_2, Add generated columns for hot recipe fields and basic indexes
INFO  [alembic.runtime.migration] Running downgrade 20251006_2 -> 20251006_1, Add ui_config JSON column to product_category
INFO  [alembic.runtime.migration] Running downgrade 20251006_1 -> 20251001_2, Add category_data JSON column to recipe table
INFO  [alembic.runtime.migration] Running downgrade 20251001_2 -> 20251001_1, add function_key and retention_extension_days to addon
=== Removing function_key and retention_extension_days from addon ===
✅ Dropped retention_extension_days from addon
✅ Dropped function_key from addon
✅ Addon fields downgrade completed
INFO  [alembic.runtime.migration] Running downgrade 20251001_1 -> 20250930_5, add addon models and tier allowed addons
=== Removing addon table and tier allowed addons ===
✅ Removed allowed_addon_keys from subscription_tier
✅ Dropped addon table
✅ Addon models and tier allowed addons downgrade completed
INFO  [alembic.runtime.migration] Running downgrade 20250930_5 -> 20250930_4, Set default visibility flags for global ingredient categories
Resetting all category visibility flags to False...
✅ Category visibility flags reset!
INFO  [alembic.runtime.migration] Running downgrade 20250930_4 -> 20250930_3, Add visibility control fields for soap-making attributes to ingredient categories
=== Removing visibility control fields from ingredient_category ===
✅ Dropped show_comedogenic_rating from ingredient_category
✅ Dropped show_shelf_life_months from ingredient_category
✅ Dropped show_moisture_content from ingredient_category
✅ Dropped show_ph_value from ingredient_category
✅ Dropped show_flash_point from ingredient_category
✅ Dropped show_melting_point from ingredient_category
✅ Dropped show_iodine_value from ingredient_category
✅ Dropped show_saponification_value from ingredient_category
✅ Visibility control fields removal completed
INFO  [alembic.runtime.migration] Running downgrade 20250930_3 -> 20250930_2, Add soap making and cosmetic formulation attributes to global_item table
=== Removing soap making and cosmetic formulation fields from global_item ===
Removing soap making fields from global_item...
  ✅ Removed comedogenic_rating from global_item
  ✅ Removed shelf_life_months from global_item
  ✅ Removed moisture_content_percent from global_item
  ✅ Removed ph_value from global_item
  ✅ Removed flash_point_c from global_item
  ✅ Removed melting_point_c from global_item
  ✅ Removed iodine_value from global_item
  ✅ Removed saponification_value from global_item
✅ Soap making and cosmetic formulation fields downgrade for global_item completed
INFO  [alembic.runtime.migration] Running downgrade 20250930_2 -> 20250930_1, Add soap making and cosmetic formulation attributes to inventory items
=== Removing soap making and cosmetic formulation fields from inventory items ===
Removing soap making fields from inventory_item...
  ✅ Removed comedogenic_rating from inventory_item
  ✅ Removed shelf_life_months from inventory_item
  ✅ Removed moisture_content_percent from inventory_item
  ✅ Removed ph_value from inventory_item
  ✅ Removed flash_point_c from inventory_item
  ✅ Removed melting_point_c from inventory_item
  ✅ Removed iodine_value from inventory_item
  ✅ Removed saponification_value from inventory_item
✅ Soap making and cosmetic formulation fields downgrade completed
INFO  [alembic.runtime.migration] Running downgrade 20250930_1 -> 20250925_04, Add global_item_alias table and performance indexes
INFO  [alembic.runtime.migration] Running downgrade 20250925_04 -> 20250925_03, Add container structured attributes to inventory_item and global_item
Dropped column container_shape from inventory_item
Dropped column container_closure_type from inventory_item
Dropped column container_color from inventory_item
Dropped column container_dimensions from inventory_item
Dropped column container_volume_unit from inventory_item
Dropped column container_volume from inventory_item
Dropped column container_material from inventory_item
Dropped column container_shape from global_item
Dropped column container_closure_type from global_item
Dropped column container_color from global_item
Dropped column container_dimensions from global_item
Dropped column container_volume_unit from global_item
Dropped column container_volume from global_item
Dropped column container_material from global_item
INFO  [alembic.runtime.migration] Running downgrade 20250925_03 -> 20250925_02, Add portion_unit_id FK to recipe and batch
Dropped column portion_unit_id from recipe
Dropped column portion_unit_id from batch
INFO  [alembic.runtime.migration] Running downgrade 20250925_02 -> 20250925_01, Add plan_snapshot JSON to batch
Dropped column plan_snapshot from batch
INFO  [alembic.runtime.migration] Running downgrade 20250925_01 -> 20250924_01, Add portion columns to recipe and batch: is_portioned, portion_name, counts
Dropped column counts from batch
Dropped column portion_name from batch
Dropped column is_portioned from batch
Dropped column counts from recipe
Dropped column portion_name from recipe
Dropped column is_portioned from recipe
INFO  [alembic.runtime.migration] Running downgrade 20250924_01 -> 20250923_04, Drop Product.base_unit column
INFO  [alembic.runtime.migration] Running downgrade 20250923_04 -> 20250923_03, Add sku_name_template to product_category
✅ Dropped sku_name_template from product_category
INFO  [alembic.runtime.migration] Running downgrade 20250923_03 -> 20250923_02, Add portioning_data JSON to recipe and batch
INFO  [alembic.runtime.migration] Running downgrade 20250923_02 -> 20250923_01, Add category_id to product and recipe, backfill to Uncategorized, set NOT NULL
INFO  [alembic.runtime.migration] Running downgrade 20250923_01 -> 20250922_02, Create product_category table
=== Dropping product_category table ===
Dropped ix_product_category_name
Dropped ix_product_category_organization_id
✅ Dropped product_category table
✅ Downgrade completed
INFO  [alembic.runtime.migration] Running downgrade 20250922_02 -> 20250922_01_align_extras, Add inventory cost method toggle and valuation method fields
=== Reverting inventory cost method toggle and valuation method fields ===
Dropped cost_method_locked_at from batch
Dropped cost_method from batch
Dropped valuation_method from unified_inventory_history
Dropped inventory_cost_method_changed_at from organization
Dropped inventory_cost_method from organization
✅ Downgrade completed successfully
INFO  [alembic.runtime.migration] Running downgrade 20250922_01_align_extras -> d953779b55a3, Align naming for extras and ensure consumable tables and indexes exist
INFO  [alembic.runtime.migration] Running downgrade d953779b55a3 -> 20250912_01, empty message
=== Removing stripe_event table ===
   Dropping stripe_event table...
   ✅ stripe_event table dropped successfully
      Creating index 'ix_user_organization_id' on table 'user'...
      ✅ Index 'ix_user_organization_id' created on table 'user'.
      ⚠️ Index 'uq_subscription_tier_stripe_storage_lookup_key' does not exist on table 'subscription_tier', skipping drop.
      ⚠️ Column 'stripe_storage_lookup_key' does not exist in table 'subscription_tier', skipping drop.
      ⚠️ Column 'storage_addon_retention_days' does not exist in table 'subscription_tier', skipping drop.
      ⚠️ Column 'retention_notice_days' does not exist in table 'subscription_tier', skipping drop.
      ⚠️ Column 'data_retention_days' does not exist in table 'subscription_tier', skipping drop.
      Creating index 'idx_recipe_stats_org' on table 'recipe_stats'...
      ✅ Index 'idx_recipe_stats_org' created on table 'recipe_stats'.
      Creating index 'ix_recipe_consumable_organization_id' on table 'recipe_consumable'...
      ✅ Index 'ix_recipe_consumable_organization_id' created on table 'recipe_consumable'.
      Dropping column 'updated_at' from table 'recipe'...
      ✅ Column 'updated_at' dropped from table 'recipe'.
      Dropping column 'created_at' from table 'recipe'...
      ✅ Column 'created_at' dropped from table 'recipe'.
      Creating index 'ix_inventory_item_inventory_category_id' on table 'inventory_item'...
      ✅ Index 'ix_inventory_item_inventory_category_id' created on table 'inventory_item'.
      Creating index 'idx_inventory_efficiency_org' on table 'inventory_efficiency_stats'...
      ✅ Index 'idx_inventory_efficiency_org' created on table 'inventory_efficiency_stats'.
      Creating index 'idx_change_log_type_date' on table 'inventory_change_log'...
      ✅ Index 'idx_change_log_type_date' created on table 'inventory_change_log'.
      Creating index 'idx_change_log_item_date' on table 'inventory_change_log'...
      ✅ Index 'idx_change_log_item_date' created on table 'inventory_change_log'.
      Creating index 'ix_global_item_is_archived' on table 'global_item'...
      ✅ Index 'ix_global_item_is_archived' created on table 'global_item'.
      Adding column 'suggested_inventory_category_id' to table 'global_item'...
      ✅ Column 'suggested_inventory_category_id' added to table 'global_item'.
      Dropping index 'ix_freshness_snapshot_snapshot_date' from table 'freshness_snapshot'...
      ✅ Index 'ix_freshness_snapshot_snapshot_date' dropped from table 'freshness_snapshot'.
      Dropping index 'ix_freshness_snapshot_organization_id' from table 'freshness_snapshot'...
      ✅ Index 'ix_freshness_snapshot_organization_id' dropped from table 'freshness_snapshot'.
      Dropping index 'ix_freshness_snapshot_inventory_item_id' from table 'freshness_snapshot'...
      ✅ Index 'ix_freshness_snapshot_inventory_item_id' dropped from table 'freshness_snapshot'.
      Creating index 'ix_freshness_snapshot_org' on table 'freshness_snapshot'...
      ✅ Index 'ix_freshness_snapshot_org' created on table 'freshness_snapshot'.
      Creating index 'ix_freshness_snapshot_item' on table 'freshness_snapshot'...
      ✅ Index 'ix_freshness_snapshot_item' created on table 'freshness_snapshot'.
      Creating index 'ix_freshness_snapshot_date' on table 'freshness_snapshot'...
      ✅ Index 'ix_freshness_snapshot_date' created on table 'freshness_snapshot'.
      Dropping index 'ix_domain_event_entity_id' from table 'domain_event'...
      ✅ Index 'ix_domain_event_entity_id' dropped from table 'domain_event'.
      Dropping index 'ix_domain_event_entity_type' from table 'domain_event'...
      ✅ Index 'ix_domain_event_entity_type' dropped from table 'domain_event'.
      Dropping index 'ix_domain_event_organization_id' from table 'domain_event'...
      ✅ Index 'ix_domain_event_organization_id' dropped from table 'domain_event'.
      Dropping index 'ix_domain_event_user_id' from table 'domain_event'...
      ✅ Index 'ix_domain_event_user_id' dropped from table 'domain_event'.
      Creating index 'ix_domain_event_user' on table 'domain_event'...
      ✅ Index 'ix_domain_event_user' created on table 'domain_event'.
      Creating index 'ix_domain_event_org' on table 'domain_event'...
      ✅ Index 'ix_domain_event_org' created on table 'domain_event'.
      Creating index 'ix_domain_event_entity' on table 'domain_event'...
      ✅ Index 'ix_domain_event_entity' created on table 'domain_event'.
      Creating index 'idx_batch_stats_recipe' on table 'batch_stats'...
      ✅ Index 'idx_batch_stats_recipe' created on table 'batch_stats'.
      Creating index 'idx_batch_stats_org' on table 'batch_stats'...
      ✅ Index 'idx_batch_stats_org' created on table 'batch_stats'.
   Dropping retention_deletion_queue table...
   ✅ retention_deletion_queue table dropped successfully
   Dropping storage_addon_subscription table...
   ✅ storage_addon_subscription table dropped successfully
   Dropping storage_addon_purchase table...
   ✅ storage_addon_purchase table dropped successfully
INFO  [alembic.runtime.migration] Running downgrade 20250912_01 -> 20250913014500, Add domain_event and freshness_snapshot tables
INFO  [alembic.runtime.migration] Running downgrade 20250913014500 -> 20250911_06, rename is_reference_category to is_global_category
🔄 Reverting is_global_category to is_reference_category...
✅ Successfully reverted to is_reference_category
INFO  [alembic.runtime.migration] Running downgrade 20250911_06 -> 20250911_05, Fix inventory item name constraint to be organization-scoped
=== REVERTING INVENTORY CONSTRAINT CHANGES ===
Dropped organization+name constraint
Recreated global name constraint
=== INVENTORY CONSTRAINT REVERT COMPLETE ===
INFO  [alembic.runtime.migration] Running downgrade 20250911_05 -> 20250911_04, Add missing timestamp columns to global_item
Removed updated_at column from global_item
Removed created_at column from global_item
INFO  [alembic.runtime.migration] Running downgrade 20250911_04 -> 20250911_03, Add missing timestamp columns to ingredient_category
Removed updated_at column from ingredient_category
Removed created_at column from ingredient_category
INFO  [alembic.runtime.migration] Running downgrade 20250911_03 -> 20250911_02, Remove reference_category field from global_item table
INFO  [alembic.runtime.migration] Running downgrade 20250911_02 -> 20250911_01, Add reference_category field to global_item table
✅ Dropped index on reference_category
✅ Dropped reference_category column
INFO  [alembic.runtime.migration] Running downgrade 20250911_01 -> 20250908_01, cleanup redundant category fields
🔄 Restoring reference_category_name field...
   Adding reference_category_name back to ingredient_category table...
   ✅ Restored reference_category_name to ingredient_category table
✅ Downgrade completed
INFO  [alembic.runtime.migration] Running downgrade 20250908_01 -> 2025090502, Add organization_id column to recipe_consumable table
INFO  [alembic.runtime.migration] Running downgrade 2025090502 -> 20250906_01, Add consumables tables for recipes and batches
=== Removing consumables tables ===
   Dropping extra_batch_consumable table...
   ✅ Dropped extra_batch_consumable table
   Dropping batch_consumable table...
   ✅ Dropped batch_consumable table
   Dropping recipe_consumable table...
   ✅ Dropped recipe_consumable table
✅ Consumables downgrade completed successfully
INFO  [alembic.runtime.migration] Running downgrade 20250906_01 -> 20250905_01, Add foreign key from global_item to ingredient_category
=== Removing ingredient_category_id from global_item ===
   Removing foreign key constraint and column...
   ✅ Dropped foreign key constraint
   ✅ Dropped index
   ✅ Dropped ingredient_category_id column
✅ Downgrade completed successfully
INFO  [alembic.runtime.migration] Running downgrade 20250905_01 -> 20250904_04a, Add soft-delete fields to global_item and ownership to inventory_item
Reversing global_item soft-delete and inventory_item ownership migration...
Removing ownership changes from inventory_item...
  Dropping ownership index...
  Dropping ownership column...
Removing soft-delete changes from global_item...
  Dropping is_archived index...
  Dropping archived_by column...
  Dropping archived_at column...
  Dropping is_archived column...
✅ Downgrade completed successfully!
INFO  [alembic.runtime.migration] Running downgrade 20250904_04a -> 20250904_04, Add reference_category to global_item
Traceback (most recent call last):
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/render/project/src/.venv/bin/flask", line 8, in <module>
    sys.exit(main())
             ~~~~^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/cli.py", line 1129, in main
    cli.main()
    ~~~~~~~~^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 1082, in main
    rv = self.invoke(ctx)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 1697, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
                           ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 1697, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
                           ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 1443, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 788, in invoke
    return __callback(*args, **kwargs)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/decorators.py", line 33, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/cli.py", line 400, in decorator
    return ctx.invoke(f, *args, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 788, in invoke
    return __callback(*args, **kwargs)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_migrate/cli.py", line 168, in downgrade
    _downgrade(directory, revision, sql, tag, x_arg)
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_migrate/__init__.py", line 111, in wrapped
    f(*args, **kwargs)
    ~^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_migrate/__init__.py", line 210, in downgrade
    command.downgrade(config, revision, sql=sql, tag=tag)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/command.py", line 455, in downgrade
    script.run_env()
    ~~~~~~~~~~~~~~^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/script/base.py", line 586, in run_env
    util.load_python_file(self.dir, "env.py")
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/util/pyfiles.py", line 95, in load_python_file
    module = load_module_py(module_id, path)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/util/pyfiles.py", line 113, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 1026, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/opt/render/project/src/migrations/env.py", line 147, in <module>
    run_migrations_online()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/render/project/src/migrations/env.py", line 141, in run_migrations_online
    context.run_migrations()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 8, in run_migrations
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/runtime/environment.py", line 946, in run_migrations
    self.get_context().run_migrations(**kw)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/runtime/migration.py", line 630, in run_migrations
    head_maintainer.update_to_step(step)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/runtime/migration.py", line 862, in update_to_step
    self._update_version(from_, to_)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/runtime/migration.py", line 797, in _update_version
    ret = self.context.impl._exec(
        self.context._version.update()
    ...<4 lines>...
        )
    )
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/ddl/impl.py", line 246, in _exec
    return conn.execute(construct, params)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: UPDATE alembic_version SET version_num='20250904_04' WHERE alembic_version.version_num = '20250904_04a']
(Background on this error at: https://sqlalche.me/e/20/2j85)
render@srv-d21alungi27c73dn1440-85f5d859f5-52jjl:~/project/src$ flask db upgrade
/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_limiter/extension.py:333: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(

=== Blueprint Registration Summary ===
✅ Successful: 29
   - Authentication
   - Admin
   - Developer
   - Inventory
   - Recipes
   - Batches
   - Organization
   - Billing
   - Settings
   - Timers
   - Expiration
   - Conversion
   - Products Main
   - Public API
   - Main API
   - Drawer Actions
   - Density Reference
   - Retention Drawer API
   - Global Link Drawer API
   - App Routes
   - Legal Routes
   - Bulk Stock
   - Fault Log
   - Tag Manager
   - Global Library Public
   - Waitlist
   - Public Tools
   - Production Planning
   - Exports

🎉 All blueprints registered successfully!
INFO  [alembic.env] Imported model module: app.models.addon
INFO  [alembic.env] Imported model module: app.models.batch
INFO  [alembic.env] Imported model module: app.models.billing_snapshot
INFO  [alembic.env] Imported model module: app.models.category
INFO  [alembic.env] Imported model module: app.models.developer_permission
INFO  [alembic.env] Imported model module: app.models.developer_role
INFO  [alembic.env] Imported model module: app.models.domain_event
INFO  [alembic.env] Imported model module: app.models.freshness_snapshot
INFO  [alembic.env] Imported model module: app.models.global_item
INFO  [alembic.env] Imported model module: app.models.global_item_alias
INFO  [alembic.env] Imported model module: app.models.inventory
INFO  [alembic.env] Imported model module: app.models.inventory_lot
INFO  [alembic.env] Imported model module: app.models.mixins
INFO  [alembic.env] Imported model module: app.models.models
INFO  [alembic.env] Imported model module: app.models.permission
INFO  [alembic.env] Imported model module: app.models.pricing_snapshot
INFO  [alembic.env] Imported model module: app.models.product
INFO  [alembic.env] Imported model module: app.models.product_category
INFO  [alembic.env] Imported model module: app.models.recipe
INFO  [alembic.env] Imported model module: app.models.reservation
INFO  [alembic.env] Imported model module: app.models.retention
INFO  [alembic.env] Imported model module: app.models.role
INFO  [alembic.env] Imported model module: app.models.statistics
INFO  [alembic.env] Imported model module: app.models.stripe_event
INFO  [alembic.env] Imported model module: app.models.subscription_tier
INFO  [alembic.env] Imported model module: app.models.unified_inventory_history
INFO  [alembic.env] Imported model module: app.models.unit
INFO  [alembic.env] Imported model module: app.models.user_preferences
INFO  [alembic.env] Imported model module: app.models.user_role_assignment
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade 20250904_04a -> 20250905_01, Add soft-delete fields to global_item and ownership to inventory_item
Starting global_item soft-delete and inventory_item ownership migration...
Adding soft-delete columns to global_item...
  Adding is_archived column...
  Adding archived_at column...
  Adding archived_by column...
  Creating index on is_archived...
Adding ownership column to inventory_item...
  Adding ownership column...
  Creating index on ownership...
  Backfilling ownership values...
    All inventory items already have ownership values
✅ Migration completed successfully!
INFO  [alembic.runtime.migration] Running upgrade 20250905_01 -> 20250906_01, Add foreign key from global_item to ingredient_category
=== Adding ingredient_category_id to global_item ===
   Adding ingredient_category_id column...
   ✅ Added ingredient_category_id column
   Adding index...
   ✅ Added index
   Adding foreign key constraint...
   ✅ Added foreign key constraint
✅ Migration completed successfully
INFO  [alembic.runtime.migration] Running upgrade 20250906_01 -> 2025090502, Add consumables tables for recipes and batches
=== Adding consumables tables ===
   Creating recipe_consumable table...
   ✅ Created recipe_consumable table
   Creating batch_consumable table...
   ✅ Created batch_consumable table
   Creating extra_batch_consumable table...
   ✅ Created extra_batch_consumable table
✅ Consumables migration completed successfully
INFO  [alembic.runtime.migration] Running upgrade 2025090502 -> 20250908_01, Add organization_id column to recipe_consumable table
   Adding organization_id column to recipe_consumable...
✅ Added organization_id column and foreign key to recipe_consumable
INFO  [alembic.runtime.migration] Running upgrade 20250908_01 -> 20250911_01, cleanup redundant category fields
🧹 Cleaning up redundant category fields...
   Removing redundant reference_category_name from ingredient_category table...
   ✅ Removed reference_category_name from ingredient_category table
   Ensuring all global items have reference_category values...
   ⚠️  Could not set default reference_category values: (psycopg2.errors.UndefinedColumn) column "reference_category" does not exist
LINE 7:                 WHERE reference_category IS NULL
                              ^

[SQL: 
                UPDATE global_item 
                SET reference_category = COALESCE(
                    (SELECT ingredient_category.name FROM ingredient_category WHERE ingredient_category.id = global_item.ingredient_category_id),
                    'Miscellaneous'
                )
                WHERE reference_category IS NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
✅ Category field cleanup completed
Traceback (most recent call last):
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/render/project/src/.venv/bin/flask", line 8, in <module>
    sys.exit(main())
             ~~~~^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/cli.py", line 1129, in main
    cli.main()
    ~~~~~~~~^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 1082, in main
    rv = self.invoke(ctx)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 1697, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
                           ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 1697, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
                           ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 1443, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 788, in invoke
    return __callback(*args, **kwargs)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/decorators.py", line 33, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/cli.py", line 400, in decorator
    return ctx.invoke(f, *args, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/click/core.py", line 788, in invoke
    return __callback(*args, **kwargs)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_migrate/cli.py", line 150, in upgrade
    _upgrade(directory, revision, sql, tag, x_arg)
    ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_migrate/__init__.py", line 111, in wrapped
    f(*args, **kwargs)
    ~^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask_migrate/__init__.py", line 200, in upgrade
    command.upgrade(config, revision, sql=sql, tag=tag)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/command.py", line 408, in upgrade
    script.run_env()
    ~~~~~~~~~~~~~~^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/script/base.py", line 586, in run_env
    util.load_python_file(self.dir, "env.py")
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/util/pyfiles.py", line 95, in load_python_file
    module = load_module_py(module_id, path)
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/util/pyfiles.py", line 113, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 1026, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/opt/render/project/src/migrations/env.py", line 147, in <module>
    run_migrations_online()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/render/project/src/migrations/env.py", line 141, in run_migrations_online
    context.run_migrations()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 8, in run_migrations
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/runtime/environment.py", line 946, in run_migrations
    self.get_context().run_migrations(**kw)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/runtime/migration.py", line 630, in run_migrations
    head_maintainer.update_to_step(step)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/runtime/migration.py", line 862, in update_to_step
    self._update_version(from_, to_)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/runtime/migration.py", line 797, in _update_version
    ret = self.context.impl._exec(
        self.context._version.update()
    ...<4 lines>...
        )
    )
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/alembic/ddl/impl.py", line 246, in _exec
    return conn.execute(construct, params)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: UPDATE alembic_version SET version_num='20250911_01' WHERE alembic_version.version_num = '20250908_01']
(Background on this error at: https://sqlalche.me/e/20/2j85)
render@srv-d21alungi27c73dn1440-85f5d859f5-52jjl:~/project/src$ 