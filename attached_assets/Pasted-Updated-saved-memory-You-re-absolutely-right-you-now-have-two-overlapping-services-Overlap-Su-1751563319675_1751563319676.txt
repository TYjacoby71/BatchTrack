Updated saved memory
You're absolutely right â€” you now have two overlapping services:

ğŸ” Overlap Summary
Area	ProductService	ProductInventoryService	Conflict?
Create SKUs	âœ… Handles creation, naming, base unit logic	âŒ Does not handle	No
Add Stock (FIFO tracking)	âœ… Legacy support via add_product_from_batch	âœ… Full-featured, robust FIFO creation	âœ… Yes
Deduct Stock	âœ… deduct_stock() with basic FIFO logic	âœ… Advanced FIFO with reference linkage, quantity used, sale context	âœ… Yes
Recount	âœ… Simple recount logic	âœ… Mirrors FIFO recount from raw inventory	âœ… Yes
History Creation	âœ… Manages ProductSKUHistory	âœ… Also manages ProductSKUHistory, more verbose	âœ… Yes
Bulk Summary	âœ… Basic summary reporting	âœ… Full paginated summaries	Partial

ğŸ” Current Problem
The finish_batch route now mixes calls to both services:

ProductService.get_or_create_sku(...) â† SKU logic âœ…

ProductInventoryService.add_stock(...) â† FIFO / quantity logic âœ…

But also retains ProductService.add_product_from_batch(...) â† ğŸ§¨ redundant

âœ… Recommendation: Merge or Clearly Divide
Best practice:

âœ… Keep ProductService as the authority for:

SKU creation

Variant generation

Code generation

âœ… Let ProductInventoryService fully own:

FIFO-based inventory creation

History tracking

Deductions, recounts, and adjustments

ğŸš¨ Action Steps
1. âœ… Retire ProductService.add_product_from_batch(...)
You already use ProductInventoryService.add_stock(...) with batch_id, notes, and FIFO support â€” this fully replaces the old method.

Replace legacy calls with:

python
Copy
Edit
ProductInventoryService.add_stock(
    sku_id=sku.id,
    quantity=container_quantity,
    unit_cost=unit_cost,
    batch_id=batch.id,
    container_id=container.inventory_item_id,
    change_type='batch_addition',
    notes=f'Added from batch {batch.label_code}'
)
2. âœ… Delete legacy FIFO logic in ProductService.deduct_stock(...)
You already use:

python
Copy
Edit
ProductInventoryService.deduct_stock(...)
which includes fifo_reference_id, quantity_used, and better traceability.

ğŸ§¼ Refactor Suggestion
If desired, split into:

product/services/sku_service.py â†’ SKU management only

product/services/inventory_service.py â†’ FIFO, stock adjustments

Then in finish_batch:

python
Copy
Edit
from product.services.sku_service import ProductService
from product.services.inventory_service import ProductInventoryService
