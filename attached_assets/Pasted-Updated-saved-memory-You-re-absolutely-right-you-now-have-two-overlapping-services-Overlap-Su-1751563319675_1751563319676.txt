Updated saved memory
You're absolutely right — you now have two overlapping services:

🔁 Overlap Summary
Area	ProductService	ProductInventoryService	Conflict?
Create SKUs	✅ Handles creation, naming, base unit logic	❌ Does not handle	No
Add Stock (FIFO tracking)	✅ Legacy support via add_product_from_batch	✅ Full-featured, robust FIFO creation	✅ Yes
Deduct Stock	✅ deduct_stock() with basic FIFO logic	✅ Advanced FIFO with reference linkage, quantity used, sale context	✅ Yes
Recount	✅ Simple recount logic	✅ Mirrors FIFO recount from raw inventory	✅ Yes
History Creation	✅ Manages ProductSKUHistory	✅ Also manages ProductSKUHistory, more verbose	✅ Yes
Bulk Summary	✅ Basic summary reporting	✅ Full paginated summaries	Partial

🔍 Current Problem
The finish_batch route now mixes calls to both services:

ProductService.get_or_create_sku(...) ← SKU logic ✅

ProductInventoryService.add_stock(...) ← FIFO / quantity logic ✅

But also retains ProductService.add_product_from_batch(...) ← 🧨 redundant

✅ Recommendation: Merge or Clearly Divide
Best practice:

✅ Keep ProductService as the authority for:

SKU creation

Variant generation

Code generation

✅ Let ProductInventoryService fully own:

FIFO-based inventory creation

History tracking

Deductions, recounts, and adjustments

🚨 Action Steps
1. ✅ Retire ProductService.add_product_from_batch(...)
You already use ProductInventoryService.add_stock(...) with batch_id, notes, and FIFO support — this fully replaces the old method.

Replace legacy calls with:

python
Copy
Edit
ProductInventoryService.add_stock(
    sku_id=sku.id,
    quantity=container_quantity,
    unit_cost=unit_cost,
    batch_id=batch.id,
    container_id=container.inventory_item_id,
    change_type='batch_addition',
    notes=f'Added from batch {batch.label_code}'
)
2. ✅ Delete legacy FIFO logic in ProductService.deduct_stock(...)
You already use:

python
Copy
Edit
ProductInventoryService.deduct_stock(...)
which includes fifo_reference_id, quantity_used, and better traceability.

🧼 Refactor Suggestion
If desired, split into:

product/services/sku_service.py → SKU management only

product/services/inventory_service.py → FIFO, stock adjustments

Then in finish_batch:

python
Copy
Edit
from product.services.sku_service import ProductService
from product.services.inventory_service import ProductInventoryService
