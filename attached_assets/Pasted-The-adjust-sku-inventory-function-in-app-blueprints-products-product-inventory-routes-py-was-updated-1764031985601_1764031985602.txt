The adjust_sku_inventory function in app/blueprints/products/product_inventory_routes.py was updated. The process_inventory_adjustment call now passes target_quantity when change_type is 'recount'. This ensures the central adjustment service clamps the master inventory_item.quantity to the recounted value. This change aligns product recounts with standard inventory adjustments, preventing FIFO validation failures that previously occurred because only lots were updated, not the overall item quantity.

can you find the error in the product recount function? it should use the exact same system as the other inventroy. but there is a fifo sync error in the way. why only with products?

im pretty sure it is because the rcount isnt set up to work with lots
Explored
 
1 file
 
1 search
Product recount requests now send the target quantity to the central adjustment service so it can clamp the master inventory_item.quantity to the same value after FIFO lots are reconciled. This brings the product recount flow in line with the standard inventory edit route and prevents FIFO validation failures that happened because only the lots were updated.

            result = process_inventory_adjustment(
                item_id=inventory_item_id,
                quantity=quantity,
                change_type=change_type,
                unit=unit,
                notes=notes,
                created_by=current_user.id,
                customer=customer,
                sale_price=sale_price,
                order_id=order_id,
                cost_override=cost_override,
                custom_expiration_date=custom_expiration_date,
                custom_shelf_life_days=custom_shelf_life_days,
                target_quantity=quantity if change_type == 'recount' else None
            )
Without this parameter, _core.process_inventory_adjustment never rewrote item.quantity for product recounts (it only does so when target_quantity is provided), so the item total stayed at the old value while the FIFO lots reflected the new countâ€”hence FIFO sync errors that appeared only in product recounts.

Tests not run (not requested). Consider exercising a product recount end-to-end to confirm FIFO validation now passes.

can you find the error in the product recount function? it should use the exact same system as the other inventroy. but there is a fifo sync error in the way. why only with products?

im pretty sure it is because the rcount isnt set up to work with lots