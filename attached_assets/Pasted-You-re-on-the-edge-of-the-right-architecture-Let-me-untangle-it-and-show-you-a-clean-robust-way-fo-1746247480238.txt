You're on the edge of the right architecture. Let me untangle it and show you a clean, robust way forward — the "snap and restore" model.

🧠 Key Insight: Ingredients and Containers ≠ Form Fields
They are not like notes or tags.
They are event-based additions to the batch. Once added, they don’t need to stay as editable rows — they need to transform into data.

✅ Suggested Architecture: Snapshot-Centric Flow
🎯 Step 1: Treat Extra Ingredients/Containers as Actions, Not Form Fields
Add a container or ingredient → appends to snapshot.extra_ingredients or snapshot.extra_containers

After that:

✅ They disappear from the form

✅ They appear in the Batch Summary section

🎯 Step 2: Save Button Behavior
Collect flat fields like notes, tags, output_type

Do not reload dynamic form rows — just update the snapshot object in the DB

json
Copy
Edit
"recipe_snapshot": {
  "notes": "This is a test batch",
  "output_type": "ingredient",
  "extra_ingredients": [
    { "id": 2, "quantity": 3, "unit": "oz" }
  ],
  "extra_containers": [
    { "id": 5, "quantity": 2, "cost": 0.35 }
  ]
}
🎯 Step 3: Summary Loads Everything
recipe_snapshot + static recipe → Batch Summary

Rows for:

Recipe ingredients

Extra ingredients

Containers used

No more re-rendering form fields. Just show the outcome.

🧼 Should You Move Output Type and Yield to the Final Step?
Yes. 100%. Here's why:

Page	Focus
🟡 Batch In Progress	Handle in-process data capture: notes, additions, timer
🟢 Complete Batch	Final decision: what was produced (product vs sub-ingredient), how much, what unit, what container
🔁 Cancel/Fail Batch	Use snapshot + current state to reverse inventory or log nothing

It mirrors how production works IRL — you don’t always know what your yield will be until the end.

✅ Refactor Plan
Action	Detail
✅ Remove form rows for “extra ingredients” and “containers”	
✅ Replace with buttons: Add Ingredient, Add Container	
✅ Add JS functions to push entries to a snapshot object	
✅ On Save: POST snapshot + flat fields	
✅ On Page Load: render summary from snapshot	
✅ Move output type, quantity, variant to the complete_batch() flow	

