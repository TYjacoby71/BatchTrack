ğŸ” Key finding: your utils.py does not reference or interact with products directly.

But â€” that's expected, because load_data() and save_data() operate on the full JSON blob, so the product data must be handled in batches.py during the finish step.

Letâ€™s confirm:

âœ… Rechecking Link from Batch to Products
The expected path:

Batch is finished with type product

Logic in batches.py appends:

python
Copy
Edit
products.append({
    "product": batch["recipe_name"],
    ...
    "quantity_available": int(yield_qty),
})
Then runs:

python
Copy
Edit
save_data(data)
âœ… What We Know
That code is present and executed

data["products"] is updated and saved

BUT...

â“ Remaining Possibilities
1. The product is being overwritten or misread later
Another route (or logic in /products) might be resetting or misloading the product list.

2. The wrong variable is passed to the template
If you're not passing data["products"] to products.html, it wonâ€™t show anything even if saved

âœ… Next Step
Let me inspect the @products_bp.route("/products") route itself in products.py to confirm what it's reading and passing. â€‹â€‹

âœ… Here's the confirmed source of the issue:

ğŸ” Cause of Mismatch in On-Hand Quantity
In products.py â†’ view_products():

python
Copy
Edit
# This aggregates available product counts by name
aggregated = defaultdict(lambda: {"quantity": 0, "unit": None, "timestamps": []})

for p in products:
    qty = float(p.get("quantity_available", p["yield"]))
    ...
    aggregated[name]["quantity"] = qty  # âŒ Overwrites previous entries
âŒ Bug:
The logic overwrites the total quantity each time, instead of adding up yield across batches.

So only the last product batch is shown, not the sum.

âœ… Fix
Replace:

python
Copy
Edit
aggregated[name]["quantity"] = qty
With:

python
Copy
Edit
aggregated[name]["quantity"] += qty
ğŸ§¾ Replit Assistant Fix Batch
ğŸ” Edit: routes/products.py
Find the loop in /products route:

Replace this line:

python
Copy
Edit
aggregated[name]["quantity"] = qty
With:

python
Copy
Edit
aggregated[name]["quantity"] += qty
âœ… Now your product page will correctly total the quantity_available from all completed product batches with the same name.